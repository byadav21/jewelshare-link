{"version":3,"file":"PlanLimitWarning-BlkgAHMZ.js","sources":["../../src/components/PlanLimitWarning.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { AlertTriangle, TrendingUp } from \"lucide-react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\ninterface PlanLimits {\r\n  subscription_plan: 'starter' | 'professional' | 'enterprise' | 'essentials';\r\n  max_products: number;\r\n  max_share_links: number;\r\n  max_team_members: number;\r\n  max_product_images: number;\r\n}\r\n\r\ninterface Usage {\r\n  products_count: number;\r\n  share_links_count: number;\r\n}\r\n\r\nexport const PlanLimitWarning = () => {\r\n  const navigate = useNavigate();\r\n  const [limits, setLimits] = useState<PlanLimits | null>(null);\r\n  const [usage, setUsage] = useState<Usage | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetchLimitsAndUsage();\r\n  }, []);\r\n\r\n  const fetchLimitsAndUsage = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      // Fetch vendor permissions (includes limits)\r\n      const { data: permissions, error: permError } = await supabase\r\n        .from(\"vendor_permissions\")\r\n        .select(\"subscription_plan, max_products, max_share_links, max_team_members, max_product_images\")\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n\r\n      if (permError) throw permError;\r\n\r\n      // Fetch current usage\r\n      const { data: products, error: prodError } = await supabase\r\n        .from(\"products\")\r\n        .select(\"id\")\r\n        .eq(\"user_id\", user.id)\r\n        .is(\"deleted_at\", null);\r\n\r\n      if (prodError) throw prodError;\r\n\r\n      const { data: shareLinks, error: shareError } = await supabase\r\n        .from(\"share_links\")\r\n        .select(\"id\")\r\n        .eq(\"user_id\", user.id);\r\n\r\n      if (shareError) throw shareError;\r\n\r\n      setLimits(permissions);\r\n      setUsage({\r\n        products_count: products?.length || 0,\r\n        share_links_count: shareLinks?.length || 0,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error fetching limits:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading || !limits || !usage) return null;\r\n\r\n  // Calculate usage percentages\r\n  const productUsagePercent = (usage.products_count / limits.max_products) * 100;\r\n  const shareLinksUsagePercent = (usage.share_links_count / limits.max_share_links) * 100;\r\n\r\n  // Check if limits are exhausted (>= 100%)\r\n  const productExhausted = productUsagePercent >= 100 && limits.max_products !== 999999;\r\n  const shareLinksExhausted = shareLinksUsagePercent >= 100 && limits.max_share_links !== 999999;\r\n  \r\n  // Check if approaching limits (>= 80% but < 100%)\r\n  const productApproaching = productUsagePercent >= 80 && productUsagePercent < 100 && limits.max_products !== 999999;\r\n  const shareLinksApproaching = shareLinksUsagePercent >= 80 && shareLinksUsagePercent < 100 && limits.max_share_links !== 999999;\r\n\r\n  const isExhausted = productExhausted || shareLinksExhausted;\r\n  const isApproaching = productApproaching || shareLinksApproaching;\r\n\r\n  if (!isExhausted && !isApproaching) return null;\r\n\r\n  return (\r\n    <Alert className={isExhausted \r\n      ? \"border-destructive bg-destructive/10 dark:bg-destructive/20\" \r\n      : \"border-orange-500 bg-orange-50 dark:bg-orange-950/20\"\r\n    }>\r\n      <AlertTriangle className={isExhausted ? \"h-4 w-4 text-destructive\" : \"h-4 w-4 text-orange-600\"} />\r\n      <AlertTitle className={isExhausted \r\n        ? \"text-destructive dark:text-destructive\" \r\n        : \"text-orange-900 dark:text-orange-100\"\r\n      }>\r\n        {isExhausted ? \"Plan Limits Exhausted\" : \"Approaching Plan Limits\"}\r\n      </AlertTitle>\r\n      <AlertDescription className={isExhausted \r\n        ? \"text-destructive/90 dark:text-destructive/90 space-y-2\" \r\n        : \"text-orange-800 dark:text-orange-200 space-y-2\"\r\n      }>\r\n        {(productExhausted || productApproaching) && (\r\n          <p>\r\n            ðŸ“¦ Products: <strong>{usage.products_count}/{limits.max_products}</strong> used \r\n            ({Math.round(productUsagePercent)}%)\r\n            {productExhausted && <span className=\"ml-2 font-semibold\">- Limit Reached!</span>}\r\n          </p>\r\n        )}\r\n        {(shareLinksExhausted || shareLinksApproaching) && (\r\n          <p>\r\n            ðŸ”— Share Links: <strong>{usage.share_links_count}/{limits.max_share_links}</strong> used \r\n            ({Math.round(shareLinksUsagePercent)}%)\r\n            {shareLinksExhausted && <span className=\"ml-2 font-semibold\">- Limit Reached!</span>}\r\n          </p>\r\n        )}\r\n        {isExhausted && (\r\n          <p className=\"font-medium mt-2\">\r\n            You've reached your plan limit. Upgrade now to continue using this feature.\r\n          </p>\r\n        )}\r\n        <div className=\"flex gap-2 mt-3\">\r\n          <Button \r\n            size=\"sm\" \r\n            onClick={() => navigate(\"/pricing\")}\r\n            className={isExhausted \r\n              ? \"bg-destructive hover:bg-destructive/90\" \r\n              : \"bg-orange-600 hover:bg-orange-700\"\r\n            }\r\n          >\r\n            <TrendingUp className=\"mr-2 h-4 w-4\" />\r\n            Upgrade to {limits.subscription_plan === 'starter' ? 'Professional' : 'Enterprise'}\r\n          </Button>\r\n        </div>\r\n      </AlertDescription>\r\n    </Alert>\r\n  );\r\n};\r\n"],"names":["PlanLimitWarning","navigate","useNavigate","limits","setLimits","useState","usage","setUsage","loading","setLoading","useEffect","fetchLimitsAndUsage","user","supabase","permissions","permError","products","prodError","shareLinks","shareError","error","productUsagePercent","shareLinksUsagePercent","productExhausted","shareLinksExhausted","productApproaching","shareLinksApproaching","isExhausted","jsxs","Alert","jsx","AlertTriangle","AlertTitle","AlertDescription","Button","TrendingUp"],"mappings":"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"}