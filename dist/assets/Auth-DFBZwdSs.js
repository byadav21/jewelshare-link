import{j as e}from"./query-vendor-CIvqgC9B.js";import{r as f,u as W,i as z}from"./react-vendor-BCzWReGx.js";import{l,C as G,t as V,x as H,y as Z,o as X,B as q}from"./index-DBHw7ps1.js";import{I as S}from"./input-CpEp8mrX.js";import{L as N}from"./label-Di_dI0OZ.js";import{C as D}from"./checkbox-UeKqwDGT.js";import{B as K}from"./badge-HmGNQ04n.js";import{j as w,af as k,l as $,d as Q,E as ee,u}from"./ui-vendor-B3Ur81tx.js";import{P as se}from"./progress-DER2Hipk.js";import{B as te}from"./BackToHomeButton-Vfa6cTYe.js";import{z as A}from"./index-ibl8YJur.js";import"./supabase-vendor-DJknrin8.js";import"./index-D6hZrTqZ.js";const ae=({password:i})=>{const C=()=>{const j={minLength:i.length>=8,hasUpperCase:/[A-Z]/.test(i),hasLowerCase:/[a-z]/.test(i),hasNumber:/[0-9]/.test(i),hasSpecial:/[!@#$%^&*(),.?":{}|<>]/.test(i)},b=Object.values(j).filter(Boolean).length;let v="Weak",d="destructive";return b===5?(v="Strong",d="success"):b>=3&&(v="Medium",d="warning"),{score:b,label:v,color:d,requirements:j}};if(!i)return null;const{score:h,label:F,color:r,requirements:m}=C(),g=h/5*100,_=()=>g>=80?"bg-green-500":g>=60?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Password Strength:"}),e.jsx("span",{className:`font-medium ${r==="success"?"text-green-600":r==="warning"?"text-yellow-600":"text-red-600"}`,children:F})]}),e.jsx(se,{value:g,className:"h-2",children:e.jsx("div",{className:`h-full transition-all rounded-full ${_()}`,style:{width:`${g}%`}})})]}),e.jsxs("div",{className:"space-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m.minLength?e.jsx(w,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(k,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:m.minLength?"text-green-600":"text-muted-foreground",children:"At least 8 characters"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.hasUpperCase?e.jsx(w,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(k,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:m.hasUpperCase?"text-green-600":"text-muted-foreground",children:"One uppercase letter"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.hasLowerCase?e.jsx(w,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(k,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:m.hasLowerCase?"text-green-600":"text-muted-foreground",children:"One lowercase letter"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.hasNumber?e.jsx(w,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(k,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:m.hasNumber?"text-green-600":"text-muted-foreground",children:"One number"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.hasSpecial?e.jsx(w,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(k,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:m.hasSpecial?"text-green-600":"text-muted-foreground",children:"One special character (!@#$%^&*)"})]})]})]})},L=i=>i.length>=8&&/[A-Z]/.test(i)&&/[a-z]/.test(i)&&/[0-9]/.test(i)&&/[!@#$%^&*(),.?":{}|<>]/.test(i),re=A.string().trim().email({message:"Invalid email address"}).max(255),ne=A.string().min(8,{message:"Password must be at least 8 characters"}),ie=A.string().trim().min(10,{message:"Phone number must be at least 10 digits"}).max(15),we=()=>{const[i,C]=f.useState(""),[h,F]=f.useState(""),[r,m]=f.useState(!1),[g,_]=f.useState(!1),[j,b]=f.useState(["Jewellery"]),[v,d]=f.useState(!1),[B,U]=f.useState(!0),[P,R]=f.useState(""),[E,Y]=f.useState(""),x=W(),[J]=z(),a=J.get("plan")==="essentials";f.useEffect(()=>{(async()=>{const{data:{session:p}}=await l.auth.getSession();if(p){const{data:n}=await l.from("user_approval_status").select("status").eq("user_id",p.user.id).maybeSingle();if((n==null?void 0:n.status)==="approved"){const{data:c}=await l.from("user_roles").select("role").eq("user_id",p.user.id).maybeSingle();if((c==null?void 0:c.role)==="admin")x("/admin",{replace:!0});else{const{data:t}=await l.from("vendor_permissions").select("subscription_plan").eq("user_id",p.user.id).maybeSingle();(t==null?void 0:t.subscription_plan)==="essentials"?x("/calculators",{replace:!0}):x("/catalog",{replace:!0})}}else x("/pending-approval",{replace:!0})}})();const{data:{subscription:o}}=l.auth.onAuthStateChange((p,n)=>{p==="SIGNED_IN"&&n&&setTimeout(async()=>{const{data:c}=await l.from("user_approval_status").select("status").eq("user_id",n.user.id).maybeSingle();if((c==null?void 0:c.status)==="approved"){const{data:t}=await l.from("user_roles").select("role").eq("user_id",n.user.id).maybeSingle();if((t==null?void 0:t.role)==="admin")x("/admin",{replace:!0});else{const{data:y}=await l.from("vendor_permissions").select("subscription_plan").eq("user_id",n.user.id).maybeSingle();(y==null?void 0:y.subscription_plan)==="essentials"?x("/calculators",{replace:!0}):x("/catalog",{replace:!0})}}else x("/pending-approval",{replace:!0})},100)});return()=>o.unsubscribe()},[x]);const M=async s=>{s.preventDefault(),d(!0);try{const{error:o}=await l.auth.resetPasswordForEmail(i,{redirectTo:`${window.location.origin}/reset-password`});if(o)throw o;u.success("Password reset link sent to your email!"),_(!1),C("")}catch(o){u.error(o.message||"Failed to send reset email")}finally{d(!1)}},O=async s=>{s.preventDefault(),d(!0);try{const o=re.safeParse(i);if(!o.success){u.error(o.error.issues[0].message),d(!1);return}const p=ne.safeParse(h);if(!p.success){u.error(p.error.issues[0].message),d(!1);return}if(r){if(!L(h)){u.error("Password must include uppercase, lowercase, number, and special character"),d(!1);return}if(a){const t=ie.safeParse(P);if(!t.success){u.error(t.error.issues[0].message),d(!1);return}}const{data:n,error:c}=await l.auth.signUp({email:o.data,password:h,options:{emailRedirectTo:`${window.location.origin}/`}});if(c)throw c;if(n.user){const t=a?"approved":"pending",{error:y}=await l.from("user_approval_status").insert({user_id:n.user.id,status:t,email:i,phone:a?P:null,business_name:a?E:null});y&&console.error("Error creating approval status:",y);const{error:I}=await l.from("vendor_profiles").insert({user_id:n.user.id,seller_categories:a?["Jewellery"]:j,business_name:a?E:null,phone:a?P:null});if(I&&console.error("Error creating vendor profile:",I),a){const{error:T}=await l.from("vendor_permissions").insert({user_id:n.user.id,subscription_plan:"essentials"});T&&console.error("Error setting essentials plan:",T)}}a?(u.success("Welcome! Your 30-day free calculator trial has started. You now have unlimited access to our professional calculators!"),setTimeout(()=>{x("/calculators")},2e3)):u.success("Account created! Your request is pending admin approval.")}else{const{data:n,error:c}=await l.auth.signInWithPassword({email:o.data,password:h});if(c)throw c;if(!B&&n.session&&await l.auth.setSession(n.session),n.session)try{const t=navigator.userAgent;await l.functions.invoke("manage-session",{body:{action:"register",sessionId:n.session.access_token,deviceInfo:t,ipAddress:"client"}})}catch(t){console.error("Session registration error:",t)}if(n.user){const{data:t}=await l.from("user_approval_status").select("status").eq("user_id",n.user.id).maybeSingle();(t==null?void 0:t.status)==="approved"?u.success("Welcome back!"):(t==null?void 0:t.status)==="pending"?u.info("Your account is pending approval."):(t==null?void 0:t.status)==="rejected"&&u.error("Your account was not approved.")}}}catch(o){u.error(o.message||"Authentication failed")}finally{d(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:[e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(te,{variant:"ghost"})}),e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(V,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:a?e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"h-12 w-12 text-gemstone-from"}),e.jsx(Q,{className:"h-5 w-5 text-gemstone-to absolute -top-1 -right-1 animate-pulse"})]}):e.jsx(ee,{className:"h-12 w-12 text-primary"})}),a&&r&&e.jsx(K,{className:"mb-3 bg-gradient-to-r from-gemstone-from to-gemstone-to",children:"Free 30-Day Trial"}),e.jsx(H,{className:"text-3xl font-serif",children:a&&r?"Start Your Free Calculator Trial":"Jewelry Catalog"}),e.jsx(Z,{children:g?"Enter your email to reset your password":r?a?"Get unlimited access to professional jewelry calculators":"Create an account to manage your inventory":"Sign in to your account"}),a&&r&&e.jsxs("div",{className:"mt-4 space-y-2 text-left",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(w,{className:"h-5 w-5 text-gemstone-from shrink-0 mt-0.5"}),e.jsx("span",{children:"Unlimited Diamond Calculator access with comparison tool"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(w,{className:"h-5 w-5 text-gemstone-from shrink-0 mt-0.5"}),e.jsx("span",{children:"Full Manufacturing Cost Estimator for accurate pricing"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(w,{className:"h-5 w-5 text-gemstone-from shrink-0 mt-0.5"}),e.jsx("span",{children:"Read-only catalog browsing to explore features"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(w,{className:"h-5 w-5 text-gemstone-from shrink-0 mt-0.5"}),e.jsx("span",{children:"Upgrade anytime to full catalog & sharing features"})]})]})]}),e.jsxs(X,{children:[g?e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"email",children:"Email"}),e.jsx(S,{id:"email",type:"email",value:i,onChange:s=>C(s.target.value),required:!0,placeholder:"you@example.com"})]}),e.jsx(q,{type:"submit",className:"w-full",disabled:v,children:v?"Sending...":"Send Reset Link"})]}):e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"email",children:"Email"}),e.jsx(S,{id:"email",type:"email",value:i,onChange:s=>C(s.target.value),required:!0,placeholder:"you@example.com"})]}),!r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Password"}),e.jsx(S,{id:"password",type:"password",value:h,onChange:s=>F(s.target.value),required:!0,placeholder:"••••••••",minLength:6})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Password"}),e.jsx(S,{id:"password",type:"password",value:h,onChange:s=>F(s.target.value),required:!0,placeholder:"••••••••",minLength:8}),e.jsx(ae,{password:h})]}),r&&a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"businessName",children:"Business Name (Optional)"}),e.jsx(S,{id:"businessName",type:"text",value:E,onChange:s=>Y(s.target.value),placeholder:"Your Jewelry Business"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"phoneNumber",children:"Phone Number *"}),e.jsx(S,{id:"phoneNumber",type:"tel",value:P,onChange:s=>R(s.target.value),required:!0,placeholder:"+1 (555) 123-4567"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required to activate your free trial"})]})]}),r&&!a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Select Product Categories"}),e.jsx("div",{className:"space-y-2",children:["Jewellery","Gemstones","Loose Diamonds"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:s,checked:j.includes(s),onChange:o=>{o.target.checked?b([...j,s]):b(j.filter(p=>p!==s))},className:"w-4 h-4"}),e.jsx(N,{htmlFor:s,className:"font-normal cursor-pointer",children:s})]},s))}),j.length===0&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select at least one category"})]}),!r&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{id:"rememberMe",checked:B,onCheckedChange:s=>U(s)}),e.jsx(N,{htmlFor:"rememberMe",className:"text-sm font-normal cursor-pointer",children:"Remember me for 30 days"})]}),e.jsx(q,{type:"submit",className:`w-full ${a&&r?"bg-gradient-to-r from-gemstone-from to-gemstone-to":""}`,disabled:v||r&&!a&&(j.length===0||!L(h))||r&&a&&(!P||!L(h)),children:v?"Loading...":r?a?"Start Free Trial":"Create Account":"Sign In"})]}),e.jsxs("div",{className:"mt-4 text-center space-y-2",children:[!g&&!r&&e.jsx("button",{type:"button",onClick:()=>_(!0),className:"block w-full text-sm text-primary hover:underline",children:"Forgot password?"}),e.jsx("button",{type:"button",onClick:()=>{_(!1),m(!r)},className:"text-sm text-primary hover:underline",children:g?"Back to sign in":r?a?"Already have a calculator trial account? Sign in":"Already have an account? Sign in":a?"Want to try calculators? Start free trial":"Don't have an account? Sign up"}),!a&&!r&&!g&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Just want to try our calculators?"}),e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>x("/auth?plan=essentials"),className:"w-full text-gemstone-from border-gemstone-from/30 hover:bg-gemstone-from/10",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Start 30-Day Free Calculator Trial"]})]})]})]})]})]})};export{we as default};
//# sourceMappingURL=Auth-DFBZwdSs.js.map
