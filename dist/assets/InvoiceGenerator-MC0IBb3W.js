import{j as e}from"./query-vendor-BLxHmmGk.js";import{u as ze,i as Ke,r as t}from"./react-vendor-BeR0k5Z3.js";import{s as m,B as h,C as N,i as K,k as Q,g as y}from"./index-CX6yiz0b.js";import{I as o}from"./input-CiHC6UAI.js";import{L as n}from"./label-DbIM3Eg1.js";import{T as Ce}from"./textarea-CBQfWmvq.js";import{u,l as X,b as Qe,ab as Ne,ai as Xe,aw as Ze,O as ye}from"./ui-vendor-DjQqXt9S.js";import{g as es}from"./invoiceGenerator-N-SvGSBq.js";import{B as ss}from"./BackToHomeButton-C1MOpu96.js";import{S as Se,a as we,b as be,c as Ie,d as l}from"./select-CYWHo3cU.js";import{D as ts,b as as,c as rs,d as ns,e as is}from"./dialog-KVJ8gRMk.js";import{P as De,a as Pe,b as ke,C as Ee}from"./popover-BMhq8iVk.js";import{f as Te}from"./format-sTPjOSS_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./jspdf.plugin.autotable-41Os2KV8.js";import"./proxy-8agjeDDu.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-D6fUEw85.js";import"./index-DjQc2W_p.js";import"./index-DhS5fNEb.js";import"./en-US-DWrl2lTx.js";import"./endOfMonth-DIWrT0r0.js";import"./subDays-ByyGNxrB.js";const Ts=()=>{const S=ze(),[Z]=Ke(),[Oe,Fe]=t.useState(null),[a,Ge]=t.useState(null),[ee,Be]=t.useState([]),[Ae,w]=t.useState(!1),[b,Me]=t.useState("INV"),[se,I]=t.useState(""),[x,Re]=t.useState(new Date),[j,te]=t.useState("Net 30"),[c,ae]=t.useState(),[p,re]=t.useState(""),[ne,Ue]=t.useState("detailed"),[f,D]=t.useState(""),[_,P]=t.useState(""),[k,E]=t.useState(""),[T,O]=t.useState(""),[F,G]=t.useState(""),[ie,oe]=t.useState(0),[Ve,ce]=t.useState(0),[le,de]=t.useState(.76),[me,B]=t.useState(0),[A,C]=t.useState(0),[M,R]=t.useState(0),[ue,he]=t.useState(0),[U,V]=t.useState(0),[L,$]=t.useState(0),[q,H]=t.useState(0),[W,J]=t.useState(0),[ge,xe]=t.useState(0),[ve,je]=t.useState(0),[Y,z]=t.useState(0);t.useEffect(()=>{Le()},[]);const Le=async()=>{const{data:{user:s}}=await m.auth.getUser();if(!s){u.error("Please sign in to generate invoices"),S("/auth");return}Fe(s),await $e(),await qe();const r=Z.get("estimate");r&&await He(r)},$e=async()=>{const{data:{user:s}}=await m.auth.getUser();if(!s)return;const{data:r,error:i}=await m.from("vendor_profiles").select("*").eq("user_id",s.id).single();i?console.error("Error fetching vendor profile:",i):Ge(r)},qe=async()=>{const{data:{user:s}}=await m.auth.getUser();if(!s)return;const{data:r,error:i}=await m.from("manufacturing_cost_estimates").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});i?console.error("Error fetching estimates:",i):Be(r||[])},v=async()=>{try{const{data:{user:s}}=await m.auth.getUser();if(!s)return;const{data:r,error:i}=await m.from("manufacturing_cost_estimates").select("invoice_number").eq("user_id",s.id).not("invoice_number","is",null).order("created_at",{ascending:!1}).limit(1);if(i)throw i;const d=new Date().getFullYear();let g=1;if(r&&r.length>0){const _e=r[0].invoice_number.match(/(\d+)$/);_e&&(g=parseInt(_e[1])+1)}const fe=`${b}-${d}-${String(g).padStart(3,"0")}`;return I(fe),fe}catch(s){return console.error("Error generating invoice number:",s),`${b}-${new Date().getFullYear()}-001`}},He=async s=>{try{const{data:r,error:i}=await m.from("manufacturing_cost_estimates").select("*").eq("id",s).single();if(i)throw i;r&&(pe(r),await v(),u.success("Estimate loaded and ready to convert to invoice"))}catch(r){console.error("Error loading estimate:",r),u.error("Failed to load estimate")}},pe=s=>{var r;D(s.estimate_name),P(s.customer_name||""),E(s.customer_phone||""),O(s.customer_email||""),G(s.customer_address||""),oe(s.net_weight||0),ce(((r=s.details)==null?void 0:r.gross_weight)||s.net_weight||0),de(s.purity_fraction||.76),B(s.gold_rate_24k||0),C(s.making_charges||0),R(s.cad_design_charges||0),he(s.camming_charges||0),V(s.certification_cost||0),$(s.diamond_cost||0),H(s.gemstone_cost||0),J(s.gold_cost||0),xe(s.total_cost||0),je(s.profit_margin_percentage||0),z(s.final_selling_price||0),s.invoice_number&&I(s.invoice_number),w(!1)},We=()=>{if(!a){u.error("Please complete your vendor profile first");return}B(a.gold_rate_24k_per_gram||0),C(a.making_charges_per_gram||0),v(),u.success("Jewelry template loaded with your profile data")},Je=async()=>{D("Diamond Engagement Ring Order"),P("Priya Sharma"),E("+91 98765 43210"),O("priya.sharma@example.com"),G("123 MG Road, Bangalore, Karnataka 560001, India"),oe(8.5),ce(10.2),de(.76),B(6500),C(15300),R(5e3),he(2e3),V(3e3),$(125e3),H(8e3);const s=8.5*.76*6500;J(s);const r=s+15300+5e3+2e3+3e3+125e3+8e3;xe(r),je(20);const i=r*1.2;z(i),re("Payment accepted via bank transfer or UPI. 50% advance required before production. Remaining 50% due upon completion."),te("Net 30");const d=new Date;d.setDate(d.getDate()+30),ae(d),await v(),u.success("Sample data loaded successfully!")},Ye=async()=>{if(!f){u.error("Please enter an estimate/order name");return}if(!_){u.error("Please enter customer name");return}let s=se;s||(s=await v()||"");const r=[a==null?void 0:a.address_line1,a==null?void 0:a.address_line2,a==null?void 0:a.city,a==null?void 0:a.state,a==null?void 0:a.pincode,a==null?void 0:a.country].filter(Boolean),i=r.length>0?r.join(", "):void 0;es({invoiceNumber:s,invoiceDate:x.toISOString(),paymentDueDate:c==null?void 0:c.toISOString(),paymentTerms:j,estimateName:f,status:"draft",customerName:_,customerPhone:k,customerEmail:T,customerAddress:F,netWeight:ie,grossWeight:Ve,purityFraction:le,goldRate24k:me,makingCharges:A,cadDesignCharges:M,cammingCharges:ue,certificationCost:U,diamondCost:L,gemstoneCost:q,goldCost:W,totalCost:ge,profitMargin:ve,finalSellingPrice:Y,invoiceNotes:p,template:ne,vendorBranding:a?{name:a.business_name,logo:a.logo_url,primaryColor:a.primary_brand_color,secondaryColor:a.secondary_brand_color,tagline:a.brand_tagline,email:a.email,phone:a.phone,address:i}:void 0});try{const d=Z.get("estimate");if(d){const{error:g}=await m.from("manufacturing_cost_estimates").update({invoice_number:s,invoice_date:x.toISOString(),payment_terms:j,payment_due_date:c==null?void 0:c.toISOString(),invoice_notes:p,is_invoice_generated:!0,invoice_status:"pending"}).eq("id",d);if(g)throw g}else{const{error:g}=await m.from("manufacturing_cost_estimates").insert({user_id:Oe.id,estimate_name:f,invoice_number:s,invoice_date:x.toISOString(),payment_terms:j,payment_due_date:c==null?void 0:c.toISOString(),invoice_notes:p,is_invoice_generated:!0,invoice_status:"pending",customer_name:_,customer_phone:k,customer_email:T,customer_address:F,net_weight:ie,purity_fraction:le,gold_rate_24k:me,making_charges:A,cad_design_charges:M,camming_charges:ue,certification_cost:U,diamond_cost:L,gemstone_cost:q,gold_cost:W,total_cost:ge,profit_margin_percentage:ve,final_selling_price:Y,status:"draft"});if(g)throw g}u.success("Invoice generated and saved successfully")}catch(d){console.error("Error saving invoice:",d),u.error("Invoice generated but failed to save to database")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx(ss,{}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(X,{className:"h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Invoice Generator"})]}),e.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Create professional invoices with your branding"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs(h,{onClick:We,variant:"default",className:"bg-gradient-to-r from-primary to-accent",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Use Jewelry Template"]}),e.jsxs(h,{onClick:Je,variant:"outline",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Load Sample Data"]}),e.jsxs(h,{onClick:()=>w(!0),variant:"outline",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Load from Estimate"]}),e.jsxs(h,{onClick:v,variant:"outline",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Auto-Generate Invoice #"]}),e.jsxs(h,{onClick:()=>S("/invoice-history"),variant:"outline",children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"View History"]}),e.jsxs(h,{onClick:()=>S("/invoice-templates"),variant:"outline",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Manage Templates"]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(N,{children:[e.jsx(K,{children:e.jsx(Q,{children:"Invoice Details"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Invoice Prefix"}),e.jsx(o,{value:b,onChange:s=>Me(s.target.value.toUpperCase()),placeholder:"INV"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Invoice Number"}),e.jsx(o,{value:se,onChange:s=>I(s.target.value),placeholder:"Auto-generated"})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Order/Estimate Name *"}),e.jsx(o,{value:f,onChange:s=>D(s.target.value),placeholder:"e.g., Diamond Ring Order"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Invoice Date"}),e.jsxs(De,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),Te(x,"PPP")]})}),e.jsx(ke,{className:"w-auto p-0",children:e.jsx(Ee,{mode:"single",selected:x,onSelect:s=>s&&Re(s)})})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Payment Terms"}),e.jsxs(Se,{value:j,onValueChange:te,children:[e.jsx(we,{children:e.jsx(be,{})}),e.jsxs(Ie,{children:[e.jsx(l,{value:"Due on Receipt",children:"Due on Receipt"}),e.jsx(l,{value:"Net 15",children:"Net 15"}),e.jsx(l,{value:"Net 30",children:"Net 30"}),e.jsx(l,{value:"Net 45",children:"Net 45"}),e.jsx(l,{value:"Net 60",children:"Net 60"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Payment Due Date"}),e.jsxs(De,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),c?Te(c,"PPP"):"Select date"]})}),e.jsx(ke,{className:"w-auto p-0",children:e.jsx(Ee,{mode:"single",selected:c,onSelect:ae})})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Invoice Template"}),e.jsxs(Se,{value:ne,onValueChange:s=>Ue(s),children:[e.jsx(we,{children:e.jsx(be,{})}),e.jsxs(Ie,{children:[e.jsx(l,{value:"detailed",children:"Detailed - Comprehensive Breakdown"}),e.jsx(l,{value:"summary",children:"Summary - Quick Overview"}),e.jsx(l,{value:"minimal",children:"Minimal - Essential Only"}),e.jsx(l,{value:"traditional",children:"Traditional - Classic Serif Style"}),e.jsx(l,{value:"modern",children:"Modern - Clean Minimalist"}),e.jsx(l,{value:"luxury",children:"Luxury - Premium Elegant"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Invoice Notes"}),e.jsx(Ce,{value:p,onChange:s=>re(s.target.value),placeholder:"Payment instructions...",rows:3})]})]})]}),e.jsxs(N,{children:[e.jsx(K,{children:e.jsx(Q,{children:"Customer Information"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Customer Name *"}),e.jsx(o,{value:_,onChange:s=>P(s.target.value),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Phone Number"}),e.jsx(o,{value:k,onChange:s=>E(s.target.value),placeholder:"+1234567890"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Email"}),e.jsx(o,{type:"email",value:T,onChange:s=>O(s.target.value),placeholder:"customer@example.com"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Address"}),e.jsx(Ce,{value:F,onChange:s=>G(s.target.value),placeholder:"Complete address",rows:3})]})]})]}),e.jsxs(N,{className:"md:col-span-2",children:[e.jsx(K,{children:e.jsx(Q,{children:"Cost Breakdown"})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Gold Cost (₹)"}),e.jsx(o,{type:"number",value:W,onChange:s=>J(Number(s.target.value))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Making Charges (₹)"}),e.jsx(o,{type:"number",value:A,onChange:s=>C(Number(s.target.value))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Cost (₹)"}),e.jsx(o,{type:"number",value:L,onChange:s=>$(Number(s.target.value))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Cost (₹)"}),e.jsx(o,{type:"number",value:q,onChange:s=>H(Number(s.target.value))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"CAD Design (₹)"}),e.jsx(o,{type:"number",value:M,onChange:s=>R(Number(s.target.value))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Certification (₹)"}),e.jsx(o,{type:"number",value:U,onChange:s=>V(Number(s.target.value))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Total Amount (₹)"}),e.jsx(o,{type:"number",value:Y,onChange:s=>z(Number(s.target.value)),className:"font-bold"})]})]})})]})]}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsxs(h,{onClick:Ye,size:"lg",children:[e.jsx(Ne,{className:"mr-2 h-5 w-5"}),"Generate Invoice PDF"]})}),e.jsx(ts,{open:Ae,onOpenChange:w,children:e.jsxs(as,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(rs,{children:[e.jsx(ns,{children:"Load from Saved Estimate"}),e.jsx(is,{children:"Select an estimate to pre-fill invoice details"})]}),e.jsx("div",{className:"space-y-2",children:ee.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No saved estimates found"}):ee.map(s=>{var r;return e.jsx(N,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>pe(s),children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.estimate_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.customer_name||"No customer"}),e.jsxs("p",{className:"text-sm font-semibold text-primary mt-1",children:["₹",(r=s.final_selling_price)==null?void 0:r.toFixed(2)]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]})})},s.id)})})]})})]})})};export{Ts as default};
//# sourceMappingURL=InvoiceGenerator-MC0IBb3W.js.map
