import{j as e}from"./query-vendor-BLxHmmGk.js";import{u as K,r as j}from"./react-vendor-BeR0k5Z3.js";import{F as _,_ as O,z as x,C as o,G as f,H as N,D as d,B as n}from"./index-DGlTgSKx.js";import{B as T}from"./badge-DknkzE8c.js";import{I as G}from"./input-CEHl5GoJ.js";import{S as $,a as J,b as X,c as W,d as v}from"./select-CQfvDDtS.js";import{A as Y}from"./AdminLoadingSkeleton-CaIP2hSP.js";import{u as w,n as E,d as A,z as Z,ae as y,aJ as q,h as k,a3 as ee,P as se,I as te,aC as L,a7 as ae,c as ce}from"./ui-vendor-CN4tOqpp.js";import{u as b,w as le}from"./xlsx-CKN5doRT.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-aqCwQlp3.js";import"./index-DjQc2W_p.js";const ve=()=>{const F=K(),[i,P]=j.useState([]),[U,B]=j.useState(!0),[m,V]=j.useState(""),[S,z]=j.useState("all");j.useEffect(()=>{H()},[]);const H=async()=>{try{const{data:{user:s}}=await _.auth.getUser();if(!s){F("/auth");return}const{data:c,error:t}=await _.from("purchase_inquiries").select(`
          *,
          products (name, retail_price, image_url, sku),
          share_links (share_token)
        `).order("created_at",{ascending:!1});if(t)throw t;P(c||[])}catch(s){console.error("Error fetching inquiries:",s),w.error("Failed to load purchase inquiries")}finally{B(!1)}},u=async(s,c)=>{try{const{error:t}=await _.from("purchase_inquiries").update({status:c}).eq("id",s);if(t)throw t;P(a=>a.map(r=>r.id===s?{...r,status:c}:r)),w.success("Status updated successfully")}catch(t){console.error("Error updating status:",t),w.error("Failed to update status")}},M=()=>{const s=C.map(l=>{var p,g,D,I;return{"Customer Name":l.customer_name,Email:l.customer_email,Phone:l.customer_phone||"N/A",Product:((p=l.products)==null?void 0:p.name)||"N/A",SKU:((g=l.products)==null?void 0:g.sku)||"N/A",Quantity:l.quantity,"Unit Price":((D=l.products)==null?void 0:D.retail_price)||0,"Total Value":(((I=l.products)==null?void 0:I.retail_price)||0)*l.quantity,Status:l.status,Message:l.message||"N/A",Date:new Date(l.created_at).toLocaleDateString()}}),c=b.json_to_sheet(s),t=b.sheet_to_csv(c),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=`purchase-inquiries-${new Date().toISOString().split("T")[0]}.csv`,r.click(),w.success("CSV exported successfully")},R=()=>{const s=C.map(a=>{var r,l,p,g;return{"Customer Name":a.customer_name,Email:a.customer_email,Phone:a.customer_phone||"N/A",Product:((r=a.products)==null?void 0:r.name)||"N/A",SKU:((l=a.products)==null?void 0:l.sku)||"N/A",Quantity:a.quantity,"Unit Price":((p=a.products)==null?void 0:p.retail_price)||0,"Total Value":(((g=a.products)==null?void 0:g.retail_price)||0)*a.quantity,Status:a.status,Message:a.message||"N/A",Date:new Date(a.created_at).toLocaleDateString()}}),c=b.json_to_sheet(s),t=b.book_new();b.book_append_sheet(t,c,"Purchase Inquiries"),le(t,`purchase-inquiries-${new Date().toISOString().split("T")[0]}.xlsx`),w.success("Excel file exported successfully")},C=i.filter(s=>{var a,r,l;const c=m===""||s.customer_name.toLowerCase().includes(m.toLowerCase())||s.customer_email.toLowerCase().includes(m.toLowerCase())||((a=s.products)==null?void 0:a.name.toLowerCase().includes(m.toLowerCase()))||((l=(r=s.products)==null?void 0:r.sku)==null?void 0:l.toLowerCase().includes(m.toLowerCase())),t=S==="all"||s.status===S;return c&&t}),h={total:i.length,pending:i.filter(s=>s.status==="pending").length,contacted:i.filter(s=>s.status==="contacted").length,completed:i.filter(s=>s.status==="completed").length,totalRevenue:i.filter(s=>s.status==="completed").reduce((s,c)=>{var t;return s+(((t=c.products)==null?void 0:t.retail_price)||0)*c.quantity},0)},Q=s=>{const c={pending:{variant:"secondary",icon:ce,label:"Pending"},contacted:{variant:"default",icon:k,label:"Contacted"},completed:{variant:"default",icon:L,label:"Completed"},cancelled:{variant:"destructive",icon:ae,label:"Cancelled"}},t=c[s]||c.pending,a=t.icon;return e.jsxs(T,{variant:t.variant,className:"gap-1",children:[e.jsx(a,{className:"h-3 w-3"}),t.label]})};return U?e.jsx(Y,{}):e.jsx(O,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-primary/20 to-accent/20 p-3 rounded-xl",children:e.jsx(E,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-serif font-bold bg-gradient-to-r from-foreground to-primary bg-clip-text text-transparent",children:"Purchase Inquiries"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer purchase requests"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(x.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(o,{className:"border-primary/20 bg-gradient-to-br from-card to-primary/5",children:[e.jsx(f,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Total Inquiries"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-primary",children:h.total})})]})}),e.jsx(x.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(o,{className:"border-secondary/20 bg-gradient-to-br from-card to-secondary/5",children:[e.jsx(f,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-secondary",children:h.pending})})]})}),e.jsx(x.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(o,{className:"border-accent/20 bg-gradient-to-br from-card to-accent/5",children:[e.jsx(f,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Contacted"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-accent",children:h.contacted})})]})}),e.jsx(x.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(o,{className:"border-green-500/20 bg-gradient-to-br from-card to-green-500/5",children:[e.jsx(f,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Completed"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.completed})})]})}),e.jsx(x.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(o,{className:"border-primary/20 bg-gradient-to-br from-card to-primary/10",children:[e.jsx(f,{className:"pb-3",children:e.jsxs(N,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Revenue"]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["₹",h.totalRevenue.toLocaleString("en-IN")]})})]})})]}),e.jsx(o,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search by customer name, email, product...",value:m,onChange:s=>V(s.target.value),className:"pl-9"})]}),e.jsxs($,{value:S,onValueChange:z,children:[e.jsx(J,{className:"w-full sm:w-[180px]",children:e.jsx(X,{placeholder:"Filter by status"})}),e.jsxs(W,{children:[e.jsx(v,{value:"all",children:"All Status"}),e.jsx(v,{value:"pending",children:"Pending"}),e.jsx(v,{value:"contacted",children:"Contacted"}),e.jsx(v,{value:"completed",children:"Completed"}),e.jsx(v,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:M,className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs(n,{variant:"outline",onClick:R,className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Export Excel"]})]})]})})}),e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsx(o,{children:e.jsxs(d,{className:"py-12 text-center",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"No purchase inquiries found"})]})}):C.map(s=>{var c,t,a,r;return e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(o,{className:"hover:shadow-lg transition-shadow",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[((c=s.products)==null?void 0:c.image_url)&&e.jsx("div",{className:"w-full lg:w-32 h-32 flex-shrink-0",children:e.jsx("img",{src:s.products.image_url,alt:s.products.name,className:"w-full h-full object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:(t=s.products)==null?void 0:t.name}),((a=s.products)==null?void 0:a.sku)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",s.products.sku]})]}),Q(s.status)]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"font-medium truncate",children:s.customer_name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.customer_email})]})]}),s.customer_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:s.customer_phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:s.quantity})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value"}),e.jsxs("p",{className:"font-medium",children:["₹",((((r=s.products)==null?void 0:r.retail_price)||0)*s.quantity).toLocaleString("en-IN")]})]})]})]}),s.message&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Message:"}),e.jsx("p",{className:"text-sm",children:s.message})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>u(s.id,"contacted"),className:"gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Mark as Contacted"]}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>u(s.id,"cancelled"),children:"Cancel"})]}),s.status==="contacted"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>u(s.id,"completed"),className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Mark as Completed"]}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>u(s.id,"pending"),children:"Back to Pending"})]}),s.status==="completed"&&e.jsxs(T,{variant:"default",className:"gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Sale Completed"]}),s.status==="cancelled"&&e.jsx(n,{size:"sm",variant:"outline",onClick:()=>u(s.id,"pending"),children:"Reopen"})]})]})]})})})},s.id)})})]})})};export{ve as default};
//# sourceMappingURL=PurchaseInquiries-D1i5yqL5.js.map
