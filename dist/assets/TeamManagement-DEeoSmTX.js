import{j as e}from"./query-vendor-BLxHmmGk.js";import{u as L,r as n}from"./react-vendor-BeR0k5Z3.js";import{w as R,s as t,A as U,B as j,C as _,i as M,k as C,l as E,g as A}from"./index-CX6yiz0b.js";import{I as S}from"./input-CiHC6UAI.js";import{T as q,a as F,b as f,c as m,d as I,e as c}from"./table-CYMzKz5T.js";import{B as P}from"./badge-45Abp579.js";import{u as d,E as H,aF as z,ar as G}from"./ui-vendor-DjQqXt9S.js";import"./supabase-vendor-VSDMYZ1k.js";function Y(){const u=L(),{isAdmin:o,loading:h}=R(),[p,k]=n.useState([]),[g,b]=n.useState(""),[w,v]=n.useState(""),[y,T]=n.useState(!1);n.useEffect(()=>{!h&&!o&&(d.error("Access denied. Admin only."),u("/catalog"))},[o,h,u]),n.useEffect(()=>{o&&x()},[o]);const x=async()=>{const{data:a,error:i}=await t.from("user_roles").select(`
        id,
        role,
        created_at,
        user_id
      `).eq("role","team_member");if(i){d.error("Failed to fetch team members");return}a.map(r=>r.user_id);const s=[];for(const r of a){const{data:l}=await t.auth.admin.getUserById(r.user_id);l.user&&s.push({id:r.id,email:l.user.email||"Unknown",role:r.role,created_at:r.created_at})}k(s)},B=async a=>{var i;a.preventDefault(),T(!0);try{const{data:s,error:r}=await t.auth.signUp({email:g,password:w,options:{emailRedirectTo:`${window.location.origin}/catalog`}});if(r)throw r;if(!s.user)throw new Error("Failed to create user");const{error:l}=await t.from("user_roles").insert({user_id:s.user.id,role:"team_member"});if(l)throw l;const{error:N}=await t.from("user_approval_status").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:(i=(await t.auth.getUser()).data.user)==null?void 0:i.id}).eq("user_id",s.user.id);N&&console.error("Error approving user:",N),d.success("Team member added and approved successfully"),b(""),v(""),x()}catch(s){d.error(s.message||"Failed to add team member")}finally{T(!1)}},D=async a=>{const{error:i}=await t.from("user_roles").delete().eq("id",a);if(i){d.error("Failed to remove team member");return}d.success("Team member removed successfully"),x()};return h?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:"Loading..."})}):o?e.jsx(U,{children:e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Team Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your team members and their access"})]}),e.jsxs(j,{variant:"outline",onClick:()=>u("/catalog"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Back to Catalog"]})]}),e.jsxs(_,{children:[e.jsxs(M,{children:[e.jsx(C,{children:"Add Team Member"}),e.jsx(E,{children:"Create a new team member account. They will be able to view inventory and create share links."})]}),e.jsx(A,{children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(S,{type:"email",placeholder:"Email",value:g,onChange:a=>b(a.target.value),required:!0}),e.jsx(S,{type:"password",placeholder:"Password",value:w,onChange:a=>v(a.target.value),required:!0})]}),e.jsxs(j,{type:"submit",disabled:y,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),y?"Adding...":"Add Team Member"]})]})})]}),e.jsxs(_,{children:[e.jsxs(M,{children:[e.jsx(C,{children:"Team Members"}),e.jsx(E,{children:"View and manage all team members"})]}),e.jsx(A,{children:e.jsxs(q,{children:[e.jsx(F,{children:e.jsxs(f,{children:[e.jsx(m,{children:"Email"}),e.jsx(m,{children:"Role"}),e.jsx(m,{children:"Added"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsx(I,{children:p.length===0?e.jsx(f,{children:e.jsx(c,{colSpan:4,className:"text-center text-muted-foreground",children:"No team members yet"})}):p.map(a=>e.jsxs(f,{children:[e.jsx(c,{children:a.email}),e.jsx(c,{children:e.jsx(P,{variant:"secondary",children:"Team Member"})}),e.jsx(c,{children:new Date(a.created_at).toLocaleDateString()}),e.jsx(c,{className:"text-right",children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>D(a.id),children:e.jsx(G,{className:"h-4 w-4 text-destructive"})})})]},a.id))})]})})]})]})})}):null}export{Y as default};
//# sourceMappingURL=TeamManagement-DEeoSmTX.js.map
