{"version":3,"file":"AdminDiamondPrices-C7oW24Hs.js","sources":["../../src/pages/AdminDiamondPrices.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { AdminLayout } from \"@/components/AdminLayout\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { Download, Upload, Trash2, AlertCircle, History, TrendingUp, TrendingDown, RefreshCw, Search, X } from \"lucide-react\";\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\r\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\n\r\nconst AdminDiamondPrices = () => {\r\n  const [uploading, setUploading] = useState(false);\r\n  const [pearFile, setPearFile] = useState<File | null>(null);\r\n  const [roundFile, setRoundFile] = useState<File | null>(null);\r\n  const [displayCount, setDisplayCount] = useState(100);\r\n  const queryClient = useQueryClient();\r\n\r\n  // Filter states\r\n  const [filterShape, setFilterShape] = useState<string>(\"\");\r\n  const [filterColorGrade, setFilterColorGrade] = useState<string>(\"\");\r\n  const [filterClarityGrade, setFilterClarityGrade] = useState<string>(\"\");\r\n  const [filterCaratMin, setFilterCaratMin] = useState<string>(\"\");\r\n  const [filterCaratMax, setFilterCaratMax] = useState<string>(\"\");\r\n\r\n  const { data: pricesData, isLoading } = useQuery({\r\n    queryKey: [\"diamond-prices\", filterShape, filterColorGrade, filterClarityGrade, filterCaratMin, filterCaratMax],\r\n    queryFn: async () => {\r\n      let query = supabase\r\n        .from(\"diamond_prices\")\r\n        .select(\"*\", { count: 'exact' });\r\n\r\n      // Apply filters\r\n      if (filterShape) {\r\n        query = query.eq(\"shape\", filterShape);\r\n      }\r\n      if (filterColorGrade) {\r\n        query = query.eq(\"color_grade\", filterColorGrade);\r\n      }\r\n      if (filterClarityGrade) {\r\n        query = query.eq(\"clarity_grade\", filterClarityGrade);\r\n      }\r\n      if (filterCaratMin) {\r\n        query = query.gte(\"carat_range_min\", parseFloat(filterCaratMin));\r\n      }\r\n      if (filterCaratMax) {\r\n        query = query.lte(\"carat_range_max\", parseFloat(filterCaratMax));\r\n      }\r\n\r\n      query = query\r\n        .order(\"shape\", { ascending: true })\r\n        .order(\"carat_range_min\", { ascending: true })\r\n        .limit(10000);\r\n\r\n      const { data, error, count } = await query;\r\n      \r\n      if (error) throw error;\r\n      return { data, count };\r\n    },\r\n  });\r\n\r\n  const prices = pricesData?.data || [];\r\n  const totalCount = pricesData?.count || 0;\r\n\r\n  // Get unique values for filter dropdowns\r\n  const uniqueShapes = Array.from(new Set(prices.map(p => p.shape))).sort();\r\n  const uniqueColorGrades = Array.from(new Set(prices.map(p => p.color_grade))).sort();\r\n  const uniqueClarityGrades = Array.from(new Set(prices.map(p => p.clarity_grade))).sort();\r\n\r\n  const clearFilters = () => {\r\n    setFilterShape(\"\");\r\n    setFilterColorGrade(\"\");\r\n    setFilterClarityGrade(\"\");\r\n    setFilterCaratMin(\"\");\r\n    setFilterCaratMax(\"\");\r\n    toast.success(\"Filters cleared\");\r\n  };\r\n\r\n  const hasActiveFilters = filterShape || filterColorGrade || filterClarityGrade || filterCaratMin || filterCaratMax;\r\n\r\n  const { data: priceHistory, isLoading: historyLoading } = useQuery({\r\n    queryKey: [\"diamond-price-history\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"diamond_price_history\")\r\n        .select(\"*\")\r\n        .order(\"changed_at\", { ascending: false })\r\n        .limit(100);\r\n      \r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n  });\r\n\r\n  const downloadTemplate = () => {\r\n    const headers = [\r\n      \"shape\",\r\n      \"carat_range_min\",\r\n      \"carat_range_max\",\r\n      \"color_grade\",\r\n      \"clarity_grade\",\r\n      \"cut_grade\",\r\n      \"price_per_carat\",\r\n      \"currency\",\r\n      \"notes\"\r\n    ];\r\n    \r\n    const sampleData = [\r\n      \"Round,0.50,0.69,D,IF,Excellent,15000,USD,Sample entry\",\r\n      \"Round,0.50,0.69,D,VVS1,Excellent,12000,USD,\",\r\n      \"Princess,1.00,1.49,E,VS1,Very Good,8000,USD,\"\r\n    ];\r\n\r\n    const csv = [headers.join(\",\"), ...sampleData].join(\"\\n\");\r\n    const blob = new Blob([csv], { type: \"text/csv\" });\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"diamond_prices_template.csv\";\r\n    a.click();\r\n    window.URL.revokeObjectURL(url);\r\n    toast.success(\"Template downloaded!\");\r\n  };\r\n\r\n  const parseRapaportFormat = (line: string, defaultShape: string = \"Round\") => {\r\n    // Format: CutGrade,Clarity,Color,CaratMin,CaratMax,Price,Date\r\n    // Example: BR,IF,D,0.01,0.03,830.0, 11/21/2025\r\n    const values = line.split(\",\").map(v => v.trim());\r\n    \r\n    if (values.length < 6) return null;\r\n\r\n    // Map cut grade codes to shape\r\n    const cutGradeMap: Record<string, string> = {\r\n      'BR': 'Round',\r\n      'PS': 'Pear',\r\n      'PR': 'Princess',\r\n      'EM': 'Emerald',\r\n      'CU': 'Cushion',\r\n      'OV': 'Oval',\r\n      'MQ': 'Marquise',\r\n      'HT': 'Heart',\r\n      'RD': 'Radiant',\r\n      'AS': 'Asscher'\r\n    };\r\n\r\n    const cutGrade = values[0];\r\n    const shape = cutGradeMap[cutGrade] || defaultShape;\r\n\r\n    return {\r\n      shape,\r\n      clarity_grade: values[1],\r\n      color_grade: values[2],\r\n      carat_range_min: parseFloat(values[3]),\r\n      carat_range_max: parseFloat(values[4]),\r\n      price_per_carat: parseFloat(values[5]),\r\n      cut_grade: 'Excellent',\r\n      currency: 'USD',\r\n      notes: null,\r\n    };\r\n  };\r\n\r\n  const parseStandardFormat = (line: string) => {\r\n    // Format: shape,carat_range_min,carat_range_max,color_grade,clarity_grade,cut_grade,price_per_carat,currency,notes\r\n    const values = line.split(\",\").map(v => v.trim());\r\n    \r\n    if (values.length < 7) return null;\r\n\r\n    return {\r\n      shape: values[0],\r\n      carat_range_min: parseFloat(values[1]),\r\n      carat_range_max: parseFloat(values[2]),\r\n      color_grade: values[3],\r\n      clarity_grade: values[4],\r\n      cut_grade: values[5],\r\n      price_per_carat: parseFloat(values[6]),\r\n      currency: values[7] || \"USD\",\r\n      notes: values[8] || null,\r\n    };\r\n  };\r\n\r\n  const handleFileUpload = async (file: File | null, targetShape: 'pear' | 'round') => {\r\n    if (!file) {\r\n      toast.error(\"Please select a CSV file\");\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const text = await file.text();\r\n      const lines = text.split(\"\\n\").filter(line => line.trim());\r\n      \r\n      if (lines.length < 1) {\r\n        toast.error(\"CSV file is empty\");\r\n        return;\r\n      }\r\n\r\n      const records = [];\r\n      let skippedRows = 0;\r\n\r\n      // Detect format from first line\r\n      const firstLine = lines[0];\r\n      const isRapaportFormat = /^[A-Z]{2},/.test(firstLine); // Starts with 2-letter code\r\n      \r\n      // If standard format with headers, skip first line\r\n      const startIndex = isRapaportFormat ? 0 : (firstLine.toLowerCase().includes('shape') ? 1 : 0);\r\n\r\n      for (let i = startIndex; i < lines.length; i++) {\r\n        const line = lines[i];\r\n        if (!line.trim()) continue;\r\n\r\n        let record = null;\r\n        \r\n        if (isRapaportFormat) {\r\n          record = parseRapaportFormat(line, targetShape === 'round' ? 'Round' : 'Pear');\r\n        } else {\r\n          record = parseStandardFormat(line);\r\n        }\r\n\r\n        // Override shape based on target\r\n        if (record && targetShape === 'round') {\r\n          record.shape = 'Round';\r\n        } else if (record && targetShape === 'pear') {\r\n          // For pear uploads, keep the parsed shape (could be any fancy shape)\r\n          // or default to Pear if not specified\r\n          if (!record.shape || record.shape === 'Round') {\r\n            record.shape = 'Pear';\r\n          }\r\n        }\r\n\r\n        if (!record) {\r\n          skippedRows++;\r\n          continue;\r\n        }\r\n\r\n        // Validate required fields\r\n        if (\r\n          !record.shape ||\r\n          isNaN(record.carat_range_min) ||\r\n          isNaN(record.carat_range_max) ||\r\n          !record.color_grade ||\r\n          !record.clarity_grade ||\r\n          !record.cut_grade ||\r\n          isNaN(record.price_per_carat)\r\n        ) {\r\n          skippedRows++;\r\n          continue;\r\n        }\r\n\r\n        records.push(record);\r\n      }\r\n\r\n      if (records.length === 0) {\r\n        toast.error(\"No valid records found in CSV\");\r\n        return;\r\n      }\r\n\r\n      // Insert records in batches\r\n      const { error } = await supabase\r\n        .from(\"diamond_prices\")\r\n        .insert(records);\r\n\r\n      if (error) throw error;\r\n\r\n      const message = skippedRows > 0 \r\n        ? `Imported ${records.length} records (${skippedRows} rows skipped)`\r\n        : `Successfully imported ${records.length} price records!`;\r\n      \r\n      toast.success(message);\r\n      queryClient.invalidateQueries({ queryKey: [\"diamond-prices\"] });\r\n      if (targetShape === 'pear') setPearFile(null);\r\n      if (targetShape === 'round') setRoundFile(null);\r\n    } catch (error: any) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(error.message || \"Failed to upload CSV\");\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const deleteAllPrices = async () => {\r\n    if (!confirm(\"Are you sure you want to delete ALL diamond prices? This action cannot be undone.\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"diamond_prices\")\r\n        .delete()\r\n        .neq(\"id\", \"00000000-0000-0000-0000-000000000000\"); // Delete all\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"All prices deleted successfully\");\r\n      queryClient.invalidateQueries({ queryKey: [\"diamond-prices\"] });\r\n    } catch (error: any) {\r\n      console.error(\"Delete error:\", error);\r\n      toast.error(\"Failed to delete prices\");\r\n    }\r\n  };\r\n\r\n  const refreshData = () => {\r\n    queryClient.invalidateQueries({ queryKey: [\"diamond-prices\"] });\r\n    queryClient.invalidateQueries({ queryKey: [\"diamond-price-history\"] });\r\n    toast.success(\"Data refreshed\");\r\n  };\r\n\r\n  return (\r\n    <AdminLayout>\r\n      <div className=\"space-y-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Diamond Price Management</h1>\r\n          <p className=\"text-muted-foreground mt-2\">\r\n            Import and manage Rapaport-style diamond pricing data\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"grid md:grid-cols-2 gap-6\">\r\n          {/* Upload Section */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Upload className=\"h-5 w-5\" />\r\n                Import CSV\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Upload a CSV file with diamond pricing data\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-6\">\r\n              <Alert>\r\n                <AlertCircle className=\"h-4 w-4\" />\r\n                <AlertDescription className=\"text-xs space-y-1\">\r\n                  <div><strong>Standard format:</strong> shape, carat_range_min, carat_range_max, color_grade, clarity_grade, cut_grade, price_per_carat, currency, notes</div>\r\n                  <div><strong>Rapaport format:</strong> CutCode, Clarity, Color, CaratMin, CaratMax, Price, Date</div>\r\n                  <div className=\"text-muted-foreground mt-1\">Supports both formats automatically</div>\r\n                </AlertDescription>\r\n              </Alert>\r\n\r\n              {/* Pear Upload - For all fancy shapes */}\r\n              <div className=\"space-y-3 p-4 border rounded-lg bg-muted/30\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Badge variant=\"secondary\">Fancy Shapes</Badge>\r\n                  <p className=\"text-sm text-muted-foreground\">Pear, Princess, Emerald, Cushion, Oval, etc.</p>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"pear-csv\">Pear Pricing CSV</Label>\r\n                  <Input\r\n                    id=\"pear-csv\"\r\n                    type=\"file\"\r\n                    accept=\".csv\"\r\n                    onChange={(e) => setPearFile(e.target.files?.[0] || null)}\r\n                  />\r\n                </div>\r\n                <Button\r\n                  onClick={() => handleFileUpload(pearFile, 'pear')}\r\n                  disabled={!pearFile || uploading}\r\n                  className=\"w-full\"\r\n                >\r\n                  {uploading ? \"Uploading...\" : \"Upload Pear/Fancy Shapes\"}\r\n                </Button>\r\n              </div>\r\n\r\n              {/* Round Upload - Round only */}\r\n              <div className=\"space-y-3 p-4 border rounded-lg bg-muted/30\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Badge variant=\"secondary\">Round</Badge>\r\n                  <p className=\"text-sm text-muted-foreground\">Round brilliant diamonds only</p>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"round-csv\">Round Pricing CSV</Label>\r\n                  <Input\r\n                    id=\"round-csv\"\r\n                    type=\"file\"\r\n                    accept=\".csv\"\r\n                    onChange={(e) => setRoundFile(e.target.files?.[0] || null)}\r\n                  />\r\n                </div>\r\n                <Button\r\n                  onClick={() => handleFileUpload(roundFile, 'round')}\r\n                  disabled={!roundFile || uploading}\r\n                  className=\"w-full\"\r\n                >\r\n                  {uploading ? \"Uploading...\" : \"Upload Round Pricing\"}\r\n                </Button>\r\n              </div>\r\n\r\n              <Button\r\n                onClick={downloadTemplate}\r\n                variant=\"outline\"\r\n                className=\"w-full\"\r\n              >\r\n                <Download className=\"h-4 w-4 mr-2\" />\r\n                Download Template\r\n              </Button>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Stats Section */}\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <CardTitle>Database Stats</CardTitle>\r\n                  <CardDescription>\r\n                    Current pricing data summary\r\n                  </CardDescription>\r\n                </div>\r\n                <Button\r\n                  onClick={refreshData}\r\n                  variant=\"outline\"\r\n                  size=\"icon\"\r\n                  disabled={isLoading}\r\n                >\r\n                  <RefreshCw className={`h-4 w-4 ${isLoading ? 'animate-spin' : ''}`} />\r\n                </Button>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"space-y-1\">\r\n                  <p className=\"text-sm text-muted-foreground\">Total Entries</p>\r\n                  <p className=\"text-2xl font-bold\">{totalCount}</p>\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <p className=\"text-sm text-muted-foreground\">Unique Shapes</p>\r\n                  <p className=\"text-2xl font-bold\">\r\n                    {prices ? new Set(prices.map(p => p.shape)).size : 0}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n                <Button\r\n                  onClick={deleteAllPrices}\r\n                  variant=\"destructive\"\r\n                  className=\"w-full\"\r\n                  disabled={totalCount === 0}\r\n                >\r\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                  Delete All Prices\r\n                </Button>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Search & Filter Section */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Search className=\"h-5 w-5\" />\r\n              Search & Filter\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Filter diamond prices by shape, grades, and carat range\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid gap-4\">\r\n              <div className=\"grid md:grid-cols-3 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>Shape</Label>\r\n                  <Select value={filterShape} onValueChange={setFilterShape}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"All shapes\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"\">All shapes</SelectItem>\r\n                      {uniqueShapes.map(shape => (\r\n                        <SelectItem key={shape} value={shape}>{shape}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label>Color Grade</Label>\r\n                  <Select value={filterColorGrade} onValueChange={setFilterColorGrade}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"All colors\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"\">All colors</SelectItem>\r\n                      {uniqueColorGrades.map(color => (\r\n                        <SelectItem key={color} value={color}>{color}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label>Clarity Grade</Label>\r\n                  <Select value={filterClarityGrade} onValueChange={setFilterClarityGrade}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"All clarities\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"\">All clarities</SelectItem>\r\n                      {uniqueClarityGrades.map(clarity => (\r\n                        <SelectItem key={clarity} value={clarity}>{clarity}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label>Carat Range Min</Label>\r\n                  <Input\r\n                    type=\"number\"\r\n                    step=\"0.01\"\r\n                    placeholder=\"e.g., 0.50\"\r\n                    value={filterCaratMin}\r\n                    onChange={(e) => setFilterCaratMin(e.target.value)}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label>Carat Range Max</Label>\r\n                  <Input\r\n                    type=\"number\"\r\n                    step=\"0.01\"\r\n                    placeholder=\"e.g., 1.00\"\r\n                    value={filterCaratMax}\r\n                    onChange={(e) => setFilterCaratMax(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {hasActiveFilters && (\r\n                <div className=\"flex items-center gap-2 pt-2\">\r\n                  <Badge variant=\"secondary\">\r\n                    {totalCount} {totalCount === 1 ? 'result' : 'results'} found\r\n                  </Badge>\r\n                  <Button\r\n                    onClick={clearFilters}\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-8\"\r\n                  >\r\n                    <X className=\"h-4 w-4 mr-1\" />\r\n                    Clear Filters\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Price List Table */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <History className=\"h-5 w-5\" />\r\n              Diamond Pricing Data\r\n            </CardTitle>\r\n            <CardDescription>\r\n              View current prices and update history\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <Tabs defaultValue=\"current\" className=\"w-full\">\r\n              <TabsList className=\"grid w-full grid-cols-2\">\r\n                <TabsTrigger value=\"current\">Current Prices</TabsTrigger>\r\n                <TabsTrigger value=\"history\">Update History</TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"current\">\r\n                {isLoading ? (\r\n                  <p className=\"text-center py-8 text-muted-foreground\">Loading...</p>\r\n                ) : totalCount === 0 ? (\r\n                  <p className=\"text-center py-8 text-muted-foreground\">\r\n                    No pricing data yet. Upload a CSV to get started.\r\n                  </p>\r\n                ) : (\r\n                  <div className=\"border rounded-lg overflow-auto max-h-[500px]\">\r\n                    <Table>\r\n                      <TableHeader>\r\n                        <TableRow>\r\n                          <TableHead>Shape</TableHead>\r\n                          <TableHead>Carat Range</TableHead>\r\n                          <TableHead>Color</TableHead>\r\n                          <TableHead>Clarity</TableHead>\r\n                          <TableHead>Cut</TableHead>\r\n                          <TableHead className=\"text-right\">Price/Carat</TableHead>\r\n                        </TableRow>\r\n                      </TableHeader>\r\n                      <TableBody>\r\n                        {prices.slice(0, displayCount).map((price) => (\r\n                          <TableRow key={price.id}>\r\n                            <TableCell>\r\n                              <Badge variant=\"outline\">{price.shape}</Badge>\r\n                            </TableCell>\r\n                            <TableCell>\r\n                              {price.carat_range_min} - {price.carat_range_max}\r\n                            </TableCell>\r\n                            <TableCell>{price.color_grade}</TableCell>\r\n                            <TableCell>{price.clarity_grade}</TableCell>\r\n                            <TableCell>{price.cut_grade}</TableCell>\r\n                            <TableCell className=\"text-right font-mono\">\r\n                              {price.currency} {price.price_per_carat.toLocaleString()}\r\n                            </TableCell>\r\n                          </TableRow>\r\n                        ))}\r\n                      </TableBody>\r\n                    </Table>\r\n                    {prices.length > displayCount && (\r\n                      <div className=\"flex flex-col items-center gap-2 py-4 border-t\">\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          Showing {displayCount} of {prices.length} entries\r\n                        </p>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          onClick={() => setDisplayCount(prev => Math.min(prev + 100, prices.length))}\r\n                        >\r\n                          Load More (100)\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"history\">\r\n                {historyLoading ? (\r\n                  <p className=\"text-center py-8 text-muted-foreground\">Loading history...</p>\r\n                ) : !priceHistory || priceHistory.length === 0 ? (\r\n                  <p className=\"text-center py-8 text-muted-foreground\">\r\n                    No price updates recorded yet.\r\n                  </p>\r\n                ) : (\r\n                  <div className=\"border rounded-lg overflow-auto max-h-[500px]\">\r\n                    <Table>\r\n                      <TableHeader>\r\n                        <TableRow>\r\n                          <TableHead>Date</TableHead>\r\n                          <TableHead>Shape</TableHead>\r\n                          <TableHead>Grades</TableHead>\r\n                          <TableHead>Change</TableHead>\r\n                          <TableHead className=\"text-right\">Old Price</TableHead>\r\n                          <TableHead className=\"text-right\">New Price</TableHead>\r\n                          <TableHead>Type</TableHead>\r\n                        </TableRow>\r\n                      </TableHeader>\r\n                      <TableBody>\r\n                        {priceHistory.map((history) => {\r\n                          const priceChange = history.old_price_per_carat \r\n                            ? ((history.new_price_per_carat - history.old_price_per_carat) / history.old_price_per_carat * 100)\r\n                            : 0;\r\n                          const isIncrease = priceChange > 0;\r\n                          \r\n                          return (\r\n                            <TableRow key={history.id}>\r\n                              <TableCell className=\"text-sm\">\r\n                                {new Date(history.changed_at).toLocaleString()}\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Badge variant=\"outline\">{history.shape}</Badge>\r\n                              </TableCell>\r\n                              <TableCell className=\"text-sm\">\r\n                                {history.color_grade}/{history.clarity_grade}/{history.cut_grade}\r\n                                <div className=\"text-xs text-muted-foreground\">\r\n                                  {history.carat_range_min}-{history.carat_range_max}ct\r\n                                </div>\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                {history.change_type === 'insert' ? (\r\n                                  <Badge variant=\"secondary\">New</Badge>\r\n                                ) : history.change_type === 'delete' ? (\r\n                                  <Badge variant=\"destructive\">Deleted</Badge>\r\n                                ) : priceChange !== 0 ? (\r\n                                  <div className=\"flex items-center gap-1\">\r\n                                    {isIncrease ? (\r\n                                      <TrendingUp className=\"h-4 w-4 text-green-500\" />\r\n                                    ) : (\r\n                                      <TrendingDown className=\"h-4 w-4 text-red-500\" />\r\n                                    )}\r\n                                    <span className={isIncrease ? \"text-green-600\" : \"text-red-600\"}>\r\n                                      {isIncrease ? '+' : ''}{priceChange.toFixed(1)}%\r\n                                    </span>\r\n                                  </div>\r\n                                ) : (\r\n                                  <span className=\"text-muted-foreground\">No change</span>\r\n                                )}\r\n                              </TableCell>\r\n                              <TableCell className=\"text-right font-mono text-sm\">\r\n                                {history.old_price_per_carat \r\n                                  ? `${history.currency} ${history.old_price_per_carat.toLocaleString()}`\r\n                                  : '-'}\r\n                              </TableCell>\r\n                              <TableCell className=\"text-right font-mono text-sm\">\r\n                                {history.currency} {history.new_price_per_carat.toLocaleString()}\r\n                              </TableCell>\r\n                              <TableCell>\r\n                                <Badge variant={\r\n                                  history.change_type === 'insert' ? 'default' :\r\n                                  history.change_type === 'delete' ? 'destructive' :\r\n                                  'secondary'\r\n                                }>\r\n                                  {history.change_type}\r\n                                </Badge>\r\n                              </TableCell>\r\n                            </TableRow>\r\n                          );\r\n                        })}\r\n                      </TableBody>\r\n                    </Table>\r\n                    <p className=\"text-sm text-muted-foreground text-center py-3 border-t\">\r\n                      Showing last 100 updates\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n            </Tabs>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </AdminLayout>\r\n  );\r\n};\r\n\r\nexport default AdminDiamondPrices;\r\n"],"names":["AdminDiamondPrices","uploading","setUploading","useState","pearFile","setPearFile","roundFile","setRoundFile","displayCount","setDisplayCount","queryClient","useQueryClient","filterShape","setFilterShape","filterColorGrade","setFilterColorGrade","filterClarityGrade","setFilterClarityGrade","filterCaratMin","setFilterCaratMin","filterCaratMax","setFilterCaratMax","pricesData","isLoading","useQuery","query","supabase","data","error","count","prices","totalCount","uniqueShapes","p","uniqueColorGrades","uniqueClarityGrades","clearFilters","toast","hasActiveFilters","priceHistory","historyLoading","downloadTemplate","headers","sampleData","csv","blob","url","a","parseRapaportFormat","line","defaultShape","values","v","cutGradeMap","cutGrade","parseStandardFormat","handleFileUpload","file","targetShape","lines","records","skippedRows","firstLine","isRapaportFormat","startIndex","i","record","message","deleteAllPrices","refreshData","jsx","AdminLayout","jsxs","Card","CardHeader","CardTitle","Upload","CardDescription","CardContent","Alert","AlertCircle","AlertDescription","Badge","Label","Input","e","_a","Button","Download","RefreshCw","Trash2","Search","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","shape","color","clarity","X","History","Tabs","TabsList","TabsTrigger","TabsContent","Table","TableHeader","TableRow","TableHead","TableBody","price","TableCell","prev","history","priceChange","isIncrease","TrendingUp","TrendingDown"],"mappings":"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"}