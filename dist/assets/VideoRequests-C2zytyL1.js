import{j as e}from"./query-vendor-BLxHmmGk.js";import{u as I,r as o}from"./react-vendor-BeR0k5Z3.js";import{E as M,F as h,B as a,C as i,G as m,H as x,D as n,I as $}from"./index-DGlTgSKx.js";import{B as L}from"./badge-DknkzE8c.js";import{S as P,a as A,b as H,c as U,d as j}from"./select-CQfvDDtS.js";import{D as W,a as G,b as J,c as Q,d as X,e as K}from"./dialog-CRWggOUB.js";import{V as D,J as O,I as Y,a5 as Z,h as N,a3 as v,c as w,aC as q,a7 as R}from"./ui-vendor-CN4tOqpp.js";import{f as ee}from"./format-CqKCEgBk.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-aqCwQlp3.js";import"./index-DjQc2W_p.js";import"./index-CVwUD2ep.js";const je=()=>{const b=I(),{toast:p}=M(),[c,y]=o.useState([]),[V,f]=o.useState(!0),[t,C]=o.useState(null),[d,F]=o.useState("all");o.useEffect(()=>{_()},[]);const _=async()=>{f(!0);try{const{data:{user:s}}=await h.auth.getUser();if(!s){b("/auth");return}const{data:l}=await h.from("share_links").select("id").eq("user_id",s.id);if(!l||l.length===0){y([]),f(!1);return}const r=l.map(B=>B.id),{data:z,error:S}=await h.from("video_requests").select(`
          *,
          products:product_id (
            name,
            sku
          )
        `).in("share_link_id",r).order("created_at",{ascending:!1});if(S)throw S;y(z||[])}catch(s){p({title:"Error",description:s.message||"Failed to fetch video requests",variant:"destructive"})}finally{f(!1)}},g=async(s,l)=>{try{const{error:r}=await h.from("video_requests").update({status:l}).eq("id",s);if(r)throw r;p({title:"Status Updated",description:`Request status changed to ${l}`}),_(),C(null)}catch(r){p({title:"Error",description:r.message||"Failed to update status",variant:"destructive"})}},E=s=>{switch(s){case"pending":return e.jsx(w,{className:"h-4 w-4"});case"fulfilled":return e.jsx(q,{className:"h-4 w-4"});case"declined":return e.jsx(R,{className:"h-4 w-4"});default:return e.jsx(w,{className:"h-4 w-4"})}},T=s=>{switch(s){case"pending":return"secondary";case"fulfilled":return"default";case"declined":return"destructive";default:return"outline"}},k=c.filter(s=>d==="all"||s.status===d),u={total:c.length,pending:c.filter(s=>s.status==="pending").length,fulfilled:c.filter(s=>s.status==="fulfilled").length,declined:c.filter(s=>s.status==="declined").length};return V?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"h-12 w-12 text-primary mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-xl text-foreground",children:"Loading video requests..."})]})}):e.jsx("div",{className:"min-h-screen bg-background p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(a,{variant:"outline",onClick:()=>b("/"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Back to Catalog"]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Video Requests"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(i,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Total Requests"})}),e.jsx(n,{children:e.jsx("p",{className:"text-2xl font-bold text-foreground",children:u.total})})]}),e.jsxs(i,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),e.jsx(n,{children:e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:u.pending})})]}),e.jsxs(i,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Fulfilled"})}),e.jsx(n,{children:e.jsx("p",{className:"text-2xl font-bold text-green-600",children:u.fulfilled})})]}),e.jsxs(i,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Declined"})}),e.jsx(n,{children:e.jsx("p",{className:"text-2xl font-bold text-red-600",children:u.declined})})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs(P,{value:d,onValueChange:F,children:[e.jsx(A,{className:"w-[200px]",children:e.jsx(H,{placeholder:"Filter by status"})}),e.jsxs(U,{children:[e.jsx(j,{value:"all",children:"All Requests"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"fulfilled",children:"Fulfilled"}),e.jsx(j,{value:"declined",children:"Declined"})]})]})}),k.length===0?e.jsx(i,{children:e.jsxs(n,{className:"py-12 text-center",children:[e.jsx(D,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"No video requests found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:d!=="all"?`No ${d} requests at the moment`:"Video requests will appear here when customers request them"})]})}):e.jsx("div",{className:"space-y-4",children:k.map(s=>e.jsxs(i,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-lg",children:s.customer_name}),e.jsxs(L,{variant:T(s.status),className:"gap-1",children:[E(s.status),s.status]})]}),e.jsxs($,{className:"flex items-center gap-4 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),ee(new Date(s.created_at),"MMM d, yyyy 'at' h:mm a")]}),s.products&&e.jsxs("span",{className:"font-medium text-primary",children:["Product: ",s.products.name," (",s.products.sku,")"]})]})]}),e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>C(s),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"View Details"]})}),e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(Q,{children:[e.jsx(X,{children:"Video Request Details"}),e.jsx(K,{children:"Manage this video request and update its status"})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Customer Information"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("a",{href:`mailto:${t.customer_email}`,className:"text-primary hover:underline",children:t.customer_email})]}),t.customer_phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("a",{href:`tel:${t.customer_phone}`,className:"text-primary hover:underline",children:t.customer_phone})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"What They Want to See"}),e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.requested_products})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Update Status"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:t.status==="pending"?"default":"outline",size:"sm",onClick:()=>g(t.id,"pending"),className:"flex-1",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Pending"]}),e.jsxs(a,{variant:t.status==="fulfilled"?"default":"outline",size:"sm",onClick:()=>g(t.id,"fulfilled"),className:"flex-1",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Fulfilled"]}),e.jsxs(a,{variant:t.status==="declined"?"destructive":"outline",size:"sm",onClick:()=>g(t.id,"declined"),className:"flex-1",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Declined"]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>window.open(`mailto:${t.customer_email}`,"_blank"),children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Email Customer"]}),t.customer_phone&&e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>window.open(`https://wa.me/${t.customer_phone.replace(/\D/g,"")}`,"_blank"),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"WhatsApp"]})]})]})]})]})]})]})}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(N,{className:"h-3 w-3"}),s.customer_email,s.customer_phone&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsx(v,{className:"h-3 w-3"}),s.customer_phone]})]}),e.jsx("p",{className:"text-sm text-foreground line-clamp-2",children:s.requested_products})]})]},s.id))})]})})};export{je as default};
//# sourceMappingURL=VideoRequests-C2zytyL1.js.map
