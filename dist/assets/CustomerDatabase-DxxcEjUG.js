import{u as S,j as e}from"./query-vendor-CIvqgC9B.js";import{u as U,r as K}from"./react-vendor-BCzWReGx.js";import{Y as V,B as O,C as x,t as j,x as f,o as h,l as I}from"./index-DBHw7ps1.js";import{I as Y}from"./input-CpEp8mrX.js";import{T as z,a as G,b as w,c as _}from"./tabs-BCLftEi3.js";import{B as H}from"./badge-HmGNQ04n.js";import{T as y,a as C,b as u,c,d as b,e as t}from"./table-CywLfQKL.js";import{a3 as J,i as g,H as W,N as X,a0 as Z,ac as L}from"./ui-vendor-B3Ur81tx.js";import{f as M}from"./format-CqKCEgBk.js";import"./supabase-vendor-DJknrin8.js";import"./index-vM6_qKqc.js";import"./index-lgWsV-kP.js";const xe=()=>{const B=U(),{isAdmin:v,loading:P}=V(),[n,q]=K.useState(""),[F,$]=K.useState("all"),{data:o,isLoading:D}=S({queryKey:["customer-interests"],queryFn:async()=>{const{data:s,error:a}=await I.from("product_interests").select(`
          *,
          product:product_id (
            name,
            sku,
            category
          ),
          share_link:share_link_id (
            share_token
          )
        `).order("created_at",{ascending:!1});if(a)throw a;return s},enabled:v}),{data:m,isLoading:Q}=S({queryKey:["customer-inquiries"],queryFn:async()=>{const{data:s,error:a}=await I.from("catalog_inquiries").select(`
          *,
          share_link:share_link_id (
            share_token
          )
        `).order("created_at",{ascending:!1});if(a)throw a;return s},enabled:v}),{data:T,isLoading:R}=S({queryKey:["manufacturing-estimates-customers"],queryFn:async()=>{const{data:s,error:a}=await I.from("manufacturing_cost_estimates").select("*").not("customer_name","is",null).order("created_at",{ascending:!1});if(a)throw a;return s},enabled:v}),A=o==null?void 0:o.filter(s=>{var r,l,d,i,N;if(!n)return!0;const a=n.toLowerCase();return((r=s.customer_name)==null?void 0:r.toLowerCase().includes(a))||((l=s.customer_email)==null?void 0:l.toLowerCase().includes(a))||((d=s.customer_phone)==null?void 0:d.toLowerCase().includes(a))||((N=(i=s.product)==null?void 0:i.name)==null?void 0:N.toLowerCase().includes(a))}),k=m==null?void 0:m.filter(s=>{var r,l,d,i;if(!n)return!0;const a=n.toLowerCase();return((r=s.customer_name)==null?void 0:r.toLowerCase().includes(a))||((l=s.customer_email)==null?void 0:l.toLowerCase().includes(a))||((d=s.customer_phone)==null?void 0:d.toLowerCase().includes(a))||((i=s.message)==null?void 0:i.toLowerCase().includes(a))}),p=T==null?void 0:T.filter(s=>{var l,d,i,N;const a=!n||((l=s.customer_name)==null?void 0:l.toLowerCase().includes(n.toLowerCase()))||((d=s.customer_email)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((i=s.customer_phone)==null?void 0:i.includes(n))||((N=s.estimate_name)==null?void 0:N.toLowerCase().includes(n.toLowerCase())),r=F==="all"||s.status===F;return a&&r}),E=()=>{const s=new Map;return o==null||o.forEach(a=>{const r=a.customer_email;s.has(r)||s.set(r,{name:a.customer_name,email:a.customer_email,phone:a.customer_phone,interests:0,inquiries:0,lastActivity:a.created_at});const l=s.get(r);l.interests++,new Date(a.created_at)>new Date(l.lastActivity)&&(l.lastActivity=a.created_at)}),m==null||m.forEach(a=>{const r=a.customer_email;s.has(r)||s.set(r,{name:a.customer_name,email:a.customer_email,phone:a.customer_phone,interests:0,inquiries:0,lastActivity:a.created_at});const l=s.get(r);l.inquiries++,new Date(a.created_at)>new Date(l.lastActivity)&&(l.lastActivity=a.created_at)}),Array.from(s.values()).filter(a=>{var l,d,i;if(!n)return!0;const r=n.toLowerCase();return((l=a.name)==null?void 0:l.toLowerCase().includes(r))||((d=a.email)==null?void 0:d.toLowerCase().includes(r))||((i=a.phone)==null?void 0:i.toLowerCase().includes(r))})};return P?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):v?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{variant:"ghost",onClick:()=>B("/super-admin"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Customer Database"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Customers"}),e.jsx(g,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:E().length})})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Product Interests"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:(o==null?void 0:o.length)||0})})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Catalog Inquiries"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:(m==null?void 0:m.length)||0})})]})]}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(Y,{type:"text",placeholder:"Search customers by name, email, or phone...",value:n,onChange:s=>q(s.target.value),className:"pl-10 h-12 text-base"})]})})}),e.jsxs(z,{defaultValue:"customers",className:"w-full",children:[e.jsxs(G,{className:"grid w-full max-w-2xl grid-cols-4",children:[e.jsx(w,{value:"customers",children:"Customers"}),e.jsx(w,{value:"interests",children:"Interests"}),e.jsx(w,{value:"inquiries",children:"Inquiries"}),e.jsx(w,{value:"manufacturing",children:"Manufacturing"})]}),e.jsx(_,{value:"customers",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(f,{children:"All Customers"})}),e.jsx(h,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(y,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Contact"}),e.jsx(c,{children:"Interests"}),e.jsx(c,{children:"Inquiries"}),e.jsx(c,{children:"Last Activity"})]})}),e.jsx(b,{children:E().map((s,a)=>e.jsxs(u,{children:[e.jsx(t,{className:"font-medium",children:s.name}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(g,{className:"h-3 w-3"}),s.email]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(L,{className:"h-3 w-3"}),s.phone]})]})}),e.jsx(t,{children:e.jsx(H,{variant:"outline",children:s.interests})}),e.jsx(t,{children:e.jsx(H,{variant:"outline",children:s.inquiries})}),e.jsx(t,{className:"text-sm text-muted-foreground",children:M(new Date(s.lastActivity),"MMM dd, yyyy HH:mm")})]},a))})]})})})]})}),e.jsx(_,{value:"interests",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(f,{children:"Product Interests"})}),e.jsx(h,{children:D?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(y,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(c,{children:"Customer"}),e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Contact"}),e.jsx(c,{children:"Notes"}),e.jsx(c,{children:"Date"})]})}),e.jsx(b,{children:A==null?void 0:A.map(s=>{var a,r;return e.jsxs(u,{children:[e.jsx(t,{className:"font-medium",children:s.customer_name}),e.jsx(t,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((a=s.product)==null?void 0:a.name)||"N/A"}),((r=s.product)==null?void 0:r.sku)&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["SKU: ",s.product.sku]})]})}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.customer_email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),s.customer_email]}),s.customer_phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),s.customer_phone]})]})}),e.jsx(t,{className:"max-w-xs truncate",children:s.notes||"-"}),e.jsx(t,{className:"text-sm text-muted-foreground",children:M(new Date(s.created_at),"MMM dd, yyyy")})]},s.id)})})]})})})]})}),e.jsx(_,{value:"inquiries",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(f,{children:"Catalog Inquiries"})}),e.jsx(h,{children:Q?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(y,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(c,{children:"Customer"}),e.jsx(c,{children:"Contact"}),e.jsx(c,{children:"Message"}),e.jsx(c,{children:"Date"})]})}),e.jsx(b,{children:k==null?void 0:k.map(s=>e.jsxs(u,{children:[e.jsx(t,{className:"font-medium",children:s.customer_name}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),s.customer_email]}),s.customer_phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),s.customer_phone]})]})}),e.jsx(t,{className:"max-w-md",children:e.jsx("div",{className:"line-clamp-2",children:s.message})}),e.jsx(t,{className:"text-sm text-muted-foreground",children:M(new Date(s.created_at),"MMM dd, yyyy")})]},s.id))})]})})})]})}),e.jsx(_,{value:"manufacturing",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(f,{children:"Manufacturing Orders"})}),e.jsx(h,{children:R?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):!p||p.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No manufacturing orders found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(y,{children:[e.jsx(C,{children:e.jsxs(u,{children:[e.jsx(c,{children:"Customer"}),e.jsx(c,{children:"Contact"}),e.jsx(c,{children:"Estimate"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Value"}),e.jsx(c,{children:"Date"})]})}),e.jsx(b,{children:p==null?void 0:p.map(s=>{var a,r;return e.jsxs(u,{children:[e.jsxs(t,{className:"font-medium",children:[s.customer_name,s.customer_address&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.customer_address})]}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.customer_email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),s.customer_email]}),s.customer_phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),s.customer_phone]})]})}),e.jsx(t,{children:s.estimate_name}),e.jsx(t,{children:e.jsx(H,{variant:s.status==="completed"?"default":s.status==="cancelled"?"destructive":"secondary",children:((a=s.status)==null?void 0:a.replace("_"," "))||"draft"})}),e.jsx(t,{children:e.jsxs("div",{className:"font-semibold",children:["â‚¹",(r=s.final_selling_price)==null?void 0:r.toFixed(2)]})}),e.jsx(t,{className:"text-sm text-muted-foreground",children:M(new Date(s.created_at),"MMM dd, yyyy")})]},s.id)})})]})})})]})})]})]}):(B("/"),null)};export{xe as default};
//# sourceMappingURL=CustomerDatabase-DxxcEjUG.js.map
