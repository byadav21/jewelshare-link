import{j as e}from"./query-vendor-BLxHmmGk.js";import{u as R,r as t}from"./react-vendor-BeR0k5Z3.js";import{s as u,W as $,B as h,C as W,i as G,k as K,l as J,g as X}from"./index-CX6yiz0b.js";import{D as Y,b as Z,c as ee,d as se,e as ae,f as re}from"./dialog-KVJ8gRMk.js";import{S as w,a as N,b as C,c as k,d as j}from"./select-CYWHo3cU.js";import{I as x}from"./input-CiHC6UAI.js";import{L as l}from"./label-DbIM3Eg1.js";import{B as ne}from"./badge-45Abp579.js";import{T as te,a as ie,b as S,c as o,d as le,e as d}from"./table-CYMzKz5T.js";import{u as m,E as ce,ac as oe,aO as P,K as de,ay as me}from"./ui-vendor-DjQqXt9S.js";import{S as T}from"./switch-7lvrHTHU.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-DhS5fNEb.js";import"./index-D6fUEw85.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-DjQc2W_p.js";function Le(){const b=R(),[D,L]=t.useState([]),[_,M]=t.useState([]),[V,v]=t.useState(!0),[f,I]=t.useState(""),[c,A]=t.useState(null),[_e,ue]=t.useState(!1),[E,p]=t.useState(!1),[n,i]=t.useState({});t.useEffect(()=>{g(),O()},[]);const g=async()=>{try{v(!0);const{data:s,error:a}=await u.from("vendor_permissions").select("*").order("subscription_plan");if(a)throw a;const r=await Promise.all((s||[]).map(async y=>{const{data:Q}=await u.from("vendor_profiles").select("business_name, email").eq("user_id",y.user_id).single();return{...y,vendor_info:Q||{business_name:null,email:null}}}));L(r)}catch(s){m.error("Failed to fetch vendors"),console.error(s)}finally{v(!1)}},O=async()=>{try{const{data:s,error:a}=await u.from("permission_templates").select("*").order("name");if(a)throw a;M(s||[])}catch(s){console.error("Failed to fetch templates",s)}},F=async s=>{if(!c)return;const a=_.find(r=>r.id===s);if(a)try{const{error:r}=await u.from("vendor_permissions").update(a.template_config).eq("user_id",c.user_id);if(r)throw r;m.success(`Template "${a.name}" applied successfully`),p(!1),g()}catch(r){m.error("Failed to apply template"),console.error(r)}},B=async(s,a)=>{try{const{error:r}=await u.from("vendor_permissions").update({subscription_plan:a}).eq("user_id",s);if(r)throw r;m.success("Plan updated successfully"),g()}catch(r){m.error("Failed to update plan"),console.error(r)}},q=s=>{A(s),i({max_products:s.max_products,max_share_links:s.max_share_links,max_team_members:s.max_team_members,max_product_images:s.max_product_images,max_active_sessions:s.max_active_sessions,override_plan_limits:s.override_plan_limits,can_add_products:s.can_add_products,can_edit_products:s.can_edit_products,can_delete_products:s.can_delete_products,can_view_catalog:s.can_view_catalog,can_share_catalog:s.can_share_catalog,can_manage_share_links:s.can_manage_share_links,can_view_share_links:s.can_view_share_links,can_view_interests:s.can_view_interests,can_manage_team:s.can_manage_team,can_edit_profile:s.can_edit_profile,can_add_vendor_details:s.can_add_vendor_details,can_view_custom_orders:s.can_view_custom_orders,can_manage_custom_orders:s.can_manage_custom_orders,can_import_data:s.can_import_data,can_view_sessions:s.can_view_sessions,can_manage_sessions:s.can_manage_sessions}),p(!0)},H=async()=>{if(c)try{const{error:s}=await u.from("vendor_permissions").update(n).eq("user_id",c.user_id);if(s)throw s;m.success("Custom plan saved successfully"),p(!1),g()}catch(s){m.error("Failed to save custom plan"),console.error(s)}},U=D.filter(s=>{var a,r;return((a=s.vendor_info.business_name)==null?void 0:a.toLowerCase().includes(f.toLowerCase()))||((r=s.vendor_info.email)==null?void 0:r.toLowerCase().includes(f.toLowerCase()))}),z=s=>{switch(s){case"starter":return"bg-secondary text-secondary-foreground";case"professional":return"bg-primary text-primary-foreground";case"enterprise":return"bg-accent text-accent-foreground";default:return"bg-muted text-muted-foreground"}};return e.jsx($,{children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>b("/super-admin"),children:e.jsx(ce,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(oe,{className:"h-8 w-8 text-primary"}),"Plan Management"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Manage vendor subscription plans and permissions",_.length>0&&` • ${_.length} template${_.length!==1?"s":""} available`]})]})]}),e.jsxs(h,{variant:"outline",onClick:()=>b("/permission-presets"),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Manage Templates"]})]})})}),e.jsx("main",{className:"container mx-auto px-6 py-8",children:e.jsxs(W,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(K,{children:"Vendor Plans"}),e.jsx(J,{children:"View and manage subscription plans for all vendors"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-72",children:[e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search vendors...",value:f,onChange:s=>I(s.target.value)})]})]})}),e.jsx(X,{children:V?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading vendors..."}):e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(S,{children:[e.jsx(o,{children:"Business Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Current Plan"}),e.jsx(o,{children:"Products"}),e.jsx(o,{children:"Share Links"}),e.jsx(o,{children:"Team Members"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx(le,{children:U.map(s=>e.jsxs(S,{children:[e.jsx(d,{className:"font-medium",children:s.vendor_info.business_name||"N/A"}),e.jsx(d,{className:"text-muted-foreground",children:s.vendor_info.email||"N/A"}),e.jsx(d,{children:e.jsx(ne,{className:z(s.subscription_plan),children:s.subscription_plan})}),e.jsx(d,{children:s.max_products||"∞"}),e.jsx(d,{children:s.max_share_links||"∞"}),e.jsx(d,{children:s.max_team_members||"∞"}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(w,{value:s.subscription_plan,onValueChange:a=>B(s.user_id,a),children:[e.jsx(N,{className:"w-36",children:e.jsx(C,{})}),e.jsxs(k,{children:[e.jsx(j,{value:"starter",children:"Starter"}),e.jsx(j,{value:"professional",children:"Professional"}),e.jsx(j,{value:"enterprise",children:"Enterprise"})]})]}),e.jsx(h,{variant:"outline",size:"icon",onClick:()=>q(s),children:e.jsx(me,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})}),e.jsx(Y,{open:E,onOpenChange:p,children:e.jsxs(Z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Custom Plan Configuration"}),e.jsxs(ae,{children:["Configure custom limits and permissions for ",c==null?void 0:c.vendor_info.business_name]})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[_.length>0&&e.jsx("div",{className:"space-y-4 p-4 bg-primary/5 rounded-lg border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-base font-semibold",children:"Apply Permission Template"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-3",children:"Quick apply a saved permission preset to this vendor"}),e.jsxs(w,{onValueChange:F,children:[e.jsx(N,{className:"w-full",children:e.jsx(C,{placeholder:"Select a template..."})}),e.jsx(k,{children:_.map(s=>e.jsx(j,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),s.description&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.description})]})},s.id))})]})]})]})}),e.jsx("div",{className:"space-y-4 p-4 bg-muted/50 rounded-lg border border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"override_limits",className:"text-base font-semibold",children:"Override Plan Limits"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Allow this vendor to bypass all plan restrictions and limits"})]}),e.jsx(T,{id:"override_limits",checked:n.override_plan_limits||!1,onCheckedChange:s=>i({...n,override_plan_limits:s})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Resource Limits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Products"}),e.jsx(x,{type:"number",value:n.max_products||"",onChange:s=>i({...n,max_products:parseInt(s.target.value)||null}),placeholder:"Unlimited"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Share Links"}),e.jsx(x,{type:"number",value:n.max_share_links||"",onChange:s=>i({...n,max_share_links:parseInt(s.target.value)||null}),placeholder:"Unlimited"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Team Members"}),e.jsx(x,{type:"number",value:n.max_team_members||"",onChange:s=>i({...n,max_team_members:parseInt(s.target.value)||null}),placeholder:"Unlimited"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Product Images"}),e.jsx(x,{type:"number",value:n.max_product_images||"",onChange:s=>i({...n,max_product_images:parseInt(s.target.value)||null}),placeholder:"Unlimited"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Max Active Sessions"}),e.jsx(x,{type:"number",value:n.max_active_sessions||"",onChange:s=>i({...n,max_active_sessions:parseInt(s.target.value)||3})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Permissions"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{key:"can_add_products",label:"Add Products"},{key:"can_edit_products",label:"Edit Products"},{key:"can_delete_products",label:"Delete Products"},{key:"can_view_catalog",label:"View Catalog"},{key:"can_share_catalog",label:"Share Catalog"},{key:"can_manage_share_links",label:"Manage Share Links"},{key:"can_view_share_links",label:"View Share Links"},{key:"can_view_interests",label:"View Interests"},{key:"can_manage_team",label:"Manage Team"},{key:"can_edit_profile",label:"Edit Profile"},{key:"can_add_vendor_details",label:"Add Vendor Details"},{key:"can_view_custom_orders",label:"View Custom Orders"},{key:"can_manage_custom_orders",label:"Manage Custom Orders"},{key:"can_import_data",label:"Import Data"},{key:"can_view_sessions",label:"View Sessions"},{key:"can_manage_sessions",label:"Manage Sessions"}].map(({key:s,label:a})=>e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsx(l,{htmlFor:s,className:"text-sm",children:a}),e.jsx(T,{id:s,checked:n[s]||!1,onCheckedChange:r=>i({...n,[s]:r})})]},s))})]})]}),e.jsxs(re,{children:[e.jsx(h,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(h,{onClick:H,children:"Save Custom Plan"})]})]})})]})})}export{Le as default};
//# sourceMappingURL=PlanManagement-C4k6gnDq.js.map
