{"version":3,"file":"Import-BIiFWPGz.js","sources":["../../src/utils/currencyConversion.ts","../../src/utils/columnMapping.ts","../../src/components/ColumnMappingPreview.tsx","../../src/pages/Import.tsx"],"sourcesContent":["// Currency conversion utility using ExchangeRate-API\r\nconst EXCHANGE_RATE_API = 'https://api.exchangerate-api.com/v4/latest/INR';\r\n\r\nlet cachedRate: number | null = null;\r\nlet cacheTimestamp: number = 0;\r\nconst CACHE_DURATION = 3600000; // 1 hour in milliseconds\r\n\r\nexport const convertINRtoUSD = async (inrAmount: number): Promise<number> => {\r\n  try {\r\n    // Check if we have a valid cached rate\r\n    const now = Date.now();\r\n    if (cachedRate && (now - cacheTimestamp) < CACHE_DURATION) {\r\n      return parseFloat((inrAmount * cachedRate).toFixed(2));\r\n    }\r\n\r\n    // Fetch new rate\r\n    const response = await fetch(EXCHANGE_RATE_API);\r\n    const data = await response.json();\r\n    \r\n    if (data.rates && data.rates.USD) {\r\n      cachedRate = data.rates.USD;\r\n      cacheTimestamp = now;\r\n      return parseFloat((inrAmount * cachedRate).toFixed(2));\r\n    }\r\n    \r\n    // Fallback to approximate rate if API fails\r\n    console.warn('Currency API failed, using fallback rate');\r\n    return parseFloat((inrAmount * 0.012).toFixed(2));\r\n  } catch (error) {\r\n    console.error('Currency conversion error:', error);\r\n    // Fallback rate (approximate)\r\n    return parseFloat((inrAmount * 0.012).toFixed(2));\r\n  }\r\n};\r\n\r\nexport const getCachedUSDRate = (): number => {\r\n  return cachedRate || 0.012; // Fallback approximate rate\r\n};\r\n","type ProductType = 'Jewellery' | 'Gemstones' | 'Loose Diamonds';\r\n\r\ninterface ExpectedColumns {\r\n  required: string[];\r\n  optional: string[];\r\n}\r\n\r\nexport const getExpectedColumns = (productType: ProductType): ExpectedColumns => {\r\n  switch (productType) {\r\n    case 'Gemstones':\r\n      return {\r\n        required: [\r\n          'SKU ID',\r\n          'GEMSTONE NAME',\r\n          'PRICE INR', // Also accepts PRICE_INR\r\n          'STOCK QUANTITY'\r\n        ],\r\n        optional: [\r\n          'GEMSTONE TYPE',\r\n          'CARAT WEIGHT',\r\n          'COLOR',\r\n          'CLARITY',\r\n          'CUT',\r\n          'POLISH',\r\n          'SYMMETRY',\r\n          'MEASUREMENT',\r\n          'CERTIFICATION',\r\n          'IMAGE URL', // Also accepts IMAGE_URL\r\n          'COST PRICE', // Also accepts COST_PRICE\r\n          'RETAIL PRICE' // Also accepts RETAIL_PRICE\r\n        ]\r\n      };\r\n    \r\n    case 'Loose Diamonds':\r\n      return {\r\n        required: [\r\n          'SKU NO',\r\n          'DIAMOND TYPE',\r\n          'SHAPE',\r\n          'CARAT',\r\n          'COLOR',\r\n          'CLARITY',\r\n          'PRICE INR', // Also accepts PRICE_INR\r\n          'STOCK QUANTITY'\r\n        ],\r\n        optional: [\r\n          'STATUS',\r\n          'COLOR SHADE AMOUNT',\r\n          'CUT',\r\n          'POLISH',\r\n          'SYMMETRY',\r\n          'FLO',\r\n          'MEASUREMENT',\r\n          'RATIO',\r\n          'LAB',\r\n          'IMAGE URL', // Also accepts IMAGE_URL\r\n          'COST PRICE', // Also accepts COST_PRICE\r\n          'RETAIL PRICE' // Also accepts RETAIL_PRICE\r\n        ]\r\n      };\r\n    \r\n    case 'Jewellery':\r\n    default:\r\n      return {\r\n        required: [\r\n          'Prodcut', // Product name - accepts: Prodcut, Product Title, Name, PRODUCT\r\n          'Gross Weight', // Weight - accepts: Gross Weight, G WT, GWT\r\n          'PURITY_FRACTION_USED' // Purity - accepts: PURITY_FRACTION_USED, Purity\r\n        ],\r\n        optional: [\r\n          'SKU',\r\n          'Category',\r\n          'Metal Type',\r\n          'Diamond Color',\r\n          'Diamond CLARITY',\r\n          'Diamond Weight 1',\r\n          'Diamond Weight 2',\r\n          'Diamond RATE 1',\r\n          'Diamond Rate 2',\r\n          'Center stone TYPE',\r\n          'Certification cost',\r\n          'Gemstone cost',\r\n          'IMAGE_URL',\r\n          'STOCK QUANTITY',\r\n          'DELIVERY TYPE',\r\n          'Description'\r\n        ]\r\n      };\r\n  }\r\n};\r\n\r\nexport const normalizeColumnName = (columnName: string): string => {\r\n  return columnName\r\n    .toLowerCase()\r\n    .replace(/[_\\s-]/g, '')\r\n    .trim();\r\n};\r\n\r\nexport const findBestMatch = (\r\n  detectedColumn: string,\r\n  expectedColumns: string[]\r\n): string | null => {\r\n  const normalized = normalizeColumnName(detectedColumn);\r\n  \r\n  for (const expected of expectedColumns) {\r\n    const expectedNorm = normalizeColumnName(expected);\r\n    \r\n    // Exact match after normalization\r\n    if (normalized === expectedNorm) {\r\n      return expected;\r\n    }\r\n    \r\n    // Contains match\r\n    if (normalized.includes(expectedNorm) || expectedNorm.includes(normalized)) {\r\n      return expected;\r\n    }\r\n  }\r\n  \r\n  return null;\r\n};\r\n","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CheckCircle2, AlertCircle, ArrowRight } from \"lucide-react\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\n\r\ninterface ColumnMapping {\r\n  excelColumn: string;\r\n  databaseField: string;\r\n  sampleValue: string;\r\n  dataType: string;\r\n  required: boolean;\r\n  mapped: boolean;\r\n  columnPosition?: string; // e.g., \"C\" for column C\r\n}\r\n\r\ninterface ColumnMappingPreviewProps {\r\n  mappings: ColumnMapping[];\r\n  productType: string;\r\n}\r\n\r\nexport const ColumnMappingPreview = ({ mappings, productType }: ColumnMappingPreviewProps) => {\r\n  const requiredMappings = mappings.filter(m => m.required);\r\n  const optionalMappings = mappings.filter(m => !m.required);\r\n  const successfulMappings = mappings.filter(m => m.mapped);\r\n  const missingMappings = requiredMappings.filter(m => !m.mapped);\r\n\r\n  return (\r\n    <Card className=\"border-2 border-primary/20\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <CardTitle className=\"text-lg\">Column Mapping Preview</CardTitle>\r\n            <CardDescription>\r\n              Review how your Excel columns will be imported for {productType}\r\n            </CardDescription>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Badge variant={missingMappings.length === 0 ? \"default\" : \"destructive\"} className=\"gap-1\">\r\n              <CheckCircle2 className=\"h-3 w-3\" />\r\n              {successfulMappings.length} / {requiredMappings.length} required\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <ScrollArea className=\"h-[400px] pr-4\">\r\n          <div className=\"space-y-6\">\r\n            {/* Required Fields Section */}\r\n            <div className=\"space-y-3\">\r\n              <h3 className=\"font-semibold text-sm flex items-center gap-2 text-primary\">\r\n                <span className=\"h-px flex-1 bg-gradient-to-r from-primary/50 to-transparent\"></span>\r\n                Required Fields\r\n                <span className=\"h-px flex-1 bg-gradient-to-l from-primary/50 to-transparent\"></span>\r\n              </h3>\r\n              {requiredMappings.map((mapping, idx) => (\r\n                <MappingRow key={`req-${idx}`} mapping={mapping} />\r\n              ))}\r\n            </div>\r\n\r\n            {/* Optional Fields Section */}\r\n            {optionalMappings.length > 0 && (\r\n              <div className=\"space-y-3\">\r\n                <h3 className=\"font-semibold text-sm flex items-center gap-2 text-muted-foreground\">\r\n                  <span className=\"h-px flex-1 bg-gradient-to-r from-border to-transparent\"></span>\r\n                  Optional Fields\r\n                  <span className=\"h-px flex-1 bg-gradient-to-l from-border to-transparent\"></span>\r\n                </h3>\r\n                {optionalMappings.map((mapping, idx) => (\r\n                  <MappingRow key={`opt-${idx}`} mapping={mapping} />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n\r\n        {/* Summary Footer */}\r\n        <div className=\"mt-4 pt-4 border-t border-border\">\r\n          <div className=\"grid grid-cols-3 gap-4 text-center\">\r\n            <div className=\"p-2 bg-green-500/10 rounded\">\r\n              <p className=\"text-xs text-muted-foreground\">Mapped</p>\r\n              <p className=\"text-lg font-bold text-green-600\">{successfulMappings.length}</p>\r\n            </div>\r\n            <div className=\"p-2 bg-amber-500/10 rounded\">\r\n              <p className=\"text-xs text-muted-foreground\">Optional</p>\r\n              <p className=\"text-lg font-bold text-amber-600\">{optionalMappings.filter(m => !m.mapped).length}</p>\r\n            </div>\r\n            <div className=\"p-2 bg-destructive/10 rounded\">\r\n              <p className=\"text-xs text-muted-foreground\">Missing</p>\r\n              <p className=\"text-lg font-bold text-destructive\">{missingMappings.length}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nconst MappingRow = ({ mapping }: { mapping: ColumnMapping }) => {\r\n  return (\r\n    <div className={`\r\n      p-3 rounded-lg border transition-all\r\n      ${mapping.mapped \r\n        ? 'bg-green-500/5 border-green-500/20' \r\n        : mapping.required \r\n          ? 'bg-destructive/5 border-destructive/20'\r\n          : 'bg-muted/30 border-border/50'\r\n      }\r\n    `}>\r\n      <div className=\"flex items-start gap-3\">\r\n        {/* Status Icon */}\r\n        <div className=\"mt-0.5\">\r\n          {mapping.mapped ? (\r\n            <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n          ) : mapping.required ? (\r\n            <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n          ) : (\r\n            <div className=\"h-4 w-4 rounded-full border-2 border-muted-foreground/30\" />\r\n          )}\r\n        </div>\r\n\r\n        {/* Mapping Details */}\r\n        <div className=\"flex-1 space-y-1\">\r\n          <div className=\"flex items-center gap-2 flex-wrap\">\r\n            {/* Excel Column */}\r\n            <div className=\"flex items-center gap-1\">\r\n              {mapping.columnPosition && (\r\n                <Badge variant=\"outline\" className=\"text-xs font-mono\">\r\n                  Col {mapping.columnPosition}\r\n                </Badge>\r\n              )}\r\n              <code className=\"px-2 py-0.5 bg-background rounded text-xs font-mono\">\r\n                {mapping.excelColumn}\r\n              </code>\r\n            </div>\r\n\r\n            {/* Arrow */}\r\n            <ArrowRight className=\"h-3 w-3 text-muted-foreground\" />\r\n\r\n            {/* Database Field */}\r\n            <code className=\"px-2 py-0.5 bg-primary/10 rounded text-xs font-mono text-primary\">\r\n              {mapping.databaseField}\r\n            </code>\r\n\r\n            {/* Required Badge */}\r\n            {mapping.required && (\r\n              <Badge variant=\"secondary\" className=\"text-xs\">\r\n                Required\r\n              </Badge>\r\n            )}\r\n\r\n            {/* Data Type */}\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              ({mapping.dataType})\r\n            </span>\r\n          </div>\r\n\r\n          {/* Sample Value */}\r\n          {mapping.sampleValue && (\r\n            <div className=\"text-xs text-muted-foreground\">\r\n              <span className=\"font-medium\">Sample:</span>{' '}\r\n              <span className=\"italic\">\"{mapping.sampleValue}\"</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};","import { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { ApprovalGuard } from \"@/components/ApprovalGuard\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { ArrowLeft, Upload, Loader2, Download, AlertCircle, CheckCircle2 } from \"lucide-react\";\r\nimport * as XLSX from 'xlsx';\r\nimport { productImportSchema, gemstoneImportSchema, diamondImportSchema } from \"@/lib/validations\";\r\nimport { generateProductTemplate } from \"@/utils/generateTemplate\";\r\nimport { convertINRtoUSD } from \"@/utils/currencyConversion\";\r\nimport { getExpectedColumns } from \"@/utils/columnMapping\";\r\nimport { ColumnMappingPreview } from \"@/components/ColumnMappingPreview\";\r\nimport { safeNumber, normalizePurity, processJewelryImportRow } from \"@/utils/jewelryCalculations\";\r\n\r\ntype ProductType = 'Jewellery' | 'Gemstones' | 'Loose Diamonds';\r\n\r\nconst Import = () => {\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [selectedProductType, setSelectedProductType] = useState<ProductType>('Jewellery');\r\n  const [importErrors, setImportErrors] = useState<Array<{row: number, product: string, errors: string[]}>>([]);\r\n  const [previewData, setPreviewData] = useState<{\r\n    valid: any[];\r\n    invalid: Array<{row: number, product: string, errors: string[]}>;\r\n  } | null>(null);\r\n  const [columnMappings, setColumnMappings] = useState<{\r\n    detected: string[];\r\n    missing: string[];\r\n    suggestions: Record<string, string>;\r\n  } | null>(null);\r\n  const [detailedMappings, setDetailedMappings] = useState<Array<{\r\n    excelColumn: string;\r\n    databaseField: string;\r\n    sampleValue: string;\r\n    dataType: string;\r\n    required: boolean;\r\n    mapped: boolean;\r\n    columnPosition?: string;\r\n  }>>([]);\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n\r\n  // Fetch approved categories\r\n  const { data: approvedCategories } = useQuery({\r\n    queryKey: ['approvedCategories'],\r\n    queryFn: async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return [];\r\n\r\n      const { data } = await supabase\r\n        .from('user_approval_status')\r\n        .select('approved_categories')\r\n        .eq('user_id', user.id)\r\n        .single();\r\n\r\n      return (data?.approved_categories || []) as string[];\r\n    },\r\n  });\r\n\r\n  // ============================================\r\n  // Product Row Processing Helpers\r\n  // ============================================\r\n\r\n  const processGemstoneRow = async (\r\n    row: Record<string, any>,\r\n    userId: string,\r\n    index: number,\r\n    imageUrl: string | null,\r\n    imageUrl2: string | null,\r\n    imageUrl3: string | null\r\n  ) => {\r\n    const priceINR = safeNumber(row['PRICE INR'] || row.PRICE_INR || row['Price INR'] || row['Price']);\r\n    const hasCostPrice = 'COST PRICE' in row || 'COST_PRICE' in row || 'Cost Price' in row;\r\n    const hasRetailPrice = 'RETAIL PRICE' in row || 'RETAIL_PRICE' in row || 'Retail Price' in row;\r\n    \r\n    const costPriceRaw = hasCostPrice ? safeNumber(row['COST PRICE'] || row.COST_PRICE || row['Cost Price']) : null;\r\n    const retailPriceRaw = hasRetailPrice ? safeNumber(row['RETAIL PRICE'] || row.RETAIL_PRICE || row['Retail Price']) : null;\r\n    \r\n    const safePriceVal = (priceINR && priceINR > 0) ? priceINR : 0.01;\r\n    const costPrice = (costPriceRaw !== null && costPriceRaw > 0) ? costPriceRaw : safePriceVal;\r\n    const retailPrice = (retailPriceRaw !== null && retailPriceRaw > 0) ? retailPriceRaw : safePriceVal;\r\n    const priceUSD = safePriceVal > 0.01 ? await convertINRtoUSD(safePriceVal) : null;\r\n    \r\n    return {\r\n      user_id: userId,\r\n      sku: row['SKU ID'] || row['SKU'] || `GEM-${index + 1}`,\r\n      gemstone_name: row['GEMSTONE NAME'] || row['Gemstone Name'] || 'Ruby',\r\n      gemstone_type: row['GEMSTONE TYPE'] || row['Gemstone Type'] || null,\r\n      carat_weight: safeNumber(row['CARAT WEIGHT'] || row['Carat Weight']),\r\n      color: row['COLOR'] || row['Color'] || null,\r\n      clarity: row['CLARITY'] || row['Clarity'] || null,\r\n      cut: row['CUT'] || row['Cut'] || null,\r\n      polish: row['POLISH'] || row['Polish'] || null,\r\n      symmetry: row['SYMMETRY'] || row['Symmetry'] || null,\r\n      measurement: row['MEASUREMENT'] || row['Measurement'] || null,\r\n      certification: row['CERTIFICATION'] || row['Certification'] || null,\r\n      image_url: imageUrl,\r\n      image_url_2: imageUrl2,\r\n      image_url_3: imageUrl3,\r\n      price_inr: safePriceVal,\r\n      price_usd: priceUSD,\r\n      cost_price: costPrice,\r\n      retail_price: retailPrice,\r\n      stock_quantity: safeNumber(row['STOCK QUANTITY'] || row['Stock Quantity']) || 1,\r\n      product_type: 'Gemstones',\r\n      name: row['GEMSTONE NAME'] || row['Gemstone Name'] || 'Unknown Gemstone',\r\n    };\r\n  };\r\n\r\n  const processDiamondRow = async (\r\n    row: Record<string, any>,\r\n    userId: string,\r\n    index: number,\r\n    imageUrl: string | null,\r\n    imageUrl2: string | null,\r\n    imageUrl3: string | null\r\n  ) => {\r\n    const priceINR = safeNumber(row['PRICE INR'] || row.PRICE_INR || row['Price INR'] || row['Price']);\r\n    const hasCostPrice = 'COST PRICE' in row || 'COST_PRICE' in row || 'Cost Price' in row;\r\n    const hasRetailPrice = 'RETAIL PRICE' in row || 'RETAIL_PRICE' in row || 'Retail Price' in row;\r\n    \r\n    const costPriceRaw = hasCostPrice ? safeNumber(row['COST PRICE'] || row.COST_PRICE || row['Cost Price']) : null;\r\n    const retailPriceRaw = hasRetailPrice ? safeNumber(row['RETAIL PRICE'] || row.RETAIL_PRICE || row['Retail Price']) : null;\r\n    \r\n    const safePriceVal = (priceINR && priceINR > 0) ? priceINR : 0.01;\r\n    const costPrice = (costPriceRaw !== null && costPriceRaw > 0) ? costPriceRaw : safePriceVal;\r\n    const retailPrice = (retailPriceRaw !== null && retailPriceRaw > 0) ? retailPriceRaw : safePriceVal;\r\n    const priceUSD = safePriceVal > 0.01 ? await convertINRtoUSD(safePriceVal) : null;\r\n    \r\n    return {\r\n      user_id: userId,\r\n      sku: row['SKU NO'] || row['SKU'] || `DIA-${index + 1}`,\r\n      diamond_type: row['DIAMOND TYPE'] || row['Diamond Type'] || 'Natural',\r\n      status: row.STATUS || row['Status'] || null,\r\n      shape: row.SHAPE || row['Shape'] || 'Round',\r\n      carat: safeNumber(row.CARAT || row['Carat']),\r\n      clarity: row.CLARITY || row['Clarity'] || 'VS1',\r\n      color: row.COLOR || row['Color'] || 'F',\r\n      color_shade_amount: row['COLOR SHADE AMOUNT'] || row['Color Shade Amount'] || null,\r\n      cut: row.CUT || row['Cut'] || null,\r\n      polish: row.POLISH || row['Polish'] || null,\r\n      symmetry: row.SYMMETRY || row['Symmetry'] || null,\r\n      fluorescence: row.FLO || row['Fluorescence'] || null,\r\n      measurement: row.MEASUREMENT || row['Measurement'] || null,\r\n      ratio: row.RATIO || row['Ratio'] || null,\r\n      lab: row.LAB || row['Lab'] || null,\r\n      image_url: imageUrl,\r\n      image_url_2: imageUrl2,\r\n      image_url_3: imageUrl3,\r\n      price_inr: safePriceVal,\r\n      price_usd: priceUSD,\r\n      cost_price: costPrice,\r\n      retail_price: retailPrice,\r\n      stock_quantity: safeNumber(row['STOCK QUANTITY'] || row['Stock Quantity']) || 1,\r\n      product_type: 'Loose Diamonds',\r\n      name: `${row.SHAPE || 'Round'} Diamond ${row.CARAT || '1.0'}ct`,\r\n    };\r\n  };\r\n\r\n  const processJewelryRow = async (\r\n    row: Record<string, any>,\r\n    userId: string,\r\n    index: number,\r\n    imageUrl: string | null,\r\n    imageUrl2: string | null,\r\n    imageUrl3: string | null,\r\n    goldRate: number,\r\n    makingChargesPerGram: number,\r\n    worksheet: XLSX.WorkSheet\r\n  ) => {\r\n    // Use shared calculation utility - calculates using vendor profile values\r\n    const calculations = processJewelryImportRow(row, goldRate, makingChargesPerGram);\r\n    \r\n    // Helper to get value from multiple possible column names\r\n    const getVal = (...keys: string[]) => {\r\n      for (const key of keys) {\r\n        if (row[key] !== undefined && row[key] !== null && row[key] !== '') {\r\n          return row[key];\r\n        }\r\n      }\r\n      return null;\r\n    };\r\n    \r\n    // Parse weight fields - support multiple column formats\r\n    const grossWeight = safeNumber(getVal('Gross Weight', 'G WT', 'GWT'));\r\n    const dWt1 = safeNumber(getVal('Diamond Weight 1', 'D.WT 1', 'D WT 1', 'DWT1'));\r\n    const dWt2 = safeNumber(getVal('Diamond Weight 2', 'D.WT 2', 'D WT 2', 'DWT2'));\r\n    const dRate1 = safeNumber(getVal('Diamond RATE 1', 'D RATE 1', 'DRATE1'));\r\n    const pointerDiamond = safeNumber(getVal('Diamond Rate 2', 'Pointer diamond', 'D RATE 2'));\r\n    const certificationCost = safeNumber(getVal('Certification cost', 'CERTIFICATION_COST'));\r\n    const gemstoneCost = safeNumber(getVal('Gemstone cost', 'GEMSTONE_COST'));\r\n    const gemstoneWeight = safeNumber(getVal('GEMSTONE WT', 'Gemstone Weight'));\r\n    \r\n    // Convert to USD\r\n    const totalUsdFromExcel = safeNumber(getVal('TOTAL_USD', 'TOTAL USD'));\r\n    const totalUsd = totalUsdFromExcel || (calculations.totalPrice > 0 ? await convertINRtoUSD(calculations.totalPrice) : null);\r\n    \r\n    // Get diamond color and clarity - support multiple column formats\r\n    const diamondColor = getVal('Diamond Color', 'DIAMOND COLOR', 'Diamond_Color') || \r\n      (worksheet[`C${index + 2}`] ? String(worksheet[`C${index + 2}`].v || '').trim() : null);\r\n    const clarity = getVal('Diamond CLARITY', 'CLARITY', 'Clarity') ||\r\n      (worksheet[`D${index + 2}`] ? String(worksheet[`D${index + 2}`].v || '').trim() : null);\r\n\r\n    // Get product name and SKU\r\n    const productName = getVal('Prodcut', 'Prodcut Title', 'Product Title', 'PRODUCT', 'Name') || `Product ${index + 1}`;\r\n    const sku = getVal('SKU', 'CERT', 'SKU ID');\r\n    const category = getVal('Category', 'CATEGORY');\r\n    \r\n    // Parse delivery type\r\n    const deliveryType = (() => {\r\n      const dt = getVal('DELIVERY TYPE', 'Delivery Type');\r\n      if (!dt) return 'immediate';\r\n      return String(dt).toLowerCase().includes('schedule') ? 'scheduled' : 'immediate';\r\n    })();\r\n    \r\n    return {\r\n      user_id: userId,\r\n      name: productName,\r\n      description: getVal('DESCRIPTION', 'Description') || null,\r\n      sku: sku,\r\n      category: category,\r\n      metal_type: getVal('METAL TYPE', 'Metal Type') || null,\r\n      gemstone: getVal('GEMSTONE Name', 'GEMSTONE', 'Gemstone', 'Gemstone Name') || null,\r\n      gemstone_name: getVal('GEMSTONE Name', 'GEMSTONE', 'Gemstone', 'Gemstone Name') || null,\r\n      color: getVal('COLOR', 'Color') || null,\r\n      diamond_color: diamondColor,\r\n      clarity: clarity,\r\n      image_url: imageUrl,\r\n      image_url_2: imageUrl2,\r\n      image_url_3: imageUrl3,\r\n      \r\n      // Weight fields\r\n      weight_grams: grossWeight || null,\r\n      net_weight: calculations.netWeight || null,\r\n      diamond_weight: calculations.totalDiamondWeight || null,\r\n      carat_weight: gemstoneWeight || null,\r\n      \r\n      // Diamond fields\r\n      d_wt_1: dWt1 || null,\r\n      d_wt_2: dWt2 || null,\r\n      diamond_type: getVal('Center stone TYPE', 'CS TYPE', 'Diamond Type', 'CENTER_STONE_TYPE') || null,\r\n      purity_fraction_used: calculations.purityFraction,\r\n      d_rate_1: dRate1 || null,\r\n      pointer_diamond: pointerDiamond || null,\r\n      d_value: calculations.dValue || null,\r\n      gemstone_type: getVal('GEMSTONE TYPE', 'Gemstone Type') || null,\r\n      mkg: calculations.makingCharges || null,\r\n      gold_per_gram_price: calculations.goldValue || null,\r\n      certification_cost: certificationCost || null,\r\n      gemstone_cost: gemstoneCost || null,\r\n      total_usd: totalUsd,\r\n      \r\n      // Pricing - calculated from vendor profile gold rate and making charges\r\n      price_inr: calculations.totalPrice,\r\n      price_usd: totalUsd,\r\n      cost_price: calculations.costPrice,\r\n      retail_price: calculations.costPrice,\r\n      stock_quantity: safeNumber(getVal('STOCK QUANTITY', 'Stock')) || 1,\r\n      \r\n      // Delivery\r\n      delivery_type: deliveryType,\r\n      dispatches_in_days: getVal('DISPATCHES IN DAYS', 'Dispatches') || null,\r\n      \r\n      product_type: 'Jewellery',\r\n    };\r\n  };\r\n\r\n  const handlePreview = async () => {\r\n    if (!file) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Please select a file\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setImportErrors([]);\r\n    setPreviewData(null);\r\n    setColumnMappings(null);\r\n\r\n    try {\r\n      // Fetch vendor profile for auto-calculations\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        throw new Error(\"Not authenticated\");\r\n      }\r\n\r\n      const { data: vendorProfile } = await supabase\r\n        .from('vendor_profiles')\r\n        .select('gold_rate_24k_per_gram, making_charges_per_gram')\r\n        .eq('user_id', user.id)\r\n        .single();\r\n\r\n      const goldRate = vendorProfile?.gold_rate_24k_per_gram || 7000; // Default fallback\r\n      const makingCharges = vendorProfile?.making_charges_per_gram || 500; // Default fallback\r\n\r\n      // Show vendor profile rates being used\r\n      if (selectedProductType === 'Jewellery') {\r\n        toast({\r\n          title: \"Using Vendor Profile Rates\",\r\n          description: `Gold Rate: ₹${goldRate.toLocaleString()}/gram | Making Charges: ₹${makingCharges.toLocaleString()}/gram`,\r\n        });\r\n      }\r\n\r\n      const data = await file.arrayBuffer();\r\n      const workbook = XLSX.read(data);\r\n      \r\n      // Find the data sheet (skip \"Instructions\" sheet if present)\r\n      let sheetName = workbook.SheetNames[0];\r\n      if (sheetName === 'Instructions' && workbook.SheetNames.length > 1) {\r\n        sheetName = workbook.SheetNames[1]; // Use second sheet if first is instructions\r\n      }\r\n      \r\n      const worksheet = workbook.Sheets[sheetName];\r\n      const jsonData = XLSX.utils.sheet_to_json(worksheet); // Don't skip any rows - read headers correctly\r\n\r\n      // Detect columns and check for mapping issues\r\n      if (jsonData.length > 0) {\r\n        const detectedColumns = Object.keys(jsonData[0] as any);\r\n        const expectedColumns = getExpectedColumns(selectedProductType);\r\n        const missing: string[] = [];\r\n        const suggestions: Record<string, string> = {};\r\n        \r\n        // Build detailed mappings\r\n        const firstRow = jsonData[0] as any;\r\n        const mappingsArray: Array<{\r\n          excelColumn: string;\r\n          databaseField: string;\r\n          sampleValue: string;\r\n          dataType: string;\r\n          required: boolean;\r\n          mapped: boolean;\r\n          columnPosition?: string;\r\n        }> = [];\r\n\r\n        if (selectedProductType === 'Jewellery') {\r\n          // Jewelry-specific mappings - aligned with template\r\n          const jewelryMappings = [\r\n            { excel: 'Prodcut', db: 'name', type: 'text', required: true, alternatives: ['Prodcut Title', 'Product Title', 'PRODUCT', 'Name'] },\r\n            { excel: 'Gross Weight', db: 'weight_grams', type: 'number', required: true, alternatives: ['G WT', 'GWT'] },\r\n            { excel: 'PURITY_FRACTION_USED', db: 'purity_fraction_used', type: 'number', required: true, alternatives: ['Purity'] },\r\n            { excel: 'SKU', db: 'sku', type: 'text', required: false, alternatives: ['CERT', 'SKU ID'] },\r\n            { excel: 'Category', db: 'category', type: 'text', required: false, alternatives: ['CATEGORY'] },\r\n            { excel: 'Metal Type', db: 'metal_type', type: 'text', required: false, alternatives: ['METAL TYPE'] },\r\n            { excel: 'Diamond Color', db: 'diamond_color', type: 'text', required: false, alternatives: ['DIAMOND COLOR'] },\r\n            { excel: 'Diamond CLARITY', db: 'clarity', type: 'text', required: false, alternatives: ['CLARITY'] },\r\n            { excel: 'Diamond Weight 1', db: 'd_wt_1', type: 'number', required: false, alternatives: ['D.WT 1', 'D WT 1'] },\r\n            { excel: 'Diamond Weight 2', db: 'd_wt_2', type: 'number', required: false, alternatives: ['D.WT 2', 'D WT 2'] },\r\n            { excel: 'Diamond RATE 1', db: 'd_rate_1', type: 'number', required: false, alternatives: ['D RATE 1'] },\r\n            { excel: 'Diamond Rate 2', db: 'pointer_diamond', type: 'number', required: false, alternatives: ['Pointer diamond'] },\r\n            { excel: 'Center stone TYPE', db: 'diamond_type', type: 'text', required: false, alternatives: ['CS TYPE', 'Diamond Type'] },\r\n            { excel: 'Certification cost', db: 'certification_cost', type: 'number', required: false, alternatives: [] },\r\n            { excel: 'Gemstone cost', db: 'gemstone_cost', type: 'number', required: false, alternatives: [] },\r\n            { excel: 'IMAGE_URL', db: 'image_url', type: 'url', required: false, alternatives: ['Image URL', 'Images'] },\r\n            { excel: 'STOCK QUANTITY', db: 'stock_quantity', type: 'number', required: false, alternatives: ['Stock', 'Stock Quantity'] },\r\n          ];\r\n\r\n          jewelryMappings.forEach(mapping => {\r\n            // Check all possible column names\r\n            const allNames = [mapping.excel, ...(mapping.alternatives || [])];\r\n            let foundValue = null;\r\n            let isMapped = false;\r\n            \r\n            for (const name of allNames) {\r\n              const val = firstRow[name] || firstRow[name.toUpperCase()] || firstRow[name.toLowerCase()];\r\n              if (val !== undefined && val !== null) {\r\n                foundValue = val;\r\n                isMapped = true;\r\n                break;\r\n              }\r\n              // Also check if column exists\r\n              if (detectedColumns.some(col => \r\n                col.toLowerCase().replace(/[^a-z0-9]/g, '') === name.toLowerCase().replace(/[^a-z0-9]/g, '')\r\n              )) {\r\n                isMapped = true;\r\n              }\r\n            }\r\n            \r\n            mappingsArray.push({\r\n              excelColumn: mapping.excel,\r\n              databaseField: mapping.db,\r\n              sampleValue: foundValue ? String(foundValue).substring(0, 50) : '',\r\n              dataType: mapping.type,\r\n              required: mapping.required,\r\n              mapped: isMapped\r\n            });\r\n          });\r\n        } else if (selectedProductType === 'Gemstones') {\r\n          // Gemstone mappings\r\n          const gemstoneMappings = [\r\n            { excel: 'SKU ID', db: 'sku', type: 'text', required: true },\r\n            { excel: 'GEMSTONE NAME', db: 'gemstone_name', type: 'text', required: true },\r\n            { excel: 'CARAT WEIGHT', db: 'carat_weight', type: 'number', required: false },\r\n            { excel: 'COLOR', db: 'color', type: 'text', required: false },\r\n            { excel: 'CLARITY', db: 'clarity', type: 'text', required: false },\r\n            { excel: 'PRICE INR', db: 'price_inr', type: 'number', required: true },\r\n          ];\r\n\r\n          gemstoneMappings.forEach(mapping => {\r\n            const excelValue = firstRow[mapping.excel];\r\n            mappingsArray.push({\r\n              excelColumn: mapping.excel,\r\n              databaseField: mapping.db,\r\n              sampleValue: excelValue ? String(excelValue).substring(0, 50) : '',\r\n              dataType: mapping.type,\r\n              required: mapping.required,\r\n              mapped: detectedColumns.includes(mapping.excel)\r\n            });\r\n          });\r\n        } else if (selectedProductType === 'Loose Diamonds') {\r\n          // Diamond mappings\r\n          const diamondMappings = [\r\n            { excel: 'SKU NO', db: 'sku', type: 'text', required: true },\r\n            { excel: 'SHAPE', db: 'shape', type: 'text', required: true },\r\n            { excel: 'CARAT', db: 'carat', type: 'number', required: true },\r\n            { excel: 'COLOR', db: 'color', type: 'text', required: true },\r\n            { excel: 'CLARITY', db: 'clarity', type: 'text', required: true },\r\n            { excel: 'PRICE INR', db: 'price_inr', type: 'number', required: true },\r\n          ];\r\n\r\n          diamondMappings.forEach(mapping => {\r\n            const excelValue = firstRow[mapping.excel];\r\n            mappingsArray.push({\r\n              excelColumn: mapping.excel,\r\n              databaseField: mapping.db,\r\n              sampleValue: excelValue ? String(excelValue).substring(0, 50) : '',\r\n              dataType: mapping.type,\r\n              required: mapping.required,\r\n              mapped: detectedColumns.includes(mapping.excel)\r\n            });\r\n          });\r\n        }\r\n\r\n        setDetailedMappings(mappingsArray);\r\n\r\n        // Check for missing required columns and suggest mappings\r\n        expectedColumns.required.forEach(reqCol => {\r\n          const exactMatch = detectedColumns.find(col => \r\n            col.toLowerCase() === reqCol.toLowerCase() || \r\n            col.replace(/[_\\s]/g, '').toLowerCase() === reqCol.replace(/[_\\s]/g, '').toLowerCase()\r\n          );\r\n          \r\n          if (!exactMatch) {\r\n            // Try to find similar column\r\n            const similar = detectedColumns.find(col => {\r\n              const colClean = col.toLowerCase().replace(/[_\\s]/g, '');\r\n              const reqClean = reqCol.toLowerCase().replace(/[_\\s]/g, '');\r\n              return colClean.includes(reqClean) || reqClean.includes(colClean);\r\n            });\r\n            \r\n            if (similar) {\r\n              suggestions[reqCol] = similar;\r\n            } else {\r\n              missing.push(reqCol);\r\n            }\r\n          }\r\n        });\r\n\r\n        setColumnMappings({\r\n          detected: detectedColumns,\r\n          missing,\r\n          suggestions\r\n        });\r\n      }\r\n\r\n      const errors: Array<{row: number, product: string, errors: string[]}> = [];\r\n      const validProducts: any[] = [];\r\n      \r\n      // Select appropriate schema based on product type\r\n      const schema = selectedProductType === 'Gemstones' ? gemstoneImportSchema :\r\n                     selectedProductType === 'Loose Diamonds' ? diamondImportSchema :\r\n                     productImportSchema;\r\n      \r\n      for (const [index, rowData] of jsonData.entries()) {\r\n        const row: any = rowData;\r\n\r\n        // Parse image URLs helper - supports multiple column names, pipe-separated URLs, and escaped chars\r\n        const parseImageUrls = () => {\r\n          const imageField = row.IMAGE_URL || row['IMAGE URL'] || row['Image URL'] || row['Images'] || row['IMAGE_URL'];\r\n          if (!imageField) return { imageUrl: null, imageUrl2: null, imageUrl3: null };\r\n          \r\n          // Clean escaped characters from Excel export (e.g., \"https\\://...\" becomes \"https://...\")\r\n          const cleanUrls = String(imageField)\r\n            .replace(/\\\\:/g, ':')  // Fix escaped colons\r\n            .replace(/\\\\\\|/g, '|') // Fix escaped pipes\r\n            .replace(/\\\\/g, '')    // Remove remaining backslashes\r\n            .split('|')\r\n            .map((url: string) => url.trim())\r\n            .filter((url: string) => url.startsWith('http'));\r\n          \r\n          return {\r\n            imageUrl: cleanUrls[0] || null,\r\n            imageUrl2: cleanUrls[1] || null,\r\n            imageUrl3: cleanUrls[2] || null,\r\n          };\r\n        };\r\n\r\n        const { imageUrl, imageUrl2, imageUrl3 } = parseImageUrls();\r\n        let product: any;\r\n\r\n        if (selectedProductType === 'Gemstones') {\r\n          product = await processGemstoneRow(row, user.id, index, imageUrl, imageUrl2, imageUrl3);\r\n        } else if (selectedProductType === 'Loose Diamonds') {\r\n          product = await processDiamondRow(row, user.id, index, imageUrl, imageUrl2, imageUrl3);\r\n        } else {\r\n          product = await processJewelryRow(row, user.id, index, imageUrl, imageUrl2, imageUrl3, goldRate, makingCharges, worksheet);\r\n        }\r\n\r\n        // Validate product data\r\n        const validation = schema.safeParse(product);\r\n        if (!validation.success) {\r\n          const errorMessages = validation.error.issues.map(err => \r\n            `${err.path.join('.')}: ${err.message}`\r\n          );\r\n          errors.push({\r\n            row: index + 2,\r\n            product: product.name || product.sku || `Row ${index + 2}`,\r\n            errors: errorMessages\r\n          });\r\n        } else {\r\n          validProducts.push(product);\r\n        }\r\n      }\r\n\r\n      // Check for duplicate SKUs within the import file\r\n      const skuMap = new Map<string, number[]>();\r\n      validProducts.forEach((product, idx) => {\r\n        if (product.sku) {\r\n          const existing = skuMap.get(product.sku) || [];\r\n          existing.push(idx);\r\n          skuMap.set(product.sku, existing);\r\n        }\r\n      });\r\n\r\n      const duplicateSKUs = Array.from(skuMap.entries())\r\n        .filter(([_, indices]) => indices.length > 1)\r\n        .map(([sku, indices]) => ({\r\n          sku,\r\n          rows: indices.map(idx => idx + 2) // +2 for Excel row numbering\r\n        }));\r\n\r\n      if (duplicateSKUs.length > 0) {\r\n        const duplicateMessage = duplicateSKUs\r\n          .map(({ sku, rows }) => `SKU \"${sku}\" appears in rows: ${rows.join(', ')}`)\r\n          .join('\\n');\r\n        \r\n        toast({\r\n          title: \"Duplicate SKUs Found\",\r\n          description: `Found ${duplicateSKUs.length} duplicate SKU(s) in your file. Please make each SKU unique:\\n${duplicateMessage}`,\r\n          variant: \"destructive\",\r\n        });\r\n        \r\n        // Add duplicate SKU errors to the invalid list\r\n        duplicateSKUs.forEach(({ sku, rows }) => {\r\n          errors.push({\r\n            row: rows[0],\r\n            product: sku,\r\n            errors: [`Duplicate SKU found in rows: ${rows.join(', ')}`]\r\n          });\r\n        });\r\n      }\r\n\r\n      setPreviewData({\r\n        valid: validProducts,\r\n        invalid: errors\r\n      });\r\n\r\n      toast({\r\n        title: \"Preview Ready\",\r\n        description: `${validProducts.length} products will be imported, ${errors.length + duplicateSKUs.length} have errors`,\r\n      });\r\n    } catch (error: any) {\r\n      toast({\r\n        title: \"Preview Failed\",\r\n        description: error.message || \"Failed to preview Excel file\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleConfirmImport = async () => {\r\n    if (!previewData || previewData.valid.length === 0) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        toast({\r\n          title: \"Error\",\r\n          description: \"You must be logged in to import products\",\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      const products = previewData.valid;\r\n\r\n      // Get existing SKUs to separate updates from inserts\r\n      const skus = products.map(p => p.sku).filter(Boolean);\r\n      const { data: existingProducts, error: fetchError } = await supabase\r\n        .from(\"products\")\r\n        .select(\"id, sku\")\r\n        .eq(\"user_id\", user.id)\r\n        .is(\"deleted_at\", null)\r\n        .in(\"sku\", skus);\r\n\r\n      if (fetchError) {\r\n        console.error('Error fetching existing products:', fetchError);\r\n        throw new Error('Failed to check existing products. Please try again.');\r\n      }\r\n\r\n      const existingSkuMap = new Map(existingProducts?.map(p => [p.sku, p.id]) || []);\r\n      const productsToUpdate = products.filter(p => p.sku && existingSkuMap.has(p.sku));\r\n      const productsToInsert = products.filter(p => !p.sku || !existingSkuMap.has(p.sku));\r\n\r\n      let updatedCount = 0;\r\n      let insertedCount = 0;\r\n\r\n      // Update existing products\r\n      if (productsToUpdate.length > 0) {\r\n        for (const product of productsToUpdate) {\r\n          const productId = existingSkuMap.get(product.sku);\r\n          const { error: updateError } = await supabase\r\n            .from(\"products\")\r\n            .update(product)\r\n            .eq(\"id\", productId);\r\n\r\n          if (!updateError) {\r\n            updatedCount++;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Insert new products\r\n      if (productsToInsert.length > 0) {\r\n        const { data: insertedProducts, error: insertError } = await supabase\r\n          .from(\"products\")\r\n          .insert(productsToInsert)\r\n          .select();\r\n\r\n        if (insertError) {\r\n          console.error('Insert error:', insertError);\r\n          \r\n          // Check if it's a duplicate SKU error\r\n          if (insertError.code === '23505' && insertError.message.includes('products_sku_key')) {\r\n            // Extract SKU from error message if possible\r\n            const duplicateSKUs = productsToInsert\r\n              .filter(p => p.sku)\r\n              .map(p => p.sku)\r\n              .join(', ');\r\n            \r\n            throw new Error(\r\n              `Duplicate SKU detected. One or more SKUs already exist in your catalog: ${duplicateSKUs}. Please use unique SKUs for each product or remove duplicate rows from your Excel file.`\r\n            );\r\n          }\r\n          \r\n          throw insertError;\r\n        }\r\n\r\n        insertedCount = insertedProducts?.length || 0;\r\n      }\r\n\r\n      setImportErrors(previewData.invalid);\r\n      \r\n      toast({\r\n        title: \"Success!\",\r\n        description: `Updated ${updatedCount} products, imported ${insertedCount} new products`,\r\n      });\r\n\r\n      navigate(\"/\");\r\n    } catch (error: any) {\r\n      toast({\r\n        title: \"Import Failed\",\r\n        description: error.message || \"Failed to import products\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const downloadErrorLog = () => {\r\n    const workbook = XLSX.utils.book_new();\r\n    const errorData = importErrors.map(error => ({\r\n      'Row Number': error.row,\r\n      'Product Name/SKU': error.product,\r\n      'Errors': error.errors.join('; ')\r\n    }));\r\n    \r\n    const worksheet = XLSX.utils.json_to_sheet(errorData);\r\n    XLSX.utils.book_append_sheet(workbook, worksheet, \"Import Errors\");\r\n    XLSX.writeFile(workbook, `import-errors-${new Date().toISOString().split('T')[0]}.xlsx`);\r\n  };\r\n\r\n  return (\r\n    <ApprovalGuard>\r\n      <div className=\"min-h-screen bg-background p-6\">\r\n        <div className=\"max-w-2xl mx-auto\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            onClick={() => navigate(\"/\")}\r\n            className=\"mb-6\"\r\n          >\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Back to Catalog\r\n          </Button>\r\n\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center gap-3\">\r\n                <Upload className=\"h-8 w-8 text-primary\" />\r\n                <div>\r\n                  <CardTitle>Import Products</CardTitle>\r\n                  <CardDescription>\r\n                    Upload your jewelry catalog from an Excel file\r\n                  </CardDescription>\r\n                </div>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-6\">\r\n              <div className=\"space-y-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"productType\">Select Product Type</Label>\r\n                  <Select value={selectedProductType} onValueChange={(v) => setSelectedProductType(v as ProductType)}>\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {approvedCategories?.map((cat) => (\r\n                        <SelectItem key={cat} value={cat}>{cat}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold\">Step 1: Download Template</h3>\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      Get the Excel template for {selectedProductType}\r\n                    </p>\r\n                  </div>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => generateProductTemplate(selectedProductType)}\r\n                    className=\"gap-2\"\r\n                  >\r\n                    <Download className=\"h-4 w-4\" />\r\n                    Download Template\r\n                  </Button>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <h3 className=\"text-lg font-semibold\">Step 2: Upload Filled Template</h3>\r\n                  <Label htmlFor=\"file\">Select Excel File</Label>\r\n                  <Input\r\n                    id=\"file\"\r\n                    type=\"file\"\r\n                    accept=\".xlsx,.xls\"\r\n                    onChange={(e) => setFile(e.target.files?.[0] || null)}\r\n                  />\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    Upload your filled .xlsx or .xls file\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"rounded-lg bg-muted p-4 space-y-2\">\r\n                  <h3 className=\"font-semibold text-sm\">Supported Columns:</h3>\r\n                  <ul className=\"text-sm text-muted-foreground space-y-1 grid grid-cols-1 md:grid-cols-2 gap-1\">\r\n                    {selectedProductType === 'Jewellery' && (\r\n                      <>\r\n                        <li>• CERT (SKU)</li>\r\n                        <li>• PRODUCT (name)</li>\r\n                        <li>• Diamond Color/Co</li>\r\n                        <li>• CLARITY</li>\r\n                        <li>• D.WT 1, D.WT 2 (diamond weights)</li>\r\n                        <li>• T DWT (total diamond weight)</li>\r\n                        <li>• G WT (gross weight)</li>\r\n                        <li>• NET WT (net weight)</li>\r\n                        <li>• CS TYPE (category)</li>\r\n                        <li>• PURITY_FRACTION_USED</li>\r\n                        <li>• D RATE 1 (diamond rate)</li>\r\n                        <li>• Pointer diamond</li>\r\n                        <li>• D VALUE (diamond value)</li>\r\n                        <li>• GEMSTONE TYPE</li>\r\n                        <li>• MKG (making charges)</li>\r\n                        <li>• GOLD (gold cost)</li>\r\n                        <li>• Certification cost</li>\r\n                        <li>• Gemstone cost</li>\r\n                        <li>• TOTAL (retail price)</li>\r\n                        <li>• TOTAL_USD</li>\r\n                        <li>• Product Type</li>\r\n                        <li>• IMAGE_URL (images - use | separator)</li>\r\n                        <li>• Thumbnail (3rd image)</li>\r\n                        <li className=\"font-semibold text-primary\">• DELIVERY TYPE (immediate/scheduled)</li>\r\n                        <li className=\"font-semibold text-primary\">• DELIVERY DATE (for scheduled)</li>\r\n                      </>\r\n                    )}\r\n                    \r\n                    {selectedProductType === 'Gemstones' && (\r\n                      <>\r\n                        <li>• SKU ID (SKU)</li>\r\n                        <li>• GEMSTONE NAME</li>\r\n                        <li>• GEMSTONE TYPE</li>\r\n                        <li>• CARAT WEIGHT</li>\r\n                        <li>• COLOR</li>\r\n                        <li>• CLARITY</li>\r\n                        <li>• CUT</li>\r\n                        <li>• POLISH</li>\r\n                        <li>• SYMMETRY</li>\r\n                        <li>• MEASUREMENT</li>\r\n                        <li>• CERTIFICATION</li>\r\n                        <li>• PRICE_INR</li>\r\n                        <li>• STOCK QUANTITY</li>\r\n                        <li>• IMAGE_URL (images - use | separator)</li>\r\n                      </>\r\n                    )}\r\n                    \r\n                    {selectedProductType === 'Loose Diamonds' && (\r\n                      <>\r\n                        <li>• SKU NO</li>\r\n                        <li>• DIAMOND TYPE (Natural/Lab-grown)</li>\r\n                        <li>• STATUS</li>\r\n                        <li>• SHAPE</li>\r\n                        <li>• CARAT</li>\r\n                        <li>• CLARITY</li>\r\n                        <li>• COLOR</li>\r\n                        <li>• COLOR SHADE AMOUNT</li>\r\n                        <li>• CUT</li>\r\n                        <li>• POLISH</li>\r\n                        <li>• SYMMETRY</li>\r\n                        <li>• FLO (Fluorescence)</li>\r\n                        <li>• MEASUREMENT</li>\r\n                        <li>• RATIO</li>\r\n                        <li>• LAB</li>\r\n                        <li>• PRICE_INR</li>\r\n                        <li>• STOCK QUANTITY</li>\r\n                        <li>• IMAGE_URL (images - use | separator)</li>\r\n                      </>\r\n                    )}\r\n                  </ul>\r\n                  <div className=\"mt-3 pt-3 border-t border-border\">\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {selectedProductType === 'Jewellery' && (\r\n                        <>\r\n                          <span className=\"font-semibold\">Delivery:</span> Set DELIVERY TYPE to \"immediate\" or \"scheduled\". \r\n                          If scheduled, add DELIVERY DATE in YYYY-MM-DD format.\r\n                        </>\r\n                      )}\r\n                      {(selectedProductType === 'Gemstones' || selectedProductType === 'Loose Diamonds') && (\r\n                        <>\r\n                          <span className=\"font-semibold\">Images:</span> Separate multiple image URLs with | (pipe) symbol. \r\n                          Up to 3 images supported.\r\n                        </>\r\n                      )}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {detailedMappings.length > 0 && (\r\n                  <div className=\"mt-6\">\r\n                    <ColumnMappingPreview \r\n                      mappings={detailedMappings}\r\n                      productType={selectedProductType}\r\n                    />\r\n                  </div>\r\n                )}\r\n\r\n                {columnMappings && (\r\n                  <div className=\"space-y-3\">\r\n                    {columnMappings.missing.length > 0 && (\r\n                      <div className=\"p-4 bg-destructive/10 border border-destructive/20 rounded-lg space-y-2\">\r\n                        <div className=\"flex items-start gap-2\">\r\n                          <AlertCircle className=\"h-5 w-5 text-destructive mt-0.5\" />\r\n                          <div className=\"flex-1\">\r\n                            <p className=\"font-semibold text-sm text-destructive\">Missing Required Columns</p>\r\n                            <p className=\"text-xs text-muted-foreground mt-1\">\r\n                              The following columns are required but not found in your file:\r\n                            </p>\r\n                            <ul className=\"mt-2 space-y-1\">\r\n                              {columnMappings.missing.map(col => (\r\n                                <li key={col} className=\"text-sm font-mono bg-background/50 px-2 py-1 rounded\">\r\n                                  {col}\r\n                                </li>\r\n                              ))}\r\n                            </ul>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {Object.keys(columnMappings.suggestions).length > 0 && (\r\n                      <div className=\"p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg space-y-2\">\r\n                        <div className=\"flex items-start gap-2\">\r\n                          <AlertCircle className=\"h-5 w-5 text-amber-600 mt-0.5\" />\r\n                          <div className=\"flex-1\">\r\n                            <p className=\"font-semibold text-sm text-amber-600\">Column Name Suggestions</p>\r\n                            <p className=\"text-xs text-muted-foreground mt-1\">\r\n                              These columns have similar names and will be automatically mapped:\r\n                            </p>\r\n                            <ul className=\"mt-2 space-y-1\">\r\n                              {Object.entries(columnMappings.suggestions).map(([expected, detected]) => (\r\n                                <li key={expected} className=\"text-sm\">\r\n                                  <span className=\"font-mono bg-background/50 px-2 py-1 rounded\">{detected}</span>\r\n                                  <span className=\"mx-2\">→</span>\r\n                                  <span className=\"font-mono bg-primary/10 px-2 py-1 rounded\">{expected}</span>\r\n                                </li>\r\n                              ))}\r\n                            </ul>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {columnMappings.missing.length === 0 && Object.keys(columnMappings.suggestions).length === 0 && (\r\n                      <div className=\"p-4 bg-green-500/10 border border-green-500/20 rounded-lg\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\r\n                          <p className=\"text-sm font-semibold text-green-600\">\r\n                            All columns match perfectly!\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"p-3 bg-muted/50 rounded-lg\">\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        <strong>Detected columns:</strong> {columnMappings.detected.join(', ')}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <Button\r\n                  onClick={handlePreview}\r\n                  disabled={loading || !file}\r\n                  className=\"w-full\"\r\n                >\r\n                  {loading ? (\r\n                    <>\r\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                      Loading Preview...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Upload className=\"mr-2 h-4 w-4\" />\r\n                      Preview Import\r\n                    </>\r\n                  )}\r\n                </Button>\r\n\r\n                {previewData && (\r\n                  <div className=\"mt-6 space-y-4\">\r\n                    <div className=\"p-4 border rounded-lg bg-muted/50\">\r\n                      <h3 className=\"font-semibold mb-3\">Import Preview</h3>\r\n                      <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n                        <div className=\"p-3 bg-green-500/10 border border-green-500/20 rounded\">\r\n                          <p className=\"text-sm text-muted-foreground\">Valid Products</p>\r\n                          <p className=\"text-2xl font-bold text-green-600\">{previewData.valid.length}</p>\r\n                        </div>\r\n                        <div className=\"p-3 bg-destructive/10 border border-destructive/20 rounded\">\r\n                          <p className=\"text-sm text-muted-foreground\">Invalid Products</p>\r\n                          <p className=\"text-2xl font-bold text-destructive\">{previewData.invalid.length}</p>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {previewData.invalid.length > 0 && (\r\n                        <div className=\"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded\">\r\n                          <p className=\"text-sm font-semibold text-destructive mb-2\">Products with errors:</p>\r\n                          <div className=\"max-h-40 overflow-y-auto space-y-1\">\r\n                            {previewData.invalid.slice(0, 5).map((err, idx) => (\r\n                              <p key={idx} className=\"text-xs text-muted-foreground\">\r\n                                Row {err.row}: {err.product} - {err.errors[0]}\r\n                              </p>\r\n                            ))}\r\n                            {previewData.invalid.length > 5 && (\r\n                              <p className=\"text-xs text-muted-foreground italic\">\r\n                                ...and {previewData.invalid.length - 5} more errors\r\n                              </p>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      <div className=\"flex gap-2\">\r\n                        <Button\r\n                          onClick={handleConfirmImport}\r\n                          disabled={loading || previewData.valid.length === 0}\r\n                          className=\"flex-1\"\r\n                        >\r\n                          {loading ? (\r\n                            <>\r\n                              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                              Importing...\r\n                            </>\r\n                          ) : (\r\n                            `Confirm Import (${previewData.valid.length} products)`\r\n                          )}\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          onClick={() => setPreviewData(null)}\r\n                          disabled={loading}\r\n                        >\r\n                          Cancel\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {importErrors.length > 0 && (\r\n                  <div className=\"mt-6 p-4 border border-destructive rounded-lg bg-destructive/10\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <h3 className=\"font-semibold text-destructive\">Import Errors ({importErrors.length})</h3>\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={downloadErrorLog}\r\n                        className=\"gap-2\"\r\n                      >\r\n                        <Download className=\"h-4 w-4\" />\r\n                        Download Error Log\r\n                      </Button>\r\n                    </div>\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      Some products failed to import. Download the error log to see details.\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </ApprovalGuard>\r\n  );\r\n};\r\n\r\nexport default Import;\r\n"],"names":["EXCHANGE_RATE_API","cachedRate","cacheTimestamp","CACHE_DURATION","convertINRtoUSD","inrAmount","now","data","error","getExpectedColumns","productType","ColumnMappingPreview","mappings","requiredMappings","m","optionalMappings","successfulMappings","missingMappings","jsxs","Card","jsx","CardHeader","CardTitle","CardDescription","Badge","CheckCircle2","CardContent","ScrollArea","mapping","idx","MappingRow","AlertCircle","ArrowRight","Import","file","setFile","useState","loading","setLoading","selectedProductType","setSelectedProductType","importErrors","setImportErrors","previewData","setPreviewData","columnMappings","setColumnMappings","detailedMappings","setDetailedMappings","toast","useToast","navigate","useNavigate","approvedCategories","useQuery","user","supabase","processGemstoneRow","row","userId","index","imageUrl","imageUrl2","imageUrl3","priceINR","safeNumber","hasCostPrice","hasRetailPrice","costPriceRaw","retailPriceRaw","safePriceVal","costPrice","retailPrice","priceUSD","processDiamondRow","processJewelryRow","goldRate","makingChargesPerGram","worksheet","calculations","processJewelryImportRow","getVal","keys","key","grossWeight","dWt1","dWt2","dRate1","pointerDiamond","certificationCost","gemstoneCost","gemstoneWeight","totalUsd","diamondColor","clarity","productName","sku","category","deliveryType","dt","handlePreview","vendorProfile","makingCharges","workbook","XLSX.read","sheetName","jsonData","XLSX.utils","detectedColumns","expectedColumns","missing","suggestions","firstRow","mappingsArray","allNames","foundValue","isMapped","name","val","col","excelValue","reqCol","similar","colClean","reqClean","errors","validProducts","schema","gemstoneImportSchema","diamondImportSchema","productImportSchema","rowData","parseImageUrls","imageField","cleanUrls","url","product","validation","errorMessages","err","skuMap","existing","duplicateSKUs","_","indices","duplicateMessage","rows","handleConfirmImport","products","skus","p","existingProducts","fetchError","existingSkuMap","productsToUpdate","productsToInsert","updatedCount","insertedCount","productId","updateError","insertedProducts","insertError","downloadErrorLog","errorData","XLSX.writeFile","ApprovalGuard","Button","ArrowLeft","Upload","Label","Select","v","SelectTrigger","SelectValue","SelectContent","cat","SelectItem","generateProductTemplate","Download","Input","e","_a","Fragment","expected","detected","Loader2"],"mappings":"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"}