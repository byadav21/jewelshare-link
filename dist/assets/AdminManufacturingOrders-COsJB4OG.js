import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as i}from"./react-vendor-BeR0k5Z3.js";import{A as Y}from"./AdminLayout-iDUtkfn_.js";import{h as we,s as B,C as u,i as N,k as v,l as be,g as j,B as b,f as P}from"./index-CX6yiz0b.js";import{I as _e}from"./input-CiHC6UAI.js";import{L as A}from"./label-DbIM3Eg1.js";import{B as F}from"./badge-45Abp579.js";import{C as K}from"./checkbox-BEepVNza.js";import{E as ye}from"./EstimateImage-DpQ34XUT.js";import{S as W,a as J,b as X,c as Z,d as o}from"./select-CYWHo3cU.js";import{T as Ce,a as Se,b as ee,c as m,d as De,e as x}from"./table-CYMzKz5T.js";import{A as ke,a as Pe,b as Ae,c as Fe,d as Te,e as Ee,f as Oe,g as Be}from"./alert-dialog-Co4VP2kw.js";import{D as Ie,b as Le,c as ze,d as Ue,e as Re}from"./dialog-KVJ8gRMk.js";import{P as se,a as te,b as ae,C as re}from"./popover-BMhq8iVk.js";import{A as $e}from"./AdminLoadingSkeleton-DpaOBF9G.js";import{a$ as qe,K as He,O as ie,b0 as Ve,h as le,y as ne,al as d,av as ce}from"./ui-vendor-DjQqXt9S.js";import{f as w}from"./format-sTPjOSS_.js";import"./separator-D0WC8Ha9.js";import"./index-DhS5fNEb.js";import"./index-D6fUEw85.js";import"./NavLink-Bvq0lq1P.js";import"./index-BC78nHQ6.js";import"./index-DVcnno33.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-DjQc2W_p.js";import"./index-BdQq_4o_.js";import"./en-US-DWrl2lTx.js";import"./endOfMonth-DIWrT0r0.js";import"./subDays-ByyGNxrB.js";const vs=()=>{var M,Q,G;const{toast:T}=we(),[C,de]=i.useState([]),[f,oe]=i.useState([]),[me,I]=i.useState(!0),[S,L]=i.useState(""),[D,z]=i.useState("all"),[p,U]=i.useState(),[g,R]=i.useState(),[n,_]=i.useState(new Set),[h,$]=i.useState(""),[xe,E]=i.useState(!1),[O,q]=i.useState(!1),[t,he]=i.useState(null),[ue,H]=i.useState(!1),y={draft:{label:"Draft",color:"bg-gray-500"},quoted:{label:"Quoted",color:"bg-blue-500"},approved:{label:"Approved",color:"bg-green-500"},in_production:{label:"In Production",color:"bg-yellow-500"},completed:{label:"Completed",color:"bg-emerald-600"}};i.useEffect(()=>{V()},[]),i.useEffect(()=>{je()},[C,S,D,p,g]);const V=async()=>{try{I(!0);const{data:s,error:a}=await B.from("manufacturing_cost_estimates").select("*").order("created_at",{ascending:!1});if(a)throw a;de(s||[])}catch(s){console.error("Error fetching orders:",s),T({title:"Error",description:"Failed to load manufacturing orders",variant:"destructive"})}finally{I(!1)}},je=()=>{let s=[...C];if(S.trim()){const a=S.toLowerCase();s=s.filter(l=>{var r,k;return((r=l.customer_name)==null?void 0:r.toLowerCase().includes(a))||((k=l.customer_email)==null?void 0:k.toLowerCase().includes(a))||l.estimate_name.toLowerCase().includes(a)})}if(D!=="all"&&(s=s.filter(a=>a.status===D)),p&&(s=s.filter(a=>new Date(a.created_at)>=p)),g){const a=new Date(g);a.setHours(23,59,59,999),s=s.filter(l=>new Date(l.created_at)<=a)}oe(s)},fe=()=>{L(""),z("all"),U(void 0),R(void 0)},pe=s=>{_(s?new Set(f.map(a=>a.id)):new Set)},ge=(s,a)=>{const l=new Set(n);a?l.add(s):l.delete(s),_(l)},Ne=async()=>{if(!(!h||n.size===0)){q(!0);try{const s=C.filter(r=>n.has(r.id)),{error:a}=await B.from("manufacturing_cost_estimates").update({status:h}).in("id",Array.from(n));if(a)throw a;const l=s.filter(r=>r.is_customer_visible&&r.customer_email).map(r=>B.functions.invoke("notify-order-status",{body:{estimateId:r.id,customerName:r.customer_name,customerEmail:r.customer_email,status:h,estimatedCompletionDate:r.estimated_completion_date,shareToken:r.share_token}}).catch(k=>(console.error(`Failed to send notification for order ${r.id}:`,k),null)));await Promise.all(l),T({title:"Success",description:`Updated ${n.size} order${n.size>1?"s":""} to ${h}`}),_(new Set),$(""),E(!1),V()}catch(s){console.error("Error updating orders:",s),T({title:"Error",description:"Failed to update orders",variant:"destructive"})}finally{q(!1)}}},c=s=>new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(s),ve=s=>{he(s),H(!0)};return me?e.jsx(Y,{children:e.jsx($e,{})}):e.jsx(Y,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Manufacturing Orders"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View and manage all manufacturing cost estimates and orders"})]}),e.jsxs(u,{children:[e.jsxs(N,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Filters"]}),e.jsx(be,{children:"Filter orders by customer, status, or date range"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_e,{id:"search",placeholder:"Customer or estimate name...",value:S,onChange:s=>L(s.target.value),className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"status",children:"Status"}),e.jsxs(W,{value:D,onValueChange:z,children:[e.jsx(J,{id:"status",children:e.jsx(X,{placeholder:"All statuses"})}),e.jsxs(Z,{children:[e.jsx(o,{value:"all",children:"All Statuses"}),e.jsx(o,{value:"draft",children:"Draft"}),e.jsx(o,{value:"quoted",children:"Quoted"}),e.jsx(o,{value:"approved",children:"Approved"}),e.jsx(o,{value:"in_production",children:"In Production"}),e.jsx(o,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Date From"}),e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:P("w-full justify-start text-left font-normal",!p&&"text-muted-foreground"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),p?w(p,"PPP"):"Pick a date"]})}),e.jsx(ae,{className:"w-auto p-0",align:"start",children:e.jsx(re,{mode:"single",selected:p,onSelect:U,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Date To"}),e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:P("w-full justify-start text-left font-normal",!g&&"text-muted-foreground"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),g?w(g,"PPP"):"Pick a date"]})}),e.jsx(ae,{className:"w-auto p-0",align:"start",children:e.jsx(re,{mode:"single",selected:g,onSelect:R,initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx(b,{variant:"outline",onClick:fe,children:"Reset Filters"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",f.length," of ",C.length," orders"]})]})]})]}),n.size>0&&e.jsx(u,{className:"border-primary",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 text-primary"}),e.jsxs("span",{className:"font-medium",children:[n.size," order",n.size>1?"s":""," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(W,{value:h,onValueChange:$,children:[e.jsx(J,{className:"w-48",children:e.jsx(X,{placeholder:"Change status to..."})}),e.jsxs(Z,{children:[e.jsx(o,{value:"draft",children:"Draft"}),e.jsx(o,{value:"quoted",children:"Quoted"}),e.jsx(o,{value:"approved",children:"Approved"}),e.jsx(o,{value:"in_production",children:"In Production"}),e.jsx(o,{value:"completed",children:"Completed"})]})]}),e.jsx(b,{onClick:()=>E(!0),disabled:!h,children:"Update Status"}),e.jsx(b,{variant:"outline",onClick:()=>_(new Set),children:"Clear Selection"})]})]})})}),e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs(v,{children:["Orders (",f.length,")"]})}),e.jsx(j,{children:f.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No orders found matching your filters"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ce,{children:[e.jsx(Se,{children:e.jsxs(ee,{children:[e.jsx(m,{className:"w-12",children:e.jsx(K,{checked:f.length>0&&f.every(s=>n.has(s.id)),onCheckedChange:pe})}),e.jsx(m,{children:"Estimate Name"}),e.jsx(m,{children:"Customer"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Total Cost"}),e.jsx(m,{children:"Selling Price"}),e.jsx(m,{children:"Created"}),e.jsx(m,{children:"Completion Date"}),e.jsx(m,{children:"Visible"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsx(De,{children:f.map(s=>{var a,l;return e.jsxs(ee,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ve(s),children:[e.jsx(x,{onClick:r=>r.stopPropagation(),children:e.jsx(K,{checked:n.has(s.id),onCheckedChange:r=>ge(s.id,r)})}),e.jsx(x,{className:"font-medium",children:s.estimate_name}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:s.customer_name||"N/A"}),s.customer_email&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(le,{className:"h-3 w-3"}),s.customer_email]}),s.customer_phone&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3"}),s.customer_phone]})]})}),e.jsx(x,{children:e.jsx(F,{className:P("text-white",((a=y[s.status])==null?void 0:a.color)||"bg-gray-500"),children:((l=y[s.status])==null?void 0:l.label)||s.status})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(s.total_cost||0)]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(s.final_selling_price||0)]})}),e.jsx(x,{children:w(new Date(s.created_at),"PPP")}),e.jsx(x,{children:s.estimated_completion_date?w(new Date(s.estimated_completion_date),"PPP"):"Not set"}),e.jsx(x,{children:e.jsx(F,{variant:s.is_customer_visible?"default":"secondary",children:s.is_customer_visible?"Yes":"No"})}),e.jsx(x,{className:"text-right",onClick:r=>r.stopPropagation(),children:s.is_customer_visible&&s.share_token&&e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>{window.open(`/order-tracking/${s.share_token}`,"_blank")},children:e.jsx(ce,{className:"h-4 w-4"})})})]},s.id)})})]})})})]}),e.jsx(ke,{open:xe,onOpenChange:E,children:e.jsxs(Pe,{children:[e.jsxs(Ae,{children:[e.jsx(Fe,{children:"Confirm Bulk Status Update"}),e.jsxs(Te,{children:["You are about to update ",n.size," order",n.size>1?"s":""," to status:"," ",e.jsx("span",{className:"font-semibold",children:((M=y[h])==null?void 0:M.label)||h}),e.jsx("br",{}),e.jsx("br",{}),"Email notifications will be sent to customers for orders that are visible to them. This action cannot be undone."]})]}),e.jsxs(Ee,{children:[e.jsx(Oe,{disabled:O,children:"Cancel"}),e.jsx(Be,{onClick:Ne,disabled:O,children:O?"Updating...":"Confirm Update"})]})]})}),e.jsx(Ie,{open:ue,onOpenChange:H,children:e.jsxs(Le,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ze,{children:[e.jsxs(Ue,{children:["Order Details: ",t==null?void 0:t.estimate_name]}),e.jsx(Re,{children:"Complete order information and cost breakdown"})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(v,{className:"text-base",children:"Order Status & Timeline"})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(F,{className:P("text-white",((Q=y[t.status])==null?void 0:Q.color)||"bg-gray-500"),children:((G=y[t.status])==null?void 0:G.label)||t.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsx("span",{className:"text-sm font-medium",children:w(new Date(t.created_at),"PPP")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Last Updated"}),e.jsx("span",{className:"text-sm font-medium",children:w(new Date(t.updated_at),"PPP")})]}),t.estimated_completion_date&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Est. Completion"}),e.jsx("span",{className:"text-sm font-medium",children:w(new Date(t.estimated_completion_date),"PPP")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Customer Visible"}),e.jsx(F,{variant:t.is_customer_visible?"default":"secondary",children:t.is_customer_visible?"Yes":"No"})]})]})]}),e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(v,{className:"text-base",children:"Customer Information"})}),e.jsx(j,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-sm font-medium",children:t.customer_name||"N/A"})]}),t.customer_email&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:t.customer_email})]})]}),t.customer_phone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Phone"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:t.customer_phone})]})]}),t.customer_address&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Address"}),e.jsx("p",{className:"text-sm font-medium whitespace-pre-wrap",children:t.customer_address})]})]})})]}),t.reference_images&&t.reference_images.length>0&&e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(v,{className:"text-base",children:"Reference Images"})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:t.reference_images.map((s,a)=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group relative aspect-square rounded-lg overflow-hidden border hover:border-primary transition-colors",children:[e.jsx(ye,{src:s,alt:`Reference ${a+1}`,className:"object-cover w-full h-full group-hover:scale-105 transition-transform"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx(ce,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]},a))})})]}),e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(v,{className:"text-base",children:"Cost Breakdown"})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[t.net_weight&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Net Weight"}),e.jsxs("span",{className:"font-medium",children:[t.net_weight,"g"]})]}),t.purity_fraction&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Purity Fraction"}),e.jsx("span",{className:"font-medium",children:t.purity_fraction})]}),t.gold_rate_24k&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Gold Rate (24k)"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.gold_rate_24k),"/g"]})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[t.gold_cost>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Gold Cost"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.gold_cost)]})]}),t.making_charges>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Making Charges"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.making_charges)]})]}),t.diamond_cost>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Diamond Cost"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.diamond_cost)]})]}),t.gemstone_cost>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Gemstone Cost"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.gemstone_cost)]})]}),t.cad_design_charges>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"CAD Design Charges"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.cad_design_charges)]})]}),t.camming_charges>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Camming Charges"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.camming_charges)]})]}),t.certification_cost>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Certification Cost"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),c(t.certification_cost)]})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Cost"}),e.jsxs("span",{className:"font-semibold text-lg flex items-center gap-1",children:[e.jsx(d,{className:"h-4 w-4"}),c(t.total_cost||0)]})]}),t.profit_margin_percentage>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Profit Margin"}),e.jsxs("span",{className:"font-medium",children:[t.profit_margin_percentage,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-primary",children:"Final Selling Price"}),e.jsxs("span",{className:"font-semibold text-lg text-primary flex items-center gap-1",children:[e.jsx(d,{className:"h-4 w-4"}),c(t.final_selling_price||0)]})]})]})]})]}),t.notes&&e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(v,{className:"text-base",children:"Notes"})}),e.jsx(j,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.notes})})]})]})]})})]})})};export{vs as default};
//# sourceMappingURL=AdminManufacturingOrders-COsJB4OG.js.map
