import{j as e}from"./query-vendor-BLxHmmGk.js";import{u as S,r as i}from"./react-vendor-BeR0k5Z3.js";import{B as f,C as l,G as x,H as g,I as N,D as d,F as b}from"./index-DGlTgSKx.js";import{A as C,a as I}from"./alert-B0m9J_BT.js";import{P}from"./progress-CD8Qom20.js";import{B as A}from"./badge-DknkzE8c.js";import{S as B}from"./scroll-area-B6OKxq6t.js";import{J as D,aZ as v,ad as F,i as y,q as w,aa as z,ac as R,a7 as U,u as o}from"./ui-vendor-CN4tOqpp.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BC78nHQ6.js";import"./index-BdQq_4o_.js";const Z=()=>{const k=S(),[c,u]=i.useState(!1),[h,p]=i.useState([]),[a,j]=i.useState(null),[m,t]=i.useState(0),M=async()=>{try{u(!0),t(10),p([]),j(null);const{data:{session:s}}=await b.auth.getSession();if(!s){o.error("You must be logged in to migrate images");return}t(30);const{data:r,error:n}=await b.functions.invoke("migrate-images",{headers:{Authorization:`Bearer ${s.access_token}`}});if(t(90),n)throw console.error("Migration error:",n),new Error(n.message||"Migration failed");if(r.error)throw new Error(r.error);p(r.results||[]),j(r.summary),t(100),r.summary.totalImagesMigrated>0?o.success(`Successfully migrated ${r.summary.totalImagesMigrated} images from ${r.summary.successfulProducts} products!`):o.info("No external images found to migrate. All images are already hosted on your server.")}catch(s){console.error("Migration error:",s),o.error(s.message||"Failed to migrate images")}finally{u(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20",children:[e.jsx("header",{className:"border-b border-border/50 bg-card/95 backdrop-blur-md shadow-lg sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>k("/"),className:"hover:bg-muted",children:e.jsx(D,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(v,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-foreground",children:"Image Migration Tool"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Migrate external images to your server"})]})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 lg:px-6 py-8 max-w-4xl",children:[e.jsxs(l,{className:"mb-6 border-primary/20 bg-card/50 backdrop-blur-sm",children:[e.jsxs(x,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-primary"}),"What does this tool do?"]}),e.jsx(N,{children:"This migration tool will automatically:"})]}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Download external images"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetches all product images currently hosted on external URLs"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Upload to your server"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stores images in your Supabase Storage for faster, reliable access"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(v,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Update product records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically updates your products with new hosted image URLs"})]})]}),e.jsxs(C,{className:"mt-4 border-blue-500/30 bg-blue-500/5",children:[e.jsx(z,{className:"h-4 w-4 text-blue-500"}),e.jsx(I,{className:"text-sm",children:"This process may take a few minutes depending on how many products you have. Images larger than 5MB will be skipped."})]})]})]}),e.jsx(l,{className:"mb-6 bg-card/80 backdrop-blur-sm",children:e.jsxs(d,{className:"pt-6",children:[e.jsx(f,{onClick:M,disabled:c,size:"lg",className:"w-full h-14 text-base shadow-lg hover:shadow-xl transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 mr-2 animate-spin"}),"Migrating Images..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-5 w-5 mr-2"}),"Start Migration"]})}),c&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(P,{value:m,className:"h-2"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:m<30?"Preparing migration...":m<90?"Processing images...":"Finalizing..."})]})]})}),a&&e.jsxs(l,{className:"mb-6 border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10",children:[e.jsx(x,{children:e.jsx(g,{className:"text-xl",children:"Migration Summary"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-background/50",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:a.totalProducts}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Products Processed"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-background/50",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:a.successfulProducts}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Successful"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-background/50",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:a.totalImagesMigrated}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Images Migrated"})]})]})})]}),h.length>0&&e.jsxs(l,{children:[e.jsxs(x,{children:[e.jsx(g,{children:"Migration Results"}),e.jsx(N,{children:"Detailed results for each product"})]}),e.jsx(d,{children:e.jsx(B,{className:"h-[400px] pr-4",children:e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border bg-muted/30 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.success?e.jsx(y,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0"}):e.jsx(U,{className:"h-5 w-5 text-destructive flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:s.sku}),s.error&&e.jsx("p",{className:"text-sm text-destructive truncate",children:s.error})]})]}),e.jsxs(A,{variant:s.migratedImages>0?"default":"secondary",className:"ml-3",children:[s.migratedImages," ",s.migratedImages===1?"image":"images"]})]},s.productId))})})})]})]})]})};export{Z as default};
//# sourceMappingURL=MigrateImages-Bu1RYusd.js.map
