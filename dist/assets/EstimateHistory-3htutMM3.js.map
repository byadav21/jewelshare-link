{"version":3,"file":"EstimateHistory-3htutMM3.js","sources":["../../src/pages/EstimateHistory.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { Search, FileText, Eye, ArrowLeft, FileCheck, Trash2, Archive, ArchiveRestore, AlertTriangle } from \"lucide-react\";\r\nimport { exportCatalogToPDF } from \"@/utils/pdfExport\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\n\r\ninterface Estimate {\r\n  id: string;\r\n  estimate_name: string;\r\n  created_at: string;\r\n  customer_name: string;\r\n  customer_email: string;\r\n  customer_phone: string;\r\n  total_cost: number;\r\n  final_selling_price: number;\r\n  status: string;\r\n  updated_at: string;\r\n  is_archived?: boolean;\r\n  archived_at?: string;\r\n}\r\n\r\nconst getDaysUntilDeletion = (archivedAt: string | undefined): number | null => {\r\n  if (!archivedAt) return null;\r\n  const archiveDate = new Date(archivedAt);\r\n  const deletionDate = new Date(archiveDate);\r\n  deletionDate.setDate(deletionDate.getDate() + 30);\r\n  const now = new Date();\r\n  const diffTime = deletionDate.getTime() - now.getTime();\r\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n  return Math.max(0, diffDays);\r\n};\r\n\r\nconst EstimateHistory = () => {\r\n  const navigate = useNavigate();\r\n  const [estimates, setEstimates] = useState<Estimate[]>([]);\r\n  const [filteredEstimates, setFilteredEstimates] = useState<Estimate[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n  const [viewMode, setViewMode] = useState<\"active\" | \"archived\">(\"active\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [estimateToDelete, setEstimateToDelete] = useState<Estimate | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [isArchiving, setIsArchiving] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchEstimates();\r\n  }, [viewMode]);\r\n\r\n  useEffect(() => {\r\n    filterEstimates();\r\n  }, [searchTerm, statusFilter, estimates]);\r\n\r\n  const fetchEstimates = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        toast.error(\"Please sign in to view estimates\");\r\n        navigate(\"/auth\");\r\n        return;\r\n      }\r\n\r\n      let query = supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .or(\"is_invoice_generated.is.null,is_invoice_generated.eq.false\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (viewMode === \"archived\") {\r\n        query = query.eq(\"is_archived\", true);\r\n      } else {\r\n        query = query.or(\"is_archived.is.null,is_archived.eq.false\");\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      setEstimates(data || []);\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to load estimates\");\r\n      console.error(\"Error fetching estimates:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filterEstimates = () => {\r\n    let filtered = estimates;\r\n\r\n    if (searchTerm) {\r\n      filtered = filtered.filter(\r\n        (estimate) =>\r\n          estimate.estimate_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n          estimate.customer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n          estimate.customer_email?.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n\r\n    if (statusFilter !== \"all\") {\r\n      filtered = filtered.filter((estimate) => estimate.status === statusFilter);\r\n    }\r\n\r\n    setFilteredEstimates(filtered);\r\n  };\r\n\r\n  const handleViewEstimate = (estimateId: string) => {\r\n    navigate(`/manufacturing-cost?estimate=${estimateId}`);\r\n  };\r\n\r\n  const handleConvertToInvoice = (estimateId: string) => {\r\n    navigate(`/invoice-generator?estimate=${estimateId}`);\r\n  };\r\n\r\n  const handleDeleteClick = (estimate: Estimate) => {\r\n    setEstimateToDelete(estimate);\r\n    setDeleteDialogOpen(true);\r\n  };\r\n\r\n  const handleConfirmDelete = async () => {\r\n    if (!estimateToDelete) return;\r\n    \r\n    setIsDeleting(true);\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .delete()\r\n        .eq(\"id\", estimateToDelete.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setEstimates(prev => prev.filter(e => e.id !== estimateToDelete.id));\r\n      toast.success(\"Estimate deleted permanently\");\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to delete estimate\");\r\n      console.error(\"Error deleting estimate:\", error);\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteDialogOpen(false);\r\n      setEstimateToDelete(null);\r\n    }\r\n  };\r\n\r\n  const handleArchive = async (estimate: Estimate) => {\r\n    setIsArchiving(true);\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .update({ is_archived: true, archived_at: new Date().toISOString() })\r\n        .eq(\"id\", estimate.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setEstimates(prev => prev.filter(e => e.id !== estimate.id));\r\n      toast.success(\"Estimate archived (auto-deletes after 30 days)\");\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to archive estimate\");\r\n      console.error(\"Error archiving estimate:\", error);\r\n    } finally {\r\n      setIsArchiving(false);\r\n    }\r\n  };\r\n\r\n  const handleRestore = async (estimate: Estimate) => {\r\n    setIsArchiving(true);\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .update({ is_archived: false })\r\n        .eq(\"id\", estimate.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setEstimates(prev => prev.filter(e => e.id !== estimate.id));\r\n      toast.success(\"Estimate restored successfully\");\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to restore estimate\");\r\n      console.error(\"Error restoring estimate:\", error);\r\n    } finally {\r\n      setIsArchiving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4 md:p-8\">\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        <Button\r\n          variant=\"ghost\"\r\n          onClick={() => navigate(\"/calculators\")}\r\n          className=\"group\"\r\n        >\r\n          <ArrowLeft className=\"mr-2 h-4 w-4 transition-transform group-hover:-translate-x-1\" />\r\n          Back to Calculators\r\n        </Button>\r\n\r\n        <Card className=\"border-primary/10 shadow-2xl backdrop-blur-sm bg-card/95\">\r\n          <CardHeader className=\"bg-gradient-to-r from-primary/5 via-secondary/5 to-accent/5 border-b\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-3xl font-bold flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                  <FileText className=\"h-7 w-7 text-primary\" />\r\n                </div>\r\n                Estimate History\r\n              </CardTitle>\r\n              <Badge variant=\"secondary\" className=\"text-sm\">\r\n                {filteredEstimates.length} {filteredEstimates.length === 1 ? \"Estimate\" : \"Estimates\"}\r\n              </Badge>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"p-6 space-y-6\">\r\n            <Tabs value={viewMode} onValueChange={(v) => setViewMode(v as \"active\" | \"archived\")} className=\"w-full\">\r\n              <TabsList className=\"grid w-full max-w-xs grid-cols-2\">\r\n                <TabsTrigger value=\"active\" className=\"flex items-center gap-2\">\r\n                  <FileText className=\"h-4 w-4\" />\r\n                  Active\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"archived\" className=\"flex items-center gap-2\">\r\n                  <Archive className=\"h-4 w-4\" />\r\n                  Archived\r\n                </TabsTrigger>\r\n              </TabsList>\r\n            </Tabs>\r\n\r\n            <div className=\"flex flex-col md:flex-row gap-4\">\r\n              <div className=\"flex-1 relative\">\r\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Search by estimate name, customer name or email...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                <SelectTrigger className=\"w-full md:w-48\">\r\n                  <SelectValue placeholder=\"Filter by status\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">All Status</SelectItem>\r\n                  <SelectItem value=\"draft\">Draft</SelectItem>\r\n                  <SelectItem value=\"quoted\">Quoted</SelectItem>\r\n                  <SelectItem value=\"approved\">Approved</SelectItem>\r\n                  <SelectItem value=\"in_production\">In Production</SelectItem>\r\n                  <SelectItem value=\"completed\">Completed</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            {viewMode === \"archived\" && filteredEstimates.length > 0 && !loading && (\r\n              <div className=\"rounded-lg border border-destructive/30 bg-destructive/5 p-4\">\r\n                <div className=\"flex items-start gap-3\">\r\n                  <div className=\"p-2 rounded-full bg-destructive/10\">\r\n                    <AlertTriangle className=\"h-5 w-5 text-destructive\" />\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <h4 className=\"font-semibold text-destructive\">Archived Estimates</h4>\r\n                    <p className=\"text-sm text-muted-foreground mt-1\">\r\n                      You have <span className=\"font-medium text-foreground\">{filteredEstimates.length}</span> archived {filteredEstimates.length === 1 ? \"estimate\" : \"estimates\"}.\r\n                      {(() => {\r\n                        const estimatesWithDates = filteredEstimates\r\n                          .filter(e => e.archived_at)\r\n                          .map(e => ({ ...e, daysLeft: getDaysUntilDeletion(e.archived_at) }))\r\n                          .filter(e => e.daysLeft !== null)\r\n                          .sort((a, b) => (a.daysLeft || 0) - (b.daysLeft || 0));\r\n                        \r\n                        if (estimatesWithDates.length === 0) return null;\r\n                        \r\n                        const nearest = estimatesWithDates[0];\r\n                        const days = nearest.daysLeft;\r\n                        \r\n                        if (days === 0) {\r\n                          return <> The next deletion is <span className=\"font-medium text-destructive\">today</span>.</>;\r\n                        } else if (days === 1) {\r\n                          return <> The next deletion is in <span className=\"font-medium text-destructive\">1 day</span>.</>;\r\n                        } else {\r\n                          return <> The next deletion is in <span className=\"font-medium text-destructive\">{days} days</span>.</>;\r\n                        }\r\n                      })()}\r\n                    </p>\r\n                    <p className=\"text-xs text-muted-foreground mt-2\">\r\n                      Archived estimates are automatically deleted after 30 days. Restore them to keep them permanently.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {loading ? (\r\n              <div className=\"space-y-4\">\r\n                {[...Array(4)].map((_, i) => (\r\n                  <div key={i} className=\"rounded-lg border bg-card p-6\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                      <div className=\"space-y-3 flex-1\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className=\"h-8 w-48 bg-muted animate-pulse rounded-lg\" />\r\n                          <div className=\"h-6 w-20 bg-muted animate-pulse rounded-full\" />\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                          <div className=\"h-4 w-32 bg-muted animate-pulse rounded\" />\r\n                          <div className=\"h-4 w-40 bg-muted animate-pulse rounded\" />\r\n                        </div>\r\n                        <div className=\"h-6 w-28 bg-muted animate-pulse rounded\" />\r\n                      </div>\r\n                      <div className=\"flex gap-3\">\r\n                        <div className=\"h-10 w-20 bg-muted animate-pulse rounded\" />\r\n                        <div className=\"h-10 w-32 bg-muted animate-pulse rounded\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : filteredEstimates.length === 0 ? (\r\n              <div className=\"text-center py-16\">\r\n                <div className=\"p-4 rounded-full bg-muted/50 inline-block mb-4\">\r\n                  <FileText className=\"h-16 w-16 text-muted-foreground\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold mb-2\">No estimates found</h3>\r\n                <p className=\"text-muted-foreground mb-6\">\r\n                  {searchTerm || statusFilter !== \"all\"\r\n                    ? \"Try adjusting your filters\"\r\n                    : \"Start creating estimates to see them here\"}\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {filteredEstimates.map((estimate) => (\r\n                  <Card \r\n                    key={estimate.id} \r\n                    className=\"group hover:shadow-lg hover:border-primary/20 transition-all duration-200 bg-gradient-to-br from-card to-card/50\"\r\n                  >\r\n                    <CardContent className=\"p-6\">\r\n                      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                        <div className=\"space-y-3 flex-1\">\r\n                          <div className=\"flex items-center gap-3 flex-wrap\">\r\n                            <div className=\"flex items-center gap-2 bg-primary/5 px-3 py-1.5 rounded-lg\">\r\n                              <FileText className=\"h-4 w-4 text-primary\" />\r\n                              <h3 className=\"font-bold text-lg\">{estimate.estimate_name}</h3>\r\n                            </div>\r\n                            <Badge \r\n                              variant={estimate.status === \"completed\" ? \"default\" : \"secondary\"}\r\n                              className=\"capitalize\"\r\n                            >\r\n                              {estimate.status?.replace(\"_\", \" \")}\r\n                            </Badge>\r\n                            {viewMode === \"archived\" && estimate.archived_at && (\r\n                              <Badge \r\n                                variant=\"destructive\" \r\n                                className=\"flex items-center gap-1\"\r\n                              >\r\n                                <AlertTriangle className=\"h-3 w-3\" />\r\n                                {(() => {\r\n                                  const days = getDaysUntilDeletion(estimate.archived_at);\r\n                                  if (days === null) return \"Pending deletion\";\r\n                                  if (days === 0) return \"Deleting today\";\r\n                                  if (days === 1) return \"1 day left\";\r\n                                  return `${days} days left`;\r\n                                })()}\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                            <div className=\"flex items-center gap-2 text-sm\">\r\n                              <span className=\"font-medium text-muted-foreground\">Customer:</span>\r\n                              <span className=\"text-foreground\">{estimate.customer_name || \"N/A\"}</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 text-sm\">\r\n                              <span className=\"font-medium text-muted-foreground\">Created:</span>\r\n                              <span className=\"text-foreground\">\r\n                                {new Date(estimate.created_at).toLocaleDateString('en-US', { \r\n                                  year: 'numeric', \r\n                                  month: 'short', \r\n                                  day: 'numeric',\r\n                                  hour: '2-digit',\r\n                                  minute: '2-digit'\r\n                                })}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-baseline gap-2 pt-1\">\r\n                            <span className=\"text-sm font-medium text-muted-foreground\">Amount:</span>\r\n                            <span className=\"text-2xl font-bold text-primary\">\r\n                              â‚¹{estimate.final_selling_price?.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 md:gap-3 flex-wrap\">\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"default\"\r\n                            onClick={() => handleViewEstimate(estimate.id)}\r\n                            className=\"group/btn\"\r\n                          >\r\n                            <Eye className=\"h-4 w-4 mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                            View\r\n                          </Button>\r\n                          {viewMode === \"active\" ? (\r\n                            <>\r\n                              <Button\r\n                                size=\"default\"\r\n                                onClick={() => handleConvertToInvoice(estimate.id)}\r\n                                className=\"group/btn bg-primary hover:bg-primary/90\"\r\n                              >\r\n                                <FileCheck className=\"h-4 w-4 mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                                Create Invoice\r\n                              </Button>\r\n                              <Button\r\n                                variant=\"secondary\"\r\n                                size=\"default\"\r\n                                onClick={() => handleArchive(estimate)}\r\n                                disabled={isArchiving}\r\n                                className=\"group/btn\"\r\n                              >\r\n                                <Archive className=\"h-4 w-4 md:mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                                <span className=\"hidden md:inline\">Archive</span>\r\n                              </Button>\r\n                            </>\r\n                          ) : (\r\n                            <Button\r\n                              variant=\"secondary\"\r\n                              size=\"default\"\r\n                              onClick={() => handleRestore(estimate)}\r\n                              disabled={isArchiving}\r\n                              className=\"group/btn\"\r\n                            >\r\n                              <ArchiveRestore className=\"h-4 w-4 md:mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                              <span className=\"hidden md:inline\">Restore</span>\r\n                            </Button>\r\n                          )}\r\n                          <Button\r\n                            variant=\"destructive\"\r\n                            size=\"default\"\r\n                            onClick={() => handleDeleteClick(estimate)}\r\n                            className=\"group/btn\"\r\n                          >\r\n                            <Trash2 className=\"h-4 w-4 md:mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                            <span className=\"hidden md:inline\">Delete</span>\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Delete Estimate</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Are you sure you want to delete \"{estimateToDelete?.estimate_name}\"? This action cannot be undone.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleConfirmDelete}\r\n              disabled={isDeleting}\r\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EstimateHistory;\r\n"],"names":["getDaysUntilDeletion","archivedAt","archiveDate","deletionDate","now","diffTime","diffDays","EstimateHistory","navigate","useNavigate","estimates","setEstimates","useState","filteredEstimates","setFilteredEstimates","searchTerm","setSearchTerm","statusFilter","setStatusFilter","viewMode","setViewMode","loading","setLoading","deleteDialogOpen","setDeleteDialogOpen","estimateToDelete","setEstimateToDelete","isDeleting","setIsDeleting","isArchiving","setIsArchiving","useEffect","fetchEstimates","filterEstimates","user","supabase","toast","query","data","error","filtered","estimate","_a","_b","_c","handleViewEstimate","estimateId","handleConvertToInvoice","handleDeleteClick","handleConfirmDelete","prev","e","handleArchive","handleRestore","jsxs","Button","jsx","ArrowLeft","Card","CardHeader","CardTitle","FileText","Badge","CardContent","Tabs","v","TabsList","TabsTrigger","Archive","Search","Input","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","AlertTriangle","estimatesWithDates","a","b","days","Fragment","_","i","Eye","FileCheck","ArchiveRestore","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"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"}