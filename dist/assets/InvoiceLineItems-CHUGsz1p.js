import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as T}from"./react-vendor-BeR0k5Z3.js";import{B as u,C as I,D as v,G as B,H as O,F as k}from"./index-DGlTgSKx.js";import{I as c}from"./input-CEHl5GoJ.js";import{L as n}from"./label-ClRcubO_.js";import{T as H}from"./textarea-DU5hu0UG.js";import{S as P,a as A,b as M,c as L,d as j}from"./select-CQfvDDtS.js";import{ak as K,ay as X,X as F,u as f}from"./ui-vendor-CN4tOqpp.js";import{E as S}from"./EstimateImage-BXHCwrxx.js";const q=3200,J=95,le=({items:d,onChange:N,goldRate24k:p,platinumRate:b=q,silverRate:w=J,purityFraction:U,estimateCategory:o="jewelry"})=>{const[x,y]=T.useState(null),[g,_]=T.useState(!1),W=(s,t)=>{switch(s){case"platinum":return b*t;case"silver":return w*t;case"gold":default:return p*t}},D=s=>{switch(s){case"platinum":return"Platinum";case"silver":return"Silver";case"gold":default:return"Gold"}},V=()=>{const s={id:`item-${Date.now()}`,item_name:"",description:"",image_url:"",certificate_image_url:"",metal_type:"gold",metal_rate:p,diamond_weight:0,diamond_per_carat_price:0,diamond_color:"",diamond_clarity:"",diamond_cut:"",diamond_certification:"",diamond_shape:"",diamond_fluorescence:"",diamond_measurements:"",gemstone_weight:0,gemstone_type:"",gemstone_color:"",gemstone_clarity:"",gemstone_origin:"",gemstone_treatment:"",gemstone_shape:"",gemstone_per_carat_price:0,net_weight:0,gross_weight:0,purity_fraction:U,diamond_cost:0,gemstone_cost:0,metal_cost:0,gold_cost:0,making_charges:0,certification_cost:0,cad_design_charges:0,camming_charges:0,subtotal:0,weight_mode:"gross"};N([...d,s]),y(d.length)},l=(s,t,a)=>{const i=[...d];i[s]={...i[s],[t]:a};const r=i[s];if(r.weight_mode==="gross"&&(t==="gross_weight"||t==="diamond_weight"||t==="gemstone_weight")){const h=(r.diamond_weight+r.gemstone_weight)/5;r.net_weight=Math.max(0,r.gross_weight-h)}if((t==="diamond_weight"||t==="diamond_per_carat_price")&&(r.diamond_cost=r.diamond_weight*r.diamond_per_carat_price),(t==="gemstone_weight"||t==="gemstone_per_carat_price")&&r.gemstone_per_carat_price&&(r.gemstone_cost=r.gemstone_weight*r.gemstone_per_carat_price),t==="metal_type")switch(a){case"platinum":r.metal_rate=b;break;case"silver":r.metal_rate=w;break;case"gold":default:r.metal_rate=p}const m=W(r.metal_type||"gold",r.purity_fraction);r.metal_cost=r.net_weight*m,r.gold_cost=r.metal_cost,o==="loose_diamond"?r.subtotal=r.diamond_cost+r.certification_cost:o==="gemstone"?r.subtotal=r.gemstone_cost+r.certification_cost:r.subtotal=r.metal_cost+r.making_charges+r.certification_cost+r.cad_design_charges+r.camming_charges+r.diamond_cost+r.gemstone_cost,N(i)},$=s=>{const t=d.filter((a,i)=>i!==s);N(t),x===s&&y(null)},z=async(s,t)=>{try{_(!0);const a=t.name.split(".").pop(),r=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${a}`}`,{error:m,data:h}=await k.storage.from("manufacturing-estimates").upload(r,t,{cacheControl:"3600",upsert:!1});if(m)throw m;const C=h.path;l(s,"image_url",C),f.success("Image uploaded successfully")}catch(a){console.error("Error uploading image:",a),f.error("Failed to upload image")}finally{_(!1)}},R=s=>{l(s,"image_url","")},E=async(s,t)=>{try{_(!0);const a=t.name.split(".").pop(),r=`${`cert-${Date.now()}-${Math.random().toString(36).substring(7)}.${a}`}`,{error:m,data:h}=await k.storage.from("manufacturing-estimates").upload(r,t,{cacheControl:"3600",upsert:!1});if(m)throw m;const C=h.path;l(s,"certificate_image_url",C),f.success("Certificate uploaded successfully")}catch(a){console.error("Error uploading certificate:",a),f.error("Failed to upload certificate")}finally{_(!1)}},G=s=>{l(s,"certificate_image_url","")};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Invoice Line Items"}),e.jsxs(u,{onClick:V,size:"sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),d.length===0?e.jsx(I,{children:e.jsx(v,{className:"p-6 text-center text-muted-foreground",children:'No items added yet. Click "Add Item" to start adding jewelry pieces to this invoice.'})}):e.jsx("div",{className:"space-y-4",children:d.map((s,t)=>e.jsxs(I,{className:"border-2",children:[e.jsx(B,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"text-base",children:["Item ",t+1,": ",s.item_name||"Untitled Item"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:x===t?"default":"outline",size:"sm",onClick:()=>y(x===t?null:t),children:x===t?"Done":"Edit"}),e.jsx(u,{variant:"destructive",size:"sm",onClick:()=>$(t),children:e.jsx(X,{className:"h-4 w-4"})})]})]})}),x===t?e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Item Name *"}),e.jsx(c,{value:s.item_name,onChange:a=>l(t,"item_name",a.target.value),placeholder:"e.g., Diamond Engagement Ring"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Description"}),e.jsx(H,{value:s.description,onChange:a=>l(t,"description",a.target.value),placeholder:"Describe the jewelry piece...",rows:3})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Product Image"}),e.jsx("div",{className:"mt-2",children:s.image_url?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:s.image_url,alt:s.item_name,className:"h-32 w-32 object-cover rounded border"}),e.jsx(u,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2",onClick:()=>R(t),children:e.jsx(F,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"file",accept:"image/*",onChange:a=>{var r;const i=(r=a.target.files)==null?void 0:r[0];i&&z(t,i)},disabled:g}),g&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})})]}),o==="jewelry"&&e.jsxs("div",{className:"col-span-2 space-y-4 p-4 border rounded-lg bg-card",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-base mb-1",children:"Metal Type & Weight"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select metal and enter weight details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"mb-2 block",children:"Metal Type:"}),e.jsxs(P,{value:s.metal_type||"gold",onValueChange:a=>l(t,"metal_type",a),children:[e.jsx(A,{children:e.jsx(M,{placeholder:"Select metal"})}),e.jsxs(L,{children:[e.jsxs(j,{value:"gold",children:["Gold (24K Rate: ₹",p.toLocaleString(),"/g)"]}),e.jsxs(j,{value:"platinum",children:["Platinum (Rate: ₹",b.toLocaleString(),"/g)"]}),e.jsxs(j,{value:"silver",children:["Silver (Rate: ₹",w.toLocaleString(),"/g)"]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"mb-2 block",children:"Weight Entry Mode:"}),e.jsxs(P,{value:s.weight_mode,onValueChange:a=>l(t,"weight_mode",a),children:[e.jsx(A,{children:e.jsx(M,{})}),e.jsxs(L,{children:[e.jsx(j,{value:"gross",children:"Gross Weight Mode"}),e.jsx(j,{value:"net",children:"Net Weight Mode"})]})]})]})]}),s.weight_mode==="gross"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(n,{children:"Gross Weight (grams)"}),e.jsx(c,{type:"number",step:"0.01",value:s.gross_weight,onChange:a=>l(t,"gross_weight",parseFloat(a.target.value)||0),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsxs(n,{children:["Net Weight (grams) ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Auto-calculated)"})]}),e.jsx(c,{type:"number",step:"0.01",value:s.net_weight,disabled:!0,className:"mt-1.5 bg-muted"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(n,{children:"Gross Weight (grams)"}),e.jsx(c,{type:"number",step:"0.01",value:s.gross_weight,onChange:a=>l(t,"gross_weight",parseFloat(a.target.value)||0),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Net Weight (grams)"}),e.jsx(c,{type:"number",step:"0.01",value:s.net_weight,onChange:a=>l(t,"net_weight",parseFloat(a.target.value)||0),className:"mt-1.5"})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Purity Fraction (e.g., 0.76 for 18K)"}),e.jsx(c,{type:"number",step:"0.01",min:"0",max:"1",value:s.purity_fraction,onChange:a=>l(t,"purity_fraction",parseFloat(a.target.value)||0),className:"mt-1.5"})]})]}),(o==="jewelry"||o==="loose_diamond")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-2 border-t my-2 pt-4",children:e.jsx("h5",{className:"font-medium text-sm text-muted-foreground mb-3",children:"Diamond Details"})}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Weight (ct)"}),e.jsx(c,{type:"number",step:"0.01",value:s.diamond_weight,onChange:a=>l(t,"diamond_weight",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Per Carat Price (₹/ct)"}),e.jsx(c,{type:"number",step:"0.01",value:s.diamond_per_carat_price,onChange:a=>l(t,"diamond_per_carat_price",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsxs(n,{children:["Diamond Cost (₹) ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Auto-calculated)"})]}),e.jsx(c,{type:"number",step:"0.01",value:s.diamond_cost,disabled:!0,className:"bg-muted"})]})]}),(o==="jewelry"||o==="loose_diamond")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Color"}),e.jsx(c,{value:s.diamond_color,onChange:a=>l(t,"diamond_color",a.target.value),placeholder:"e.g., D, E, F"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Clarity"}),e.jsx(c,{value:s.diamond_clarity,onChange:a=>l(t,"diamond_clarity",a.target.value),placeholder:"e.g., VVS1, VS1, SI1"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Cut"}),e.jsx(c,{value:s.diamond_cut,onChange:a=>l(t,"diamond_cut",a.target.value),placeholder:"e.g., Excellent, Very Good"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Certification"}),e.jsx(c,{value:s.diamond_certification,onChange:a=>l(t,"diamond_certification",a.target.value),placeholder:"e.g., GIA, IGI"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Shape"}),e.jsx(c,{value:s.diamond_shape||"",onChange:a=>l(t,"diamond_shape",a.target.value),placeholder:"e.g., Round, Princess, Oval"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Diamond Fluorescence"}),e.jsx(c,{value:s.diamond_fluorescence||"",onChange:a=>l(t,"diamond_fluorescence",a.target.value),placeholder:"e.g., None, Faint, Medium"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Diamond Measurements"}),e.jsx(c,{value:s.diamond_measurements||"",onChange:a=>l(t,"diamond_measurements",a.target.value),placeholder:"e.g., 6.5 x 6.5 x 4.0 mm"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Certificate Image"}),e.jsx("div",{className:"mt-2",children:s.certificate_image_url?e.jsxs("div",{className:"relative inline-block",children:[e.jsx(S,{src:s.certificate_image_url,alt:"Certificate",className:"h-32 w-auto object-contain rounded border"}),e.jsx(u,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2",onClick:()=>G(t),children:e.jsx(F,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"file",accept:"image/*,.pdf",onChange:a=>{var r;const i=(r=a.target.files)==null?void 0:r[0];i&&E(t,i)},disabled:g}),g&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})})]})]}),(o==="jewelry"||o==="gemstone")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-2 border-t my-2 pt-4",children:e.jsx("h5",{className:"font-medium text-sm text-muted-foreground mb-3",children:"Gemstone Details"})}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Type"}),e.jsx(c,{value:s.gemstone_type,onChange:a=>l(t,"gemstone_type",a.target.value),placeholder:"e.g., Ruby, Sapphire, Emerald"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Weight (ct)"}),e.jsx(c,{type:"number",step:"0.01",value:s.gemstone_weight,onChange:a=>l(t,"gemstone_weight",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Per Carat Price (₹/ct)"}),e.jsx(c,{type:"number",step:"0.01",value:s.gemstone_per_carat_price||0,onChange:a=>l(t,"gemstone_per_carat_price",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsxs(n,{children:["Gemstone Cost (₹) ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Auto/Manual)"})]}),e.jsx(c,{type:"number",step:"0.01",value:s.gemstone_cost,onChange:a=>l(t,"gemstone_cost",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Color"}),e.jsx(c,{value:s.gemstone_color,onChange:a=>l(t,"gemstone_color",a.target.value),placeholder:"e.g., Pigeon Blood Red"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Clarity"}),e.jsx(c,{value:s.gemstone_clarity,onChange:a=>l(t,"gemstone_clarity",a.target.value),placeholder:"e.g., Eye Clean, VVS"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Origin"}),e.jsx(c,{value:s.gemstone_origin||"",onChange:a=>l(t,"gemstone_origin",a.target.value),placeholder:"e.g., Burma, Kashmir, Colombia"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Treatment"}),e.jsx(c,{value:s.gemstone_treatment||"",onChange:a=>l(t,"gemstone_treatment",a.target.value),placeholder:"e.g., None, Heated, Untreated"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Gemstone Shape"}),e.jsx(c,{value:s.gemstone_shape||"",onChange:a=>l(t,"gemstone_shape",a.target.value),placeholder:"e.g., Oval, Cushion, Cabochon"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Certificate Image"}),e.jsx("div",{className:"mt-2",children:s.certificate_image_url?e.jsxs("div",{className:"relative inline-block",children:[e.jsx(S,{src:s.certificate_image_url,alt:"Certificate",className:"h-32 w-auto object-contain rounded border"}),e.jsx(u,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2",onClick:()=>G(t),children:e.jsx(F,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"file",accept:"image/*,.pdf",onChange:a=>{var r;const i=(r=a.target.files)==null?void 0:r[0];i&&E(t,i)},disabled:g}),g&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})})]})]}),o==="jewelry"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-2 border-t my-2 pt-4",children:e.jsx("h5",{className:"font-medium text-sm text-muted-foreground mb-3",children:"Additional Charges"})}),e.jsxs("div",{children:[e.jsx(n,{children:"Making Charges (₹)"}),e.jsx(c,{type:"number",step:"0.01",value:s.making_charges,onChange:a=>l(t,"making_charges",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"CAD Design Charges (₹)"}),e.jsx(c,{type:"number",step:"0.01",value:s.cad_design_charges,onChange:a=>l(t,"cad_design_charges",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Camming Charges (₹)"}),e.jsx(c,{type:"number",step:"0.01",value:s.camming_charges,onChange:a=>l(t,"camming_charges",parseFloat(a.target.value)||0)})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Certification Cost (₹)"}),e.jsx(c,{type:"number",step:"0.01",value:s.certification_cost,onChange:a=>l(t,"certification_cost",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"col-span-2 pt-4 border-t",children:[o==="jewelry"&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-semibold",children:[D(s.metal_type||"gold")," Cost (Auto-calculated):"]}),e.jsxs("span",{className:"text-lg",children:["₹",(s.metal_cost||s.gold_cost||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-bold text-lg",children:"Item Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["₹",s.subtotal.toFixed(2)]})]})]})]})}):e.jsx(v,{children:e.jsxs("div",{className:"flex gap-4",children:[s.image_url&&e.jsx(S,{src:s.image_url,alt:s.item_name,className:"h-20 w-20 object-cover rounded border flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 truncate",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 text-sm",children:[o==="loose_diamond"&&s.diamond_weight>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carat:"})," ",s.diamond_weight,"ct"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Color:"})," ",s.diamond_color||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Clarity:"})," ",s.diamond_clarity||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Cut:"})," ",s.diamond_cut||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shape:"})," ",s.diamond_shape||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Cert:"})," ",s.diamond_certification||"-"]})]}),o==="gemstone"&&s.gemstone_weight>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",s.gemstone_type||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Carat:"})," ",s.gemstone_weight,"ct"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Color:"})," ",s.gemstone_color||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Origin:"})," ",s.gemstone_origin||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Treatment:"})," ",s.gemstone_treatment||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shape:"})," ",s.gemstone_shape||"-"]})]}),o==="jewelry"&&e.jsxs(e.Fragment,{children:[s.net_weight>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[D(s.metal_type||"gold"),":"]})," ",s.net_weight,"g (",(s.purity_fraction*100).toFixed(0),"%)"]}),s.diamond_weight>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Diamond:"})," ",s.diamond_weight,"ct ",s.diamond_color,"/",s.diamond_clarity]}),s.gemstone_weight>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Gemstone:"})," ",s.gemstone_weight,"ct ",s.gemstone_type]})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Subtotal:"}),e.jsxs("span",{className:"font-bold text-primary",children:["₹",s.subtotal.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})]})]})})]},s.id))}),d.length>0&&e.jsx(I,{className:"bg-muted/50",children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Total (All Items):"}),e.jsxs("span",{className:"text-2xl font-bold text-primary",children:["₹",d.reduce((s,t)=>s+t.subtotal,0).toFixed(2)]})]})})})]})};export{le as I};
//# sourceMappingURL=InvoiceLineItems-CHUGsz1p.js.map
