import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as d}from"./react-vendor-BeR0k5Z3.js";import{h as Y,s as o,W as E,B as u,C as p,i as h,k as j,g as _,l as A}from"./index-CX6yiz0b.js";import{I as S}from"./input-CiHC6UAI.js";import{L as m}from"./label-DbIM3Eg1.js";import{T as Z}from"./textarea-CBQfWmvq.js";import{S as $,a as ee,b as se,c as te,d as C}from"./select-CYWHo3cU.js";import{D as ae,a as re,b as ie,c as ne,d as de,e as ce}from"./dialog-KVJ8gRMk.js";import{T as k,a as I,b as w,c as r,d as F,e as i}from"./table-CYMzKz5T.js";import{B as R}from"./badge-45Abp579.js";import{ai as le,a2 as oe,d as me,U as xe,ay as ue,ar as pe}from"./ui-vendor-DjQqXt9S.js";import{f as he}from"./format-sTPjOSS_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-D6fUEw85.js";import"./index-DjQc2W_p.js";import"./index-DhS5fNEb.js";import"./en-US-DWrl2lTx.js";const Pe=()=>{const{toast:c}=Y(),[P,q]=d.useState([]),[L,M]=d.useState([]),[y,B]=d.useState({total_redemptions:0,total_points_spent:0,active_redemptions:0}),[v,D]=d.useState(null),[U,f]=d.useState(!1),[H,T]=d.useState(!0),[t,n]=d.useState({name:"",description:"",points_cost:"",reward_type:"extra_products",reward_value_amount:"",is_active:!0});d.useEffect(()=>{z()},[]);const z=async()=>{T(!0),await Promise.all([x(),O(),V()]),T(!1)},x=async()=>{const{data:s,error:a}=await o.from("rewards_catalog").select("*").order("points_cost",{ascending:!0});!a&&s&&q(s)},O=async()=>{const{data:s,error:a}=await o.from("redemptions").select("*").order("redeemed_at",{ascending:!1}).limit(50);!a&&s&&M(s)},V=async()=>{const{data:s,error:a}=await o.from("redemptions").select("points_spent, status");if(!a&&s){const g=s.length,l=s.reduce((N,X)=>N+X.points_spent,0),Q=s.filter(N=>N.status==="applied").length;B({total_redemptions:g,total_points_spent:l,active_redemptions:Q})}},G=async s=>{s.preventDefault();const a={amount:parseInt(t.reward_value_amount)||0};t.reward_type==="premium_support"&&(a.duration_days=parseInt(t.reward_value_amount)||30,delete a.amount);const g={name:t.name,description:t.description,points_cost:parseInt(t.points_cost),reward_type:t.reward_type,reward_value:a,is_active:t.is_active};if(v){const{error:l}=await o.from("rewards_catalog").update(g).eq("id",v.id);l?c({title:"Error",description:l.message,variant:"destructive"}):(c({title:"Success",description:"Reward updated successfully"}),f(!1),x(),b())}else{const{error:l}=await o.from("rewards_catalog").insert([g]);l?c({title:"Error",description:l.message,variant:"destructive"}):(c({title:"Success",description:"Reward created successfully"}),f(!1),x(),b())}},W=s=>{D(s),n({name:s.name,description:s.description||"",points_cost:s.points_cost.toString(),reward_type:s.reward_type,reward_value_amount:(s.reward_value.amount||s.reward_value.duration_days||"").toString(),is_active:s.is_active}),f(!0)},J=async s=>{if(!confirm("Are you sure you want to delete this reward?"))return;const{error:a}=await o.from("rewards_catalog").delete().eq("id",s);a?c({title:"Error",description:a.message,variant:"destructive"}):(c({title:"Success",description:"Reward deleted successfully"}),x())},K=async s=>{const{error:a}=await o.from("rewards_catalog").update({is_active:!s.is_active}).eq("id",s.id);a?c({title:"Error",description:a.message,variant:"destructive"}):x()},b=()=>{n({name:"",description:"",points_cost:"",reward_type:"extra_products",reward_value_amount:"",is_active:!0}),D(null)};return H?e.jsx(E,{children:e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-10 bg-muted rounded w-1/4"}),e.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-muted rounded"},s))})]})})}):e.jsx(E,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Rewards Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage reward catalog and view redemption analytics"})]}),e.jsxs(ae,{open:U,onOpenChange:s=>{f(s),s||b()},children:[e.jsx(re,{asChild:!0,children:e.jsxs(u,{children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Add Reward"]})}),e.jsxs(ie,{className:"max-w-md",children:[e.jsxs(ne,{children:[e.jsx(de,{children:v?"Edit Reward":"Add New Reward"}),e.jsx(ce,{children:"Create or update a reward in the catalog"})]}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:"Reward Name"}),e.jsx(S,{id:"name",value:t.name,onChange:s=>n({...t,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(Z,{id:"description",value:t.description,onChange:s=>n({...t,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"points_cost",children:"Points Cost"}),e.jsx(S,{id:"points_cost",type:"number",value:t.points_cost,onChange:s=>n({...t,points_cost:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reward_type",children:"Reward Type"}),e.jsxs($,{value:t.reward_type,onValueChange:s=>n({...t,reward_type:s}),children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(te,{children:[e.jsx(C,{value:"extra_products",children:"Extra Products"}),e.jsx(C,{value:"extra_share_links",children:"Extra Share Links"}),e.jsx(C,{value:"premium_support",children:"Premium Support"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reward_value_amount",children:t.reward_type==="premium_support"?"Duration (days)":"Amount"}),e.jsx(S,{id:"reward_value_amount",type:"number",value:t.reward_value_amount,onChange:s=>n({...t,reward_value_amount:s.target.value}),required:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:t.is_active,onChange:s=>n({...t,is_active:s.target.checked})}),e.jsx(m,{htmlFor:"is_active",children:"Active"})]}),e.jsx(u,{type:"submit",className:"w-full",children:v?"Update Reward":"Create Reward"})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs(p,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Total Redemptions"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:y.total_redemptions})})]}),e.jsxs(p,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Points Spent"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:y.total_points_spent.toLocaleString()})})]}),e.jsxs(p,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Active Rewards"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:y.active_redemptions})})]})]}),e.jsxs(p,{children:[e.jsxs(h,{children:[e.jsx(j,{children:"Rewards Catalog"}),e.jsx(A,{children:"Manage available rewards"})]}),e.jsx(_,{children:e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(w,{children:[e.jsx(r,{children:"Reward"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Cost"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(F,{children:P.map(s=>e.jsxs(w,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})}),e.jsx(i,{children:e.jsx(R,{variant:"outline",children:s.reward_type.replace(/_/g," ")})}),e.jsxs(i,{children:[s.points_cost," pts"]}),e.jsx(i,{children:e.jsx(R,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>W(s),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>K(s),children:s.is_active?"Disable":"Enable"}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>J(s.id),children:e.jsx(pe,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsxs(p,{children:[e.jsxs(h,{children:[e.jsx(j,{children:"Recent Redemptions"}),e.jsx(A,{children:"Latest reward redemptions by vendors"})]}),e.jsx(_,{children:e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(w,{children:[e.jsx(r,{children:"User ID"}),e.jsx(r,{children:"Points Spent"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Date"})]})}),e.jsx(F,{children:L.slice(0,10).map(s=>e.jsxs(w,{children:[e.jsxs(i,{className:"font-mono text-xs",children:[s.user_id.substring(0,8),"..."]}),e.jsxs(i,{children:[s.points_spent," pts"]}),e.jsx(i,{children:e.jsx(R,{variant:s.status==="applied"?"default":"secondary",children:s.status})}),e.jsx(i,{children:he(new Date(s.redeemed_at),"MMM d, yyyy")})]},s.id))})]})})]})]})})};export{Pe as default};
//# sourceMappingURL=AdminRewards-BqXAkuPO.js.map
