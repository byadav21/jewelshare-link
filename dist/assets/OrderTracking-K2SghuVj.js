import{j as e}from"./query-vendor-BLxHmmGk.js";import{h as D,u as I,r as m}from"./react-vendor-BeR0k5Z3.js";import{s as f,C as a,g as c,B as S,i as l,k as d,l as B}from"./index-CX6yiz0b.js";import{B as L}from"./badge-45Abp579.js";import{u as y,a9 as T,a7 as p,as as C,c as $,P as O}from"./ui-vendor-DjQqXt9S.js";import{E as F}from"./EstimateImage-DpQ34XUT.js";import{f as k}from"./format-sTPjOSS_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./en-US-DWrl2lTx.js";const x={draft:{label:"Draft",color:"bg-muted text-muted-foreground",icon:p},quoted:{label:"Quoted",color:"bg-blue-500 text-white",icon:O},approved:{label:"Approved",color:"bg-green-500 text-white",icon:C},in_production:{label:"In Production",color:"bg-amber-500 text-white",icon:$},completed:{label:"Completed",color:"bg-emerald-500 text-white",icon:C},cancelled:{label:"Cancelled",color:"bg-destructive text-destructive-foreground",icon:p}};function V(){var N,b,v,_,w;const{token:o}=D(),P=I(),[s,j]=m.useState(null),[E,u]=m.useState(!0),[g,h]=m.useState(null);if(m.useEffect(()=>{(async()=>{if(!o){h("Invalid tracking link"),u(!1);return}try{const{data:t,error:i}=await f.from("manufacturing_cost_estimates").select("*").eq("share_token",o).eq("is_customer_visible",!0).single();if(i)throw i;if(!t){h("Order not found or access denied"),u(!1);return}j(t)}catch(t){console.error("Error fetching order:",t),h("Unable to load order details"),y.error("Failed to load order")}finally{u(!1)}})();const r=f.channel("order-updates").on("postgres_changes",{event:"UPDATE",schema:"public",table:"manufacturing_cost_estimates",filter:`share_token=eq.${o}`},t=>{j(t.new),y.success("Order status updated!")}).subscribe();return()=>{f.removeChannel(r)}},[o]),E)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-secondary/20 to-background",children:e.jsx(a,{className:"w-full max-w-md",children:e.jsxs(c,{className:"pt-6 flex flex-col items-center gap-4",children:[e.jsx(T,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading order details..."})]})})});if(g||!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-secondary/20 to-background p-4",children:e.jsx(a,{className:"w-full max-w-md",children:e.jsxs(c,{className:"pt-6 flex flex-col items-center gap-4",children:[e.jsx(p,{className:"h-12 w-12 text-destructive"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Order Not Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:g}),e.jsx(S,{onClick:()=>P("/"),variant:"outline",children:"Go to Homepage"})]})})});const q=((N=x[s.status])==null?void 0:N.icon)||O;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-secondary/20 to-background py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(a,{children:e.jsx(l,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-2xl",children:"Order Tracking"}),e.jsx(B,{className:"mt-2",children:"Track your custom jewelry manufacturing order"})]}),e.jsxs(L,{className:(b=x[s.status])==null?void 0:b.color,children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),(v=x[s.status])==null?void 0:v.label]})]})})}),e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(d,{children:"Order Details"})}),e.jsx(c,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order Name"}),e.jsx("p",{className:"font-medium",children:s.estimate_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order Date"}),e.jsx("p",{className:"font-medium",children:k(new Date(s.created_at),"PPP")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Customer Name"}),e.jsx("p",{className:"font-medium",children:s.customer_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contact"}),e.jsx("p",{className:"font-medium",children:s.customer_phone||s.customer_email})]}),s.estimated_completion_date&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Estimated Completion"}),e.jsx("p",{className:"font-medium text-primary",children:k(new Date(s.estimated_completion_date),"PPP")})]})]})})]}),s.reference_images&&s.reference_images.length>0&&e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(d,{children:"Reference Images"})}),e.jsx(c,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:s.reference_images.map((n,r)=>e.jsx("div",{className:"relative aspect-square rounded-lg overflow-hidden border",children:e.jsx(F,{src:n,alt:`Reference ${r+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})},r))})})]}),e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(d,{children:"Pricing Information"})}),e.jsxs(c,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"Manufacturing Cost"}),e.jsxs("span",{className:"font-medium",children:["₹",((_=s.total_cost)==null?void 0:_.toLocaleString())||"N/A"]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"font-semibold",children:"Final Price"}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["₹",((w=s.final_selling_price)==null?void 0:w.toLocaleString())||"N/A"]})]})]})]}),s.notes&&e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(d,{children:"Additional Notes"})}),e.jsx(c,{children:e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:s.notes})})]}),e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(d,{children:"Order Progress"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(x).map(([n,r])=>{const t=r.icon,i=s.status===n,A=["draft","quoted","approved","in_production","completed"].indexOf(s.status)>["draft","quoted","approved","in_production","completed"].indexOf(n);return e.jsxs("div",{className:`flex items-center gap-3 ${i?"opacity-100":"opacity-50"}`,children:[e.jsx("div",{className:`rounded-full p-2 ${A||i?r.color:"bg-muted"}`,children:e.jsx(t,{className:"h-4 w-4"})}),e.jsx("span",{className:`font-medium ${i?"text-primary":""}`,children:r.label})]},n)})})})]})]})})}export{V as default};
//# sourceMappingURL=OrderTracking-K2SghuVj.js.map
