import{j as e}from"./query-vendor-CIvqgC9B.js";import{u as U,r as i}from"./react-vendor-BCzWReGx.js";import{Y as z,ak as n,Z as G,B as m,C as I,t as Y,x as X,o as Z,l}from"./index-DBHw7ps1.js";import{T as K,a as M,b as y,c as o,d as Q,e as d}from"./table-CywLfQKL.js";import{B as p}from"./badge-HmGNQ04n.js";import{D as W,b as ee,c as se,d as te,e as re,f as ae}from"./dialog-acGhLkoK.js";import{T as ie}from"./textarea-Bx7WjwE9.js";import{T as ne,a as oe,b as v,c as de}from"./tabs-BCLftEi3.js";import{C as ce}from"./checkbox-UeKqwDGT.js";import{L as le}from"./label-Di_dI0OZ.js";import{a3 as ue,C as he,aP as me,af as xe}from"./ui-vendor-B3Ur81tx.js";import"./supabase-vendor-DJknrin8.js";import"./index-BswhvY0M.js";import"./index-vsC2Ycwh.js";import"./index-vM6_qKqc.js";import"./index-lgWsV-kP.js";import"./index-D6hZrTqZ.js";const ye=()=>{const g=U(),{isAdmin:u,loading:f}=z(),[N,w]=i.useState([]),[B,A]=i.useState(!0),[_,T]=i.useState(null),[L,x]=i.useState(!1),[b,R]=i.useState(""),[h,q]=i.useState("pending"),[j,D]=i.useState({});i.useEffect(()=>{!f&&!u&&(n({title:"Access Denied",description:"You don't have permission to access this page.",variant:"destructive"}),g("/catalog"))},[u,f,g]);const C=async()=>{A(!0);const{data:s,error:r}=await l.from("user_approval_status").select("*").order("requested_at",{ascending:!1});if(r)console.error("Error fetching approvals:",r),n({title:"Error",description:"Failed to fetch vendor approvals",variant:"destructive"}),w([]);else{w(s||[]);const a={};s==null||s.forEach(t=>{a[t.id]=t.approved_categories||["Jewellery"]}),D(a)}A(!1)};i.useEffect(()=>{u&&C()},[u]);const V=async s=>{const r=j[s.id]||[];if(r.length===0){n({title:"Error",description:"Please select at least one category to approve",variant:"destructive"});return}const{data:{user:a}}=await l.auth.getUser(),{error:t}=await l.from("user_approval_status").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:a==null?void 0:a.id,approved_categories:r}).eq("id",s.id);if(t){n({title:"Error",description:"Failed to approve vendor",variant:"destructive"});return}const{error:c}=await l.from("user_roles").insert({user_id:s.user_id,role:"team_member"});c&&!c.message.includes("duplicate")&&console.error("Error assigning role:",c),n({title:"Vendor Approved",description:`The vendor has been approved for ${r.join(", ")}.`}),C()},P=async()=>{if(!_||!b.trim()){n({title:"Error",description:"Please provide a rejection reason",variant:"destructive"});return}const{data:{user:s}}=await l.auth.getUser(),{error:r}=await l.from("user_approval_status").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:s==null?void 0:s.id,rejection_reason:b}).eq("id",_.id);if(r){n({title:"Error",description:"Failed to reject vendor",variant:"destructive"});return}n({title:"Vendor Rejected",description:"The vendor has been rejected."}),x(!1),T(null),R(""),C()},$=s=>{T(s),x(!0)},F=s=>{switch(s){case"approved":return e.jsx(p,{className:"bg-green-500",children:"Approved"});case"rejected":return e.jsx(p,{variant:"destructive",children:"Rejected"});case"pending":return e.jsx(p,{variant:"secondary",children:"Pending"});default:return e.jsx(p,{variant:"outline",children:s})}},S=N.filter(s=>h==="all"||s.status===h),E=N.filter(s=>s.status==="pending").length;return f||B?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-pulse text-primary text-xl",children:"Loading..."})}):u?e.jsx(G,{children:e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Vendor Approvals"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and manage vendor access requests"})]}),e.jsxs(m,{variant:"outline",onClick:()=>g("/admin"),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})]}),e.jsxs(I,{children:[e.jsx(Y,{children:e.jsx(X,{children:"Vendor Requests"})}),e.jsx(Z,{children:e.jsxs(ne,{value:h,onValueChange:q,children:[e.jsxs(oe,{className:"mb-4",children:[e.jsxs(v,{value:"pending",children:["Pending ",E>0&&`(${E})`]}),e.jsx(v,{value:"approved",children:"Approved"}),e.jsx(v,{value:"rejected",children:"Rejected"}),e.jsx(v,{value:"all",children:"All"})]}),e.jsx(de,{value:h,children:S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground",children:["No ",h," vendors found"]})]}):e.jsxs(K,{children:[e.jsx(M,{children:e.jsxs(y,{children:[e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Business Name"}),e.jsx(o,{children:"Phone"}),e.jsx(o,{children:"Requested Categories"}),e.jsx(o,{children:"Approve Categories"}),e.jsx(o,{children:"Requested"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(Q,{children:S.map(s=>{var r,a;return e.jsxs(y,{children:[e.jsx(d,{className:"font-medium",children:s.email||"N/A"}),e.jsx(d,{children:s.business_name||"N/A"}),e.jsx(d,{children:s.phone||"N/A"}),e.jsx(d,{children:e.jsx("div",{className:"text-sm",children:((r=s.approved_categories)==null?void 0:r.join(", "))||"Jewellery"})}),e.jsx(d,{children:s.status==="pending"?e.jsx("div",{className:"space-y-2",children:["Jewellery","Gemstones","Loose Diamonds"].map(t=>{var c;return s.approved_categories,e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:`${s.id}-${t}`,checked:((c=j[s.id])==null?void 0:c.includes(t))||!1,onCheckedChange:O=>{const k=j[s.id]||[],H=O?[...k,t]:k.filter(J=>J!==t);D({...j,[s.id]:H})},disabled:!1}),e.jsx(le,{htmlFor:`${s.id}-${t}`,className:"text-xs cursor-pointer ",children:t})]},t)})}):e.jsx("div",{className:"text-sm",children:((a=s.approved_categories)==null?void 0:a.join(", "))||"N/A"})}),e.jsx(d,{children:new Date(s.requested_at).toLocaleDateString()}),e.jsx(d,{children:F(s.status)}),e.jsxs(d,{children:[s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{size:"sm",variant:"default",onClick:()=>V(s),children:[e.jsx(me,{className:"mr-1 h-4 w-4"}),"Approve"]}),e.jsxs(m,{size:"sm",variant:"destructive",onClick:()=>$(s),children:[e.jsx(xe,{className:"mr-1 h-4 w-4"}),"Reject"]})]}),s.status==="rejected"&&s.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Reason: ",s.rejection_reason]})]})]},s.id)})})]})})]})})]}),e.jsx(W,{open:L,onOpenChange:x,children:e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(te,{children:"Reject Vendor Application"}),e.jsx(re,{children:"Please provide a reason for rejecting this vendor application."})]}),e.jsx(ie,{placeholder:"Enter rejection reason...",value:b,onChange:s=>R(s.target.value),className:"min-h-[100px]"}),e.jsxs(ae,{children:[e.jsx(m,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:P,children:"Reject Vendor"})]})]})})]})}):null};export{ye as default};
//# sourceMappingURL=VendorApprovals-BERzAHpo.js.map
