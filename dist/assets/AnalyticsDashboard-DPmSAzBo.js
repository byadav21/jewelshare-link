import{u as H,j as e}from"./query-vendor-BLxHmmGk.js";import{Z as S,B as O,C as f,G as w,H as y,D as _,I as P,F as u}from"./index-DGlTgSKx.js";import{T as R,a as k,b as D,c,d as B,e as o}from"./table-BDYxPG4d.js";import{B as A}from"./badge-DknkzE8c.js";import{u as G}from"./react-vendor-BeR0k5Z3.js";import{J,d as M,a5 as Q,U as Z,aH as $,P as z}from"./ui-vendor-CN4tOqpp.js";import{f as W}from"./formatDistanceToNow-CVMQ6KIS.js";import{f as X}from"./format-CqKCEgBk.js";import"./supabase-vendor-VSDMYZ1k.js";import"./endOfMonth-CPC63KWN.js";const ce=()=>{var E;const I=G(),{isAdmin:C,loading:U}=S(),{data:h,isLoading:q}=H({queryKey:["vendor-activity"],queryFn:async()=>{const{data:s,error:x}=await u.from("user_approval_status").select("user_id, business_name, email, status").eq("status","approved");if(x)throw x;const{data:m,error:p}=await u.from("vendor_profiles").select("user_id, business_name");if(p)throw p;const{data:a,error:N}=await u.from("user_sessions").select("user_id, last_activity").order("last_activity",{ascending:!1});if(N)throw N;const v=new Date;v.setDate(v.getDate()-30);const{data:g,error:n}=await u.from("products").select("user_id, created_at").gte("created_at",v.toISOString()).is("deleted_at",null);if(n)throw n;const{data:d,error:l}=await u.from("share_links").select("user_id, view_count, created_at");if(l)throw l;const b=g==null?void 0:g.reduce((t,r)=>(t[r.user_id]=(t[r.user_id]||0)+1,t),{}),j=d==null?void 0:d.reduce((t,r)=>(t[r.user_id]||(t[r.user_id]={count:0,totalViews:0}),t[r.user_id].count++,t[r.user_id].totalViews+=r.view_count||0,t),{}),F=a==null?void 0:a.reduce((t,r)=>((!t[r.user_id]||new Date(r.last_activity)>new Date(t[r.user_id]))&&(t[r.user_id]=r.last_activity),t),{});return s==null?void 0:s.map(t=>{var r,L,V;return{...t,businessName:((r=m==null?void 0:m.find(K=>K.user_id===t.user_id))==null?void 0:r.business_name)||t.business_name,lastActivity:F[t.user_id],productsAddedThisMonth:(b==null?void 0:b[t.user_id])||0,shareLinks:((L=j==null?void 0:j[t.user_id])==null?void 0:L.count)||0,totalViews:((V=j==null?void 0:j[t.user_id])==null?void 0:V.totalViews)||0}}).sort((t,r)=>t.lastActivity?r.lastActivity?new Date(r.lastActivity).getTime()-new Date(t.lastActivity).getTime():-1:1)},enabled:C}),{data:i,isLoading:T}=H({queryKey:["engagement-metrics"],queryFn:async()=>{const{data:s,error:x}=await u.from("product_interests").select("product_id, created_at");if(x)throw x;const{data:m,error:p}=await u.from("catalog_inquiries").select("created_at");if(p)throw p;const{data:a,error:N}=await u.from("products").select("id, name, sku").is("deleted_at",null);if(N)throw N;const v=s==null?void 0:s.reduce((n,d)=>(n[d.product_id]=(n[d.product_id]||0)+1,n),{}),g=Object.entries(v||{}).map(([n,d])=>{const l=a==null?void 0:a.find(b=>b.id===n);return{productId:n,name:(l==null?void 0:l.name)||"Unknown",sku:l==null?void 0:l.sku,interestCount:d}}).sort((n,d)=>d.interestCount-n.interestCount).slice(0,10);return{totalInterests:(s==null?void 0:s.length)||0,totalInquiries:(m==null?void 0:m.length)||0,conversionRate:a!=null&&a.length?(((s==null?void 0:s.length)||0)/a.length*100).toFixed(2):0,topProducts:g}},enabled:C});return U?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):C?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{variant:"ghost",onClick:()=>I("/super-admin"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Activity Analytics"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(f,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Interests"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:T?"...":i==null?void 0:i.totalInterests})})]}),e.jsxs(f,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Inquiries"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:T?"...":i==null?void 0:i.totalInquiries})})]}),e.jsxs(f,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:q?"...":h==null?void 0:h.length})})]}),e.jsxs(f,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Interest Rate"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:T?"...":`${i==null?void 0:i.conversionRate}%`})})]})]}),e.jsxs(f,{children:[e.jsxs(w,{children:[e.jsx(y,{children:"Vendor Activity"}),e.jsx(P,{children:"Monitor vendor engagement and productivity"})]}),e.jsx(_,{children:q?e.jsx("div",{className:"text-center py-8",children:"Loading vendor activity..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(k,{children:e.jsxs(D,{children:[e.jsx(c,{children:"Vendor"}),e.jsx(c,{children:"Last Login"}),e.jsx(c,{children:"Products Added (30d)"}),e.jsx(c,{children:"Share Links"}),e.jsx(c,{children:"Total Views"})]})}),e.jsx(B,{children:h==null?void 0:h.map(s=>e.jsxs(D,{children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.businessName||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})}),e.jsx(o,{children:s.lastActivity?e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:W(new Date(s.lastActivity),{addSuffix:!0})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:X(new Date(s.lastActivity),"MMM dd, yyyy HH:mm")})]}):e.jsx("span",{className:"text-muted-foreground",children:"Never"})}),e.jsx(o,{children:e.jsx(A,{variant:"outline",children:s.productsAddedThisMonth})}),e.jsx(o,{children:e.jsx(A,{variant:"outline",children:s.shareLinks})}),e.jsx(o,{children:e.jsx(A,{variant:"secondary",children:s.totalViews})})]},s.user_id))})]})})})]}),e.jsxs(f,{children:[e.jsxs(w,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Most Inquired Products"]}),e.jsx(P,{children:"Products with the highest customer interest"})]}),e.jsx(_,{children:T?e.jsx("div",{className:"text-center py-8",children:"Loading metrics..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(k,{children:e.jsxs(D,{children:[e.jsx(c,{children:"Rank"}),e.jsx(c,{children:"Product Name"}),e.jsx(c,{children:"SKU"}),e.jsx(c,{children:"Interest Count"})]})}),e.jsx(B,{children:(E=i==null?void 0:i.topProducts)==null?void 0:E.map((s,x)=>e.jsxs(D,{children:[e.jsx(o,{children:e.jsxs(A,{variant:x<3?"default":"outline",children:["#",x+1]})}),e.jsx(o,{className:"font-medium",children:s.name}),e.jsx(o,{children:s.sku||"-"}),e.jsx(o,{children:e.jsx(A,{variant:"secondary",children:s.interestCount})})]},s.productId))})]})})})]})]}):(I("/"),null)};export{ce as default};
//# sourceMappingURL=AnalyticsDashboard-DPmSAzBo.js.map
