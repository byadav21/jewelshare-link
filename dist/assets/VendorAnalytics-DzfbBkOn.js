import{j as e,u as ee}from"./query-vendor-BLxHmmGk.js";import{y as p,Z as te,B as se,C as _,G as L,H as S,D as M,I as W,F as A}from"./index-DGlTgSKx.js";import{r as w,u as re}from"./react-vendor-BeR0k5Z3.js";import{g as ae,B as I,X as $,Y as O,f as ne,T as oe,R as H,C as F,L as ce,b as K}from"./LineChart-DzZ6j5U1.js";import{S as le,a as de,b as ie,c as he,d as E}from"./select-CQfvDDtS.js";import{J as xe,P as ue,m as me,U as fe,d as je}from"./ui-vendor-CN4tOqpp.js";import{t as R,s as ve,f as T}from"./format-CqKCEgBk.js";import{s as ge}from"./subDays-BcNQht-D.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-CrGJ45nU.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-aqCwQlp3.js";import"./index-DjQc2W_p.js";function pe(d,t){const a=R(d.start),s=R(d.end);let c=+a>+s;const n=c?+a:+s,o=c?s:a;o.setHours(0,0,0,0);let l=1;const h=[];for(;+o<=n;)h.push(R(o)),o.setDate(o.getDate()+l),o.setHours(0,0,0,0);return c?h.reverse():h}var ye=ae({chartName:"BarChart",GraphicalChild:I,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:$},{axisType:"yAxis",AxisComp:O}],formatAxisMap:ne});const be={light:"",dark:".dark"},Y=w.createContext(null);function J(){const d=w.useContext(Y);if(!d)throw new Error("useChart must be used within a <ChartContainer />");return d}const U=w.forwardRef(({id:d,className:t,children:a,config:s,...c},n)=>{const o=w.useId(),l=`chart-${d||o.replace(/:/g,"")}`;return e.jsx(Y.Provider,{value:{config:s},children:e.jsxs("div",{"data-chart":l,ref:n,className:p("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...c,children:[e.jsx(Ne,{id:l,config:s}),e.jsx(H,{children:a})]})})});U.displayName="Chart";const Ne=({id:d,config:t})=>{const a=Object.entries(t).filter(([s,c])=>c.theme||c.color);return a.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(be).map(([s,c])=>`
${c} [data-chart=${d}] {
${a.map(([n,o])=>{var h;const l=((h=o.theme)==null?void 0:h[s])||o.color;return l?`  --color-${n}: ${l};`:null}).join(`
`)}
}
`).join(`
`)}}):null},X=oe,q=w.forwardRef(({active:d,payload:t,className:a,indicator:s="dot",hideLabel:c=!1,hideIndicator:n=!1,label:o,labelFormatter:l,labelClassName:h,formatter:i,color:y,nameKey:D,labelKey:v},P)=>{const{config:j}=J(),C=w.useMemo(()=>{var b;if(c||!(t!=null&&t.length))return null;const[r]=t,g=`${v||r.dataKey||r.name||"value"}`,m=G(j,r,g),x=!v&&typeof o=="string"?((b=j[o])==null?void 0:b.label)||o:m==null?void 0:m.label;return l?e.jsx("div",{className:p("font-medium",h),children:l(x,t)}):x?e.jsx("div",{className:p("font-medium",h),children:x}):null},[o,l,t,c,h,j,v]);if(!d||!(t!=null&&t.length))return null;const k=t.length===1&&s!=="dot";return e.jsxs("div",{ref:P,className:p("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",a),children:[k?null:C,e.jsx("div",{className:"grid gap-1.5",children:t.map((r,g)=>{const m=`${D||r.name||r.dataKey||"value"}`,x=G(j,r,m),b=y||r.payload.fill||r.color;return e.jsx("div",{className:p("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",s==="dot"&&"items-center"),children:i&&(r==null?void 0:r.value)!==void 0&&r.name?i(r.value,r.name,r,g,r.payload):e.jsxs(e.Fragment,{children:[x!=null&&x.icon?e.jsx(x.icon,{}):!n&&e.jsx("div",{className:p("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":s==="dot","w-1":s==="line","w-0 border-[1.5px] border-dashed bg-transparent":s==="dashed","my-0.5":k&&s==="dashed"}),style:{"--color-bg":b,"--color-border":b}}),e.jsxs("div",{className:p("flex flex-1 justify-between leading-none",k?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[k?C:null,e.jsx("span",{className:"text-muted-foreground",children:(x==null?void 0:x.label)||r.name})]}),r.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:r.value.toLocaleString()})]})]})},r.dataKey)})})]})});q.displayName="ChartTooltip";const we=w.forwardRef(({className:d,hideIcon:t=!1,payload:a,verticalAlign:s="bottom",nameKey:c},n)=>{const{config:o}=J();return a!=null&&a.length?e.jsx("div",{ref:n,className:p("flex items-center justify-center gap-4",s==="top"?"pb-3":"pt-3",d),children:a.map(l=>{const h=`${c||l.dataKey||"value"}`,i=G(o,l,h);return e.jsxs("div",{className:p("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[i!=null&&i.icon&&!t?e.jsx(i.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:l.color}}),i==null?void 0:i.label]},l.value)})}):null});we.displayName="ChartLegend";function G(d,t,a){if(typeof t!="object"||t===null)return;const s="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let c=a;return a in t&&typeof t[a]=="string"?c=t[a]:s&&a in s&&typeof s[a]=="string"&&(c=s[a]),c in d?d[c]:d[a]}const $e=()=>{const d=re(),{role:t,loading:a}=te(),[s,c]=w.useState("30"),{data:n,isLoading:o}=ee({queryKey:["vendor-usage-trends",s],queryFn:async()=>{const{data:{user:l}}=await A.auth.getUser();if(!l)throw new Error("Not authenticated");const h=parseInt(s),i=ve(ge(new Date,h)),{data:y,error:D}=await A.from("products").select("created_at").eq("user_id",l.id).gte("created_at",i.toISOString()).is("deleted_at",null);if(D)throw D;const{data:v,error:P}=await A.from("share_links").select("created_at").eq("user_id",l.id).gte("created_at",i.toISOString());if(P)throw P;const{data:j,error:C}=await A.from("user_roles").select("created_at").gte("created_at",i.toISOString());if(C)throw C;const k=pe({start:i,end:new Date}),r=y==null?void 0:y.reduce((u,f)=>{const N=T(new Date(f.created_at),"yyyy-MM-dd");return u[N]=(u[N]||0)+1,u},{}),g=v==null?void 0:v.reduce((u,f)=>{const N=T(new Date(f.created_at),"yyyy-MM-dd");return u[N]=(u[N]||0)+1,u},{}),m=j==null?void 0:j.reduce((u,f)=>{const N=T(new Date(f.created_at),"yyyy-MM-dd");return u[N]=(u[N]||0)+1,u},{});let x=0,b=0,V=0;const Q=k.map(u=>{const f=T(u,"yyyy-MM-dd");return x+=(r==null?void 0:r[f])||0,b+=(g==null?void 0:g[f])||0,V+=(m==null?void 0:m[f])||0,{date:T(u,"MMM dd"),products:(r==null?void 0:r[f])||0,shareLinks:(g==null?void 0:g[f])||0,teamMembers:(m==null?void 0:m[f])||0,cumulativeProducts:x,cumulativeLinks:b,cumulativeMembers:V}}),Z=(y==null?void 0:y.length)||0,z=(v==null?void 0:v.length)||0,B=(j==null?void 0:j.length)||0;return{chartData:Q,summary:{totalProducts:Z,totalShareLinks:z,totalTeamMembers:B}}},enabled:!a&&!!t});return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(se,{variant:"ghost",onClick:()=>d("/admin"),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Usage Analytics"})]}),e.jsxs(le,{value:s,onValueChange:c,children:[e.jsx(de,{className:"w-[180px]",children:e.jsx(ie,{placeholder:"Select time range"})}),e.jsxs(he,{children:[e.jsx(E,{value:"7",children:"Last 7 days"}),e.jsx(E,{value:"30",children:"Last 30 days"}),e.jsx(E,{value:"90",children:"Last 90 days"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(_,{children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Products Added"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?"...":n==null?void 0:n.summary.totalProducts}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last ",s," days"]})]})]}),e.jsxs(_,{children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Share Links Created"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?"...":n==null?void 0:n.summary.totalShareLinks}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last ",s," days"]})]})]}),e.jsxs(_,{children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Team Members Invited"}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?"...":n==null?void 0:n.summary.totalTeamMembers}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last ",s," days"]})]})]})]}),e.jsxs(_,{children:[e.jsxs(L,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Daily Activity"]}),e.jsx(W,{children:"Daily breakdown of products, share links, and team invites"})]}),e.jsx(M,{children:o?e.jsx("div",{className:"text-center py-8",children:"Loading chart data..."}):e.jsx(U,{config:{products:{label:"Products",color:"hsl(var(--chart-1))"},shareLinks:{label:"Share Links",color:"hsl(var(--chart-2))"},teamMembers:{label:"Team Members",color:"hsl(var(--chart-3))"}},className:"h-[300px]",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ye,{data:n==null?void 0:n.chartData,children:[e.jsx(F,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{dataKey:"date",className:"text-xs"}),e.jsx(O,{className:"text-xs"}),e.jsx(X,{content:e.jsx(q,{})}),e.jsx(I,{dataKey:"products",fill:"hsl(var(--chart-1))",radius:[4,4,0,0]}),e.jsx(I,{dataKey:"shareLinks",fill:"hsl(var(--chart-2))",radius:[4,4,0,0]}),e.jsx(I,{dataKey:"teamMembers",fill:"hsl(var(--chart-3))",radius:[4,4,0,0]})]})})})})]}),e.jsxs(_,{children:[e.jsxs(L,{children:[e.jsx(S,{children:"Cumulative Growth Trends"}),e.jsx(W,{children:"Total cumulative growth over time"})]}),e.jsx(M,{children:o?e.jsx("div",{className:"text-center py-8",children:"Loading chart data..."}):e.jsx(U,{config:{cumulativeProducts:{label:"Total Products",color:"hsl(var(--chart-1))"},cumulativeLinks:{label:"Total Share Links",color:"hsl(var(--chart-2))"},cumulativeMembers:{label:"Total Team Members",color:"hsl(var(--chart-3))"}},className:"h-[300px]",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ce,{data:n==null?void 0:n.chartData,children:[e.jsx(F,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{dataKey:"date",className:"text-xs"}),e.jsx(O,{className:"text-xs"}),e.jsx(X,{content:e.jsx(q,{})}),e.jsx(K,{type:"monotone",dataKey:"cumulativeProducts",stroke:"hsl(var(--chart-1))",strokeWidth:2,dot:!1}),e.jsx(K,{type:"monotone",dataKey:"cumulativeLinks",stroke:"hsl(var(--chart-2))",strokeWidth:2,dot:!1}),e.jsx(K,{type:"monotone",dataKey:"cumulativeMembers",stroke:"hsl(var(--chart-3))",strokeWidth:2,dot:!1})]})})})})]})]})};export{$e as default};
//# sourceMappingURL=VendorAnalytics-DzfbBkOn.js.map
