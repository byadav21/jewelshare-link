import{b as we,u as be,j as e}from"./query-vendor-CIvqgC9B.js";import{r as t}from"./react-vendor-BCzWReGx.js";import{A as Re}from"./AdminLayout-Bt5p8wlS.js";import{C as A,t as F,x as D,y as P,o as U,B as h,l as b}from"./index-DBHw7ps1.js";import{I as T}from"./input-CpEp8mrX.js";import{L as p}from"./label-Di_dI0OZ.js";import{s as Ae,ai as Fe,D as De,bl as Pe,aG as Ue,a0 as Te,X as Ve,be as qe,u as i}from"./ui-vendor-B3Ur81tx.js";import{A as ke,a as Me}from"./alert-D-6GOIHR.js";import{T as Le,a as Ge,b as ce,c as j,d as Ee,e as g}from"./table-CywLfQKL.js";import{B as V}from"./badge-HmGNQ04n.js";import{S as B,a as H,b as O,c as Q,d as f}from"./select-B1aOqld7.js";import{C as de}from"./checkbox-UeKqwDGT.js";import{A as Ie,a as Be,b as He,c as Oe,d as Qe,e as $e,f as Ke,g as ze}from"./alert-dialog-C5S5s-18.js";import"./separator-6caDi7bi.js";import"./sheet-BWMSKSTq.js";import"./index-BswhvY0M.js";import"./index-vsC2Ycwh.js";import"./NavLink-B_nTQT1l.js";import"./index-lgWsV-kP.js";import"./index-vM6_qKqc.js";import"./supabase-vendor-DJknrin8.js";import"./index-BdQq_4o_.js";import"./index-D6hZrTqZ.js";const fa=()=>{const[R,$]=t.useState(!1),[K,z]=t.useState(null),[X,Y]=t.useState(null),[q,oe]=t.useState(!0),[k,pe]=t.useState(!0),[M,me]=t.useState(100),[m,L]=t.useState(null),G=we(),[y,Z]=t.useState(""),[C,J]=t.useState(""),[v,W]=t.useState(""),[_,ee]=t.useState(""),[N,ae]=t.useState(""),{data:u,isLoading:E}=be({queryKey:["diamond-prices",y,C,v,_,N],queryFn:async()=>{let a=b.from("diamond_prices").select("*",{count:"exact"});y&&(a=a.eq("shape",y)),C&&(a=a.eq("color_grade",C)),v&&(a=a.eq("clarity_grade",v)),_&&(a=a.gte("carat_range_min",parseFloat(_))),N&&(a=a.lte("carat_range_max",parseFloat(N))),a=a.order("shape",{ascending:!0}).order("carat_range_min",{ascending:!0}).limit(1e4);const{data:s,error:r,count:d}=await a;if(r)throw r;return{data:s,count:d}}}),c=(u==null?void 0:u.data)||[],S=(u==null?void 0:u.count)||0,he=Array.from(new Set(c.map(a=>a.shape))).sort(),ue=Array.from(new Set(c.map(a=>a.color_grade))).sort(),xe=Array.from(new Set(c.map(a=>a.clarity_grade))).sort(),je=()=>{Z(""),J(""),W(""),ee(""),ae(""),i.success("Filters cleared")},ge=y||C||v||_||N,fe=()=>{const a=["shape","carat_range_min","carat_range_max","color_grade","clarity_grade","cut_grade","price_per_carat","currency","notes"],s=["Round,0.50,0.69,D,IF,Excellent,15000,USD,Sample entry","Round,0.50,0.69,D,VVS1,Excellent,12000,USD,","Princess,1.00,1.49,E,VS1,Very Good,8000,USD,"],r=[a.join(","),...s].join(`
`),d=new Blob([r],{type:"text/csv"}),o=window.URL.createObjectURL(d),n=document.createElement("a");n.href=o,n.download="diamond_prices_template.csv",n.click(),window.URL.revokeObjectURL(o),i.success("Template downloaded!")},ye=(a,s="Round")=>{const r=a.split(",").map(x=>x.trim());if(r.length<6)return null;const d={BR:"Round",PS:"Pear",PR:"Princess",EM:"Emerald",CU:"Cushion",OV:"Oval",MQ:"Marquise",HT:"Heart",RD:"Radiant",AS:"Asscher"},o=r[0];return{shape:d[o]||s,clarity_grade:r[1],color_grade:r[2],carat_range_min:parseFloat(r[3]),carat_range_max:parseFloat(r[4]),price_per_carat:parseFloat(r[5]),cut_grade:"Excellent",currency:"USD",notes:null}},Ce=a=>{const s=a.split(",").map(r=>r.trim());return s.length<7?null:{shape:s[0],carat_range_min:parseFloat(s[1]),carat_range_max:parseFloat(s[2]),color_grade:s[3],clarity_grade:s[4],cut_grade:s[5],price_per_carat:parseFloat(s[6]),currency:s[7]||"USD",notes:s[8]||null}},se=(a,s)=>{if(!a){i.error("Please select a CSV file");return}(s==="pear"?q:k)?L({file:a,targetShape:s}):re(a,s,!1)},re=async(a,s,r)=>{$(!0);try{const o=(await a.text()).split(`
`).filter(w=>w.trim());if(o.length<1){i.error("CSV file is empty");return}const n=[];let x=0;const le=o[0],te=/^[A-Z]{2},/.test(le),Ne=te?0:le.toLowerCase().includes("shape")?1:0;for(let w=Ne;w<o.length;w++){const I=o[w];if(!I.trim())continue;let l=null;if(te?l=ye(I,s==="round"?"Round":"Pear"):l=Ce(I),l&&s==="round"?l.shape="Round":l&&s==="pear"&&(!l.shape||l.shape==="Round")&&(l.shape="Pear"),!l){x++;continue}if(!l.shape||isNaN(l.carat_range_min)||isNaN(l.carat_range_max)||!l.color_grade||!l.clarity_grade||!l.cut_grade||isNaN(l.price_per_carat)){x++;continue}n.push(l)}if(n.length===0){i.error("No valid records found in CSV");return}r&&(s==="round"?await b.from("diamond_prices").delete().eq("shape","Round"):await b.from("diamond_prices").delete().neq("shape","Round"));const{error:ne}=await b.from("diamond_prices").insert(n);if(ne)throw ne;const ie=r?" (replaced existing)":"",Se=x>0?`Imported ${n.length} records${ie} (${x} rows skipped)`:`Successfully imported ${n.length} price records${ie}!`;i.success(Se),G.invalidateQueries({queryKey:["diamond-prices"]}),s==="pear"&&z(null),s==="round"&&Y(null)}catch(d){console.error("Upload error:",d),i.error(d.message||"Failed to upload CSV")}finally{$(!1)}},ve=async()=>{if(confirm("Are you sure you want to delete ALL diamond prices? This action cannot be undone."))try{const{error:a}=await b.from("diamond_prices").delete().neq("id","00000000-0000-0000-0000-000000000000");if(a)throw a;i.success("All prices deleted successfully"),G.invalidateQueries({queryKey:["diamond-prices"]})}catch(a){console.error("Delete error:",a),i.error("Failed to delete prices")}},_e=()=>{G.invalidateQueries({queryKey:["diamond-prices"]}),i.success("Data refreshed")};return e.jsxs(Re,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Diamond Price Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Import and manage Rapaport-style diamond pricing data"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(A,{children:[e.jsxs(F,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Import CSV"]}),e.jsx(P,{children:"Upload a CSV file with diamond pricing data"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs(ke,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsxs(Me,{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Standard format:"})," shape, carat_range_min, carat_range_max, color_grade, clarity_grade, cut_grade, price_per_carat, currency, notes"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Rapaport format:"})," CutCode, Clarity, Color, CaratMin, CaratMax, Price, Date"]}),e.jsx("div",{className:"text-muted-foreground mt-1",children:"Supports both formats automatically"})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"secondary",children:"Fancy Shapes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pear, Princess, Emerald, Cushion, Oval, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"pear-csv",children:"Pear Pricing CSV"}),e.jsx(T,{id:"pear-csv",type:"file",accept:".csv",onChange:a=>{var s;return z(((s=a.target.files)==null?void 0:s[0])||null)}})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{id:"replace-pear",checked:q,onCheckedChange:a=>oe(a===!0)}),e.jsx(p,{htmlFor:"replace-pear",className:"text-sm font-normal cursor-pointer",children:"Replace all existing fancy shape prices"})]}),e.jsx(h,{onClick:()=>se(K,"pear"),disabled:!K||R,className:"w-full",children:R?"Uploading...":"Upload Pear/Fancy Shapes"})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"secondary",children:"Round"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Round brilliant diamonds only"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"round-csv",children:"Round Pricing CSV"}),e.jsx(T,{id:"round-csv",type:"file",accept:".csv",onChange:a=>{var s;return Y(((s=a.target.files)==null?void 0:s[0])||null)}})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{id:"replace-round",checked:k,onCheckedChange:a=>pe(a===!0)}),e.jsx(p,{htmlFor:"replace-round",className:"text-sm font-normal cursor-pointer",children:"Replace all existing round prices"})]}),e.jsx(h,{onClick:()=>se(X,"round"),disabled:!X||R,className:"w-full",children:R?"Uploading...":"Upload Round Pricing"})]}),e.jsxs(h,{onClick:fe,variant:"outline",className:"w-full",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]}),e.jsxs(A,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(D,{children:"Database Stats"}),e.jsx(P,{children:"Current pricing data summary"})]}),e.jsx(h,{onClick:_e,variant:"outline",size:"icon",disabled:E,children:e.jsx(Pe,{className:`h-4 w-4 ${E?"animate-spin":""}`})})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Entries"}),e.jsx("p",{className:"text-2xl font-bold",children:S})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unique Shapes"}),e.jsx("p",{className:"text-2xl font-bold",children:c?new Set(c.map(a=>a.shape)).size:0})]})]}),e.jsxs(h,{onClick:ve,variant:"destructive",className:"w-full",disabled:S===0,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Delete All Prices"]})]})]})]}),e.jsxs(A,{children:[e.jsxs(F,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Search & Filter"]}),e.jsx(P,{children:"Filter diamond prices by shape, grades, and carat range"})]}),e.jsx(U,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Shape"}),e.jsxs(B,{value:y,onValueChange:Z,children:[e.jsx(H,{children:e.jsx(O,{placeholder:"All shapes"})}),e.jsxs(Q,{children:[e.jsx(f,{value:"",children:"All shapes"}),he.map(a=>e.jsx(f,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Color Grade"}),e.jsxs(B,{value:C,onValueChange:J,children:[e.jsx(H,{children:e.jsx(O,{placeholder:"All colors"})}),e.jsxs(Q,{children:[e.jsx(f,{value:"",children:"All colors"}),ue.map(a=>e.jsx(f,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Clarity Grade"}),e.jsxs(B,{value:v,onValueChange:W,children:[e.jsx(H,{children:e.jsx(O,{placeholder:"All clarities"})}),e.jsxs(Q,{children:[e.jsx(f,{value:"",children:"All clarities"}),xe.map(a=>e.jsx(f,{value:a,children:a},a))]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Carat Range Min"}),e.jsx(T,{type:"number",step:"0.01",placeholder:"e.g., 0.50",value:_,onChange:a=>ee(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Carat Range Max"}),e.jsx(T,{type:"number",step:"0.01",placeholder:"e.g., 1.00",value:N,onChange:a=>ae(a.target.value)})]})]}),ge&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsxs(V,{variant:"secondary",children:[S," ",S===1?"result":"results"," found"]}),e.jsxs(h,{onClick:je,variant:"ghost",size:"sm",className:"h-8",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]})]})})]}),e.jsxs(A,{children:[e.jsxs(F,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Current Prices"]}),e.jsx(P,{children:"View current rapport prices"})]}),e.jsx(U,{children:E?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):S===0?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No pricing data yet. Upload a CSV to get started."}):e.jsxs("div",{className:"border rounded-lg overflow-auto max-h-[500px]",children:[e.jsxs(Le,{children:[e.jsx(Ge,{children:e.jsxs(ce,{children:[e.jsx(j,{children:"Shape"}),e.jsx(j,{children:"Carat Range"}),e.jsx(j,{children:"Color"}),e.jsx(j,{children:"Clarity"}),e.jsx(j,{children:"Cut"}),e.jsx(j,{className:"text-right",children:"Price/Carat"})]})}),e.jsx(Ee,{children:c.slice(0,M).map(a=>e.jsxs(ce,{children:[e.jsx(g,{children:e.jsx(V,{variant:"outline",children:a.shape})}),e.jsxs(g,{children:[a.carat_range_min," - ",a.carat_range_max]}),e.jsx(g,{children:a.color_grade}),e.jsx(g,{children:a.clarity_grade}),e.jsx(g,{children:a.cut_grade}),e.jsxs(g,{className:"text-right font-mono",children:[a.currency," ",a.price_per_carat.toLocaleString()]})]},a.id))})]}),c.length>M&&e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",M," of ",c.length," entries"]}),e.jsx(h,{variant:"outline",onClick:()=>me(a=>Math.min(a+100,c.length)),children:"Load More (100)"})]})]})})]})]}),e.jsx(Ie,{open:!!m,onOpenChange:a=>!a&&L(null),children:e.jsxs(Be,{children:[e.jsxs(He,{children:[e.jsx(Oe,{children:"Replace All Prices?"}),e.jsxs(Qe,{children:["This will permanently delete all existing ",(m==null?void 0:m.targetShape)==="round"?"round":"fancy shape"," diamond prices before importing the new data. This action cannot be undone."]})]}),e.jsxs($e,{children:[e.jsx(Ke,{children:"Cancel"}),e.jsx(ze,{onClick:()=>{if(m){const a=m.targetShape==="pear"?q:k;re(m.file,m.targetShape,a),L(null)}},children:"Yes, Replace All"})]})]})})]})};export{fa as default};
//# sourceMappingURL=AdminDiamondPrices-CRF-xK_C.js.map
