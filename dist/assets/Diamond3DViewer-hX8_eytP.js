import{j as i}from"./query-vendor-CIvqgC9B.js";import{r as u}from"./react-vendor-BCzWReGx.js";import{u as ue,b as $,_ as Re,D as Ce,V as _,l as b,P as he,m as fe,C as Ee,A as ke,a as Ie,E as Te,O as We,c as X,B as Oe,F as Fe,n as Ae,j as Z}from"./Sparkles-D2u_hPla.js";import{am as De}from"./index-DBHw7ps1.js";import"./ui-vendor-B3Ur81tx.js";import"./supabase-vendor-DJknrin8.js";const H=new _,ee=new _,Le=new _,le=new b;function Ve(t,e,a){const o=H.setFromMatrixPosition(t.matrixWorld);o.project(e);const c=a.width/2,d=a.height/2;return[o.x*c+c,-(o.y*d)+d]}function ze(t,e){const a=H.setFromMatrixPosition(t.matrixWorld),o=ee.setFromMatrixPosition(e.matrixWorld),c=a.sub(o),d=e.getWorldDirection(Le);return c.angleTo(d)>Math.PI/2}function $e(t,e,a,o){const c=H.setFromMatrixPosition(t.matrixWorld),d=c.clone();d.project(e),le.set(d.x,d.y),a.setFromCamera(le,e);const M=a.intersectObjects(o,!0);if(M.length){const h=M[0].distance;return c.distanceTo(a.ray.origin)<h}return!0}function He(t,e){if(e instanceof fe)return e.zoom;if(e instanceof he){const a=H.setFromMatrixPosition(t.matrixWorld),o=ee.setFromMatrixPosition(e.matrixWorld),c=e.fov*Math.PI/180,d=a.distanceTo(o);return 1/(2*Math.tan(c/2)*d)}else return 1}function Ne(t,e,a){if(e instanceof he||e instanceof fe){const o=H.setFromMatrixPosition(t.matrixWorld),c=ee.setFromMatrixPosition(e.matrixWorld),d=o.distanceTo(c),M=(a[1]-a[0])/(e.far-e.near),h=a[1]-M*e.far;return Math.round(M*d+h)}}const Y=t=>Math.abs(t)<1e-10?0:t;function de(t,e,a=""){let o="matrix3d(";for(let c=0;c!==16;c++)o+=Y(e[c]*t.elements[c])+(c!==15?",":")");return a+o}const Be=(t=>e=>de(e,t))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Ge=(t=>(e,a)=>de(e,t(a),"translate(-50%,-50%)"))(t=>[1/t,1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1]);function qe(t){return t&&typeof t=="object"&&"current"in t}const pe=u.forwardRef(({children:t,eps:e=.001,style:a,className:o,prepend:c,center:d,fullscreen:M,portal:h,distanceFactor:f,sprite:j=!1,transform:y=!1,occlude:n,onOcclude:r,castShadow:p,receiveShadow:g,material:s,geometry:l,zIndexRange:m=[16777271,0],calculatePosition:I=Ve,as:L="div",wrapperClass:F,pointerEvents:J="auto",...R},te)=>{const{gl:ne,camera:v,scene:se,size:P,raycaster:me,events:xe,viewport:Me}=ue(),[w]=u.useState(()=>document.createElement(L)),K=u.useRef(),C=u.useRef(null),oe=u.useRef(0),N=u.useRef([0,0]),V=u.useRef(null),Q=u.useRef(null),A=(h==null?void 0:h.current)||xe.connected||ne.domElement.parentNode,k=u.useRef(null),B=u.useRef(!1),G=u.useMemo(()=>n&&n!=="blending"||Array.isArray(n)&&n.length&&qe(n[0]),[n]);u.useLayoutEffect(()=>{const S=ne.domElement;n&&n==="blending"?(S.style.zIndex=`${Math.floor(m[0]/2)}`,S.style.position="absolute",S.style.pointerEvents="none"):(S.style.zIndex=null,S.style.position=null,S.style.pointerEvents=null)},[n]),u.useLayoutEffect(()=>{if(C.current){const S=K.current=De(w);if(se.updateMatrixWorld(),y)w.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const x=I(C.current,v,P);w.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${x[0]}px,${x[1]}px,0);transform-origin:0 0;`}return A&&(c?A.prepend(w):A.appendChild(w)),()=>{A&&A.removeChild(w),S.unmount()}}},[A,y]),u.useLayoutEffect(()=>{F&&(w.className=F)},[F]);const re=u.useMemo(()=>y?{position:"absolute",top:0,left:0,width:P.width,height:P.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:d?"translate3d(-50%,-50%,0)":"none",...M&&{top:-P.height/2,left:-P.width/2,width:P.width,height:P.height},...a},[a,d,M,P,y]),ge=u.useMemo(()=>({position:"absolute",pointerEvents:J}),[J]);u.useLayoutEffect(()=>{if(B.current=!1,y){var S;(S=K.current)==null||S.render(u.createElement("div",{ref:V,style:re},u.createElement("div",{ref:Q,style:ge},u.createElement("div",{ref:te,className:o,style:a,children:t}))))}else{var x;(x=K.current)==null||x.render(u.createElement("div",{ref:te,style:re,className:o,children:t}))}});const D=u.useRef(!0);$(S=>{if(C.current){v.updateMatrixWorld(),C.current.updateWorldMatrix(!0,!1);const x=y?N.current:I(C.current,v,P);if(y||Math.abs(oe.current-v.zoom)>e||Math.abs(N.current[0]-x[0])>e||Math.abs(N.current[1]-x[1])>e){const T=ze(C.current,v);let E=!1;G&&(Array.isArray(n)?E=n.map(W=>W.current):n!=="blending"&&(E=[se]));const z=D.current;if(E){const W=$e(C.current,v,me,E);D.current=W&&!T}else D.current=!T;z!==D.current&&(r?r(!D.current):w.style.display=D.current?"block":"none");const q=Math.floor(m[0]/2),ye=n?G?[m[0],q]:[q-1,0]:m;if(w.style.zIndex=`${Ne(C.current,v,ye)}`,y){const[W,ae]=[P.width/2,P.height/2],U=v.projectionMatrix.elements[5]*ae,{isOrthographicCamera:ce,top:be,left:ve,bottom:we,right:je}=v,Pe=Be(v.matrixWorldInverse),Se=ce?`scale(${U})translate(${Y(-(je+ve)/2)}px,${Y((be+we)/2)}px)`:`translateZ(${U}px)`;let O=C.current.matrixWorld;j&&(O=v.matrixWorldInverse.clone().transpose().copyPosition(O).scale(C.current.scale),O.elements[3]=O.elements[7]=O.elements[11]=0,O.elements[15]=1),w.style.width=P.width+"px",w.style.height=P.height+"px",w.style.perspective=ce?"":`${U}px`,V.current&&Q.current&&(V.current.style.transform=`${Se}${Pe}translate(${W}px,${ae}px)`,Q.current.style.transform=Ge(O,1/((f||10)/400)))}else{const W=f===void 0?1:He(C.current,v)*f;w.style.transform=`translate3d(${x[0]}px,${x[1]}px,0) scale(${W})`}N.current=x,oe.current=v.zoom}}if(!G&&k.current&&!B.current)if(y){if(V.current){const x=V.current.children[0];if(x!=null&&x.clientWidth&&x!=null&&x.clientHeight){const{isOrthographicCamera:T}=v;if(T||l)R.scale&&(Array.isArray(R.scale)?R.scale instanceof _?k.current.scale.copy(R.scale.clone().divideScalar(1)):k.current.scale.set(1/R.scale[0],1/R.scale[1],1/R.scale[2]):k.current.scale.setScalar(1/R.scale));else{const E=(f||10)/400,z=x.clientWidth*E,q=x.clientHeight*E;k.current.scale.set(z,q,1)}B.current=!0}}}else{const x=w.children[0];if(x!=null&&x.clientWidth&&x!=null&&x.clientHeight){const T=1/Me.factor,E=x.clientWidth*T,z=x.clientHeight*T;k.current.scale.set(E,z,1),B.current=!0}k.current.lookAt(S.camera.position)}});const ie=u.useMemo(()=>({vertexShader:y?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[y]);return u.createElement("group",Re({},R,{ref:C}),n&&!G&&u.createElement("mesh",{castShadow:p,receiveShadow:g,ref:k},l||u.createElement("planeGeometry",null),s||u.createElement("shaderMaterial",{side:Ce,vertexShader:ie.vertexShader,fragmentShader:ie.fragmentShader})))}),Ze=(t,e=64)=>{const a=[];switch(t){case"round":for(let n=0;n<e;n++){const r=n/e*Math.PI*2;a.push(new b(Math.cos(r),Math.sin(r)))}break;case"oval":for(let n=0;n<e;n++){const r=n/e*Math.PI*2;a.push(new b(Math.cos(r)*1.4,Math.sin(r)*.9))}break;case"pear":for(let n=0;n<e;n++){const r=n/e*Math.PI*2,p=.8+.4*Math.sin(r/2),g=p*Math.sin(r)*.85,s=p*Math.cos(r)*1.1-.2;a.push(new b(g,s))}break;case"marquise":for(let n=0;n<e;n++){const r=n/e*Math.PI*2,p=Math.sin(r)*.55,g=Math.cos(r)*1.5,s=Math.pow(Math.abs(Math.sin(r)),.3);a.push(new b(p*s,g))}break;case"heart":for(let n=0;n<e;n++){const r=n/e*Math.PI*2,p=16*Math.pow(Math.sin(r),3),g=13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r);a.push(new b(p/18,g/18-.1))}break;case"princess":case"asscher":const o=t==="asscher"?.15:.08,c=1,d=[{x:-c,y:-c},{x:c,y:-c},{x:c,y:c},{x:-c,y:c}],M=Math.floor(e/4);for(let n=0;n<4;n++){const r=d[n],p=d[(n+1)%4];for(let g=0;g<M;g++){const s=g/M;let l=r.x+(p.x-r.x)*s,m=r.y+(p.y-r.y)*s;const I=Math.min(Math.hypot(l-r.x,m-r.y),Math.hypot(l-p.x,m-p.y));if(I<o*2){const L=I/(o*2),F=Math.atan2(m,l),R=Math.max(Math.abs(l),Math.abs(m))*(.95+.05*L);l=Math.cos(F)*R*Math.sign(l)*(Math.abs(l)>.01?1:0)||l,m=Math.sin(F)*R*Math.sign(m)*(Math.abs(m)>.01?1:0)||m}a.push(new b(l*.75,m*.75))}}break;case"cushion":for(let n=0;n<e;n++){const r=n/e*Math.PI*2,p=3,g=1,s=1,l=Math.cos(r),m=Math.sin(r),I=Math.sign(l)*g*Math.pow(Math.abs(l),2/p),L=Math.sign(m)*s*Math.pow(Math.abs(m),2/p);a.push(new b(I,L))}break;case"emerald":case"radiant":const h=t==="emerald"?1.5:1.2,f=.25,j=[new b(-1+f,-h),new b(1-f,-h),new b(1,-h+f*h),new b(1,h-f*h),new b(1-f,h),new b(-1+f,h),new b(-1,h-f*h),new b(-1,-h+f*h)],y=Math.floor(e/8);for(let n=0;n<8;n++){const r=j[n],p=j[(n+1)%8];for(let g=0;g<y;g++){const s=g/y;a.push(new b((r.x+(p.x-r.x)*s)*.65,(r.y+(p.y-r.y)*s)*.65))}}break;default:for(let n=0;n<e;n++){const r=n/e*Math.PI*2;a.push(new b(Math.cos(r),Math.sin(r)))}}return a},_e=t=>{const e=new Oe,o=Ze(t,64),c=.22,d=.55,M=.04,h=[],f=[],j=(s,l,m)=>(h.push(s,l,m),h.length/3-1),y=j(0,c,0),n=[];for(let s=0;s<o.length;s++){const l=o[s],m=j(l.x*d,c,l.y*d);n.push(m)}const r=[];for(let s=0;s<o.length;s++){const l=o[s],m=j(l.x,M/2,l.y);r.push(m)}const p=[];for(let s=0;s<o.length;s++){const l=o[s],m=j(l.x,-M/2,l.y);p.push(m)}const g=j(0,-.5,0);for(let s=0;s<o.length;s++){const l=(s+1)%o.length;f.push(y,n[s],n[l])}for(let s=0;s<o.length;s++){const l=(s+1)%o.length;f.push(n[s],r[s],n[l]),f.push(n[l],r[s],r[l])}for(let s=0;s<o.length;s++){const l=(s+1)%o.length;f.push(r[s],p[s],r[l]),f.push(r[l],p[s],p[l])}for(let s=0;s<o.length;s++){const l=(s+1)%o.length;f.push(p[s],g,p[l])}return e.setAttribute("position",new Fe(h,3)),e.setIndex(f),e.computeVertexNormals(),e},Je=({intensity:t=1})=>{const e=u.useRef(null);return $(a=>{e.current&&(e.current.rotation.y=a.clock.elapsedTime*.2)}),i.jsxs("group",{ref:e,children:[i.jsx(Z,{count:50,scale:2.5,size:3*t,speed:.4,opacity:.6,color:"#ffffff"}),i.jsx(Z,{count:15,scale:2,size:2.5,speed:.3,opacity:.4,color:"#ff6b6b"}),i.jsx(Z,{count:15,scale:2,size:2.5,speed:.35,opacity:.4,color:"#4ecdc4"}),i.jsx(Z,{count:15,scale:2,size:2.5,speed:.4,opacity:.4,color:"#a855f7"})]})},Ke=({visible:t=!0})=>{const e=u.useRef(null);$(o=>{e.current&&t&&(e.current.rotation.y=o.clock.elapsedTime*.6,e.current.children.forEach((c,d)=>{const M=c,h=M.material,f=o.clock.elapsedTime+d*.4;M.scale.y=.5+Math.sin(f*3)*.3,h.opacity=.15+Math.sin(f*2)*.1}))});const a=["#ff4444","#ff8844","#ffff44","#44ff44","#44ffff","#4444ff","#ff44ff","#ff4488"];return t?i.jsx("group",{ref:e,position:[0,.1,0],children:a.map((o,c)=>i.jsxs("mesh",{rotation:[0,c/a.length*Math.PI*2,Math.PI/6],children:[i.jsx("coneGeometry",{args:[.012,2,4]}),i.jsx("meshBasicMaterial",{color:o,transparent:!0,opacity:.2,blending:Ae})]},c))}):null},Qe=({shape:t})=>{const e={round:"Round Brilliant",princess:"Princess Cut",oval:"Oval",cushion:"Cushion",emerald:"Emerald Cut",pear:"Pear",marquise:"Marquise",heart:"Heart",radiant:"Radiant",asscher:"Asscher"};return i.jsx(pe,{position:[0,-1.2,0],center:!0,children:i.jsx("div",{className:"bg-black/70 backdrop-blur-sm text-white text-xs px-3 py-1.5 rounded-full whitespace-nowrap font-medium",children:e[t]})})},Ue=({shape:t,color:e="#f8fcff",showFire:a=!0,caratSize:o=1})=>{const c=u.useRef(null),[d,M]=u.useState(!1),h=u.useMemo(()=>.7+o*.12,[o]),f=u.useMemo(()=>_e(t),[t]);$(y=>{if(c.current){const n=1+Math.sin(y.clock.elapsedTime*.8)*.008;c.current.scale.setScalar(h*n)}});const j=u.useMemo(()=>new X(e),[e]);return i.jsxs("group",{ref:c,scale:h,children:[i.jsx("mesh",{geometry:f,onPointerOver:()=>M(!0),onPointerOut:()=>M(!1),castShadow:!0,receiveShadow:!0,children:i.jsx("meshPhysicalMaterial",{color:j,metalness:0,roughness:0,transmission:.95,thickness:1.8,ior:2.417,clearcoat:1,clearcoatRoughness:0,envMapIntensity:d?4.5:3.5,transparent:!0,opacity:1,attenuationDistance:.6,attenuationColor:j,sheen:.4,sheenRoughness:.2,sheenColor:new X("#ffffff"),specularIntensity:1,specularColor:new X("#ffffff")})}),a&&i.jsxs(i.Fragment,{children:[i.jsx(Ke,{visible:!0}),i.jsx(Je,{intensity:d?1.3:1})]}),i.jsx(Qe,{shape:t})]})},Xe=({showFire:t})=>{const e=u.useRef(null);return $(a=>{e.current&&t&&(e.current.rotation.y=a.clock.elapsedTime*.25)}),i.jsxs(i.Fragment,{children:[i.jsx("directionalLight",{position:[4,7,4],intensity:1.5,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,color:"#ffffff"}),i.jsx("directionalLight",{position:[-3,5,-3],intensity:.8,color:"#f0f8ff"}),i.jsx("pointLight",{position:[2.5,1.5,2.5],intensity:.6,color:"#fff5e6",distance:8}),i.jsx("pointLight",{position:[-2.5,1.5,-2.5],intensity:.6,color:"#e6f0ff",distance:8}),i.jsx("spotLight",{position:[0,5,0],angle:.5,penumbra:.6,intensity:1.5,color:"#ffffff",castShadow:!0}),t&&i.jsxs("group",{ref:e,children:[i.jsx("pointLight",{position:[2.5,.8,0],intensity:.4,color:"#ff6666",distance:5}),i.jsx("pointLight",{position:[-1.25,.8,2.2],intensity:.4,color:"#66ff66",distance:5}),i.jsx("pointLight",{position:[-1.25,.8,-2.2],intensity:.4,color:"#6666ff",distance:5})]}),i.jsx("ambientLight",{intensity:.3})]})},Ye=({shape:t})=>{const{camera:e}=ue();return u.useEffect(()=>{const o=["marquise","pear","oval","emerald"].includes(t)?4.2:3.8;e.position.set(0,1.2,o),e.lookAt(0,0,0)},[t,e]),null},et=()=>i.jsx(pe,{center:!0,children:i.jsxs("div",{className:"flex flex-col items-center gap-3 text-white/80",children:[i.jsxs("div",{className:"relative w-10 h-10",children:[i.jsx("div",{className:"absolute inset-0 border-3 border-white/20 rounded-full"}),i.jsx("div",{className:"absolute inset-0 border-3 border-transparent border-t-white rounded-full animate-spin"})]}),i.jsx("span",{className:"text-sm font-medium",children:"Loading Diamond..."})]})}),at=({shape:t,autoRotate:e=!0,color:a="#f8fcff",showFire:o=!0,caratSize:c=1})=>i.jsx("div",{className:"w-full h-full min-h-[300px] rounded-xl overflow-hidden",style:{background:"radial-gradient(ellipse at 50% 30%, #1e293b 0%, #0f172a 50%, #020617 100%)"},children:i.jsx(Ee,{shadows:!0,dpr:[1,2],camera:{position:[0,1.2,3.8],fov:42},gl:{antialias:!0,alpha:!0,powerPreference:"high-performance",toneMapping:ke,toneMappingExposure:1.2},children:i.jsxs(u.Suspense,{fallback:i.jsx(et,{}),children:[i.jsx(Ye,{shape:t}),i.jsx(Xe,{showFire:o}),i.jsx(Ue,{shape:t,color:a,showFire:o,caratSize:c}),i.jsx(Ie,{position:[0,-1.1,0],opacity:.5,scale:6,blur:2,far:3}),i.jsx(Te,{preset:"city"}),i.jsx(We,{enableZoom:!0,enablePan:!1,autoRotate:e,autoRotateSpeed:1.2,minDistance:2,maxDistance:8,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/1.5,dampingFactor:.05,enableDamping:!0})]})})});export{at as Diamond3DViewer,at as default};
//# sourceMappingURL=Diamond3DViewer-hX8_eytP.js.map
