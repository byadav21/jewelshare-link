import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as m,u as z}from"./react-vendor-BeR0k5Z3.js";import{B as g,s as y,C as f,i as N,k as b,g as v,A as I}from"./index-CX6yiz0b.js";import{I as P}from"./input-CiHC6UAI.js";import{L}from"./label-DbIM3Eg1.js";import{C as Q}from"./checkbox-BEepVNza.js";import{B as M}from"./badge-45Abp579.js";import{Q as B,S as q,a as O}from"./ShareStats-DyeN2AUB.js";import{D as H,a as V,b as G,c as J,d as W,e as Y}from"./dialog-KVJ8gRMk.js";import{m as K,ab as X,u as p,av as Z,P as ee,d as se,E as ae,aE as te,Y as re,o as ne,C as ie}from"./ui-vendor-DjQqXt9S.js";import{R as oe,L as ce,C as le,X as de,Y as me,T as he,a as xe,b as pe}from"./LineChart-B9gSYMLc.js";import{s as A}from"./subDays-ByyGNxrB.js";import{f as F}from"./format-sTPjOSS_.js";import{C as ue,a as ge,b as je}from"./collapsible-Dru8hkE9.js";import{P as we}from"./PlanLimitWarning-BlkgAHMZ.js";import{u as fe}from"./useRewardsSystem-d5GTIiEP.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-DjQc2W_p.js";import"./proxy-8agjeDDu.js";import"./index-DhS5fNEb.js";import"./index-D6fUEw85.js";import"./index-CrGJ45nU.js";import"./en-US-DWrl2lTx.js";import"./index-DSkn7fL5.js";import"./alert-DIsJjuyH.js";const ve=({shareToken:h,businessName:_})=>{const j=`${window.location.origin}/shared/${encodeURIComponent(h)}`,x=()=>{const l=document.getElementById(`qr-${h}`);if(!l)return;const c=new XMLSerializer().serializeToString(l),d=document.createElement("canvas"),w=d.getContext("2d"),u=new Image;u.onload=()=>{d.width=u.width,d.height=u.height,w==null||w.drawImage(u,0,0),d.toBlob(t=>{if(t){const r=URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=`catalog-qr-${h.substring(0,8)}.png`,o.click(),URL.revokeObjectURL(r),p.success("QR code downloaded!")}})},u.src="data:image/svg+xml;base64,"+btoa(c)},k=()=>{var d;const l=window.open("","_blank");if(!l)return;const c=_||"Jewelry Catalog";l.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>QR Code - ${c}</title>
          <style>
            body {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              min-height: 100vh;
              margin: 0;
              font-family: Arial, sans-serif;
            }
            .container {
              text-align: center;
              padding: 40px;
            }
            h1 {
              margin-bottom: 20px;
              color: #333;
            }
            .qr-container {
              background: white;
              padding: 30px;
              border: 2px solid #333;
              border-radius: 10px;
              display: inline-block;
            }
            .instructions {
              margin-top: 30px;
              font-size: 14px;
              color: #666;
            }
          </style>
        </head>
        <body>
          <div class="container">
            <h1>${c}</h1>
            <div class="qr-container">
              ${((d=document.getElementById(`qr-${h}`))==null?void 0:d.outerHTML)||""}
            </div>
            <div class="instructions">
              <p>Scan this QR code to view our jewelry collection</p>
              <p style="font-size: 12px; margin-top: 10px;">${j}</p>
            </div>
          </div>
        </body>
      </html>
    `),l.document.close(),setTimeout(()=>{l.print()},250)};return e.jsxs(H,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"QR Code"]})}),e.jsxs(G,{className:"sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Share Link QR Code"}),e.jsx(Y,{children:"Print or download this QR code to share your catalog offline"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-6 py-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl border-2 border-primary/20 shadow-lg",children:e.jsx(B,{id:`qr-${h}`,value:j,size:256,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs text-muted-foreground text-center mb-2",children:"Catalog Link:"}),e.jsx("div",{className:"bg-muted rounded-lg px-3 py-2 text-xs text-center break-all",children:j})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(g,{onClick:x,variant:"outline",className:"flex-1 gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Download"]}),e.jsxs(g,{onClick:k,className:"flex-1 gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print"]})]})]})]})]})},_e=({shareLinkId:h,viewCount:_})=>{const[j,x]=m.useState(!0),[k,l]=m.useState([]),[c,d]=m.useState([]),[w,u]=m.useState(0);m.useEffect(()=>{t()},[h]);const t=async()=>{x(!0);try{const r=A(new Date,7),{data:o,error:C}=await y.from("share_link_product_views").select("viewed_at, product_id, products(name, image_url)").eq("share_link_id",h).gte("viewed_at",r.toISOString());if(C)throw C;const S={},R=Array.from({length:7},(a,i)=>{const E=A(new Date,6-i),D=F(E,"MMM dd");return S[D]=0,D});o==null||o.forEach(a=>{const i=F(new Date(a.viewed_at),"MMM dd");i in S&&S[i]++});const $=R.map(a=>({date:a,views:S[a]||0}));l($);const s={};o==null||o.forEach(a=>{const i=a.products;i&&a.product_id&&(s[a.product_id]||(s[a.product_id]={count:0,name:i.name||"Unknown Product",image:i.image_url||null}),s[a.product_id].count++)});const n=Object.entries(s).map(([a,i])=>({id:a,name:i.name,image:i.image,views:i.count})).sort((a,i)=>i.views-a.views).slice(0,5);d(n),u((o==null?void 0:o.length)||0)}catch(r){console.error("Error fetching analytics:",r)}finally{x(!1)}};return j?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Catalog Views"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:_}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total link opens"})]})]}),e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Product Views"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Individual product views"})]})]}),e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Engagement Rate"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[_>0?(w/_*100).toFixed(1):"0","%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Products per visit"})]})]})]}),e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{className:"text-base",children:"Views Over Time (Last 7 Days)"})}),e.jsx(v,{children:e.jsx(oe,{width:"100%",height:250,children:e.jsxs(ce,{data:k,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"date"}),e.jsx(me,{}),e.jsx(he,{}),e.jsx(xe,{}),e.jsx(pe,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})]}),c.length>0&&e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{className:"text-base",children:"Most Viewed Products"})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:c.map((r,o)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{variant:"secondary",className:"min-w-[2rem] justify-center",children:o+1}),r.image&&e.jsx("img",{src:r.image,alt:r.name,className:"h-12 w-12 object-cover rounded-md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.views," views"]})]}),e.jsx("div",{className:"w-32 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${r.views/c[0].views*100}%`}})})]},r.id))})})]})]})},Je=()=>{const h=z(),{awardPoints:_}=fe(),[j,x]=m.useState(!1),[k,l]=m.useState([]),[c,d]=m.useState(null),[w,u]=m.useState(null),[t,r]=m.useState({markup_percentage:"",markdown_percentage:"",expires_at:"",show_vendor_details:!0,shared_categories:["Jewellery","Gemstones","Loose Diamonds"]});m.useEffect(()=>{C(),o()},[]);const o=async()=>{try{const{data:{user:s}}=await y.auth.getUser();if(!s)return;const{data:n,error:a}=await y.from("vendor_profiles").select("business_name").eq("user_id",s.id).maybeSingle();!a&&n&&d(n)}catch(s){console.error("Error fetching vendor profile:",s)}},C=async()=>{try{const{data:s,error:n}=await y.from("share_links").select("*").order("created_at",{ascending:!1});if(n)throw n;l(s||[])}catch{p.error("Failed to load share links")}},S=async s=>{s.preventDefault(),x(!0);try{const{data:{user:n}}=await y.auth.getUser();if(!n)throw new Error("Not authenticated");const a=t.markup_percentage?parseFloat(t.markup_percentage):0,i=t.markdown_percentage?parseFloat(t.markdown_percentage):0;if(a>0&&i>0){p.error("Please use either markup or markdown, not both"),x(!1);return}if(t.shared_categories.length===0){p.error("Please select at least one product category to share"),x(!1);return}if(new Date(t.expires_at)<=new Date){p.error("Expiration date must be in the future"),x(!1);return}const{data:ye,error:T}=await y.from("share_links").insert([{user_id:n.id,markup_percentage:a,markdown_percentage:i,expires_at:t.expires_at,show_vendor_details:t.show_vendor_details,shared_categories:t.shared_categories}]).select().single();if(T)throw T;try{await _("share_link_created")}catch(U){console.error("Failed to award points:",U)}p.success("Share link created successfully! ðŸŽ‰"),r({markup_percentage:"",markdown_percentage:"",expires_at:"",show_vendor_details:!0,shared_categories:["Jewellery","Gemstones","Loose Diamonds"]}),C()}catch(n){p.error(n.message||"Failed to create share link")}finally{x(!1)}},R=s=>{const n=`${window.location.origin}/shared/${encodeURIComponent(s)}`;navigator.clipboard.writeText(n),p.success("Link copied to clipboard!")},$=async(s,n)=>{try{const{error:a}=await y.from("share_links").update({is_active:!n}).eq("id",s);if(a)throw a;p.success(n?"Link deactivated":"Link activated"),C()}catch{p.error("Failed to update link status")}};return e.jsx(I,{children:e.jsx("div",{className:"min-h-screen bg-background py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs(g,{variant:"ghost",onClick:()=>h("/"),className:"mb-6",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Back to Catalog"]}),e.jsxs(f,{className:"mb-8",children:[e.jsx(N,{children:e.jsx(b,{className:"text-3xl font-serif",children:"Create Share Link"})}),e.jsxs(v,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(we,{})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"markup_percentage",children:"Markup % (optional)"}),e.jsx(P,{id:"markup_percentage",name:"markup_percentage",type:"number",step:"0.01",min:"0",max:"1000",value:t.markup_percentage,onChange:s=>r({...t,markup_percentage:s.target.value,markdown_percentage:""}),placeholder:"10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"markdown_percentage",children:"Markdown % (optional)"}),e.jsx(P,{id:"markdown_percentage",name:"markdown_percentage",type:"number",step:"0.01",min:"0",max:"100",value:t.markdown_percentage,onChange:s=>r({...t,markdown_percentage:s.target.value,markup_percentage:""}),placeholder:"5"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"expires_at",children:"Expiration Date *"}),e.jsx(P,{id:"expires_at",name:"expires_at",type:"datetime-local",value:t.expires_at,onChange:s=>r({...t,expires_at:s.target.value}),min:new Date().toISOString().slice(0,16),required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Set when this catalog link should stop working"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Product Categories to Share *"}),e.jsx("div",{className:"space-y-2",children:["Jewellery","Gemstones","Loose Diamonds"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:`category-${s}`,checked:t.shared_categories.includes(s),onCheckedChange:n=>{r(n?{...t,shared_categories:[...t.shared_categories,s]}:{...t,shared_categories:t.shared_categories.filter(a=>a!==s)})}}),e.jsx(L,{htmlFor:`category-${s}`,className:"cursor-pointer font-normal",children:s})]},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select which product types to include in this share link"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"show_vendor_details",checked:t.show_vendor_details,onChange:s=>r({...t,show_vendor_details:s.target.checked}),className:"h-4 w-4 rounded border-input"}),e.jsx(L,{htmlFor:"show_vendor_details",className:"cursor-pointer",children:"Show vendor details in shared catalog header"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"When enabled, your business name, contact info, and QR codes will be visible in the shared catalog"})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:j,children:j?"Creating Link...":"Create Share Link"})]})]})]}),e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{className:"text-2xl font-serif",children:"Your Share Links"})}),e.jsx(v,{children:k.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No share links yet"}):e.jsx("div",{className:"space-y-4",children:k.map(s=>{var E;const n=`${window.location.origin}/shared/${encodeURIComponent(s.share_token)}`,a=new Date(s.expires_at).getTime()-new Date().getTime()<24*60*60*1e3,i=w===s.id;return e.jsx(f,{className:"border-border hover:border-primary/30 transition-colors",children:e.jsxs(v,{className:"p-4 space-y-3",children:[e.jsx(q,{viewCount:s.view_count,isExpiringSoon:a,showTrending:!0}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("code",{className:"text-sm bg-muted px-2 py-1 rounded truncate max-w-[200px]",children:[s.share_token.substring(0,20),"..."]}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>R(s.share_token),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>window.open(n,"_blank"),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(ve,{shareToken:s.share_token,businessName:c==null?void 0:c.business_name}),e.jsx(O,{url:n,title:(c==null?void 0:c.business_name)||"Exclusive Jewelry Collection",description:"Discover stunning jewelry pieces"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[s.markup_percentage>0&&`+${s.markup_percentage}% markup`,s.markdown_percentage>0&&`-${s.markdown_percentage}% markdown`,s.markup_percentage===0&&s.markdown_percentage===0&&"No price adjustment"," â€¢ ","Expires: ",new Date(s.expires_at).toLocaleString()]}),e.jsx("div",{className:"flex gap-1 mt-2 flex-wrap",children:(E=s.shared_categories)==null?void 0:E.map(D=>e.jsx(M,{variant:"secondary",className:"text-xs",children:D},D))})]}),e.jsx(g,{size:"sm",variant:s.is_active?"destructive":"default",onClick:()=>$(s.id,s.is_active),children:s.is_active?"Deactivate":"Activate"})]}),e.jsxs(ue,{open:i,onOpenChange:()=>u(i?null:s.id),children:[e.jsx(ge,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),i?"Hide Analytics":"View Analytics",e.jsx(ie,{className:`h-4 w-4 transition-transform ${i?"rotate-180":""}`})]})}),e.jsx(je,{className:"mt-4",children:e.jsx(_e,{shareLinkId:s.id,viewCount:s.view_count})})]})]})},s.id)})})})]})]})})})};export{Je as default};
//# sourceMappingURL=Share-CWlSLn4J.js.map
