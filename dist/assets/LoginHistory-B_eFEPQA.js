import{u as I,j as e}from"./query-vendor-CIvqgC9B.js";import{u as F,r as p}from"./react-vendor-BCzWReGx.js";import{Y as P,B as Q,C as c,t as o,x as m,o as d,y as R,l as y}from"./index-DBHw7ps1.js";import{I as V}from"./input-CpEp8mrX.js";import{B as D}from"./badge-HmGNQ04n.js";import{T as E,a as z,b as A,c as x,d as K,e as u}from"./table-CywLfQKL.js";import{S as Y,a as G,b as J,c as O,d as v}from"./select-B1aOqld7.js";import{a3 as W,bd as k,ad as X,C as Z,T as M,a0 as $}from"./ui-vendor-B3Ur81tx.js";import{f as ee}from"./formatDistanceToNow-CVMQ6KIS.js";import{f as se}from"./format-CqKCEgBk.js";import"./supabase-vendor-DJknrin8.js";import"./index-BdQq_4o_.js";import"./index-lgWsV-kP.js";import"./index-vsC2Ycwh.js";import"./index-D6hZrTqZ.js";import"./endOfMonth-CPC63KWN.js";const ve=()=>{const w=F(),{isAdmin:g,loading:H}=P(),[h,U]=p.useState(""),[f,q]=p.useState("all"),{data:a,isLoading:B}=I({queryKey:["login-history"],queryFn:async()=>{const{data:s,error:t}=await y.from("user_sessions").select("*").order("last_activity",{ascending:!1});if(t)throw t;const{data:r}=await y.from("vendor_profiles").select("user_id, business_name, email"),{data:i}=await y.from("user_approval_status").select("user_id, business_name, email");return s==null?void 0:s.map(l=>({...l,profile:r==null?void 0:r.find(n=>n.user_id===l.user_id),approval:i==null?void 0:i.find(n=>n.user_id===l.user_id)}))},enabled:g}),N=s=>{const t=a==null?void 0:a.filter(r=>r.user_id===s.user_id);return!!(t&&t.length>5)},b=p.useMemo(()=>{if(!a)return[];let s=a;if(f!=="all"){const t=new Date;switch(f){case"today":t.setHours(0,0,0,0);break;case"week":t.setDate(t.getDate()-7);break;case"month":t.setMonth(t.getMonth()-1);break}s=s.filter(r=>new Date(r.last_activity)>=t)}if(h){const t=h.toLowerCase();s=s.filter(r=>{var i,l,n,_,S,C,T,L;return((l=(i=r.profile)==null?void 0:i.business_name)==null?void 0:l.toLowerCase().includes(t))||((_=(n=r.profile)==null?void 0:n.email)==null?void 0:_.toLowerCase().includes(t))||((C=(S=r.approval)==null?void 0:S.email)==null?void 0:C.toLowerCase().includes(t))||((T=r.ip_address)==null?void 0:T.toLowerCase().includes(t))||((L=r.device_info)==null?void 0:L.toLowerCase().includes(t))})}return s},[a,h,f]),j=p.useMemo(()=>{const s=new Set(a==null?void 0:a.map(i=>i.user_id)).size,t=(a==null?void 0:a.filter(i=>N(i)).length)||0,r=(a==null?void 0:a.filter(i=>{const l=new Date(i.last_activity),n=new Date;return l.toDateString()===n.toDateString()}).length)||0;return{totalSessions:(a==null?void 0:a.length)||0,uniqueUsers:s,suspiciousCount:t,activeToday:r}},[a]);return H?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):g?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Q,{variant:"ghost",onClick:()=>w("/super-admin"),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(k,{className:"h-8 w-8"}),"Login History"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor vendor login activity and sessions"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Sessions"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.totalSessions})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Unique Users"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.uniqueUsers})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Active Today"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:j.activeToday})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Suspicious Activity"}),e.jsx(M,{className:"h-4 w-4 text-destructive"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:j.suspiciousCount})})]})]}),e.jsx(c,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{type:"text",placeholder:"Search by business name, email, IP, or device...",value:h,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsxs(Y,{value:f,onValueChange:q,children:[e.jsx(G,{className:"w-full md:w-[200px]",children:e.jsx(J,{placeholder:"Time period"})}),e.jsxs(O,{children:[e.jsx(v,{value:"all",children:"All Time"}),e.jsx(v,{value:"today",children:"Today"}),e.jsx(v,{value:"week",children:"Last 7 Days"}),e.jsx(v,{value:"month",children:"Last 30 Days"})]})]})]})})}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Login Sessions"}),e.jsx(R,{children:"View all login sessions with device and location information"})]}),e.jsx(d,{children:B?e.jsx("div",{className:"text-center py-8",children:"Loading sessions..."}):b.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No sessions found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(E,{children:[e.jsx(z,{children:e.jsxs(A,{children:[e.jsx(x,{children:"User"}),e.jsx(x,{children:"Last Activity"}),e.jsx(x,{children:"IP Address"}),e.jsx(x,{children:"Device"}),e.jsx(x,{children:"Status"})]})}),e.jsx(K,{children:b.map(s=>{var r,i,l,n;const t=N(s);return e.jsxs(A,{children:[e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((r=s.profile)==null?void 0:r.business_name)||((i=s.approval)==null?void 0:i.business_name)||"Unknown"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:((l=s.profile)==null?void 0:l.email)||((n=s.approval)==null?void 0:n.email)||"N/A"})]})}),e.jsx(u,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:ee(new Date(s.last_activity),{addSuffix:!0})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:se(new Date(s.last_activity),"MMM dd, yyyy HH:mm")})]})}),e.jsx(u,{className:"font-mono text-sm",children:s.ip_address||"N/A"}),e.jsx(u,{className:"max-w-xs truncate text-sm",children:s.device_info||"Unknown device"}),e.jsx(u,{children:t?e.jsxs(D,{variant:"destructive",className:"flex items-center gap-1 w-fit",children:[e.jsx(M,{className:"h-3 w-3"}),"Suspicious"]}):e.jsx(D,{variant:"secondary",children:"Normal"})})]},s.id)})})]})})})]})]}):(w("/"),null)};export{ve as default};
//# sourceMappingURL=LoginHistory-B_eFEPQA.js.map
