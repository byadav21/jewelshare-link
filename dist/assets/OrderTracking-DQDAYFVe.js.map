{"version":3,"file":"OrderTracking-DQDAYFVe.js","sources":["../../src/pages/OrderTracking.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Loader2, Package, Clock, CheckCircle, AlertCircle } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { format } from 'date-fns';\r\nimport { toast } from 'sonner';\r\nimport { EstimateImage } from '@/components/EstimateImage';\r\n\r\ninterface OrderDetails {\r\n  id: string;\r\n  estimate_name: string;\r\n  customer_name: string;\r\n  customer_email: string;\r\n  customer_phone: string;\r\n  customer_address: string;\r\n  status: string;\r\n  created_at: string;\r\n  estimated_completion_date: string | null;\r\n  total_cost: number;\r\n  final_selling_price: number;\r\n  reference_images: string[];\r\n  notes: string;\r\n}\r\n\r\nconst statusConfig = {\r\n  draft: { label: 'Draft', color: 'bg-muted text-muted-foreground', icon: AlertCircle },\r\n  quoted: { label: 'Quoted', color: 'bg-blue-500 text-white', icon: Package },\r\n  approved: { label: 'Approved', color: 'bg-green-500 text-white', icon: CheckCircle },\r\n  in_production: { label: 'In Production', color: 'bg-amber-500 text-white', icon: Clock },\r\n  completed: { label: 'Completed', color: 'bg-emerald-500 text-white', icon: CheckCircle },\r\n  cancelled: { label: 'Cancelled', color: 'bg-destructive text-destructive-foreground', icon: AlertCircle },\r\n};\r\n\r\nexport default function OrderTracking() {\r\n  const { token } = useParams<{ token: string }>();\r\n  const navigate = useNavigate();\r\n  const [order, setOrder] = useState<OrderDetails | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchOrder = async () => {\r\n      if (!token) {\r\n        setError('Invalid tracking link');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const { data, error: fetchError } = await supabase\r\n          .from('manufacturing_cost_estimates')\r\n          .select('*')\r\n          .eq('share_token', token)\r\n          .eq('is_customer_visible', true)\r\n          .single();\r\n\r\n        if (fetchError) throw fetchError;\r\n\r\n        if (!data) {\r\n          setError('Order not found or access denied');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        setOrder(data as OrderDetails);\r\n      } catch (err) {\r\n        console.error('Error fetching order:', err);\r\n        setError('Unable to load order details');\r\n        toast.error('Failed to load order');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchOrder();\r\n\r\n    // Set up realtime subscription\r\n    const channel = supabase\r\n      .channel('order-updates')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'UPDATE',\r\n          schema: 'public',\r\n          table: 'manufacturing_cost_estimates',\r\n          filter: `share_token=eq.${token}`,\r\n        },\r\n        (payload) => {\r\n          setOrder(payload.new as OrderDetails);\r\n          toast.success('Order status updated!');\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [token]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-secondary/20 to-background\">\r\n        <Card className=\"w-full max-w-md\">\r\n          <CardContent className=\"pt-6 flex flex-col items-center gap-4\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            <p className=\"text-muted-foreground\">Loading order details...</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !order) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-secondary/20 to-background p-4\">\r\n        <Card className=\"w-full max-w-md\">\r\n          <CardContent className=\"pt-6 flex flex-col items-center gap-4\">\r\n            <AlertCircle className=\"h-12 w-12 text-destructive\" />\r\n            <h2 className=\"text-xl font-semibold\">Order Not Found</h2>\r\n            <p className=\"text-muted-foreground text-center\">{error}</p>\r\n            <Button onClick={() => navigate('/')} variant=\"outline\">\r\n              Go to Homepage\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const StatusIcon = statusConfig[order.status as keyof typeof statusConfig]?.icon || Package;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-secondary/20 to-background py-12 px-4\">\r\n      <div className=\"max-w-4xl mx-auto space-y-6\">\r\n        {/* Header */}\r\n        <Card>\r\n          <CardHeader>\r\n            <div className=\"flex items-start justify-between\">\r\n              <div>\r\n                <CardTitle className=\"text-2xl\">Order Tracking</CardTitle>\r\n                <CardDescription className=\"mt-2\">\r\n                  Track your custom jewelry manufacturing order\r\n                </CardDescription>\r\n              </div>\r\n              <Badge className={statusConfig[order.status as keyof typeof statusConfig]?.color}>\r\n                <StatusIcon className=\"h-4 w-4 mr-1\" />\r\n                {statusConfig[order.status as keyof typeof statusConfig]?.label}\r\n              </Badge>\r\n            </div>\r\n          </CardHeader>\r\n        </Card>\r\n\r\n        {/* Order Details */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Order Details</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Order Name</p>\r\n                <p className=\"font-medium\">{order.estimate_name}</p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Order Date</p>\r\n                <p className=\"font-medium\">{format(new Date(order.created_at), 'PPP')}</p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Customer Name</p>\r\n                <p className=\"font-medium\">{order.customer_name}</p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Contact</p>\r\n                <p className=\"font-medium\">{order.customer_phone || order.customer_email}</p>\r\n              </div>\r\n              {order.estimated_completion_date && (\r\n                <div className=\"md:col-span-2\">\r\n                  <p className=\"text-sm text-muted-foreground\">Estimated Completion</p>\r\n                  <p className=\"font-medium text-primary\">\r\n                    {format(new Date(order.estimated_completion_date), 'PPP')}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Reference Images */}\r\n        {order.reference_images && order.reference_images.length > 0 && (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Reference Images</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n                {order.reference_images.map((imageUrl, index) => (\r\n                  <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden border\">\r\n                    <EstimateImage\r\n                      src={imageUrl}\r\n                      alt={`Reference ${index + 1}`}\r\n                      className=\"w-full h-full object-cover hover:scale-105 transition-transform duration-300\"\r\n                    />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Pricing */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Pricing Information</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-3\">\r\n            <div className=\"flex justify-between py-2 border-b\">\r\n              <span className=\"text-muted-foreground\">Manufacturing Cost</span>\r\n              <span className=\"font-medium\">₹{order.total_cost?.toLocaleString() || 'N/A'}</span>\r\n            </div>\r\n            <div className=\"flex justify-between py-2 border-b\">\r\n              <span className=\"font-semibold\">Final Price</span>\r\n              <span className=\"font-bold text-lg text-primary\">\r\n                ₹{order.final_selling_price?.toLocaleString() || 'N/A'}\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Notes */}\r\n        {order.notes && (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Additional Notes</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <p className=\"text-muted-foreground whitespace-pre-wrap\">{order.notes}</p>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Status Timeline */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Order Progress</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-4\">\r\n              {Object.entries(statusConfig).map(([key, config]) => {\r\n                const Icon = config.icon;\r\n                const isActive = order.status === key;\r\n                const isPast = ['draft', 'quoted', 'approved', 'in_production', 'completed'].indexOf(order.status) >\r\n                  ['draft', 'quoted', 'approved', 'in_production', 'completed'].indexOf(key);\r\n                \r\n                return (\r\n                  <div key={key} className={`flex items-center gap-3 ${isActive ? 'opacity-100' : 'opacity-50'}`}>\r\n                    <div className={`rounded-full p-2 ${isPast || isActive ? config.color : 'bg-muted'}`}>\r\n                      <Icon className=\"h-4 w-4\" />\r\n                    </div>\r\n                    <span className={`font-medium ${isActive ? 'text-primary' : ''}`}>{config.label}</span>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["statusConfig","AlertCircle","Package","CheckCircle","Clock","OrderTracking","token","useParams","navigate","useNavigate","order","setOrder","useState","loading","setLoading","error","setError","useEffect","data","fetchError","supabase","err","toast","channel","payload","jsx","Card","jsxs","CardContent","Loader2","Button","StatusIcon","_a","CardHeader","CardTitle","CardDescription","Badge","_b","_c","format","imageUrl","index","EstimateImage","_d","_e","key","config","Icon","isActive","isPast"],"mappings":"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"}