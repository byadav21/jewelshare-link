{"version":3,"file":"MigrateImages-DDig_QSo.js","sources":["../../src/pages/MigrateImages.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { toast } from \"sonner\";\r\nimport { \r\n  ArrowLeft, \r\n  Image, \r\n  Upload, \r\n  CheckCircle2, \r\n  XCircle, \r\n  Loader2,\r\n  AlertCircle,\r\n  Database\r\n} from \"lucide-react\";\r\n\r\ninterface MigrationResult {\r\n  productId: string;\r\n  sku: string;\r\n  success: boolean;\r\n  migratedImages: number;\r\n  error?: string;\r\n}\r\n\r\ninterface MigrationSummary {\r\n  totalProducts: number;\r\n  successfulProducts: number;\r\n  totalImagesMigrated: number;\r\n}\r\n\r\nconst MigrateImages = () => {\r\n  const navigate = useNavigate();\r\n  const [migrating, setMigrating] = useState(false);\r\n  const [results, setResults] = useState<MigrationResult[]>([]);\r\n  const [summary, setSummary] = useState<MigrationSummary | null>(null);\r\n  const [progress, setProgress] = useState(0);\r\n\r\n  const handleMigration = async () => {\r\n    try {\r\n      setMigrating(true);\r\n      setProgress(10);\r\n      setResults([]);\r\n      setSummary(null);\r\n\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      if (!session) {\r\n        toast.error(\"You must be logged in to migrate images\");\r\n        return;\r\n      }\r\n\r\n      setProgress(30);\r\n\r\n      const { data, error } = await supabase.functions.invoke('migrate-images', {\r\n        headers: {\r\n          Authorization: `Bearer ${session.access_token}`,\r\n        },\r\n      });\r\n\r\n      setProgress(90);\r\n\r\n      if (error) {\r\n        console.error('Migration error:', error);\r\n        throw new Error(error.message || 'Migration failed');\r\n      }\r\n\r\n      if (data.error) {\r\n        throw new Error(data.error);\r\n      }\r\n\r\n      setResults(data.results || []);\r\n      setSummary(data.summary);\r\n      setProgress(100);\r\n\r\n      if (data.summary.totalImagesMigrated > 0) {\r\n        toast.success(\r\n          `Successfully migrated ${data.summary.totalImagesMigrated} images from ${data.summary.successfulProducts} products!`\r\n        );\r\n      } else {\r\n        toast.info(\"No external images found to migrate. All images are already hosted on your server.\");\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error('Migration error:', error);\r\n      toast.error(error.message || \"Failed to migrate images\");\r\n    } finally {\r\n      setMigrating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20\">\r\n      {/* Header */}\r\n      <header className=\"border-b border-border/50 bg-card/95 backdrop-blur-md shadow-lg sticky top-0 z-10\">\r\n        <div className=\"container mx-auto px-4 lg:px-6 py-4\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={() => navigate(\"/\")}\r\n              className=\"hover:bg-muted\"\r\n            >\r\n              <ArrowLeft className=\"h-5 w-5\" />\r\n            </Button>\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                <Database className=\"h-6 w-6 text-primary\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-2xl font-serif font-bold text-foreground\">\r\n                  Image Migration Tool\r\n                </h1>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Migrate external images to your server\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"container mx-auto px-4 lg:px-6 py-8 max-w-4xl\">\r\n        {/* Instructions Card */}\r\n        <Card className=\"mb-6 border-primary/20 bg-card/50 backdrop-blur-sm\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Image className=\"h-5 w-5 text-primary\" />\r\n              What does this tool do?\r\n            </CardTitle>\r\n            <CardDescription>\r\n              This migration tool will automatically:\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-3\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <CheckCircle2 className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\r\n              <div>\r\n                <p className=\"font-medium text-foreground\">Download external images</p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Fetches all product images currently hosted on external URLs\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-start gap-3\">\r\n              <Upload className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\r\n              <div>\r\n                <p className=\"font-medium text-foreground\">Upload to your server</p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Stores images in your Supabase Storage for faster, reliable access\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-start gap-3\">\r\n              <Database className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\r\n              <div>\r\n                <p className=\"font-medium text-foreground\">Update product records</p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Automatically updates your products with new hosted image URLs\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <Alert className=\"mt-4 border-blue-500/30 bg-blue-500/5\">\r\n              <AlertCircle className=\"h-4 w-4 text-blue-500\" />\r\n              <AlertDescription className=\"text-sm\">\r\n                This process may take a few minutes depending on how many products you have.\r\n                Images larger than 5MB will be skipped.\r\n              </AlertDescription>\r\n            </Alert>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Migration Control */}\r\n        <Card className=\"mb-6 bg-card/80 backdrop-blur-sm\">\r\n          <CardContent className=\"pt-6\">\r\n            <Button\r\n              onClick={handleMigration}\r\n              disabled={migrating}\r\n              size=\"lg\"\r\n              className=\"w-full h-14 text-base shadow-lg hover:shadow-xl transition-all\"\r\n            >\r\n              {migrating ? (\r\n                <>\r\n                  <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\r\n                  Migrating Images...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Upload className=\"h-5 w-5 mr-2\" />\r\n                  Start Migration\r\n                </>\r\n              )}\r\n            </Button>\r\n\r\n            {migrating && (\r\n              <div className=\"mt-4 space-y-2\">\r\n                <Progress value={progress} className=\"h-2\" />\r\n                <p className=\"text-sm text-muted-foreground text-center\">\r\n                  {progress < 30 ? \"Preparing migration...\" : \r\n                   progress < 90 ? \"Processing images...\" : \r\n                   \"Finalizing...\"}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Summary */}\r\n        {summary && (\r\n          <Card className=\"mb-6 border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10\">\r\n            <CardHeader>\r\n              <CardTitle className=\"text-xl\">Migration Summary</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n                <div className=\"text-center p-4 rounded-lg bg-background/50\">\r\n                  <div className=\"text-3xl font-bold text-primary\">{summary.totalProducts}</div>\r\n                  <div className=\"text-sm text-muted-foreground mt-1\">Products Processed</div>\r\n                </div>\r\n                <div className=\"text-center p-4 rounded-lg bg-background/50\">\r\n                  <div className=\"text-3xl font-bold text-green-600 dark:text-green-400\">\r\n                    {summary.successfulProducts}\r\n                  </div>\r\n                  <div className=\"text-sm text-muted-foreground mt-1\">Successful</div>\r\n                </div>\r\n                <div className=\"text-center p-4 rounded-lg bg-background/50\">\r\n                  <div className=\"text-3xl font-bold text-blue-600 dark:text-blue-400\">\r\n                    {summary.totalImagesMigrated}\r\n                  </div>\r\n                  <div className=\"text-sm text-muted-foreground mt-1\">Images Migrated</div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Results */}\r\n        {results.length > 0 && (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Migration Results</CardTitle>\r\n              <CardDescription>\r\n                Detailed results for each product\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ScrollArea className=\"h-[400px] pr-4\">\r\n                <div className=\"space-y-3\">\r\n                  {results.map((result) => (\r\n                    <div\r\n                      key={result.productId}\r\n                      className=\"flex items-center justify-between p-4 rounded-lg border border-border bg-muted/30 hover:bg-muted/50 transition-colors\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3 flex-1\">\r\n                        {result.success ? (\r\n                          <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0\" />\r\n                        ) : (\r\n                          <XCircle className=\"h-5 w-5 text-destructive flex-shrink-0\" />\r\n                        )}\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"font-medium text-foreground truncate\">\r\n                            {result.sku}\r\n                          </p>\r\n                          {result.error && (\r\n                            <p className=\"text-sm text-destructive truncate\">\r\n                              {result.error}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <Badge \r\n                        variant={result.migratedImages > 0 ? \"default\" : \"secondary\"}\r\n                        className=\"ml-3\"\r\n                      >\r\n                        {result.migratedImages} {result.migratedImages === 1 ? 'image' : 'images'}\r\n                      </Badge>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </ScrollArea>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MigrateImages;\r\n"],"names":["MigrateImages","navigate","useNavigate","migrating","setMigrating","useState","results","setResults","summary","setSummary","progress","setProgress","handleMigration","session","supabase","toast","data","error","jsxs","jsx","Button","ArrowLeft","Database","Card","CardHeader","CardTitle","Image","CardDescription","CardContent","CheckCircle2","Upload","Alert","AlertCircle","AlertDescription","Fragment","Loader2","Progress","ScrollArea","result","XCircle","Badge"],"mappings":"qiBAmCA,MAAMA,EAAgB,IAAM,CAC1B,MAAMC,EAAWC,EAAA,EACX,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAA4B,CAAA,CAAE,EACtD,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAkC,IAAI,EAC9D,CAACK,EAAUC,CAAW,EAAIN,EAAAA,SAAS,CAAC,EAEpCO,EAAkB,SAAY,CAClC,GAAI,CACFR,EAAa,EAAI,EACjBO,EAAY,EAAE,EACdJ,EAAW,CAAA,CAAE,EACbE,EAAW,IAAI,EAEf,KAAM,CAAE,KAAM,CAAE,QAAAI,CAAA,GAAc,MAAMC,EAAS,KAAK,WAAA,EAClD,GAAI,CAACD,EAAS,CACZE,EAAM,MAAM,yCAAyC,EACrD,MACF,CAEAJ,EAAY,EAAE,EAEd,KAAM,CAAE,KAAAK,EAAM,MAAAC,CAAA,EAAU,MAAMH,EAAS,UAAU,OAAO,iBAAkB,CACxE,QAAS,CACP,cAAe,UAAUD,EAAQ,YAAY,EAAA,CAC/C,CACD,EAID,GAFAF,EAAY,EAAE,EAEVM,EACF,cAAQ,MAAM,mBAAoBA,CAAK,EACjC,IAAI,MAAMA,EAAM,SAAW,kBAAkB,EAGrD,GAAID,EAAK,MACP,MAAM,IAAI,MAAMA,EAAK,KAAK,EAG5BT,EAAWS,EAAK,SAAW,EAAE,EAC7BP,EAAWO,EAAK,OAAO,EACvBL,EAAY,GAAG,EAEXK,EAAK,QAAQ,oBAAsB,EACrCD,EAAM,QACJ,yBAAyBC,EAAK,QAAQ,mBAAmB,gBAAgBA,EAAK,QAAQ,kBAAkB,YAAA,EAG1GD,EAAM,KAAK,oFAAoF,CAGnG,OAASE,EAAY,CACnB,QAAQ,MAAM,mBAAoBA,CAAK,EACvCF,EAAM,MAAME,EAAM,SAAW,0BAA0B,CACzD,QAAA,CACEb,EAAa,EAAK,CACpB,CACF,EAEA,OACEc,EAAAA,KAAC,MAAA,CAAI,UAAU,4EAEb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,UAAU,oFAChB,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,sCACb,SAAAD,OAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,CACC,QAAQ,QACR,KAAK,OACL,QAAS,IAAMnB,EAAS,GAAG,EAC3B,UAAU,iBAEV,SAAAkB,EAAAA,IAACE,EAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,EAEjCH,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,+BACb,eAACG,EAAA,CAAS,UAAU,uBAAuB,CAAA,CAC7C,SACC,MAAA,CACC,SAAA,CAAAH,EAAAA,IAAC,KAAA,CAAG,UAAU,gDAAgD,SAAA,uBAE9D,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,wCAAA,CAE7C,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,EACF,EACF,EAEAD,EAAAA,KAAC,OAAA,CAAK,UAAU,gDAEd,SAAA,CAAAA,EAAAA,KAACK,EAAA,CAAK,UAAU,qDACd,SAAA,CAAAL,OAACM,EAAA,CACC,SAAA,CAAAN,EAAAA,KAACO,EAAA,CAAU,UAAU,0BACnB,SAAA,CAAAN,EAAAA,IAACO,EAAA,CAAM,UAAU,sBAAA,CAAuB,EAAE,yBAAA,EAE5C,EACAP,EAAAA,IAACQ,GAAgB,SAAA,yCAAA,CAEjB,CAAA,EACF,EACAT,EAAAA,KAACU,EAAA,CAAY,UAAU,YACrB,SAAA,CAAAV,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACU,EAAA,CAAa,UAAU,2CAAA,CAA4C,SACnE,MAAA,CACC,SAAA,CAAAV,EAAAA,IAAC,IAAA,CAAE,UAAU,8BAA8B,SAAA,2BAAwB,EACnEA,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,8DAAA,CAE7C,CAAA,CAAA,CACF,CAAA,EACF,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACW,EAAA,CAAO,UAAU,2CAAA,CAA4C,SAC7D,MAAA,CACC,SAAA,CAAAX,EAAAA,IAAC,IAAA,CAAE,UAAU,8BAA8B,SAAA,wBAAqB,EAChEA,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,oEAAA,CAE7C,CAAA,CAAA,CACF,CAAA,EACF,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACG,EAAA,CAAS,UAAU,2CAAA,CAA4C,SAC/D,MAAA,CACC,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAE,UAAU,8BAA8B,SAAA,yBAAsB,EACjEA,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,gEAAA,CAE7C,CAAA,CAAA,CACF,CAAA,EACF,EAEAD,EAAAA,KAACa,EAAA,CAAM,UAAU,wCACf,SAAA,CAAAZ,EAAAA,IAACa,EAAA,CAAY,UAAU,uBAAA,CAAwB,EAC/Cb,EAAAA,IAACc,EAAA,CAAiB,UAAU,UAAU,SAAA,sHAAA,CAGtC,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,QAGCV,EAAA,CAAK,UAAU,mCACd,SAAAL,EAAAA,KAACU,EAAA,CAAY,UAAU,OACrB,SAAA,CAAAT,EAAAA,IAACC,EAAA,CACC,QAASR,EACT,SAAUT,EACV,KAAK,KACL,UAAU,iEAET,WACCe,EAAAA,KAAAgB,EAAAA,SAAA,CACE,SAAA,CAAAf,EAAAA,IAACgB,EAAA,CAAQ,UAAU,2BAAA,CAA4B,EAAE,qBAAA,CAAA,CAEnD,EAEAjB,EAAAA,KAAAgB,EAAAA,SAAA,CACE,SAAA,CAAAf,EAAAA,IAACW,EAAA,CAAO,UAAU,cAAA,CAAe,EAAE,iBAAA,CAAA,CAErC,CAAA,CAAA,EAIH3B,GACCe,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAC,EAAAA,IAACiB,EAAA,CAAS,MAAO1B,EAAU,UAAU,MAAM,EAC3CS,EAAAA,IAAC,IAAA,CAAE,UAAU,4CACV,SAAAT,EAAW,GAAK,yBAChBA,EAAW,GAAK,uBAChB,eAAA,CACH,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CACF,EAGCF,GACCU,EAAAA,KAACK,EAAA,CAAK,UAAU,wEACd,SAAA,CAAAJ,EAAAA,IAACK,GACC,SAAAL,EAAAA,IAACM,EAAA,CAAU,UAAU,UAAU,6BAAiB,CAAA,CAClD,EACAN,MAACS,EAAA,CACC,SAAAV,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,kCAAmC,SAAAX,EAAQ,cAAc,EACxEW,EAAAA,IAAC,MAAA,CAAI,UAAU,qCAAqC,SAAA,oBAAA,CAAkB,CAAA,EACxE,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,wDACZ,SAAAX,EAAQ,mBACX,EACAW,EAAAA,IAAC,MAAA,CAAI,UAAU,qCAAqC,SAAA,YAAA,CAAU,CAAA,EAChE,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,sDACZ,SAAAX,EAAQ,oBACX,EACAW,EAAAA,IAAC,MAAA,CAAI,UAAU,qCAAqC,SAAA,iBAAA,CAAe,CAAA,CAAA,CACrE,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EACF,EAIDb,EAAQ,OAAS,GAChBY,EAAAA,KAACK,EAAA,CACC,SAAA,CAAAL,OAACM,EAAA,CACC,SAAA,CAAAL,EAAAA,IAACM,GAAU,SAAA,mBAAA,CAAiB,EAC5BN,EAAAA,IAACQ,GAAgB,SAAA,mCAAA,CAEjB,CAAA,EACF,EACAR,MAACS,EAAA,CACC,SAAAT,EAAAA,IAACkB,EAAA,CAAW,UAAU,iBACpB,SAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,YACZ,SAAAb,EAAQ,IAAKgC,GACZpB,EAAAA,KAAC,MAAA,CAEC,UAAU,wHAEV,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iCACZ,SAAA,CAAAoB,EAAO,cACLT,EAAA,CAAa,UAAU,2DAA2D,EAEnFV,EAAAA,IAACoB,EAAA,CAAQ,UAAU,wCAAA,CAAyC,EAE9DrB,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAC,EAAAA,IAAC,IAAA,CAAE,UAAU,uCACV,SAAAmB,EAAO,IACV,EACCA,EAAO,OACNnB,EAAAA,IAAC,KAAE,UAAU,oCACV,WAAO,KAAA,CACV,CAAA,CAAA,CAEJ,CAAA,EACF,EACAD,EAAAA,KAACsB,EAAA,CACC,QAASF,EAAO,eAAiB,EAAI,UAAY,YACjD,UAAU,OAET,SAAA,CAAAA,EAAO,eAAe,IAAEA,EAAO,iBAAmB,EAAI,QAAU,QAAA,CAAA,CAAA,CACnE,CAAA,EAzBKA,EAAO,SAAA,CA2Bf,CAAA,CACH,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,EACF,CAEJ"}