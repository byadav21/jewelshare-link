{"version":3,"file":"OptimizedImage-CZRxPWyo.js","sources":["../../src/components/OptimizedImage.tsx"],"sourcesContent":["/**\r\n * Optimized Image component with lazy loading and blur-up placeholder\r\n * Handles lazy loading with Intersection Observer and graceful error handling\r\n */\r\n\r\nimport { useState, useEffect, useRef, ImgHTMLAttributes, useMemo } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface OptimizedImageProps extends Omit<ImgHTMLAttributes<HTMLImageElement>, \"src\"> {\r\n  src: string;\r\n  alt: string;\r\n  width?: number;\r\n  height?: number;\r\n  lazy?: boolean;\r\n  priority?: boolean;\r\n  className?: string;\r\n  objectFit?: \"contain\" | \"cover\" | \"fill\" | \"none\" | \"scale-down\";\r\n  onLoad?: () => void;\r\n  onError?: () => void;\r\n  blurPlaceholder?: boolean;\r\n}\r\n\r\n// Generate a tiny placeholder color based on image URL for consistent blur effect\r\nconst generatePlaceholderColor = (src: string): string => {\r\n  let hash = 0;\r\n  for (let i = 0; i < src.length; i++) {\r\n    hash = src.charCodeAt(i) + ((hash << 5) - hash);\r\n  }\r\n  const h = Math.abs(hash % 360);\r\n  return `hsl(${h}, 20%, 85%)`;\r\n};\r\n\r\nexport const OptimizedImage = ({\r\n  src,\r\n  alt,\r\n  width,\r\n  height,\r\n  lazy = true,\r\n  priority = false,\r\n  className,\r\n  objectFit = \"cover\",\r\n  onLoad,\r\n  onError,\r\n  blurPlaceholder = true,\r\n  ...props\r\n}: OptimizedImageProps) => {\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n  const [hasError, setHasError] = useState(false);\r\n  const [isInView, setIsInView] = useState(!lazy || priority);\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Memoize placeholder color for consistent blur effect\r\n  const placeholderColor = useMemo(() => generatePlaceholderColor(src || ''), [src]);\r\n\r\n  // Reset state when src changes\r\n  useEffect(() => {\r\n    setIsLoaded(false);\r\n    setHasError(false);\r\n  }, [src]);\r\n\r\n  // Lazy loading with Intersection Observer\r\n  useEffect(() => {\r\n    if (!lazy || priority || isInView) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting) {\r\n            setIsInView(true);\r\n            observer.disconnect();\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"200px\", threshold: 0.01 }\r\n    );\r\n\r\n    if (containerRef.current) {\r\n      observer.observe(containerRef.current);\r\n    }\r\n\r\n    return () => observer.disconnect();\r\n  }, [lazy, priority, isInView]);\r\n\r\n  const handleLoad = () => {\r\n    setIsLoaded(true);\r\n    onLoad?.();\r\n  };\r\n\r\n  const handleError = () => {\r\n    setHasError(true);\r\n    onError?.();\r\n  };\r\n\r\n  const objectFitClass = {\r\n    contain: \"object-contain\",\r\n    cover: \"object-cover\",\r\n    fill: \"object-fill\",\r\n    none: \"object-none\",\r\n    \"scale-down\": \"object-scale-down\",\r\n  }[objectFit];\r\n\r\n  // Show placeholder while not in view\r\n  if (!isInView) {\r\n    return (\r\n      <div\r\n        ref={containerRef}\r\n        className={cn(\"relative overflow-hidden\", className)}\r\n        style={{ \r\n          width, \r\n          height,\r\n          backgroundColor: blurPlaceholder ? placeholderColor : undefined\r\n        }}\r\n      >\r\n        {/* Blur placeholder with shimmer effect */}\r\n        <div \r\n          className=\"absolute inset-0 animate-pulse\"\r\n          style={{ \r\n            background: `linear-gradient(90deg, ${placeholderColor} 0%, hsl(0, 0%, 90%) 50%, ${placeholderColor} 100%)`,\r\n            backgroundSize: '200% 100%',\r\n            animation: 'shimmer 1.5s infinite'\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show error state\r\n  if (hasError) {\r\n    return (\r\n      <div\r\n        className={cn(\r\n          \"flex items-center justify-center bg-muted text-muted-foreground\",\r\n          className\r\n        )}\r\n        style={{ width, height }}\r\n      >\r\n        <span className=\"text-xs\">Image unavailable</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef} \r\n      className={cn(\"relative overflow-hidden\", className)}\r\n    >\r\n      <img\r\n        ref={imgRef}\r\n        src={src}\r\n        alt={alt}\r\n        width={width}\r\n        height={height}\r\n        loading={lazy && !priority ? \"lazy\" : \"eager\"}\r\n        decoding=\"async\"\r\n        onLoad={handleLoad}\r\n        onError={handleError}\r\n        className={cn(\r\n          \"w-full h-full\",\r\n          objectFitClass\r\n        )}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Background Image component with lazy loading and blur-up placeholder\r\n */\r\ninterface OptimizedBackgroundImageProps {\r\n  src: string;\r\n  className?: string;\r\n  children?: React.ReactNode;\r\n  lazy?: boolean;\r\n  overlay?: boolean;\r\n  overlayOpacity?: number;\r\n}\r\n\r\n// Generate placeholder color for background images\r\nconst generateBgPlaceholderColor = (src: string): string => {\r\n  let hash = 0;\r\n  for (let i = 0; i < src.length; i++) {\r\n    hash = src.charCodeAt(i) + ((hash << 5) - hash);\r\n  }\r\n  const h = Math.abs(hash % 360);\r\n  return `hsl(${h}, 15%, 80%)`;\r\n};\r\n\r\nexport const OptimizedBackgroundImage = ({\r\n  src,\r\n  className,\r\n  children,\r\n  lazy = true,\r\n  overlay = false,\r\n  overlayOpacity = 0.5,\r\n}: OptimizedBackgroundImageProps) => {\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n  const [isInView, setIsInView] = useState(!lazy);\r\n  const divRef = useRef<HTMLDivElement>(null);\r\n  const placeholderColor = useMemo(() => generateBgPlaceholderColor(src || ''), [src]);\r\n\r\n  useEffect(() => {\r\n    if (!lazy || isInView) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting) {\r\n            setIsInView(true);\r\n            observer.disconnect();\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"200px\" }\r\n    );\r\n\r\n    if (divRef.current) {\r\n      observer.observe(divRef.current);\r\n    }\r\n\r\n    return () => observer.disconnect();\r\n  }, [lazy, isInView]);\r\n\r\n  useEffect(() => {\r\n    if (!isInView) return;\r\n\r\n    const img = new Image();\r\n    img.onload = () => setIsLoaded(true);\r\n    img.src = src;\r\n  }, [isInView, src]);\r\n\r\n  return (\r\n    <div\r\n      ref={divRef}\r\n      className={cn(\"relative overflow-hidden\", className)}\r\n      style={{\r\n        backgroundImage: isLoaded ? `url(${src})` : undefined,\r\n        backgroundSize: \"cover\",\r\n        backgroundPosition: \"center\",\r\n        backgroundColor: !isLoaded ? placeholderColor : undefined,\r\n      }}\r\n    >\r\n      {/* Blur-up placeholder for background */}\r\n      {!isLoaded && (\r\n        <div \r\n          className=\"absolute inset-0 animate-pulse\"\r\n          style={{ \r\n            background: `linear-gradient(135deg, ${placeholderColor} 0%, hsl(0, 0%, 85%) 100%)`,\r\n            filter: 'blur(4px)'\r\n          }}\r\n        />\r\n      )}\r\n      \r\n      {overlay && isLoaded && (\r\n        <div\r\n          className=\"absolute inset-0 bg-background\"\r\n          style={{ opacity: overlayOpacity }}\r\n        />\r\n      )}\r\n      \r\n      <div className=\"relative z-10\">{children}</div>\r\n    </div>\r\n  );\r\n};\r\n"],"names":["generatePlaceholderColor","src","hash","i","OptimizedImage","alt","width","height","lazy","priority","className","objectFit","onLoad","onError","blurPlaceholder","props","isLoaded","setIsLoaded","useState","hasError","setHasError","isInView","setIsInView","imgRef","useRef","containerRef","placeholderColor","useMemo","useEffect","observer","entries","entry","handleLoad","handleError","objectFitClass","jsx","cn","generateBgPlaceholderColor","OptimizedBackgroundImage","children","overlay","overlayOpacity","divRef","img","jsxs"],"mappings":"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"}