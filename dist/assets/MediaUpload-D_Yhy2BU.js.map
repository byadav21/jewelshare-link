{"version":3,"file":"MediaUpload-D_Yhy2BU.js","sources":["../../src/components/MediaUpload.tsx"],"sourcesContent":["import { useState, useRef } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Upload, X, Image as ImageIcon } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\ninterface MediaUploadProps {\r\n  bucket: \"blog-images\" | \"brand-logos\" | \"press-media\";\r\n  onUploadComplete: (url: string) => void;\r\n  currentImage?: string;\r\n}\r\n\r\nexport const MediaUpload = ({ bucket, onUploadComplete, currentImage }: MediaUploadProps) => {\r\n  const [uploading, setUploading] = useState(false);\r\n  const [preview, setPreview] = useState<string | null>(currentImage || null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const { toast } = useToast();\r\n\r\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const validTypes = bucket === \"brand-logos\" \r\n      ? [\"image/jpeg\", \"image/png\", \"image/svg+xml\", \"image/webp\"]\r\n      : [\"image/jpeg\", \"image/png\", \"image/webp\", \"image/gif\"];\r\n\r\n    if (!validTypes.includes(file.type)) {\r\n      toast({\r\n        title: \"Invalid File Type\",\r\n        description: `Please upload ${validTypes.join(\", \")}`,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Validate file size (5MB for blog/press, 2MB for logos)\r\n    const maxSize = bucket === \"brand-logos\" ? 2 * 1024 * 1024 : 5 * 1024 * 1024;\r\n    if (file.size > maxSize) {\r\n      toast({\r\n        title: \"File Too Large\",\r\n        description: `Maximum file size is ${maxSize / 1024 / 1024}MB`,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setUploading(true);\r\n\r\n      // Create a unique file name\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      // Upload to Supabase Storage\r\n      const { data, error } = await supabase.storage\r\n        .from(bucket)\r\n        .upload(filePath, file, {\r\n          cacheControl: \"3600\",\r\n          upsert: false,\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      // Get public URL\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(bucket)\r\n        .getPublicUrl(data.path);\r\n\r\n      setPreview(publicUrl);\r\n      onUploadComplete(publicUrl);\r\n\r\n      toast({\r\n        title: \"Upload Successful\",\r\n        description: \"Image has been uploaded successfully.\",\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast({\r\n        title: \"Upload Failed\",\r\n        description: \"Something went wrong. Please try again.\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setUploading(false);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRemove = () => {\r\n    setPreview(null);\r\n    onUploadComplete(\"\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <Label>Image Upload</Label>\r\n      <input\r\n        ref={fileInputRef}\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        onChange={handleFileSelect}\r\n        className=\"hidden\"\r\n      />\r\n\r\n      {preview ? (\r\n        <Card className=\"relative overflow-hidden\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"relative aspect-video w-full overflow-hidden rounded-lg bg-muted\">\r\n              <img\r\n                src={preview}\r\n                alt=\"Preview\"\r\n                className=\"h-full w-full object-cover\"\r\n              />\r\n              <Button\r\n                variant=\"destructive\"\r\n                size=\"icon\"\r\n                className=\"absolute right-2 top-2\"\r\n                onClick={handleRemove}\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <Card\r\n          className=\"cursor-pointer border-2 border-dashed transition-colors hover:border-category-jewellery\"\r\n          onClick={() => fileInputRef.current?.click()}\r\n        >\r\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\r\n            <div className=\"mb-4 rounded-full bg-category-jewellery/10 p-4\">\r\n              {uploading ? (\r\n                <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-category-jewellery border-t-transparent\" />\r\n              ) : (\r\n                <ImageIcon className=\"h-8 w-8 text-category-jewellery\" />\r\n              )}\r\n            </div>\r\n            <p className=\"mb-2 text-sm font-medium\">\r\n              {uploading ? \"Uploading...\" : \"Click to upload image\"}\r\n            </p>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {bucket === \"brand-logos\" \r\n                ? \"PNG, JPG, SVG or WebP (max 2MB)\"\r\n                : \"PNG, JPG, WebP or GIF (max 5MB)\"}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};"],"names":["MediaUpload","bucket","onUploadComplete","currentImage","uploading","setUploading","useState","preview","setPreview","fileInputRef","useRef","toast","useToast","handleFileSelect","e","file","_a","validTypes","maxSize","fileExt","filePath","data","error","supabase","publicUrl","handleRemove","jsxs","jsx","Label","Card","CardContent","Button","X","ImageIcon"],"mappings":"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"}