import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as c,u as F}from"./react-vendor-BeR0k5Z3.js";import{u as q}from"./useRewardsSystem-5YgyYoFa.js";import{F as m,z as _,C as g,G as f,H as j,I as y,D as v,B as A,E as Y,_ as L}from"./index-DGlTgSKx.js";import{B as k}from"./badge-DknkzE8c.js";import{P as J}from"./progress-CD8Qom20.js";import{x as K,aT as $,L as O,P as R,G as w,J as Q,aE as C,e as S,aU as V,m as P,aH as W}from"./ui-vendor-CN4tOqpp.js";import{f as T}from"./format-CqKCEgBk.js";import"./supabase-vendor-VSDMYZ1k.js";const X=()=>{const[r,o]=c.useState([]),[t,l]=c.useState(!0),[n,i]=c.useState(null);c.useEffect(()=>{x(),h()},[]);const x=async()=>{try{const{data:{user:d}}=await m.auth.getUser();if(!d)return;const{data:p,error:u}=await m.from("vendor_milestones").select("*").eq("user_id",d.id).order("achieved_at",{ascending:!1});if(u)throw u;o(p||[])}catch(d){console.error("Error fetching milestones:",d)}finally{l(!1)}},h=()=>{const d=m.channel("milestone-achievements").on("postgres_changes",{event:"INSERT",schema:"public",table:"vendor_milestones"},p=>{p.new&&(i(p.new),o(u=>[p.new,...u]))}).subscribe();return()=>{m.removeChannel(d)}};return{milestones:r,loading:t,latestMilestone:n,clearLatestMilestone:()=>{i(null)},refetch:x}},Z=()=>{const[r,o]=c.useState([]),[t,l]=c.useState(!0);c.useEffect(()=>{n()},[]);const n=async()=>{try{const{data:{user:i}}=await m.auth.getUser();if(!i)return;const{data:x,error:h}=await m.from("redemptions").select("*").eq("user_id",i.id).order("redeemed_at",{ascending:!1});if(h)throw h;o(x||[])}catch(i){console.error("Error fetching redemptions:",i)}finally{l(!1)}};return{redemptions:r,loading:t,refetch:n}},ee=r=>({extra_products:R,extra_share_links:O,premium_support:$})[r]||w,se=({reward:r,userPoints:o,onRedeem:t,isRedeeming:l})=>{const n=o>=r.points_cost,i=ee(r.reward_type);return e.jsx(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},children:e.jsxs(g,{className:`relative overflow-hidden ${n?"":"opacity-60"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-primary/10 to-accent/10 rounded-full blur-3xl"}),e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center mb-3",children:e.jsx(i,{className:"h-6 w-6 text-primary"})}),e.jsxs(k,{variant:n?"default":"secondary",children:[r.points_cost," points"]})]}),e.jsx(j,{className:"text-lg",children:r.name}),r.description&&e.jsx(y,{children:r.description})]}),e.jsx(v,{children:e.jsx(A,{onClick:()=>t(r.id),disabled:!n||l,className:"w-full",variant:n?"default":"outline",children:l?"Redeeming...":n?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Redeem Now"]}):"Not Enough Points"})})]})})},me=()=>{const r=F(),{toast:o}=Y(),{points:t,history:l,loading:n,refetch:i}=q(),{milestones:x,loading:h}=X(),{refetch:M}=Z(),[d,p]=c.useState([]),[u,E]=c.useState(null),I=n||h;c.useEffect(()=>{U()},[]);const U=async()=>{const{data:s,error:a}=await m.from("rewards_catalog").select("*").eq("is_active",!0).order("points_cost",{ascending:!0});!a&&s&&p(s)},z=async s=>{E(s);try{const{data:a,error:b}=await m.functions.invoke("redeem-reward",{body:{reward_id:s}});if(b)throw b;o({title:"Reward Redeemed!",description:"Your reward has been successfully applied to your account."}),await i(),await M()}catch(a){o({title:"Redemption Failed",description:a.message||"Unable to redeem reward. Please try again.",variant:"destructive"})}finally{E(null)}},B=s=>{const a={bronze:"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400",silver:"bg-gray-100 text-gray-700 dark:bg-gray-800/20 dark:text-gray-400",gold:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400",platinum:"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400"};return a[s]||a.bronze},G=s=>({bronze:{next:"Silver",points:500},silver:{next:"Gold",points:2e3},gold:{next:"Platinum",points:5e3},platinum:{next:"Legend",points:1e4}})[s]||{next:"Silver",points:500},H=s=>({product_added:R,share_link_created:P,product_viewed:W,first_product:R,profile_completed:w})[s]||S;if(I)return e.jsx(L,{children:e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-10 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-40 bg-muted rounded"}),e.jsx("div",{className:"h-60 bg-muted rounded"})]})})})});const N=t?G(t.current_tier):null,D=t&&N?t.total_points/N.points*100:0;return e.jsx(L,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-muted/10 to-background",children:e.jsxs("div",{className:"container mx-auto max-w-6xl p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>r("/catalog"),children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Rewards & Achievements"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your progress and earn rewards"})]})]}),t&&e.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(g,{className:"bg-gradient-to-br from-primary/10 via-background to-accent/10 border-primary/20",children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center",children:e.jsx(C,{className:"h-8 w-8 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsxs(j,{className:"text-2xl",children:[t.total_points.toLocaleString()," Points"]}),e.jsx(y,{children:"Your total reward points"})]})]}),e.jsx(k,{className:B(t.current_tier),variant:"secondary",children:t.current_tier.toUpperCase()})]})}),N&&t.current_tier!=="platinum"&&e.jsx(v,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Progress to ",N.next]}),e.jsxs("span",{className:"font-medium",children:[N.points-t.total_points," points to go"]})]}),e.jsx(J,{value:Math.min(D,100),className:"h-3"})]})})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-primary"}),"Achievements"]}),e.jsx(y,{children:"Milestones you've unlocked"})]}),e.jsx(v,{children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No achievements yet. Keep growing!"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:x.map((s,a)=>e.jsxs(_.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(C,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.milestone_type.replace(/_/g," ").toUpperCase()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:T(new Date(s.achieved_at),"MMM d, yyyy")})]}),e.jsxs(k,{variant:"secondary",className:"flex-shrink-0",children:["+",s.points_awarded," pts"]})]},s.id))})})]}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-primary"}),"Recent Activity"]}),e.jsx(y,{children:"Points you've earned recently"})]}),e.jsx(v,{children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No activity yet. Start earning points!"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:l.map((s,a)=>{const b=H(s.action_type);return e.jsxs(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(b,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.action_type.replace(/_/g," ").toUpperCase()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:T(new Date(s.created_at),"MMM d, yyyy h:mm a")})]}),e.jsxs(k,{variant:s.points>0?"default":"secondary",className:"flex-shrink-0",children:[s.points>0?"+":"",s.points," pts"]})]},s.id)})})})]})]}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"Redeem Rewards"]}),e.jsx(y,{children:"Exchange your points for exclusive perks"})]}),e.jsx(v,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>e.jsx(se,{reward:s,userPoints:(t==null?void 0:t.total_points)||0,onRedeem:z,isRedeeming:u===s.id},s.id))})})]}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"How to Earn Points"}),e.jsx(y,{children:"Actions that reward you with points"})]}),e.jsx(v,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[{action:"Add a product",points:10,icon:R},{action:"Create share link",points:20,icon:P},{action:"Complete profile",points:30,icon:w},{action:"First product",points:50,icon:S}].map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border border-border bg-muted/30 hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.action}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",s.points," points"]})]})]},s.action))})})]})]})})})};export{me as default};
//# sourceMappingURL=Rewards-BdfG5HkO.js.map
