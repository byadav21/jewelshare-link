{"version":3,"file":"InvoiceHistory-DRu4jtaY.js","sources":["../../src/pages/InvoiceHistory.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { Search, FileText, Download, Eye, ArrowLeft, Trash2, Mail, CheckSquare, Square, Calendar } from \"lucide-react\";\r\nimport { generateInvoicePDF } from \"@/utils/invoiceGenerator\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Calendar as CalendarComponent } from \"@/components/ui/calendar\";\r\nimport { format } from \"date-fns\";\r\nimport { \r\n  AlertDialog, \r\n  AlertDialogAction, \r\n  AlertDialogCancel, \r\n  AlertDialogContent, \r\n  AlertDialogDescription, \r\n  AlertDialogFooter, \r\n  AlertDialogHeader, \r\n  AlertDialogTitle \r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\n\r\ninterface Invoice {\r\n  id: string;\r\n  invoice_number: string;\r\n  invoice_date: string;\r\n  customer_name: string;\r\n  customer_email: string;\r\n  customer_phone: string;\r\n  final_selling_price: number;\r\n  status: string;\r\n  invoice_status: string | null;\r\n  payment_date: string | null;\r\n  payment_due_date: string | null;\r\n  estimate_name: string;\r\n  created_at: string;\r\n  last_reminder_sent_at: string | null;\r\n}\r\n\r\nconst InvoiceHistory = () => {\r\n  const navigate = useNavigate();\r\n  const [invoices, setInvoices] = useState<Invoice[]>([]);\r\n  const [filteredInvoices, setFilteredInvoices] = useState<Invoice[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n  const [paymentStatusFilter, setPaymentStatusFilter] = useState<string>(\"all\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [invoiceToDelete, setInvoiceToDelete] = useState<Invoice | null>(null);\r\n  const [selectedInvoices, setSelectedInvoices] = useState<Set<string>>(new Set());\r\n  const [dateFrom, setDateFrom] = useState<Date | undefined>();\r\n  const [dateTo, setDateTo] = useState<Date | undefined>();\r\n  const [bulkActionLoading, setBulkActionLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchInvoices();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    filterInvoices();\r\n  }, [searchTerm, statusFilter, paymentStatusFilter, invoices, dateFrom, dateTo]);\r\n\r\n  const fetchInvoices = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        toast.error(\"Please sign in to view invoices\");\r\n        navigate(\"/auth\");\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .eq(\"is_invoice_generated\", true)\r\n        .not(\"invoice_number\", \"is\", null)\r\n        .order(\"invoice_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      setInvoices(data || []);\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to load invoices\");\r\n      console.error(\"Error fetching invoices:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filterInvoices = () => {\r\n    let filtered = invoices;\r\n\r\n    if (searchTerm) {\r\n      filtered = filtered.filter(\r\n        (invoice) =>\r\n          invoice.invoice_number?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n          invoice.customer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n          invoice.customer_email?.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n\r\n    if (statusFilter !== \"all\") {\r\n      filtered = filtered.filter((invoice) => invoice.status === statusFilter);\r\n    }\r\n\r\n    if (paymentStatusFilter !== \"all\") {\r\n      filtered = filtered.filter((invoice) => invoice.invoice_status === paymentStatusFilter);\r\n    }\r\n\r\n    if (dateFrom) {\r\n      filtered = filtered.filter((invoice) => new Date(invoice.invoice_date) >= dateFrom);\r\n    }\r\n\r\n    if (dateTo) {\r\n      filtered = filtered.filter((invoice) => new Date(invoice.invoice_date) <= dateTo);\r\n    }\r\n\r\n    setFilteredInvoices(filtered);\r\n  };\r\n\r\n  const toggleSelectAll = () => {\r\n    if (selectedInvoices.size === filteredInvoices.length) {\r\n      setSelectedInvoices(new Set());\r\n    } else {\r\n      setSelectedInvoices(new Set(filteredInvoices.map(inv => inv.id)));\r\n    }\r\n  };\r\n\r\n  const toggleSelectInvoice = (invoiceId: string) => {\r\n    const newSelected = new Set(selectedInvoices);\r\n    if (newSelected.has(invoiceId)) {\r\n      newSelected.delete(invoiceId);\r\n    } else {\r\n      newSelected.add(invoiceId);\r\n    }\r\n    setSelectedInvoices(newSelected);\r\n  };\r\n\r\n  const handleBulkExport = async () => {\r\n    if (selectedInvoices.size === 0) {\r\n      toast.error(\"Please select invoices to export\");\r\n      return;\r\n    }\r\n\r\n    setBulkActionLoading(true);\r\n    try {\r\n      for (const invoiceId of selectedInvoices) {\r\n        const invoice = invoices.find(inv => inv.id === invoiceId);\r\n        if (invoice) {\r\n          await handleRegenerateInvoice(invoice);\r\n          await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between downloads\r\n        }\r\n      }\r\n      toast.success(`Exported ${selectedInvoices.size} invoices`);\r\n    } catch (error) {\r\n      toast.error(\"Failed to export some invoices\");\r\n    } finally {\r\n      setBulkActionLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleBulkEmail = async () => {\r\n    if (selectedInvoices.size === 0) {\r\n      toast.error(\"Please select invoices to email\");\r\n      return;\r\n    }\r\n\r\n    setBulkActionLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data: profile } = await supabase\r\n        .from(\"vendor_profiles\")\r\n        .select(\"business_name, email\")\r\n        .eq(\"user_id\", user.id)\r\n        .maybeSingle();\r\n\r\n      let successCount = 0;\r\n      for (const invoiceId of selectedInvoices) {\r\n        const invoice = invoices.find(inv => inv.id === invoiceId);\r\n        if (invoice && invoice.customer_email) {\r\n          try {\r\n            const { error } = await supabase.functions.invoke(\"send-invoice-email\", {\r\n              body: {\r\n                to: invoice.customer_email,\r\n                customerName: invoice.customer_name,\r\n                invoiceNumber: invoice.invoice_number,\r\n                amount: invoice.final_selling_price,\r\n                vendorName: profile?.business_name || \"Your Vendor\",\r\n                vendorEmail: profile?.email || \"vendor@example.com\",\r\n              },\r\n            });\r\n\r\n            if (!error) successCount++;\r\n          } catch (err) {\r\n            console.error(`Failed to send email for ${invoice.invoice_number}:`, err);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (successCount > 0) {\r\n        toast.success(`Sent ${successCount} of ${selectedInvoices.size} emails`);\r\n      } else {\r\n        toast.error(\"Failed to send emails\");\r\n      }\r\n    } catch (error) {\r\n      toast.error(\"Failed to send emails\");\r\n      console.error(error);\r\n    } finally {\r\n      setBulkActionLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleBulkStatusUpdate = async (newStatus: string) => {\r\n    if (selectedInvoices.size === 0) {\r\n      toast.error(\"Please select invoices to update\");\r\n      return;\r\n    }\r\n\r\n    setBulkActionLoading(true);\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .update({ status: newStatus })\r\n        .in(\"id\", Array.from(selectedInvoices));\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(`Updated ${selectedInvoices.size} invoices to ${newStatus}`);\r\n      setSelectedInvoices(new Set());\r\n      fetchInvoices();\r\n    } catch (error) {\r\n      toast.error(\"Failed to update invoices\");\r\n      console.error(error);\r\n    } finally {\r\n      setBulkActionLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePaymentStatusUpdate = async (invoiceId: string, newPaymentStatus: string) => {\r\n    try {\r\n      const updateData: any = { invoice_status: newPaymentStatus };\r\n      if (newPaymentStatus === \"paid\") {\r\n        updateData.payment_date = new Date().toISOString();\r\n      } else if (newPaymentStatus === \"pending\" || newPaymentStatus === \"cancelled\") {\r\n        updateData.payment_date = null;\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .update(updateData)\r\n        .eq(\"id\", invoiceId);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(`Payment status updated to ${newPaymentStatus}`);\r\n      fetchInvoices();\r\n    } catch (error: any) {\r\n      console.error(\"Error updating payment status:\", error);\r\n      toast.error(\"Failed to update payment status\");\r\n    }\r\n  };\r\n\r\n  const handleSendPaymentReminder = async (invoice: Invoice) => {\r\n    if (!invoice.customer_email) {\r\n      toast.error(\"No customer email available\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const dueDate = new Date(invoice.payment_due_date || invoice.created_at);\r\n      const today = new Date();\r\n      const daysOverdue = invoice.invoice_status === \"overdue\" \r\n        ? Math.floor((today.getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24))\r\n        : 0;\r\n\r\n      const { error } = await supabase.functions.invoke(\"send-payment-reminder\", {\r\n        body: {\r\n          invoiceId: invoice.id,\r\n          customerEmail: invoice.customer_email,\r\n          customerName: invoice.customer_name,\r\n          invoiceNumber: invoice.invoice_number,\r\n          amount: invoice.final_selling_price || 0,\r\n          dueDate: invoice.payment_due_date,\r\n          daysOverdue,\r\n        },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"Payment reminder sent successfully\");\r\n      fetchInvoices();\r\n    } catch (error: any) {\r\n      console.error(\"Error sending payment reminder:\", error);\r\n      toast.error(\"Failed to send payment reminder\");\r\n    }\r\n  };\r\n\r\n  const handleRegenerateInvoice = async (invoice: Invoice) => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data: estimateRaw, error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .select(\"*\")\r\n        .eq(\"id\", invoice.id)\r\n        .maybeSingle();\r\n\r\n      if (error) throw error;\r\n      if (!estimateRaw) {\r\n        toast.error(\"Invoice not found\");\r\n        return;\r\n      }\r\n      \r\n      const estimate = estimateRaw as any;\r\n\r\n      const { data: profile } = await supabase\r\n        .from(\"vendor_profiles\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .maybeSingle();\r\n\r\n      const estimateDetails = estimate.details || {};\r\n      const estimateLineItems = estimate.line_items || [];\r\n\r\n      // Build vendor address\r\n      const addressParts = [\r\n        profile?.address_line1,\r\n        profile?.address_line2,\r\n        profile?.city,\r\n        profile?.state,\r\n        profile?.pincode,\r\n        profile?.country\r\n      ].filter(Boolean);\r\n      const vendorAddress = addressParts.join(\", \");\r\n\r\n      const invoiceData = {\r\n        invoiceNumber: estimate.invoice_number,\r\n        invoiceDate: estimate.invoice_date,\r\n        paymentDueDate: estimate.payment_due_date,\r\n        paymentTerms: estimate.payment_terms,\r\n        estimateName: estimate.estimate_name,\r\n        status: estimate.status,\r\n        customerName: estimate.customer_name,\r\n        customerPhone: estimate.customer_phone,\r\n        customerEmail: estimate.customer_email,\r\n        customerAddress: estimate.customer_address,\r\n        customerGSTIN: estimateDetails.customer_gstin,\r\n        vendorGSTIN: estimateDetails.vendor_gstin,\r\n        netWeight: estimate.net_weight,\r\n        grossWeight: estimate.net_weight,\r\n        purityFraction: estimate.purity_fraction,\r\n        goldRate24k: estimate.gold_rate_24k,\r\n        makingCharges: estimate.making_charges,\r\n        cadDesignCharges: estimate.cad_design_charges,\r\n        cammingCharges: estimate.camming_charges,\r\n        certificationCost: estimate.certification_cost,\r\n        diamondCost: estimate.diamond_cost,\r\n        gemstoneCost: estimate.gemstone_cost,\r\n        goldCost: estimate.gold_cost,\r\n        totalCost: estimate.total_cost,\r\n        profitMargin: estimate.profit_margin_percentage,\r\n        finalSellingPrice: estimate.final_selling_price,\r\n        gstMode: estimateDetails.gst_mode,\r\n        sgstPercentage: estimateDetails.sgst_percentage,\r\n        cgstPercentage: estimateDetails.cgst_percentage,\r\n        igstPercentage: estimateDetails.igst_percentage,\r\n        sgstAmount: estimateDetails.sgst_amount,\r\n        cgstAmount: estimateDetails.cgst_amount,\r\n        igstAmount: estimateDetails.igst_amount,\r\n        shippingCharges: estimateDetails.shipping_charges,\r\n        shippingZone: estimateDetails.shipping_zone,\r\n        exchangeRate: estimateDetails.exchange_rate,\r\n        grandTotal: estimateDetails.grand_total,\r\n        invoiceNotes: estimate.invoice_notes,\r\n        lineItems: estimateLineItems,\r\n        details: estimateDetails,\r\n        vendorBranding: profile ? {\r\n          name: profile.business_name,\r\n          logo: profile.logo_url,\r\n          primaryColor: profile.primary_brand_color,\r\n          secondaryColor: profile.secondary_brand_color,\r\n          tagline: profile.brand_tagline,\r\n          email: profile.email,\r\n          phone: profile.phone,\r\n          address: vendorAddress\r\n        } : undefined,\r\n      };\r\n\r\n      await generateInvoicePDF(invoiceData);\r\n      toast.success(\"Invoice downloaded successfully\");\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to regenerate invoice\");\r\n      console.error(\"Error regenerating invoice:\", error);\r\n    }\r\n  };\r\n\r\n  const handleDeleteClick = (invoice: Invoice) => {\r\n    setInvoiceToDelete(invoice);\r\n    setDeleteDialogOpen(true);\r\n  };\r\n\r\n  const handleDeleteConfirm = async () => {\r\n    if (!invoiceToDelete) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .delete()\r\n        .eq(\"id\", invoiceToDelete.id);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"Invoice deleted successfully\");\r\n      setDeleteDialogOpen(false);\r\n      setInvoiceToDelete(null);\r\n      fetchInvoices(); // Refresh the list\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to delete invoice\");\r\n      console.error(\"Error deleting invoice:\", error);\r\n    }\r\n  };\r\n\r\n  const handleViewEstimate = (invoiceId: string) => {\r\n    navigate(`/manufacturing-cost?estimate=${invoiceId}`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4 md:p-8\">\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        <Button\r\n          variant=\"ghost\"\r\n          onClick={() => navigate(\"/calculators\")}\r\n          className=\"group\"\r\n        >\r\n          <ArrowLeft className=\"mr-2 h-4 w-4 transition-transform group-hover:-translate-x-1\" />\r\n          Back to Calculators\r\n        </Button>\r\n\r\n        <Card className=\"border-primary/10 shadow-2xl backdrop-blur-sm bg-card/95\">\r\n          <CardHeader className=\"bg-gradient-to-r from-primary/5 via-secondary/5 to-accent/5 border-b\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-3xl font-bold flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                  <FileText className=\"h-7 w-7 text-primary\" />\r\n                </div>\r\n                Invoice History\r\n              </CardTitle>\r\n              <Badge variant=\"secondary\" className=\"text-sm\">\r\n                {filteredInvoices.length} {filteredInvoices.length === 1 ? \"Invoice\" : \"Invoices\"}\r\n              </Badge>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"p-6 space-y-6\">\r\n            <div className=\"flex flex-col gap-4\">\r\n              <div className=\"flex flex-col md:flex-row gap-4\">\r\n                <div className=\"flex-1 relative\">\r\n                  <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\r\n                  <Input\r\n                    placeholder=\"Search by invoice number, customer name or email...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"pl-10\"\r\n                  />\r\n                </div>\r\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                  <SelectTrigger className=\"w-full md:w-48\">\r\n                    <SelectValue placeholder=\"Filter by status\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"all\">All Status</SelectItem>\r\n                    <SelectItem value=\"draft\">Draft</SelectItem>\r\n                    <SelectItem value=\"quoted\">Quoted</SelectItem>\r\n                    <SelectItem value=\"approved\">Approved</SelectItem>\r\n                    <SelectItem value=\"in_production\">In Production</SelectItem>\r\n                    <SelectItem value=\"completed\">Completed</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n                <Select value={paymentStatusFilter} onValueChange={setPaymentStatusFilter}>\r\n                  <SelectTrigger className=\"w-full md:w-48\">\r\n                    <SelectValue placeholder=\"Payment status\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"all\">All Payments</SelectItem>\r\n                    <SelectItem value=\"pending\">Pending</SelectItem>\r\n                    <SelectItem value=\"paid\">Paid</SelectItem>\r\n                    <SelectItem value=\"overdue\">Overdue</SelectItem>\r\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"flex flex-col md:flex-row gap-4 items-start md:items-center\">\r\n                <div className=\"flex gap-2 flex-wrap\">\r\n                  <Popover>\r\n                    <PopoverTrigger asChild>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        <Calendar className=\"mr-2 h-4 w-4\" />\r\n                        {dateFrom ? format(dateFrom, \"MMM dd, yyyy\") : \"From Date\"}\r\n                      </Button>\r\n                    </PopoverTrigger>\r\n                    <PopoverContent className=\"w-auto p-0\">\r\n                      <CalendarComponent\r\n                        mode=\"single\"\r\n                        selected={dateFrom}\r\n                        onSelect={setDateFrom}\r\n                        initialFocus\r\n                      />\r\n                    </PopoverContent>\r\n                  </Popover>\r\n\r\n                  <Popover>\r\n                    <PopoverTrigger asChild>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        <Calendar className=\"mr-2 h-4 w-4\" />\r\n                        {dateTo ? format(dateTo, \"MMM dd, yyyy\") : \"To Date\"}\r\n                      </Button>\r\n                    </PopoverTrigger>\r\n                    <PopoverContent className=\"w-auto p-0\">\r\n                      <CalendarComponent\r\n                        mode=\"single\"\r\n                        selected={dateTo}\r\n                        onSelect={setDateTo}\r\n                        initialFocus\r\n                      />\r\n                    </PopoverContent>\r\n                  </Popover>\r\n\r\n                  {(dateFrom || dateTo) && (\r\n                    <Button \r\n                      variant=\"ghost\" \r\n                      size=\"sm\"\r\n                      onClick={() => {\r\n                        setDateFrom(undefined);\r\n                        setDateTo(undefined);\r\n                      }}\r\n                    >\r\n                      Clear Dates\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {selectedInvoices.size > 0 && (\r\n                <div className=\"flex flex-wrap gap-2 items-center p-3 bg-primary/5 rounded-lg border border-primary/20\">\r\n                  <span className=\"text-sm font-medium\">\r\n                    {selectedInvoices.size} selected\r\n                  </span>\r\n                  <div className=\"flex gap-2 ml-auto flex-wrap\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={handleBulkExport}\r\n                      disabled={bulkActionLoading}\r\n                    >\r\n                      <Download className=\"h-4 w-4 mr-2\" />\r\n                      Export All\r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={handleBulkEmail}\r\n                      disabled={bulkActionLoading}\r\n                    >\r\n                      <Mail className=\"h-4 w-4 mr-2\" />\r\n                      Email All\r\n                    </Button>\r\n                    <Select onValueChange={handleBulkStatusUpdate}>\r\n                      <SelectTrigger className=\"w-[140px] h-9\">\r\n                        <SelectValue placeholder=\"Update Status\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"draft\">Draft</SelectItem>\r\n                        <SelectItem value=\"quoted\">Quoted</SelectItem>\r\n                        <SelectItem value=\"approved\">Approved</SelectItem>\r\n                        <SelectItem value=\"in_production\">In Production</SelectItem>\r\n                        <SelectItem value=\"completed\">Completed</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={() => setSelectedInvoices(new Set())}\r\n                    >\r\n                      Clear Selection\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"text-center py-16\">\r\n                <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4\"></div>\r\n                <p className=\"text-muted-foreground text-lg\">Loading invoices...</p>\r\n              </div>\r\n            ) : filteredInvoices.length === 0 ? (\r\n              <div className=\"text-center py-16\">\r\n                <div className=\"p-4 rounded-full bg-muted/50 inline-block mb-4\">\r\n                  <FileText className=\"h-16 w-16 text-muted-foreground\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold mb-2\">No invoices found</h3>\r\n                <p className=\"text-muted-foreground mb-6\">\r\n                  {searchTerm || statusFilter !== \"all\"\r\n                    ? \"Try adjusting your filters\"\r\n                    : \"Start creating invoices to see them here\"}\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {filteredInvoices.length > 0 && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-muted/50 rounded-lg\">\r\n                    <Checkbox\r\n                      checked={selectedInvoices.size === filteredInvoices.length}\r\n                      onCheckedChange={toggleSelectAll}\r\n                    />\r\n                    <span className=\"text-sm font-medium\">\r\n                      Select All ({filteredInvoices.length})\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                {filteredInvoices.map((invoice) => (\r\n                  <Card \r\n                    key={invoice.id} \r\n                    className=\"group hover:shadow-lg hover:border-primary/20 transition-all duration-200 bg-gradient-to-br from-card to-card/50\"\r\n                  >\r\n                    <CardContent className=\"p-6\">\r\n                      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                        <div className=\"flex items-start gap-3 flex-1\">\r\n                          <Checkbox\r\n                            checked={selectedInvoices.has(invoice.id)}\r\n                            onCheckedChange={() => toggleSelectInvoice(invoice.id)}\r\n                            className=\"mt-1\"\r\n                          />\r\n                          <div className=\"space-y-3 flex-1\">\r\n                            <div className=\"flex items-center gap-3 flex-wrap\">\r\n                              <div className=\"flex items-center gap-2 bg-primary/5 px-3 py-1.5 rounded-lg\">\r\n                                <FileText className=\"h-4 w-4 text-primary\" />\r\n                                <h3 className=\"font-bold text-lg\">{invoice.invoice_number}</h3>\r\n                              </div>\r\n                              <Badge \r\n                                variant={invoice.status === \"completed\" ? \"default\" : \"secondary\"}\r\n                                className=\"capitalize\"\r\n                              >\r\n                                {invoice.status?.replace(\"_\", \" \")}\r\n                              </Badge>\r\n                              <Badge \r\n                                variant={\r\n                                  invoice.invoice_status === \"paid\" \r\n                                    ? \"default\" \r\n                                    : invoice.invoice_status === \"overdue\" \r\n                                    ? \"destructive\" \r\n                                    : \"outline\"\r\n                                }\r\n                                className=\"text-xs capitalize\"\r\n                              >\r\n                                {invoice.invoice_status || \"pending\"}\r\n                              </Badge>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                              <div className=\"flex items-center gap-2 text-sm\">\r\n                                <span className=\"font-medium text-muted-foreground\">Customer:</span>\r\n                                <span className=\"text-foreground\">{invoice.customer_name}</span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2 text-sm\">\r\n                                <span className=\"font-medium text-muted-foreground\">Date:</span>\r\n                                <span className=\"text-foreground\">\r\n                                  {new Date(invoice.invoice_date).toLocaleDateString('en-US', { \r\n                                    year: 'numeric', \r\n                                    month: 'short', \r\n                                    day: 'numeric' \r\n                                  })}\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2 text-sm\">\r\n                                <span className=\"font-medium text-muted-foreground\">Due Date:</span>\r\n                                <span className=\"text-foreground\">\r\n                                  {format(new Date(invoice.payment_due_date || invoice.created_at), \"MMM dd, yyyy\")}\r\n                                </span>\r\n                              </div>\r\n                              {invoice.payment_date && (\r\n                                <div className=\"flex items-center gap-2 text-sm\">\r\n                                  <span className=\"font-medium text-muted-foreground\">Paid:</span>\r\n                                  <span className=\"text-green-600 font-medium\">\r\n                                    {format(new Date(invoice.payment_date), \"MMM dd, yyyy\")}\r\n                                  </span>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"flex items-baseline gap-2 pt-1\">\r\n                              <span className=\"text-sm font-medium text-muted-foreground\">Amount:</span>\r\n                              <span className=\"text-2xl font-bold text-primary\">\r\n                                â‚¹{invoice.final_selling_price?.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"flex flex-wrap gap-2 pt-2\">\r\n                              <Select \r\n                                value={invoice.invoice_status || \"pending\"}\r\n                                onValueChange={(value) => handlePaymentStatusUpdate(invoice.id, value)}\r\n                              >\r\n                                <SelectTrigger className=\"w-[150px] h-8 text-xs\">\r\n                                  <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                  <SelectItem value=\"pending\">Pending</SelectItem>\r\n                                  <SelectItem value=\"paid\">Paid</SelectItem>\r\n                                  <SelectItem value=\"overdue\">Overdue</SelectItem>\r\n                                  <SelectItem value=\"cancelled\">Cancelled</SelectItem>\r\n                                </SelectContent>\r\n                              </Select>\r\n                              {invoice.invoice_status !== \"paid\" && invoice.customer_email && (\r\n                                <Button\r\n                                  size=\"sm\"\r\n                                  variant=\"outline\"\r\n                                  onClick={() => handleSendPaymentReminder(invoice)}\r\n                                >\r\n                                  <Mail className=\"h-4 w-4 mr-2\" />\r\n                                  Send Reminder\r\n                                </Button>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 md:ml-3\">\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"default\"\r\n                            onClick={() => handleViewEstimate(invoice.id)}\r\n                            className=\"group/btn\"\r\n                          >\r\n                            <Eye className=\"h-4 w-4 mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                            View Details\r\n                          </Button>\r\n                          <Button\r\n                            size=\"default\"\r\n                            onClick={() => handleRegenerateInvoice(invoice)}\r\n                            className=\"group/btn bg-primary hover:bg-primary/90\"\r\n                          >\r\n                            <Download className=\"h-4 w-4 mr-2 transition-transform group-hover/btn:translate-y-0.5\" />\r\n                            Export PDF\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"icon\"\r\n                            onClick={() => handleDeleteClick(invoice)}\r\n                            className=\"group/btn hover:bg-destructive hover:text-destructive-foreground hover:border-destructive\"\r\n                          >\r\n                            <Trash2 className=\"h-4 w-4 transition-transform group-hover/btn:scale-110\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>Delete Invoice</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                Are you sure you want to delete invoice <strong>{invoiceToDelete?.invoice_number}</strong>? \r\n                This will permanently remove this invoice from your records. This action cannot be undone.\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={handleDeleteConfirm}\r\n                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n              >\r\n                Delete Invoice\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InvoiceHistory;\r\n"],"names":["InvoiceHistory","navigate","useNavigate","invoices","setInvoices","useState","filteredInvoices","setFilteredInvoices","searchTerm","setSearchTerm","statusFilter","setStatusFilter","paymentStatusFilter","setPaymentStatusFilter","loading","setLoading","deleteDialogOpen","setDeleteDialogOpen","invoiceToDelete","setInvoiceToDelete","selectedInvoices","setSelectedInvoices","dateFrom","setDateFrom","dateTo","setDateTo","bulkActionLoading","setBulkActionLoading","useEffect","fetchInvoices","filterInvoices","user","supabase","toast","data","error","filtered","invoice","_a","_b","_c","toggleSelectAll","inv","toggleSelectInvoice","invoiceId","newSelected","handleBulkExport","handleRegenerateInvoice","resolve","handleBulkEmail","profile","successCount","err","handleBulkStatusUpdate","newStatus","handlePaymentStatusUpdate","newPaymentStatus","updateData","handleSendPaymentReminder","dueDate","today","daysOverdue","estimateRaw","estimate","estimateDetails","estimateLineItems","vendorAddress","invoiceData","generateInvoicePDF","handleDeleteClick","handleDeleteConfirm","handleViewEstimate","jsxs","Button","jsx","ArrowLeft","Card","CardHeader","CardTitle","FileText","Badge","CardContent","Search","Input","e","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Popover","PopoverTrigger","Calendar","format","PopoverContent","CalendarComponent","Download","Mail","Checkbox","value","Eye","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"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"}