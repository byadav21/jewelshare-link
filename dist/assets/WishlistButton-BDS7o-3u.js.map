{"version":3,"file":"WishlistButton-BDS7o-3u.js","sources":["../../src/hooks/useWishlist.tsx","../../src/components/WishlistButton.tsx"],"sourcesContent":["import { useState, useEffect, useCallback } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\n/**\r\n * Generate or retrieve a persistent session ID for anonymous users\r\n * \r\n * @description Creates a unique session ID stored in localStorage that\r\n * persists across browser sessions. Used to identify wishlists for\r\n * users who haven't logged in.\r\n * \r\n * @returns The session ID string (UUID format)\r\n */\r\nconst getSessionId = (): string => {\r\n  let sessionId = localStorage.getItem('wishlist_session_id');\r\n  if (!sessionId) {\r\n    sessionId = crypto.randomUUID();\r\n    localStorage.setItem('wishlist_session_id', sessionId);\r\n  }\r\n  return sessionId;\r\n};\r\n\r\n/**\r\n * Wishlist hook return type\r\n */\r\ninterface UseWishlistReturn {\r\n  /** The current wishlist's database ID */\r\n  wishlistId: string | null;\r\n  /** Array of product IDs in the wishlist */\r\n  wishlistItems: string[];\r\n  /** Whether the wishlist is being loaded */\r\n  loading: boolean;\r\n  /** Add a product to the wishlist */\r\n  addToWishlist: (productId: string, shareLinkId?: string) => Promise<boolean>;\r\n  /** Remove a product from the wishlist */\r\n  removeFromWishlist: (productId: string) => Promise<boolean>;\r\n  /** Check if a product is in the wishlist */\r\n  isInWishlist: (productId: string) => boolean;\r\n  /** Toggle a product's wishlist status */\r\n  toggleWishlist: (productId: string, shareLinkId?: string) => Promise<boolean>;\r\n  /** Number of items in the wishlist */\r\n  itemCount: number;\r\n}\r\n\r\n/**\r\n * Custom hook for managing user wishlists\r\n * \r\n * @description Provides wishlist functionality for both authenticated users\r\n * and anonymous users (via session ID). Handles wishlist creation,\r\n * item management, and persistence to the database.\r\n * \r\n * @returns Object containing wishlist state and management functions\r\n * \r\n * @example\r\n * ```tsx\r\n * function ProductCard({ product, shareLinkId }) {\r\n *   const { isInWishlist, toggleWishlist, loading } = useWishlist();\r\n *   \r\n *   return (\r\n *     <div>\r\n *       <h3>{product.name}</h3>\r\n *       <button \r\n *         onClick={() => toggleWishlist(product.id, shareLinkId)}\r\n *         disabled={loading}\r\n *       >\r\n *         {isInWishlist(product.id) ? '‚ù§Ô∏è' : 'ü§ç'}\r\n *       </button>\r\n *     </div>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport const useWishlist = (): UseWishlistReturn => {\r\n  const [wishlistId, setWishlistId] = useState<string | null>(null);\r\n  const [wishlistItems, setWishlistItems] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  /**\r\n   * Initialize or fetch the user's wishlist\r\n   */\r\n  const initializeWishlist = useCallback(async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      const sessionId = user ? null : getSessionId();\r\n\r\n      // Try to find existing wishlist\r\n      let query = supabase.from('wishlists').select('id, wishlist_items(product_id)');\r\n\r\n      if (user) {\r\n        query = query.eq('user_id', user.id);\r\n      } else {\r\n        query = query.eq('session_id', sessionId);\r\n      }\r\n\r\n      const { data: wishlists, error } = await query.maybeSingle();\r\n\r\n      if (error && error.code !== 'PGRST116') {\r\n        console.error('Error fetching wishlist:', error);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (wishlists) {\r\n        setWishlistId(wishlists.id);\r\n        setWishlistItems(wishlists.wishlist_items?.map((item: any) => item.product_id) || []);\r\n      } else {\r\n        // Create new wishlist\r\n        const { data: newWishlist, error: createError } = await supabase\r\n          .from('wishlists')\r\n          .insert({\r\n            user_id: user?.id || null,\r\n            session_id: sessionId,\r\n            name: 'My Wishlist'\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (createError) {\r\n          console.error('Error creating wishlist:', createError);\r\n        } else if (newWishlist) {\r\n          setWishlistId(newWishlist.id);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error initializing wishlist:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Initialize wishlist on mount\r\n  useEffect(() => {\r\n    initializeWishlist();\r\n  }, [initializeWishlist]);\r\n\r\n  /**\r\n   * Add a product to the wishlist\r\n   * \r\n   * @param productId - The ID of the product to add\r\n   * @param shareLinkId - Optional share link ID for tracking\r\n   * @returns Promise resolving to success status\r\n   */\r\n  const addToWishlist = useCallback(async (productId: string, shareLinkId?: string): Promise<boolean> => {\r\n    if (!wishlistId) {\r\n      toast.error('Wishlist not initialized');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase.from('wishlist_items').insert({\r\n        wishlist_id: wishlistId,\r\n        product_id: productId,\r\n        share_link_id: shareLinkId || null\r\n      });\r\n\r\n      if (error) {\r\n        if (error.code === '23505') {\r\n          toast.info('Product already in wishlist');\r\n          return false;\r\n        }\r\n        throw error;\r\n      }\r\n\r\n      setWishlistItems(prev => [...prev, productId]);\r\n      toast.success('Added to wishlist!');\r\n      return true;\r\n    } catch (err: any) {\r\n      console.error('Error adding to wishlist:', err);\r\n      toast.error('Failed to add to wishlist');\r\n      return false;\r\n    }\r\n  }, [wishlistId]);\r\n\r\n  /**\r\n   * Remove a product from the wishlist\r\n   * \r\n   * @param productId - The ID of the product to remove\r\n   * @returns Promise resolving to success status\r\n   */\r\n  const removeFromWishlist = useCallback(async (productId: string): Promise<boolean> => {\r\n    if (!wishlistId) return false;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('wishlist_items')\r\n        .delete()\r\n        .eq('wishlist_id', wishlistId)\r\n        .eq('product_id', productId);\r\n\r\n      if (error) throw error;\r\n\r\n      setWishlistItems(prev => prev.filter(id => id !== productId));\r\n      toast.success('Removed from wishlist');\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Error removing from wishlist:', err);\r\n      toast.error('Failed to remove from wishlist');\r\n      return false;\r\n    }\r\n  }, [wishlistId]);\r\n\r\n  /**\r\n   * Check if a product is in the wishlist\r\n   * \r\n   * @param productId - The ID of the product to check\r\n   * @returns Boolean indicating if the product is in the wishlist\r\n   */\r\n  const isInWishlist = useCallback((productId: string): boolean => {\r\n    return wishlistItems.includes(productId);\r\n  }, [wishlistItems]);\r\n\r\n  /**\r\n   * Toggle a product's wishlist status\r\n   * \r\n   * @description Adds the product if not in wishlist, removes if already present\r\n   * \r\n   * @param productId - The ID of the product to toggle\r\n   * @param shareLinkId - Optional share link ID for tracking (used when adding)\r\n   * @returns Promise resolving to success status\r\n   */\r\n  const toggleWishlist = useCallback(async (productId: string, shareLinkId?: string): Promise<boolean> => {\r\n    if (isInWishlist(productId)) {\r\n      return removeFromWishlist(productId);\r\n    }\r\n    return addToWishlist(productId, shareLinkId);\r\n  }, [isInWishlist, addToWishlist, removeFromWishlist]);\r\n\r\n  return {\r\n    wishlistId,\r\n    wishlistItems,\r\n    loading,\r\n    addToWishlist,\r\n    removeFromWishlist,\r\n    isInWishlist,\r\n    toggleWishlist,\r\n    itemCount: wishlistItems.length\r\n  };\r\n};\r\n","import { useState } from \"react\";\r\nimport { Heart } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useWishlist } from \"@/hooks/useWishlist\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface WishlistButtonProps {\r\n  productId: string;\r\n  shareLinkId?: string;\r\n  variant?: \"default\" | \"icon\";\r\n  className?: string;\r\n}\r\n\r\nexport const WishlistButton = ({ \r\n  productId, \r\n  shareLinkId,\r\n  variant = \"icon\",\r\n  className \r\n}: WishlistButtonProps) => {\r\n  const { addToWishlist, removeFromWishlist, isInWishlist, loading } = useWishlist();\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const inWishlist = isInWishlist(productId);\r\n\r\n  const handleClick = async (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    \r\n    setIsAnimating(true);\r\n    setTimeout(() => setIsAnimating(false), 600);\r\n\r\n    if (inWishlist) {\r\n      await removeFromWishlist(productId);\r\n    } else {\r\n      await addToWishlist(productId, shareLinkId);\r\n    }\r\n  };\r\n\r\n  if (variant === \"icon\") {\r\n    return (\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        onClick={handleClick}\r\n        disabled={loading}\r\n        className={`h-8 w-8 hover:bg-background/80 ${className}`}\r\n      >\r\n        <motion.div\r\n          animate={isAnimating ? { scale: [1, 1.3, 1] } : {}}\r\n          transition={{ duration: 0.3 }}\r\n        >\r\n          <Heart \r\n            className={`h-4 w-4 transition-colors ${\r\n              inWishlist \r\n                ? 'fill-red-500 text-red-500' \r\n                : 'text-muted-foreground hover:text-red-500'\r\n            }`}\r\n          />\r\n        </motion.div>\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Button\r\n      variant={inWishlist ? \"default\" : \"outline\"}\r\n      size=\"sm\"\r\n      onClick={handleClick}\r\n      disabled={loading}\r\n      className={`gap-2 ${\r\n        inWishlist \r\n          ? 'bg-red-500 hover:bg-red-600 text-white' \r\n          : 'hover:bg-red-50 dark:hover:bg-red-950/20 hover:text-red-500'\r\n      } ${className}`}\r\n    >\r\n      <motion.div\r\n        animate={isAnimating ? { scale: [1, 1.3, 1] } : {}}\r\n        transition={{ duration: 0.3 }}\r\n      >\r\n        <Heart \r\n          className={`h-4 w-4 ${inWishlist ? 'fill-current' : ''}`}\r\n        />\r\n      </motion.div>\r\n      {inWishlist ? 'Saved' : 'Save'}\r\n    </Button>\r\n  );\r\n};\r\n"],"names":["getSessionId","sessionId","useWishlist","wishlistId","setWishlistId","useState","wishlistItems","setWishlistItems","loading","setLoading","initializeWishlist","useCallback","user","supabase","query","wishlists","error","_a","item","newWishlist","createError","err","useEffect","addToWishlist","productId","shareLinkId","toast","prev","removeFromWishlist","id","isInWishlist","toggleWishlist","WishlistButton","variant","className","isAnimating","setIsAnimating","inWishlist","handleClick","e","jsx","Button","motion","Heart","jsxs"],"mappings":"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"}