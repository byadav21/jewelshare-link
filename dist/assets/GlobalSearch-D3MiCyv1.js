import{u as C,j as e}from"./query-vendor-BLxHmmGk.js";import{u as D,r as _}from"./react-vendor-BeR0k5Z3.js";import{Z as H,B as G,C as y,D as v,G as L,H as T,F as u}from"./index-DGlTgSKx.js";import{I}from"./input-CEHl5GoJ.js";import{T as K,a as M,b as S,c as B}from"./tabs-DfoelxW9.js";import{B as g}from"./badge-DknkzE8c.js";import{T as P,a as k,b as N,c,d as q,e as o}from"./table-BDYxPG4d.js";import{J as Q,z as U,P as z,ab as J,h as Y,a3 as Z}from"./ui-vendor-CN4tOqpp.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-XJCymQHf.js";import"./index-BC78nHQ6.js";const ne=()=>{const w=D(),{isAdmin:b,loading:E}=H(),[h,F]=_.useState(""),{data:j,isLoading:R}=C({queryKey:["global-products"],queryFn:async()=>{const{data:s,error:a}=await u.from("products").select(`
          *,
          vendor:user_id (
            id,
            email
          )
        `).is("deleted_at",null).order("created_at",{ascending:!1});if(a)throw a;const{data:l,error:i}=await u.from("vendor_profiles").select("user_id, business_name, email, phone");if(i)throw i;return s==null?void 0:s.map(r=>({...r,vendorProfile:l==null?void 0:l.find(n=>n.user_id===r.user_id)}))},enabled:b}),{data:p,isLoading:A}=C({queryKey:["global-vendors"],queryFn:async()=>{const{data:s,error:a}=await u.from("user_approval_status").select("user_id, status, is_enabled, business_name, email, phone");if(a)throw a;const{data:l,error:i}=await u.from("vendor_profiles").select("user_id, business_name, email, phone");if(i)throw i;const{data:r,error:n}=await u.from("products").select("user_id").is("deleted_at",null);if(n)throw n;const t=r==null?void 0:r.reduce((x,f)=>(x[f.user_id]=(x[f.user_id]||0)+1,x),{});return s==null?void 0:s.map(x=>({...x,profile:l==null?void 0:l.find(f=>f.user_id===x.user_id),productCount:(t==null?void 0:t[x.user_id])||0}))},enabled:b}),d=_.useMemo(()=>{if(!h||!j)return j||[];const s=h.toLowerCase().trim();return j.filter(a=>{var i,r,n;return[a.name,a.sku,a.category,a.product_type,a.metal_type,a.gemstone,a.diamond_color,a.clarity,(i=a.vendorProfile)==null?void 0:i.business_name,(r=a.vendorProfile)==null?void 0:r.email,(n=a.vendor)==null?void 0:n.email].filter(Boolean).some(t=>t==null?void 0:t.toLowerCase().includes(s))})},[j,h]),m=_.useMemo(()=>{if(!h||!p)return p||[];const s=h.toLowerCase().trim();return p.filter(a=>{var i,r,n;return[a.business_name,a.email,a.phone,(i=a.profile)==null?void 0:i.business_name,(r=a.profile)==null?void 0:r.email,a.status,(n=a.productCount)==null?void 0:n.toString()].filter(Boolean).some(t=>t==null?void 0:t.toLowerCase().includes(s))})},[p,h]);return E?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):b?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(G,{variant:"ghost",onClick:()=>w("/super-admin"),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Global Search"})]})}),e.jsx(y,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(I,{type:"text",placeholder:"Search across all products and vendors...",value:h,onChange:s=>F(s.target.value),className:"pl-10 h-12 text-base"})]})})}),e.jsxs(K,{defaultValue:"products",className:"w-full",children:[e.jsxs(M,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(S,{value:"products",children:["Products (",(d==null?void 0:d.length)||0,")"]}),e.jsxs(S,{value:"vendors",children:["Vendors (",(m==null?void 0:m.length)||0,")"]})]}),e.jsx(B,{value:"products",className:"space-y-4",children:e.jsxs(y,{children:[e.jsx(L,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Product Results"]})}),e.jsx(v,{children:R?e.jsx("div",{className:"text-center py-8",children:"Loading products..."}):(d==null?void 0:d.length)===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No products found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(P,{children:[e.jsx(k,{children:e.jsxs(N,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"SKU"}),e.jsx(c,{children:"Vendor"}),e.jsx(c,{children:"Category"}),e.jsx(c,{children:"Price (INR)"}),e.jsx(c,{children:"Stock"})]})}),e.jsx(q,{children:d==null?void 0:d.map(s=>{var a,l,i,r;return e.jsxs(N,{children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{children:[e.jsx("div",{children:s.name}),s.product_type&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.product_type})]})}),e.jsx(o,{children:s.sku||"-"}),e.jsx(o,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:((a=s.vendorProfile)==null?void 0:a.business_name)||"N/A"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:((l=s.vendorProfile)==null?void 0:l.email)||((i=s.vendor)==null?void 0:i.email)})]})}),e.jsx(o,{children:e.jsx(g,{variant:"outline",children:s.category||"N/A"})}),e.jsxs(o,{children:["â‚¹",((r=s.retail_price)==null?void 0:r.toLocaleString())||"0"]}),e.jsx(o,{children:s.stock_quantity||0})]},s.id)})})]})})})]})}),e.jsx(B,{value:"vendors",className:"space-y-4",children:e.jsxs(y,{children:[e.jsx(L,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Vendor Results"]})}),e.jsx(v,{children:A?e.jsx("div",{className:"text-center py-8",children:"Loading vendors..."}):(m==null?void 0:m.length)===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No vendors found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(P,{children:[e.jsx(k,{children:e.jsxs(N,{children:[e.jsx(c,{children:"Business Name"}),e.jsx(c,{children:"Contact"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Products"}),e.jsx(c,{children:"Enabled"})]})}),e.jsx(q,{children:m==null?void 0:m.map(s=>{var a,l,i,r,n;return e.jsxs(N,{children:[e.jsx(o,{className:"font-medium",children:((a=s.profile)==null?void 0:a.business_name)||s.business_name||"N/A"}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-1",children:[(((l=s.profile)==null?void 0:l.email)||s.email)&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Y,{className:"h-3 w-3"}),((i=s.profile)==null?void 0:i.email)||s.email]}),(((r=s.profile)==null?void 0:r.phone)||s.phone)&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Z,{className:"h-3 w-3"}),((n=s.profile)==null?void 0:n.phone)||s.phone]})]})}),e.jsx(o,{children:e.jsx(g,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",children:s.status})}),e.jsx(o,{children:e.jsx(g,{variant:"outline",children:s.productCount})}),e.jsx(o,{children:e.jsx(g,{variant:s.is_enabled?"default":"secondary",children:s.is_enabled?"Yes":"No"})})]},s.user_id)})})]})})})]})})]})]}):(w("/"),null)};export{ne as default};
//# sourceMappingURL=GlobalSearch-D3MiCyv1.js.map
