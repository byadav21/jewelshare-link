{"version":3,"file":"useVendorPermissions-3FIyIdzZ.js","sources":["../../src/hooks/useVendorPermissions.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { getCachedUser } from \"@/lib/authCache\";\r\n\r\nexport interface VendorPermissions {\r\n  can_view_catalog: boolean;\r\n  can_add_products: boolean;\r\n  can_import_data: boolean;\r\n  can_share_catalog: boolean;\r\n  can_manage_team: boolean;\r\n  can_view_interests: boolean;\r\n  can_delete_products: boolean;\r\n  can_edit_products: boolean;\r\n  can_edit_profile: boolean;\r\n  can_add_vendor_details: boolean;\r\n  can_view_custom_orders: boolean;\r\n  can_manage_custom_orders: boolean;\r\n  can_view_share_links: boolean;\r\n  can_manage_share_links: boolean;\r\n  can_view_sessions: boolean;\r\n  can_manage_sessions: boolean;\r\n}\r\n\r\nexport const useVendorPermissions = () => {\r\n  const [permissions, setPermissions] = useState<VendorPermissions>({\r\n    can_view_catalog: true,\r\n    can_add_products: true,\r\n    can_import_data: true,\r\n    can_share_catalog: true,\r\n    can_manage_team: false,\r\n    can_view_interests: true,\r\n    can_delete_products: true,\r\n    can_edit_products: true,\r\n    can_edit_profile: true,\r\n    can_add_vendor_details: true,\r\n    can_view_custom_orders: true,\r\n    can_manage_custom_orders: false,\r\n    can_view_share_links: true,\r\n    can_manage_share_links: true,\r\n    can_view_sessions: true,\r\n    can_manage_sessions: true,\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    let channel: any;\r\n    let isMounted = true;\r\n\r\n    const fetchPermissions = async () => {\r\n      const user = await getCachedUser();\r\n      \r\n      if (!user) {\r\n        if (isMounted) setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"vendor_permissions\")\r\n        .select(\"can_view_catalog, can_add_products, can_import_data, can_share_catalog, can_manage_team, can_view_interests, can_delete_products, can_edit_products, can_edit_profile, can_add_vendor_details, can_view_custom_orders, can_manage_custom_orders, can_view_share_links, can_manage_share_links, can_view_sessions, can_manage_sessions\")\r\n        .eq(\"user_id\", user.id)\r\n        .maybeSingle();\r\n\r\n      if (!isMounted) return;\r\n\r\n      if (error) {\r\n        console.error(\"Error fetching permissions:\", error);\r\n      } else if (data) {\r\n        setPermissions({\r\n          can_view_catalog: data.can_view_catalog,\r\n          can_add_products: data.can_add_products,\r\n          can_import_data: data.can_import_data,\r\n          can_share_catalog: data.can_share_catalog,\r\n          can_manage_team: data.can_manage_team,\r\n          can_view_interests: data.can_view_interests,\r\n          can_delete_products: data.can_delete_products,\r\n          can_edit_products: data.can_edit_products,\r\n          can_edit_profile: data.can_edit_profile,\r\n          can_add_vendor_details: data.can_add_vendor_details,\r\n          can_view_custom_orders: data.can_view_custom_orders,\r\n          can_manage_custom_orders: data.can_manage_custom_orders,\r\n          can_view_share_links: data.can_view_share_links,\r\n          can_manage_share_links: data.can_manage_share_links,\r\n          can_view_sessions: data.can_view_sessions ?? true,\r\n          can_manage_sessions: data.can_manage_sessions ?? true,\r\n        });\r\n      }\r\n      \r\n      setLoading(false);\r\n\r\n      // Defer realtime subscription to not block initial load\r\n      setTimeout(() => {\r\n        if (!isMounted) return;\r\n        channel = supabase\r\n          .channel(`vendor_permissions_${user.id}`)\r\n          .on(\r\n            'postgres_changes',\r\n            {\r\n              event: 'UPDATE',\r\n              schema: 'public',\r\n              table: 'vendor_permissions',\r\n              filter: `user_id=eq.${user.id}`\r\n            },\r\n            (payload) => {\r\n              if (!isMounted) return;\r\n              const newData = payload.new as any;\r\n              setPermissions({\r\n                can_view_catalog: newData.can_view_catalog,\r\n                can_add_products: newData.can_add_products,\r\n                can_import_data: newData.can_import_data,\r\n                can_share_catalog: newData.can_share_catalog,\r\n                can_manage_team: newData.can_manage_team,\r\n                can_view_interests: newData.can_view_interests,\r\n                can_delete_products: newData.can_delete_products,\r\n                can_edit_products: newData.can_edit_products,\r\n                can_edit_profile: newData.can_edit_profile,\r\n                can_add_vendor_details: newData.can_add_vendor_details,\r\n                can_view_custom_orders: newData.can_view_custom_orders,\r\n                can_manage_custom_orders: newData.can_manage_custom_orders,\r\n                can_view_share_links: newData.can_view_share_links,\r\n                can_manage_share_links: newData.can_manage_share_links,\r\n                can_view_sessions: newData.can_view_sessions ?? true,\r\n                can_manage_sessions: newData.can_manage_sessions ?? true,\r\n              });\r\n            }\r\n          )\r\n          .subscribe();\r\n      }, 1000);\r\n    };\r\n\r\n    fetchPermissions();\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      if (channel) {\r\n        supabase.removeChannel(channel);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return { permissions, loading };\r\n};\r\n"],"names":["useVendorPermissions","permissions","setPermissions","useState","loading","setLoading","useEffect","channel","isMounted","user","getCachedUser","data","error","supabase","payload","newData"],"mappings":"8FAuBO,MAAMA,EAAuB,IAAM,CACxC,KAAM,CAACC,EAAaC,CAAc,EAAIC,WAA4B,CAChE,iBAAkB,GAClB,iBAAkB,GAClB,gBAAiB,GACjB,kBAAmB,GACnB,gBAAiB,GACjB,mBAAoB,GACpB,oBAAqB,GACrB,kBAAmB,GACnB,iBAAkB,GAClB,uBAAwB,GACxB,uBAAwB,GACxB,yBAA0B,GAC1B,qBAAsB,GACtB,uBAAwB,GACxB,kBAAmB,GACnB,oBAAqB,EAAA,CACtB,EACK,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAE3CG,OAAAA,EAAAA,UAAU,IAAM,CACd,IAAIC,EACAC,EAAY,GAmFhB,OAjFyB,SAAY,CACnC,MAAMC,EAAO,MAAMC,EAAA,EAEnB,GAAI,CAACD,EAAM,CACLD,KAAsB,EAAK,EAC/B,MACF,CAEA,KAAM,CAAE,KAAAG,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAC3B,KAAK,oBAAoB,EACzB,OAAO,uUAAuU,EAC9U,GAAG,UAAWJ,EAAK,EAAE,EACrB,YAAA,EAEED,IAEDI,EACF,QAAQ,MAAM,8BAA+BA,CAAK,EACzCD,GACTT,EAAe,CACb,iBAAkBS,EAAK,iBACvB,iBAAkBA,EAAK,iBACvB,gBAAiBA,EAAK,gBACtB,kBAAmBA,EAAK,kBACxB,gBAAiBA,EAAK,gBACtB,mBAAoBA,EAAK,mBACzB,oBAAqBA,EAAK,oBAC1B,kBAAmBA,EAAK,kBACxB,iBAAkBA,EAAK,iBACvB,uBAAwBA,EAAK,uBAC7B,uBAAwBA,EAAK,uBAC7B,yBAA0BA,EAAK,yBAC/B,qBAAsBA,EAAK,qBAC3B,uBAAwBA,EAAK,uBAC7B,kBAAmBA,EAAK,mBAAqB,GAC7C,oBAAqBA,EAAK,qBAAuB,EAAA,CAClD,EAGHN,EAAW,EAAK,EAGhB,WAAW,IAAM,CACVG,IACLD,EAAUM,EACP,QAAQ,sBAAsBJ,EAAK,EAAE,EAAE,EACvC,GACC,mBACA,CACE,MAAO,SACP,OAAQ,SACR,MAAO,qBACP,OAAQ,cAAcA,EAAK,EAAE,EAAA,EAE9BK,GAAY,CACX,GAAI,CAACN,EAAW,OAChB,MAAMO,EAAUD,EAAQ,IACxBZ,EAAe,CACb,iBAAkBa,EAAQ,iBAC1B,iBAAkBA,EAAQ,iBAC1B,gBAAiBA,EAAQ,gBACzB,kBAAmBA,EAAQ,kBAC3B,gBAAiBA,EAAQ,gBACzB,mBAAoBA,EAAQ,mBAC5B,oBAAqBA,EAAQ,oBAC7B,kBAAmBA,EAAQ,kBAC3B,iBAAkBA,EAAQ,iBAC1B,uBAAwBA,EAAQ,uBAChC,uBAAwBA,EAAQ,uBAChC,yBAA0BA,EAAQ,yBAClC,qBAAsBA,EAAQ,qBAC9B,uBAAwBA,EAAQ,uBAChC,kBAAmBA,EAAQ,mBAAqB,GAChD,oBAAqBA,EAAQ,qBAAuB,EAAA,CACrD,CACH,CAAA,EAED,UAAA,EACL,EAAG,GAAI,EACT,GAEA,EAEO,IAAM,CACXP,EAAY,GACRD,GACFM,EAAS,cAAcN,CAAO,CAElC,CACF,EAAG,CAAA,CAAE,EAEE,CAAE,YAAAN,EAAa,QAAAG,CAAA,CACxB"}