{"version":3,"file":"OptimizedImage-DQ051bg0.js","sources":["../../src/components/OptimizedImage.tsx"],"sourcesContent":["/**\r\n * Optimized Image component with lazy loading and modern formats\r\n * Automatically handles WebP/AVIF with fallbacks, lazy loading, and responsive images\r\n */\r\n\r\nimport { useState, useEffect, useRef, ImgHTMLAttributes } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\n\r\ninterface OptimizedImageProps extends Omit<ImgHTMLAttributes<HTMLImageElement>, \"src\"> {\r\n  src: string;\r\n  alt: string;\r\n  width?: number;\r\n  height?: number;\r\n  lazy?: boolean;\r\n  priority?: boolean;\r\n  quality?: number;\r\n  sizes?: string;\r\n  className?: string;\r\n  objectFit?: \"contain\" | \"cover\" | \"fill\" | \"none\" | \"scale-down\";\r\n  onLoad?: () => void;\r\n  onError?: () => void;\r\n}\r\n\r\nexport const OptimizedImage = ({\r\n  src,\r\n  alt,\r\n  width,\r\n  height,\r\n  lazy = true,\r\n  priority = false,\r\n  quality = 85,\r\n  sizes,\r\n  className,\r\n  objectFit = \"cover\",\r\n  onLoad,\r\n  onError,\r\n  ...props\r\n}: OptimizedImageProps) => {\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n  const [hasError, setHasError] = useState(false);\r\n  const [isInView, setIsInView] = useState(!lazy || priority);\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const observerRef = useRef<IntersectionObserver | null>(null);\r\n\r\n  // Lazy loading with Intersection Observer\r\n  useEffect(() => {\r\n    if (!lazy || priority || isInView) return;\r\n\r\n    observerRef.current = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting) {\r\n            setIsInView(true);\r\n            observerRef.current?.disconnect();\r\n          }\r\n        });\r\n      },\r\n      {\r\n        rootMargin: \"50px\", // Start loading 50px before entering viewport\r\n      }\r\n    );\r\n\r\n    if (imgRef.current) {\r\n      observerRef.current.observe(imgRef.current);\r\n    }\r\n\r\n    return () => {\r\n      observerRef.current?.disconnect();\r\n    };\r\n  }, [lazy, priority, isInView]);\r\n\r\n  // Generate srcset for responsive images\r\n  const generateSrcSet = (baseSrc: string): string => {\r\n    if (!width) return baseSrc;\r\n    \r\n    const widths = [320, 640, 768, 1024, 1920];\r\n    return widths\r\n      .map((w) => `${baseSrc}?w=${w}&q=${quality} ${w}w`)\r\n      .join(\", \");\r\n  };\r\n\r\n  // Generate WebP and AVIF sources\r\n  const getImageSources = () => {\r\n    const sources = [];\r\n    \r\n    // AVIF (best compression, if supported)\r\n    sources.push(\r\n      <source\r\n        key=\"avif\"\r\n        type=\"image/avif\"\r\n        srcSet={`${src}?format=avif&q=${quality}`}\r\n      />\r\n    );\r\n    \r\n    // WebP (good compression, widely supported)\r\n    sources.push(\r\n      <source\r\n        key=\"webp\"\r\n        type=\"image/webp\"\r\n        srcSet={generateSrcSet(src)}\r\n        sizes={sizes}\r\n      />\r\n    );\r\n    \r\n    return sources;\r\n  };\r\n\r\n  const handleLoad = () => {\r\n    setIsLoaded(true);\r\n    onLoad?.();\r\n  };\r\n\r\n  const handleError = () => {\r\n    setHasError(true);\r\n    onError?.();\r\n  };\r\n\r\n  const imageClasses = cn(\r\n    \"transition-opacity duration-300 max-w-full h-auto\",\r\n    isLoaded ? \"opacity-100\" : \"opacity-0\",\r\n    className\r\n  );\r\n\r\n  const objectFitClass = {\r\n    contain: \"object-contain\",\r\n    cover: \"object-cover\",\r\n    fill: \"object-fill\",\r\n    none: \"object-none\",\r\n    \"scale-down\": \"object-scale-down\",\r\n  }[objectFit];\r\n\r\n  // Show skeleton while loading\r\n  if (!isInView) {\r\n    return (\r\n      <div\r\n        ref={imgRef}\r\n        className={cn(\"relative\", className)}\r\n        style={{ width, height }}\r\n      >\r\n        <Skeleton className=\"w-full h-full\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show error state\r\n  if (hasError) {\r\n    return (\r\n      <div\r\n        className={cn(\r\n          \"flex items-center justify-center bg-muted text-muted-foreground\",\r\n          className\r\n        )}\r\n        style={{ width, height }}\r\n      >\r\n        <span className=\"text-sm\">Failed to load image</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={cn(\"relative\", !isLoaded && \"overflow-hidden\")}>\r\n      {!isLoaded && <Skeleton className=\"absolute inset-0\" />}\r\n      \r\n      <picture>\r\n        {getImageSources()}\r\n        \r\n        {/* Fallback to original format */}\r\n        <img\r\n          ref={imgRef}\r\n          src={src}\r\n          alt={alt}\r\n          width={width}\r\n          height={height}\r\n          loading={lazy && !priority ? \"lazy\" : \"eager\"}\r\n          decoding={priority ? \"sync\" : \"async\"}\r\n          onLoad={handleLoad}\r\n          onError={handleError}\r\n          className={cn(imageClasses, objectFitClass)}\r\n          {...props}\r\n        />\r\n      </picture>\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Background Image component with lazy loading\r\n */\r\ninterface OptimizedBackgroundImageProps {\r\n  src: string;\r\n  className?: string;\r\n  children?: React.ReactNode;\r\n  lazy?: boolean;\r\n  overlay?: boolean;\r\n  overlayOpacity?: number;\r\n}\r\n\r\nexport const OptimizedBackgroundImage = ({\r\n  src,\r\n  className,\r\n  children,\r\n  lazy = true,\r\n  overlay = false,\r\n  overlayOpacity = 0.5,\r\n}: OptimizedBackgroundImageProps) => {\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n  const [isInView, setIsInView] = useState(!lazy);\r\n  const divRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!lazy || isInView) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting) {\r\n            setIsInView(true);\r\n            observer.disconnect();\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"50px\" }\r\n    );\r\n\r\n    if (divRef.current) {\r\n      observer.observe(divRef.current);\r\n    }\r\n\r\n    return () => observer.disconnect();\r\n  }, [lazy, isInView]);\r\n\r\n  useEffect(() => {\r\n    if (!isInView) return;\r\n\r\n    const img = new Image();\r\n    img.onload = () => setIsLoaded(true);\r\n    img.src = src;\r\n  }, [isInView, src]);\r\n\r\n  return (\r\n    <div\r\n      ref={divRef}\r\n      className={cn(\"relative\", className)}\r\n      style={{\r\n        backgroundImage: isLoaded ? `url(${src})` : undefined,\r\n        backgroundSize: \"cover\",\r\n        backgroundPosition: \"center\",\r\n      }}\r\n    >\r\n      {!isLoaded && <Skeleton className=\"absolute inset-0\" />}\r\n      \r\n      {overlay && isLoaded && (\r\n        <div\r\n          className=\"absolute inset-0 bg-background\"\r\n          style={{ opacity: overlayOpacity }}\r\n        />\r\n      )}\r\n      \r\n      <div className=\"relative z-10\">{children}</div>\r\n    </div>\r\n  );\r\n};\r\n"],"names":["OptimizedImage","src","alt","width","height","lazy","priority","quality","sizes","className","objectFit","onLoad","onError","props","isLoaded","setIsLoaded","useState","hasError","setHasError","isInView","setIsInView","imgRef","useRef","observerRef","useEffect","entries","entry","_a","generateSrcSet","baseSrc","w","getImageSources","sources","jsx","handleLoad","handleError","imageClasses","cn","objectFitClass","jsxs","Skeleton","OptimizedBackgroundImage","children","overlay","overlayOpacity","divRef","observer","img"],"mappings":"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"}