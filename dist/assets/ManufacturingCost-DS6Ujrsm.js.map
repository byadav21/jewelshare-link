{"version":3,"file":"ManufacturingCost-DS6Ujrsm.js","sources":["../../src/components/estimate/EstimateWorkflowSteps.tsx","../../src/components/estimate/EstimateFlowGuide.tsx","../../src/components/estimate/BasicInfoSection.tsx","../../src/components/estimate/CostingSection.tsx","../../src/components/estimate/PricingSection.tsx","../../src/components/estimate/ReviewSection.tsx","../../src/hooks/useEstimateWorkflow.ts","../../src/components/InvoiceLineItems.tsx","../../src/components/InvoicePreviewDialog.tsx","../../src/pages/ManufacturingCost.tsx"],"sourcesContent":["import { Check } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface Step {\r\n  id: number;\r\n  title: string;\r\n  description: string;\r\n}\r\n\r\ninterface EstimateWorkflowStepsProps {\r\n  currentStep: number;\r\n  steps: Step[];\r\n}\r\n\r\nexport const EstimateWorkflowSteps = ({ currentStep, steps }: EstimateWorkflowStepsProps) => {\r\n  return (\r\n    <div className=\"w-full py-8\">\r\n      <div className=\"flex items-center justify-between\">\r\n        {steps.map((step, index) => (\r\n          <div key={step.id} className=\"flex flex-1 items-center\">\r\n            {/* Step Circle */}\r\n            <div className=\"flex flex-col items-center\">\r\n              <div\r\n                className={cn(\r\n                  \"flex h-12 w-12 items-center justify-center rounded-full border-2 transition-all duration-300\",\r\n                  currentStep > step.id\r\n                    ? \"border-primary bg-primary text-primary-foreground\"\r\n                    : currentStep === step.id\r\n                    ? \"border-primary bg-background text-primary animate-pulse\"\r\n                    : \"border-muted-foreground/30 bg-background text-muted-foreground\"\r\n                )}\r\n              >\r\n                {currentStep > step.id ? (\r\n                  <Check className=\"h-6 w-6\" />\r\n                ) : (\r\n                  <span className=\"text-sm font-bold\">{step.id}</span>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Step Label */}\r\n              <div className=\"mt-2 text-center max-w-[120px]\">\r\n                <p\r\n                  className={cn(\r\n                    \"text-sm font-semibold transition-colors\",\r\n                    currentStep >= step.id\r\n                      ? \"text-foreground\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                >\r\n                  {step.title}\r\n                </p>\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  {step.description}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Connector Line */}\r\n            {index < steps.length - 1 && (\r\n              <div\r\n                className={cn(\r\n                  \"h-0.5 flex-1 mx-4 transition-all duration-300\",\r\n                  currentStep > step.id\r\n                    ? \"bg-primary\"\r\n                    : \"bg-muted-foreground/30\"\r\n                )}\r\n              />\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { \r\n  FileText, \r\n  Calculator, \r\n  Diamond, \r\n  IndianRupee, \r\n  TrendingUp,\r\n  Save,\r\n  FileCheck,\r\n  Info,\r\n  ArrowRight\r\n} from \"lucide-react\";\r\n\r\n/**\r\n * EstimateFlowGuide Component\r\n * \r\n * Provides visual guidance on the estimate creation and invoice generation workflow.\r\n * Helps users understand the difference between estimates and invoices.\r\n */\r\nexport const EstimateFlowGuide = () => {\r\n  return (\r\n    <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 via-background to-accent/5\">\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <Info className=\"h-5 w-5 text-primary\" />\r\n          Estimate vs Invoice - Quick Guide\r\n        </CardTitle>\r\n        <CardDescription>\r\n          Understanding the workflow from cost estimation to final invoice\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Estimate Section */}\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Calculator className=\"h-5 w-5 text-primary\" />\r\n            <h3 className=\"font-semibold text-lg\">Step 1: Create Estimate</h3>\r\n          </div>\r\n          <div className=\"pl-7 space-y-2 text-sm text-muted-foreground\">\r\n            <p className=\"flex items-center gap-2\">\r\n              <Diamond className=\"h-4 w-4\" />\r\n              Enter jewelry specifications (weight, purity, diamonds, gemstones)\r\n            </p>\r\n            <p className=\"flex items-center gap-2\">\r\n              <IndianRupee className=\"h-4 w-4\" />\r\n              Calculate manufacturing costs (gold, making charges, CAD, certification)\r\n            </p>\r\n            <p className=\"flex items-center gap-2\">\r\n              <TrendingUp className=\"h-4 w-4\" />\r\n              Set profit margin to determine selling price\r\n            </p>\r\n            <p className=\"flex items-center gap-2\">\r\n              <Save className=\"h-4 w-4\" />\r\n              Save as <span className=\"font-semibold text-foreground\">Draft</span> for future reference\r\n            </p>\r\n          </div>\r\n          \r\n          <Alert className=\"bg-primary/5 border-primary/20\">\r\n            <AlertDescription className=\"text-sm\">\r\n              <strong>Estimates</strong> are for quotations and internal calculations. \r\n              They can be modified anytime and don't require complete customer details.\r\n            </AlertDescription>\r\n          </Alert>\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-center\">\r\n          <ArrowRight className=\"h-6 w-6 text-muted-foreground\" />\r\n        </div>\r\n\r\n        <Separator />\r\n\r\n        {/* Invoice Section */}\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <FileCheck className=\"h-5 w-5 text-accent\" />\r\n            <h3 className=\"font-semibold text-lg\">Step 2: Generate Invoice</h3>\r\n          </div>\r\n          <div className=\"pl-7 space-y-2 text-sm text-muted-foreground\">\r\n            <p className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-4 w-4\" />\r\n              Convert approved estimate to professional invoice\r\n            </p>\r\n            <p>• Add invoice number (auto-generated)</p>\r\n            <p>• Set payment terms and due date</p>\r\n            <p>• Include customer name (mandatory for invoices)</p>\r\n            <p>• Choose invoice template style</p>\r\n          </div>\r\n          \r\n          <Alert className=\"bg-accent/5 border-accent/20\">\r\n            <AlertDescription className=\"text-sm\">\r\n              <strong>Invoices</strong> are final billing documents with unique numbers. \r\n              Once generated, they're stored separately in Invoice History for record-keeping.\r\n            </AlertDescription>\r\n          </Alert>\r\n        </div>\r\n\r\n        {/* Quick Actions */}\r\n        <div className=\"mt-6 p-4 bg-muted/30 rounded-lg border\">\r\n          <p className=\"text-sm font-semibold mb-2\">Quick Actions:</p>\r\n          <div className=\"grid grid-cols-2 gap-2 text-xs text-muted-foreground\">\r\n            <div>✓ Save Estimate → Draft status</div>\r\n            <div>✓ Export Estimate PDF → Quotation</div>\r\n            <div>✓ Generate Invoice → Final bill</div>\r\n            <div>✓ View History → Past records</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Status Workflow */}\r\n        <div className=\"p-4 bg-gradient-to-r from-primary/10 via-accent/10 to-primary/10 rounded-lg\">\r\n          <p className=\"text-sm font-semibold mb-2\">Status Workflow:</p>\r\n          <div className=\"flex items-center gap-2 text-xs\">\r\n            <span className=\"px-2 py-1 bg-background rounded border\">Draft</span>\r\n            <ArrowRight className=\"h-3 w-3\" />\r\n            <span className=\"px-2 py-1 bg-background rounded border\">Quoted</span>\r\n            <ArrowRight className=\"h-3 w-3\" />\r\n            <span className=\"px-2 py-1 bg-background rounded border\">Approved</span>\r\n            <ArrowRight className=\"h-3 w-3\" />\r\n            <span className=\"px-2 py-1 bg-background rounded border\">In Production</span>\r\n            <ArrowRight className=\"h-3 w-3\" />\r\n            <span className=\"px-2 py-1 bg-background rounded border text-accent font-semibold\">Completed</span>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Building2, User } from \"lucide-react\";\r\n\r\ninterface VendorProfile {\r\n  business_name?: string;\r\n  logo_url?: string;\r\n  address_line1?: string;\r\n  address_line2?: string;\r\n  city?: string;\r\n  state?: string;\r\n  pincode?: string;\r\n  country?: string;\r\n  phone?: string;\r\n  email?: string;\r\n}\r\n\r\ninterface CustomerDetails {\r\n  name: string;\r\n  phone: string;\r\n  email: string;\r\n  address: string;\r\n  gstin: string;\r\n}\r\n\r\ninterface BasicInfoSectionProps {\r\n  vendorProfile: VendorProfile | null;\r\n  vendorGSTIN: string;\r\n  onVendorGSTINChange: (value: string) => void;\r\n  customerDetails: CustomerDetails;\r\n  onCustomerDetailsChange: (details: CustomerDetails) => void;\r\n}\r\n\r\nexport const BasicInfoSection = ({\r\n  vendorProfile,\r\n  vendorGSTIN,\r\n  onVendorGSTINChange,\r\n  customerDetails,\r\n  onCustomerDetailsChange,\r\n}: BasicInfoSectionProps) => {\r\n  const handleCustomerChange = (field: keyof CustomerDetails, value: string) => {\r\n    onCustomerDetailsChange({\r\n      ...customerDetails,\r\n      [field]: value,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n      {/* Vertical Separator - only visible on md+ screens */}\r\n      <div className=\"hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-border to-transparent transform -translate-x-1/2\" />\r\n      \r\n      {/* Vendor Details (Auto-fetched) */}\r\n      <Card className=\"border-primary/20 shadow-sm relative z-10\">\r\n        <CardHeader className=\"bg-gradient-to-r from-primary/10 to-primary/5 border-b border-primary/10\">\r\n          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n            <Building2 className=\"h-5 w-5 text-primary\" />\r\n            Vendor Details\r\n          </CardTitle>\r\n          <CardDescription>Your business information</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"pt-6 bg-primary/5\">\r\n          {vendorProfile ? (\r\n            <div className=\"space-y-4\">\r\n              {vendorProfile.logo_url && (\r\n                <div className=\"flex justify-center mb-4\">\r\n                  <img \r\n                    src={vendorProfile.logo_url} \r\n                    alt=\"Vendor Logo\" \r\n                    className=\"h-20 w-auto object-contain\" \r\n                  />\r\n                </div>\r\n              )}\r\n              <div className=\"space-y-3 text-sm\">\r\n                <div className=\"border-b border-border pb-2\">\r\n                  <p className=\"font-semibold text-foreground\">\r\n                    {vendorProfile.business_name || 'Business Name'}\r\n                  </p>\r\n                </div>\r\n                {(vendorProfile.address_line1 || vendorProfile.city || vendorProfile.state) && (\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground mb-1\">Address</p>\r\n                    <p className=\"text-foreground leading-relaxed\">\r\n                      {[\r\n                        vendorProfile.address_line1,\r\n                        vendorProfile.address_line2,\r\n                        vendorProfile.city,\r\n                        vendorProfile.state,\r\n                        vendorProfile.pincode,\r\n                        vendorProfile.country,\r\n                      ]\r\n                        .filter(Boolean)\r\n                        .join(', ')}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n                {vendorProfile.phone && (\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground mb-1\">Phone</p>\r\n                    <p className=\"text-foreground\">{vendorProfile.phone}</p>\r\n                  </div>\r\n                )}\r\n                {vendorProfile.email && (\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground mb-1\">Email</p>\r\n                    <p className=\"text-foreground\">{vendorProfile.email}</p>\r\n                  </div>\r\n                )}\r\n                <div>\r\n                  <Label htmlFor=\"vendor-gstin\" className=\"text-xs text-muted-foreground mb-1\">\r\n                    GSTIN (Optional)\r\n                  </Label>\r\n                  <Input\r\n                    id=\"vendor-gstin\"\r\n                    value={vendorGSTIN}\r\n                    onChange={(e) => onVendorGSTINChange(e.target.value)}\r\n                    placeholder=\"Enter GSTIN\"\r\n                    className=\"mt-1.5\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-sm text-muted-foreground py-4\">Loading vendor details...</p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Customer Details (Input fields) */}\r\n      <Card className=\"border-accent/20 shadow-sm relative z-10\">\r\n        <CardHeader className=\"bg-gradient-to-r from-accent/10 to-accent/5 border-b border-accent/10\">\r\n          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n            <User className=\"h-5 w-5 text-accent\" />\r\n            Customer Details\r\n          </CardTitle>\r\n          <CardDescription>Enter customer information</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"pt-6 bg-accent/5\">\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label htmlFor=\"customer-name\" className=\"text-sm font-medium\">\r\n                Customer Name *\r\n              </Label>\r\n              <Input\r\n                id=\"customer-name\"\r\n                value={customerDetails.name}\r\n                onChange={(e) => handleCustomerChange('name', e.target.value)}\r\n                placeholder=\"Enter customer name\"\r\n                className=\"mt-1.5\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"customer-phone\" className=\"text-sm font-medium\">\r\n                Phone Number\r\n              </Label>\r\n              <Input\r\n                id=\"customer-phone\"\r\n                value={customerDetails.phone}\r\n                onChange={(e) => handleCustomerChange('phone', e.target.value)}\r\n                placeholder=\"Enter phone number\"\r\n                className=\"mt-1.5\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"customer-email\" className=\"text-sm font-medium\">\r\n                Email Address\r\n              </Label>\r\n              <Input\r\n                id=\"customer-email\"\r\n                type=\"email\"\r\n                value={customerDetails.email}\r\n                onChange={(e) => handleCustomerChange('email', e.target.value)}\r\n                placeholder=\"Enter email address\"\r\n                className=\"mt-1.5\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"customer-address\" className=\"text-sm font-medium\">\r\n                Address\r\n              </Label>\r\n              <Textarea\r\n                id=\"customer-address\"\r\n                value={customerDetails.address}\r\n                onChange={(e) => handleCustomerChange('address', e.target.value)}\r\n                placeholder=\"Enter customer address\"\r\n                className=\"mt-1.5 min-h-[90px]\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"customer-gstin\" className=\"text-sm font-medium\">\r\n                GSTIN (Optional)\r\n              </Label>\r\n              <Input\r\n                id=\"customer-gstin\"\r\n                value={customerDetails.gstin}\r\n                onChange={(e) => handleCustomerChange('gstin', e.target.value)}\r\n                placeholder=\"Enter customer GSTIN\"\r\n                className=\"mt-1.5\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Percent, IndianRupee } from \"lucide-react\";\r\n\r\ninterface CostingSectionProps {\r\n  gstMode: 'sgst_cgst' | 'igst';\r\n  onGstModeChange: (mode: 'sgst_cgst' | 'igst') => void;\r\n  sgstPercentage: number;\r\n  cgstPercentage: number;\r\n  igstPercentage: number;\r\n  onSgstChange: (value: number) => void;\r\n  onCgstChange: (value: number) => void;\r\n  onIgstChange: (value: number) => void;\r\n  shippingCharges: number;\r\n  onShippingChargesChange: (value: number) => void;\r\n  shippingZone: string;\r\n  onShippingZoneChange: (value: string) => void;\r\n  exchangeRate: number;\r\n  onExchangeRateChange: (value: number) => void;\r\n  costs: {\r\n    finalSellingPrice: number;\r\n    sgstAmount: number;\r\n    cgstAmount: number;\r\n    igstAmount: number;\r\n    grandTotal: number;\r\n    totalInUSD: number;\r\n  };\r\n}\r\n\r\nexport const CostingSection = ({\r\n  gstMode,\r\n  onGstModeChange,\r\n  sgstPercentage,\r\n  cgstPercentage,\r\n  igstPercentage,\r\n  onSgstChange,\r\n  onCgstChange,\r\n  onIgstChange,\r\n  shippingCharges,\r\n  onShippingChargesChange,\r\n  shippingZone,\r\n  exchangeRate,\r\n  onExchangeRateChange,\r\n  costs,\r\n}: CostingSectionProps) => {\r\n  const applyQuickGSTRate = (rate: number) => {\r\n    if (gstMode === 'sgst_cgst') {\r\n      onSgstChange(rate / 2);\r\n      onCgstChange(rate / 2);\r\n    } else {\r\n      onIgstChange(rate);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <Percent className=\"h-5 w-5 text-primary\" />\r\n          Tax, Shipping & Currency\r\n        </CardTitle>\r\n        <CardDescription>Configure GST, shipping charges, and currency conversion</CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        {/* GST Mode Selection */}\r\n        <div className=\"space-y-3\">\r\n          <Label className=\"text-sm font-semibold\">GST Type</Label>\r\n          <div className=\"flex gap-4\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <input\r\n                type=\"radio\"\r\n                id=\"sgst-cgst-mode\"\r\n                checked={gstMode === 'sgst_cgst'}\r\n                onChange={() => onGstModeChange('sgst_cgst')}\r\n                className=\"h-4 w-4\"\r\n              />\r\n              <Label htmlFor=\"sgst-cgst-mode\" className=\"text-sm cursor-pointer\">\r\n                SGST + CGST (Intra-State)\r\n              </Label>\r\n            </div>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <input\r\n                type=\"radio\"\r\n                id=\"igst-mode\"\r\n                checked={gstMode === 'igst'}\r\n                onChange={() => onGstModeChange('igst')}\r\n                className=\"h-4 w-4\"\r\n              />\r\n              <Label htmlFor=\"igst-mode\" className=\"text-sm cursor-pointer\">\r\n                IGST (Inter-State)\r\n              </Label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* GST Rate Presets */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm font-semibold\">Quick GST Rate Selection</Label>\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            {[0, 3, 5, 12, 18, 28].map((rate) => (\r\n              <Button\r\n                key={rate}\r\n                type=\"button\"\r\n                variant={\r\n                  (gstMode === 'sgst_cgst' && sgstPercentage === rate / 2) ||\r\n                  (gstMode === 'igst' && igstPercentage === rate)\r\n                    ? 'default'\r\n                    : 'outline'\r\n                }\r\n                size=\"sm\"\r\n                onClick={() => applyQuickGSTRate(rate)}\r\n              >\r\n                {rate}%\r\n              </Button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* GST Input Fields */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          {gstMode === 'sgst_cgst' ? (\r\n            <>\r\n              <div className=\"space-y-1\">\r\n                <Label htmlFor=\"sgst\" className=\"text-sm\">\r\n                  SGST (%)\r\n                </Label>\r\n                <Input\r\n                  id=\"sgst\"\r\n                  type=\"number\"\r\n                  min={0}\r\n                  max={100}\r\n                  step={0.1}\r\n                  value={sgstPercentage}\r\n                  onChange={(e) => onSgstChange(parseFloat(e.target.value) || 0)}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-1\">\r\n                <Label htmlFor=\"cgst\" className=\"text-sm\">\r\n                  CGST (%)\r\n                </Label>\r\n                <Input\r\n                  id=\"cgst\"\r\n                  type=\"number\"\r\n                  min={0}\r\n                  max={100}\r\n                  step={0.1}\r\n                  value={cgstPercentage}\r\n                  onChange={(e) => onCgstChange(parseFloat(e.target.value) || 0)}\r\n                />\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div className=\"space-y-1 md:col-span-2\">\r\n              <Label htmlFor=\"igst\" className=\"text-sm\">\r\n                IGST (%)\r\n              </Label>\r\n              <Input\r\n                id=\"igst\"\r\n                type=\"number\"\r\n                min={0}\r\n                max={100}\r\n                step={0.1}\r\n                value={igstPercentage}\r\n                onChange={(e) => onIgstChange(parseFloat(e.target.value) || 0)}\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"space-y-1\">\r\n            <Label htmlFor=\"exchange-rate\" className=\"text-sm\">\r\n              Exchange Rate (USD to INR)\r\n            </Label>\r\n            <Input\r\n              id=\"exchange-rate\"\r\n              type=\"number\"\r\n              min={0}\r\n              step={0.01}\r\n              value={exchangeRate}\r\n              onChange={(e) => onExchangeRateChange(parseFloat(e.target.value) || 0)}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Manual Shipping Charges Override */}\r\n        <div className=\"space-y-1\">\r\n          <Label htmlFor=\"shipping\" className=\"text-sm\">\r\n            Shipping Charges (₹) - Manual Override\r\n          </Label>\r\n          <div className=\"relative\">\r\n            <IndianRupee className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              id=\"shipping\"\r\n              type=\"number\"\r\n              min={0}\r\n              step={0.01}\r\n              value={shippingCharges}\r\n              onChange={(e) => onShippingChargesChange(parseFloat(e.target.value) || 0)}\r\n              className=\"pl-9\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Cost Breakdown Display */}\r\n        <div className=\"border-t pt-4 space-y-3\">\r\n          <h4 className=\"font-semibold text-sm text-muted-foreground\">Cost Breakdown</h4>\r\n          <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n            <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded\">\r\n              <span className=\"text-muted-foreground\">Subtotal (Before Tax):</span>\r\n              <span className=\"font-semibold\">₹{costs.finalSellingPrice.toLocaleString('en-IN')}</span>\r\n            </div>\r\n\r\n            {gstMode === 'sgst_cgst' ? (\r\n              <>\r\n                <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded\">\r\n                  <span className=\"text-muted-foreground\">SGST ({sgstPercentage}%):</span>\r\n                  <span className=\"font-semibold\">₹{costs.sgstAmount.toLocaleString('en-IN')}</span>\r\n                </div>\r\n\r\n                <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded\">\r\n                  <span className=\"text-muted-foreground\">CGST ({cgstPercentage}%):</span>\r\n                  <span className=\"font-semibold\">₹{costs.cgstAmount.toLocaleString('en-IN')}</span>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded\">\r\n                <span className=\"text-muted-foreground\">IGST ({igstPercentage}%):</span>\r\n                <span className=\"font-semibold\">₹{costs.igstAmount.toLocaleString('en-IN')}</span>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded\">\r\n              <span className=\"text-muted-foreground\">Shipping ({shippingZone}):</span>\r\n              <span className=\"font-semibold\">₹{shippingCharges.toLocaleString('en-IN')}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"border-t pt-3 mt-3\">\r\n            <div className=\"flex justify-between items-center p-3 bg-primary/10 rounded-lg\">\r\n              <span className=\"font-bold text-lg\">Grand Total (INR):</span>\r\n              <span className=\"font-bold text-xl text-primary\">\r\n                ₹{costs.grandTotal.toLocaleString('en-IN')}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between items-center p-3 bg-accent/10 rounded-lg mt-2\">\r\n              <span className=\"font-semibold\">Equivalent (USD):</span>\r\n              <span className=\"font-semibold text-lg text-accent\">\r\n                ${costs.totalInUSD.toLocaleString('en-US')}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { TrendingUp } from \"lucide-react\";\r\n\r\ninterface Costs {\r\n  goldCost: number;\r\n  totalCost: number;\r\n  finalSellingPrice: number;\r\n  profitAmount: number;\r\n  grandTotal: number;\r\n}\r\n\r\ninterface FormData {\r\n  diamondPerCaratPrice: number;\r\n  diamondWeight: number;\r\n  gemstonePerCaratPrice: number;\r\n  gemstoneWeight: number;\r\n  makingCharges: number;\r\n  cadDesignCharges: number;\r\n  cammingCharges: number;\r\n  certificationCost: number;\r\n}\r\n\r\ninterface PricingSectionProps {\r\n  profitMargin: number;\r\n  onProfitMarginChange: (value: number) => void;\r\n  costs: Costs;\r\n  formData: FormData;\r\n}\r\n\r\nexport const PricingSection = ({\r\n  profitMargin,\r\n  onProfitMarginChange,\r\n  costs,\r\n  formData,\r\n}: PricingSectionProps) => {\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <TrendingUp className=\"h-5 w-5 text-primary\" />\r\n          Profit Margin & Final Pricing\r\n        </CardTitle>\r\n        <CardDescription>Set profit margin and view final selling price</CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Profit Margin Slider */}\r\n        <div className=\"space-y-2\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <Label htmlFor=\"profit-margin\" className=\"text-sm font-semibold\">\r\n              Profit Margin (%)\r\n            </Label>\r\n            <span className=\"text-lg font-bold text-primary\">{profitMargin}%</span>\r\n          </div>\r\n          <Input\r\n            id=\"profit-margin\"\r\n            type=\"range\"\r\n            min={0}\r\n            max={200}\r\n            step={1}\r\n            value={profitMargin}\r\n            onChange={(e) => onProfitMarginChange(parseFloat(e.target.value))}\r\n            className=\"w-full\"\r\n          />\r\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\r\n            <span>0%</span>\r\n            <span>100%</span>\r\n            <span>200%</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Summary Cards */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div className=\"p-4 bg-muted/50 rounded-lg space-y-2\">\r\n            <p className=\"text-sm text-muted-foreground\">Manufacturing Cost</p>\r\n            <p className=\"text-2xl font-bold\">₹{costs.totalCost.toLocaleString('en-IN')}</p>\r\n          </div>\r\n\r\n          <div className=\"p-4 bg-primary/10 rounded-lg space-y-2\">\r\n            <p className=\"text-sm text-muted-foreground\">Final Selling Price (Before Tax)</p>\r\n            <p className=\"text-2xl font-bold text-primary\">\r\n              ₹{costs.finalSellingPrice.toLocaleString('en-IN')}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"p-4 bg-accent/10 rounded-lg space-y-2\">\r\n            <p className=\"text-sm text-muted-foreground\">Profit Amount</p>\r\n            <p className=\"text-2xl font-bold text-accent\">\r\n              ₹{costs.profitAmount.toLocaleString('en-IN')}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"p-4 bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg space-y-2\">\r\n            <p className=\"text-sm text-muted-foreground\">Grand Total (After Tax)</p>\r\n            <p className=\"text-2xl font-bold\">₹{costs.grandTotal.toLocaleString('en-IN')}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Cost Breakdown Summary */}\r\n        <div className=\"border-t pt-4 space-y-2\">\r\n          <h4 className=\"font-semibold text-sm\">Cost Breakdown</h4>\r\n          <div className=\"space-y-1 text-sm\">\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">Gold Cost:</span>\r\n              <span className=\"font-medium\">₹{costs.goldCost.toLocaleString('en-IN')}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">Diamond Cost:</span>\r\n              <span className=\"font-medium\">\r\n                ₹{(formData.diamondPerCaratPrice * formData.diamondWeight).toLocaleString('en-IN')}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">Gemstone Cost:</span>\r\n              <span className=\"font-medium\">\r\n                ₹\r\n                {(formData.gemstonePerCaratPrice * formData.gemstoneWeight).toLocaleString('en-IN')}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">Making Charges:</span>\r\n              <span className=\"font-medium\">₹{formData.makingCharges.toLocaleString('en-IN')}</span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">CAD Design:</span>\r\n              <span className=\"font-medium\">\r\n                ₹{formData.cadDesignCharges.toLocaleString('en-IN')}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">Camming:</span>\r\n              <span className=\"font-medium\">\r\n                ₹{formData.cammingCharges.toLocaleString('en-IN')}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span className=\"text-muted-foreground\">Certification:</span>\r\n              <span className=\"font-medium\">\r\n                ₹{formData.certificationCost.toLocaleString('en-IN')}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};","import { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Save, FolderOpen, FileText, Trash2 } from \"lucide-react\";\r\n\r\ninterface ReviewSectionProps {\r\n  onSave: () => void;\r\n  onLoad: () => void;\r\n  onExportPDF: () => void;\r\n  onReset: () => void;\r\n  onViewHistory: () => void;\r\n  onCreateInvoice: () => void;\r\n  isAuthenticated: boolean;\r\n}\r\n\r\nexport const ReviewSection = ({\r\n  onSave,\r\n  onLoad,\r\n  onExportPDF,\r\n  onReset,\r\n  onViewHistory,\r\n  onCreateInvoice,\r\n  isAuthenticated,\r\n}: ReviewSectionProps) => {\r\n  return (\r\n    <Card className=\"border-primary/20 shadow-lg\">\r\n      <CardContent className=\"p-6\">\r\n        <div className=\"space-y-4\">\r\n          {/* Primary Actions */}\r\n          <div className=\"flex flex-wrap gap-4 justify-center\">\r\n            {isAuthenticated && (\r\n              <>\r\n                <Button onClick={onSave} size=\"lg\" variant=\"outline\" className=\"gap-2\">\r\n                  <Save className=\"h-5 w-5\" />\r\n                  Save Estimate\r\n                </Button>\r\n\r\n                <Button onClick={onLoad} size=\"lg\" variant=\"outline\" className=\"gap-2\">\r\n                  <FolderOpen className=\"h-5 w-5\" />\r\n                  Load Estimate\r\n                </Button>\r\n              </>\r\n            )}\r\n\r\n            <Button\r\n              onClick={onExportPDF}\r\n              size=\"lg\"\r\n              className=\"gap-2 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70\"\r\n            >\r\n              <FileText className=\"h-5 w-5\" />\r\n              Export Estimate PDF\r\n            </Button>\r\n          </div>\r\n\r\n          {/* Secondary Actions */}\r\n          {isAuthenticated && (\r\n            <div className=\"flex flex-wrap gap-4 justify-center border-t pt-4\">\r\n              <Button onClick={onViewHistory} size=\"lg\" variant=\"secondary\" className=\"gap-2\">\r\n                <FolderOpen className=\"h-5 w-5\" />\r\n                View Estimate History\r\n              </Button>\r\n\r\n              <Button onClick={onCreateInvoice} size=\"lg\" variant=\"secondary\" className=\"gap-2\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                Create Invoice\r\n              </Button>\r\n\r\n              <Button onClick={onReset} size=\"lg\" variant=\"destructive\" className=\"gap-2\">\r\n                <Trash2 className=\"h-5 w-5\" />\r\n                Reset Form\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};","import { useState } from \"react\";\r\n\r\nexport type EstimateStep = 1 | 2 | 3 | 4 | 5;\r\n\r\ninterface WorkflowStep {\r\n  id: EstimateStep;\r\n  title: string;\r\n  description: string;\r\n  isComplete: boolean;\r\n}\r\n\r\nexport const useEstimateWorkflow = () => {\r\n  const [currentStep, setCurrentStep] = useState<EstimateStep>(1);\r\n  \r\n  const steps: WorkflowStep[] = [\r\n    {\r\n      id: 1,\r\n      title: \"Basic Info\",\r\n      description: \"Customer & estimate details\",\r\n      isComplete: false,\r\n    },\r\n    {\r\n      id: 2,\r\n      title: \"Specifications\",\r\n      description: \"Jewelry details & weights\",\r\n      isComplete: false,\r\n    },\r\n    {\r\n      id: 3,\r\n      title: \"Additional Costs\",\r\n      description: \"CAD, camming & GST\",\r\n      isComplete: false,\r\n    },\r\n    {\r\n      id: 4,\r\n      title: \"Pricing\",\r\n      description: \"Profit margin & final price\",\r\n      isComplete: false,\r\n    },\r\n    {\r\n      id: 5,\r\n      title: \"Review & Save\",\r\n      description: \"Export or generate invoice\",\r\n      isComplete: false,\r\n    },\r\n  ];\r\n\r\n  const goToNextStep = () => {\r\n    if (currentStep < 5) {\r\n      setCurrentStep((prev) => (prev + 1) as EstimateStep);\r\n    }\r\n  };\r\n\r\n  const goToPreviousStep = () => {\r\n    if (currentStep > 1) {\r\n      setCurrentStep((prev) => (prev - 1) as EstimateStep);\r\n    }\r\n  };\r\n\r\n  const goToStep = (step: EstimateStep) => {\r\n    setCurrentStep(step);\r\n  };\r\n\r\n  const validateStep = (step: EstimateStep): { isValid: boolean; message?: string } => {\r\n    switch (step) {\r\n      case 1:\r\n        // Basic info validation would go here\r\n        return { isValid: true };\r\n      case 2:\r\n        // Jewelry specs validation would go here\r\n        return { isValid: true };\r\n      case 3:\r\n        // Additional costs validation would go here\r\n        return { isValid: true };\r\n      case 4:\r\n        // Pricing validation would go here\r\n        return { isValid: true };\r\n      case 5:\r\n        // Final review validation would go here\r\n        return { isValid: true };\r\n      default:\r\n        return { isValid: false };\r\n    }\r\n  };\r\n\r\n  return {\r\n    currentStep,\r\n    steps,\r\n    goToNextStep,\r\n    goToPreviousStep,\r\n    goToStep,\r\n    validateStep,\r\n    isFirstStep: currentStep === 1,\r\n    isLastStep: currentStep === 5,\r\n  };\r\n};","import { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Plus, Trash2, Upload, X } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { EstimateImage } from \"@/components/EstimateImage\";\r\n\r\nexport interface LineItem {\r\n  id: string;\r\n  item_name: string;\r\n  description: string;\r\n  image_url: string;\r\n  diamond_weight: number;\r\n  diamond_per_carat_price: number;\r\n  diamond_color: string;\r\n  diamond_clarity: string;\r\n  diamond_cut: string;\r\n  diamond_certification: string;\r\n  gemstone_weight: number;\r\n  gemstone_type: string;\r\n  gemstone_color: string;\r\n  gemstone_clarity: string;\r\n  net_weight: number;\r\n  gross_weight: number;\r\n  purity_fraction: number;\r\n  diamond_cost: number;\r\n  gemstone_cost: number;\r\n  gold_cost: number;\r\n  making_charges: number;\r\n  certification_cost: number;\r\n  cad_design_charges: number;\r\n  camming_charges: number;\r\n  subtotal: number;\r\n  weight_mode: 'gross' | 'net';\r\n}\r\n\r\ninterface InvoiceLineItemsProps {\r\n  items: LineItem[];\r\n  onChange: (items: LineItem[]) => void;\r\n  goldRate24k: number;\r\n  purityFraction: number;\r\n}\r\n\r\nexport const InvoiceLineItems = ({ items, onChange, goldRate24k, purityFraction }: InvoiceLineItemsProps) => {\r\n  const [editingIndex, setEditingIndex] = useState<number | null>(null);\r\n  const [uploadingImage, setUploadingImage] = useState(false);\r\n\r\n  const addNewItem = () => {\r\n    const newItem: LineItem = {\r\n      id: `item-${Date.now()}`,\r\n      item_name: \"\",\r\n      description: \"\",\r\n      image_url: \"\",\r\n      diamond_weight: 0,\r\n      diamond_per_carat_price: 0,\r\n      diamond_color: \"\",\r\n      diamond_clarity: \"\",\r\n      diamond_cut: \"\",\r\n      diamond_certification: \"\",\r\n      gemstone_weight: 0,\r\n      gemstone_type: \"\",\r\n      gemstone_color: \"\",\r\n      gemstone_clarity: \"\",\r\n      net_weight: 0,\r\n      gross_weight: 0,\r\n      purity_fraction: purityFraction,\r\n      diamond_cost: 0,\r\n      gemstone_cost: 0,\r\n      gold_cost: 0,\r\n      making_charges: 0,\r\n      certification_cost: 0,\r\n      cad_design_charges: 0,\r\n      camming_charges: 0,\r\n      subtotal: 0,\r\n      weight_mode: 'gross',\r\n    };\r\n    onChange([...items, newItem]);\r\n    setEditingIndex(items.length);\r\n  };\r\n\r\n  const updateItem = (index: number, field: keyof LineItem, value: any) => {\r\n    const updatedItems = [...items];\r\n    updatedItems[index] = { ...updatedItems[index], [field]: value };\r\n    \r\n    const item = updatedItems[index];\r\n    \r\n    // Auto-calculate net weight if in gross weight mode\r\n    if (item.weight_mode === 'gross' && (field === 'gross_weight' || field === 'diamond_weight' || field === 'gemstone_weight')) {\r\n      const totalStoneWeight = (item.diamond_weight + item.gemstone_weight) / 5;\r\n      item.net_weight = Math.max(0, item.gross_weight - totalStoneWeight);\r\n    }\r\n    \r\n    // Auto-calculate diamond cost from weight × per carat price\r\n    if (field === 'diamond_weight' || field === 'diamond_per_carat_price') {\r\n      item.diamond_cost = item.diamond_weight * item.diamond_per_carat_price;\r\n    }\r\n    \r\n    // Auto-calculate gold cost and subtotal using item's own purity fraction\r\n    item.gold_cost = item.net_weight * item.purity_fraction * goldRate24k;\r\n    item.subtotal = \r\n      item.gold_cost +\r\n      item.making_charges +\r\n      item.certification_cost +\r\n      item.cad_design_charges +\r\n      item.camming_charges +\r\n      item.diamond_cost +\r\n      item.gemstone_cost;\r\n    \r\n    onChange(updatedItems);\r\n  };\r\n\r\n  const deleteItem = (index: number) => {\r\n    const updatedItems = items.filter((_, i) => i !== index);\r\n    onChange(updatedItems);\r\n    if (editingIndex === index) {\r\n      setEditingIndex(null);\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (index: number, file: File) => {\r\n    try {\r\n      setUploadingImage(true);\r\n      \r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      const { error: uploadError, data } = await supabase.storage\r\n        .from('manufacturing-estimates')\r\n        .upload(filePath, file, {\r\n          cacheControl: '3600',\r\n          upsert: false,\r\n        });\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      // Store the storage path (not public URL)\r\n      // Signed URLs will be generated when displaying\r\n      const imagePath = data.path;\r\n\r\n      updateItem(index, 'image_url', imagePath);\r\n      toast.success(\"Image uploaded successfully\");\r\n    } catch (error: any) {\r\n      console.error('Error uploading image:', error);\r\n      toast.error(\"Failed to upload image\");\r\n    } finally {\r\n      setUploadingImage(false);\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    updateItem(index, 'image_url', '');\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold\">Invoice Line Items</h3>\r\n        <Button onClick={addNewItem} size=\"sm\">\r\n          <Plus className=\"h-4 w-4 mr-2\" />\r\n          Add Item\r\n        </Button>\r\n      </div>\r\n\r\n      {items.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"p-6 text-center text-muted-foreground\">\r\n            No items added yet. Click \"Add Item\" to start adding jewelry pieces to this invoice.\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {items.map((item, index) => (\r\n            <Card key={item.id} className=\"border-2\">\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <CardTitle className=\"text-base\">\r\n                    Item {index + 1}: {item.item_name || \"Untitled Item\"}\r\n                  </CardTitle>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      variant={editingIndex === index ? \"default\" : \"outline\"}\r\n                      size=\"sm\"\r\n                      onClick={() => setEditingIndex(editingIndex === index ? null : index)}\r\n                    >\r\n                      {editingIndex === index ? \"Done\" : \"Edit\"}\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"destructive\"\r\n                      size=\"sm\"\r\n                      onClick={() => deleteItem(index)}\r\n                    >\r\n                      <Trash2 className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              \r\n              {editingIndex === index ? (\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"col-span-2\">\r\n                      <Label>Item Name *</Label>\r\n                      <Input\r\n                        value={item.item_name}\r\n                        onChange={(e) => updateItem(index, 'item_name', e.target.value)}\r\n                        placeholder=\"e.g., Diamond Engagement Ring\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    <div className=\"col-span-2\">\r\n                      <Label>Description</Label>\r\n                      <Textarea\r\n                        value={item.description}\r\n                        onChange={(e) => updateItem(index, 'description', e.target.value)}\r\n                        placeholder=\"Describe the jewelry piece...\"\r\n                        rows={3}\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"col-span-2\">\r\n                      <Label>Product Image</Label>\r\n                      <div className=\"mt-2\">\r\n                        {item.image_url ? (\r\n                          <div className=\"relative inline-block\">\r\n                            <img\r\n                              src={item.image_url}\r\n                              alt={item.item_name}\r\n                              className=\"h-32 w-32 object-cover rounded border\"\r\n                            />\r\n                            <Button\r\n                              variant=\"destructive\"\r\n                              size=\"sm\"\r\n                              className=\"absolute -top-2 -right-2\"\r\n                              onClick={() => removeImage(index)}\r\n                            >\r\n                              <X className=\"h-3 w-3\" />\r\n                            </Button>\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"file\"\r\n                              accept=\"image/*\"\r\n                              onChange={(e) => {\r\n                                const file = e.target.files?.[0];\r\n                                if (file) handleImageUpload(index, file);\r\n                              }}\r\n                              disabled={uploadingImage}\r\n                            />\r\n                            {uploadingImage && <span className=\"text-sm text-muted-foreground\">Uploading...</span>}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"col-span-2 space-y-4 p-4 border rounded-lg bg-card\">\r\n                      <div>\r\n                        <h4 className=\"font-semibold text-base mb-1\">Weight & Purity</h4>\r\n                        <p className=\"text-sm text-muted-foreground\">Enter weights and purity details</p>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label className=\"mb-2 block\">Weight Entry Mode:</Label>\r\n                        <Select\r\n                          value={item.weight_mode}\r\n                          onValueChange={(value: 'gross' | 'net') => updateItem(index, 'weight_mode', value)}\r\n                        >\r\n                          <SelectTrigger>\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"gross\">Gross Weight Mode (Auto-calculate Net Weight)</SelectItem>\r\n                            <SelectItem value=\"net\">Net Weight Mode (Direct Entry)</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n\r\n                      {item.weight_mode === 'gross' ? (\r\n                        <>\r\n                          <div>\r\n                            <Label>Gross Weight (grams)</Label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              step=\"0.01\"\r\n                              value={item.gross_weight}\r\n                              onChange={(e) => updateItem(index, 'gross_weight', parseFloat(e.target.value) || 0)}\r\n                              className=\"mt-1.5\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div>\r\n                            <Label>Net Weight (grams) <span className=\"text-muted-foreground text-xs\">(Auto-calculated)</span></Label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              step=\"0.01\"\r\n                              value={item.net_weight}\r\n                              disabled\r\n                              className=\"mt-1.5 bg-muted\"\r\n                            />\r\n                          </div>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <div>\r\n                            <Label>Gross Weight (grams)</Label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              step=\"0.01\"\r\n                              value={item.gross_weight}\r\n                              onChange={(e) => updateItem(index, 'gross_weight', parseFloat(e.target.value) || 0)}\r\n                              className=\"mt-1.5\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div>\r\n                            <Label>Net Weight (grams)</Label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              step=\"0.01\"\r\n                              value={item.net_weight}\r\n                              onChange={(e) => updateItem(index, 'net_weight', parseFloat(e.target.value) || 0)}\r\n                              className=\"mt-1.5\"\r\n                            />\r\n                          </div>\r\n                        </>\r\n                      )}\r\n\r\n                      <div>\r\n                        <Label>Purity Fraction (e.g., 0.76 for 18K)</Label>\r\n                        <Input\r\n                          type=\"number\"\r\n                          step=\"0.01\"\r\n                          min=\"0\"\r\n                          max=\"1\"\r\n                          value={item.purity_fraction}\r\n                          onChange={(e) => updateItem(index, 'purity_fraction', parseFloat(e.target.value) || 0)}\r\n                          className=\"mt-1.5\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Weight (ct)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.diamond_weight}\r\n                        onChange={(e) => updateItem(index, 'diamond_weight', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Per Carat Price (₹/ct)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.diamond_per_carat_price}\r\n                        onChange={(e) => updateItem(index, 'diamond_per_carat_price', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Cost (₹) <span className=\"text-muted-foreground text-xs\">(Auto-calculated)</span></Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.diamond_cost}\r\n                        disabled\r\n                        className=\"bg-muted\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Color</Label>\r\n                      <Input\r\n                        value={item.diamond_color}\r\n                        onChange={(e) => updateItem(index, 'diamond_color', e.target.value)}\r\n                        placeholder=\"e.g., D, E, F\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Clarity</Label>\r\n                      <Input\r\n                        value={item.diamond_clarity}\r\n                        onChange={(e) => updateItem(index, 'diamond_clarity', e.target.value)}\r\n                        placeholder=\"e.g., VVS1, VS1, SI1\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Cut</Label>\r\n                      <Input\r\n                        value={item.diamond_cut}\r\n                        onChange={(e) => updateItem(index, 'diamond_cut', e.target.value)}\r\n                        placeholder=\"e.g., Excellent, Very Good\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Diamond Certification</Label>\r\n                      <Input\r\n                        value={item.diamond_certification}\r\n                        onChange={(e) => updateItem(index, 'diamond_certification', e.target.value)}\r\n                        placeholder=\"e.g., GIA, IGI\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Gemstone Weight (ct)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.gemstone_weight}\r\n                        onChange={(e) => updateItem(index, 'gemstone_weight', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Gemstone Cost (₹)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.gemstone_cost}\r\n                        onChange={(e) => updateItem(index, 'gemstone_cost', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Gemstone Type</Label>\r\n                      <Input\r\n                        value={item.gemstone_type}\r\n                        onChange={(e) => updateItem(index, 'gemstone_type', e.target.value)}\r\n                        placeholder=\"e.g., Ruby, Sapphire, Emerald\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Gemstone Color</Label>\r\n                      <Input\r\n                        value={item.gemstone_color}\r\n                        onChange={(e) => updateItem(index, 'gemstone_color', e.target.value)}\r\n                        placeholder=\"e.g., Pigeon Blood Red\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Gemstone Clarity</Label>\r\n                      <Input\r\n                        value={item.gemstone_clarity}\r\n                        onChange={(e) => updateItem(index, 'gemstone_clarity', e.target.value)}\r\n                        placeholder=\"e.g., Eye Clean, VVS\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"col-span-2\"></div>\r\n\r\n                    <div>\r\n                      <Label>Making Charges (₹)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.making_charges}\r\n                        onChange={(e) => updateItem(index, 'making_charges', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>CAD Design Charges (₹)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.cad_design_charges}\r\n                        onChange={(e) => updateItem(index, 'cad_design_charges', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Camming Charges (₹)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.camming_charges}\r\n                        onChange={(e) => updateItem(index, 'camming_charges', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Certification Cost (₹)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.certification_cost}\r\n                        onChange={(e) => updateItem(index, 'certification_cost', parseFloat(e.target.value) || 0)}\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"col-span-2 pt-4 border-t\">\r\n                      <div className=\"flex justify-between items-center\">\r\n                        <span className=\"font-semibold\">Gold Cost (Auto-calculated):</span>\r\n                        <span className=\"text-lg\">₹{item.gold_cost.toFixed(2)}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between items-center mt-2\">\r\n                        <span className=\"font-bold text-lg\">Item Subtotal:</span>\r\n                        <span className=\"text-xl font-bold text-primary\">₹{item.subtotal.toFixed(2)}</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              ) : (\r\n                <CardContent>\r\n                  <div className=\"flex gap-4\">\r\n                    {item.image_url && (\r\n                      <EstimateImage\r\n                        src={item.image_url}\r\n                        alt={item.item_name}\r\n                        className=\"h-24 w-24 object-cover rounded border\"\r\n                      />\r\n                    )}\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-sm text-muted-foreground mb-2\">{item.description}</p>\r\n                      <div className=\"grid grid-cols-2 gap-2 text-sm mb-2\">\r\n                        {item.diamond_weight > 0 && (\r\n                          <>\r\n                            <div>\r\n                              <span className=\"text-muted-foreground\">Diamond:</span> {item.diamond_weight}ct\r\n                            </div>\r\n                            <div>\r\n                              <span className=\"text-muted-foreground\">Color/Clarity:</span> {item.diamond_color || 'N/A'}/{item.diamond_clarity || 'N/A'}\r\n                            </div>\r\n                            {item.diamond_cut && (\r\n                              <div>\r\n                                <span className=\"text-muted-foreground\">Cut:</span> {item.diamond_cut}\r\n                              </div>\r\n                            )}\r\n                            {item.diamond_certification && (\r\n                              <div>\r\n                                <span className=\"text-muted-foreground\">Cert:</span> {item.diamond_certification}\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        )}\r\n                        {item.gemstone_weight > 0 && (\r\n                          <>\r\n                            <div>\r\n                              <span className=\"text-muted-foreground\">Gemstone:</span> {item.gemstone_weight}ct\r\n                            </div>\r\n                            <div>\r\n                              <span className=\"text-muted-foreground\">Type:</span> {item.gemstone_type || 'N/A'}\r\n                            </div>\r\n                            {item.gemstone_color && (\r\n                              <div>\r\n                                <span className=\"text-muted-foreground\">Color:</span> {item.gemstone_color}\r\n                              </div>\r\n                            )}\r\n                            {item.gemstone_clarity && (\r\n                              <div>\r\n                                <span className=\"text-muted-foreground\">Clarity:</span> {item.gemstone_clarity}\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        )}\r\n                        <div>\r\n                          <span className=\"text-muted-foreground\">Gold:</span> {item.net_weight}g\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"mt-2 font-semibold\">\r\n                        Subtotal: ₹{item.subtotal.toFixed(2)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              )}\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {items.length > 0 && (\r\n        <Card className=\"bg-muted/50\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-lg font-bold\">Total (All Items):</span>\r\n              <span className=\"text-2xl font-bold text-primary\">\r\n                ₹{items.reduce((sum, item) => sum + item.subtotal, 0).toFixed(2)}\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Download, X } from \"lucide-react\";\r\nimport { InvoiceData } from \"@/utils/invoiceGenerator\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\n\r\ninterface InvoicePreviewDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  invoiceData: InvoiceData | null;\r\n  onConfirmDownload: () => void;\r\n}\r\n\r\nexport const InvoicePreviewDialog = ({\r\n  open,\r\n  onOpenChange,\r\n  invoiceData,\r\n  onConfirmDownload,\r\n}: InvoicePreviewDialogProps) => {\r\n  if (!invoiceData) return null;\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-IN', {\r\n      style: 'currency',\r\n      currency: 'INR',\r\n      maximumFractionDigits: 0\r\n    }).format(amount);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] p-0\">\r\n        <DialogHeader className=\"px-6 pt-6\">\r\n          <DialogTitle>Invoice Preview</DialogTitle>\r\n          <DialogDescription>\r\n            Review your invoice before downloading the PDF\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        \r\n        <ScrollArea className=\"h-[calc(90vh-180px)] px-6\">\r\n          <div className=\"bg-background border rounded-lg p-8 space-y-6\">\r\n            {/* Header Section */}\r\n            <div className=\"flex justify-between items-start border-b pb-4\">\r\n              <div>\r\n                {invoiceData.vendorBranding?.logo && (\r\n                  <img \r\n                    src={invoiceData.vendorBranding.logo} \r\n                    alt=\"Logo\" \r\n                    className=\"h-16 mb-2\"\r\n                  />\r\n                )}\r\n                <h1 className=\"text-3xl font-bold text-primary\">INVOICE</h1>\r\n                <p className=\"text-lg font-semibold mt-1\">\r\n                  {invoiceData.invoiceNumber}\r\n                </p>\r\n              </div>\r\n              {invoiceData.vendorBranding && (\r\n                <div className=\"text-right text-sm\">\r\n                  <p className=\"font-semibold\">{invoiceData.vendorBranding.name}</p>\r\n                  {invoiceData.vendorBranding.address && (\r\n                    <p className=\"text-muted-foreground\">{invoiceData.vendorBranding.address}</p>\r\n                  )}\r\n                  {invoiceData.vendorBranding.phone && (\r\n                    <p className=\"text-muted-foreground\">Phone: {invoiceData.vendorBranding.phone}</p>\r\n                  )}\r\n                  {invoiceData.vendorBranding.email && (\r\n                    <p className=\"text-muted-foreground\">Email: {invoiceData.vendorBranding.email}</p>\r\n                  )}\r\n                  {invoiceData.vendorGSTIN && (\r\n                    <p className=\"text-muted-foreground\">GSTIN: {invoiceData.vendorGSTIN}</p>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Invoice & Customer Details */}\r\n            <div className=\"grid grid-cols-2 gap-6\">\r\n              <div>\r\n                <h3 className=\"font-semibold mb-2\">Invoice Details</h3>\r\n                <div className=\"text-sm space-y-1\">\r\n                  <p>Date: {new Date(invoiceData.invoiceDate).toLocaleDateString()}</p>\r\n                  {invoiceData.paymentDueDate && (\r\n                    <p>Due Date: {new Date(invoiceData.paymentDueDate).toLocaleDateString()}</p>\r\n                  )}\r\n                  {invoiceData.paymentTerms && (\r\n                    <p>Terms: {invoiceData.paymentTerms}</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <h3 className=\"font-semibold mb-2\">Bill To</h3>\r\n                <div className=\"text-sm space-y-1\">\r\n                  <p className=\"font-semibold\">{invoiceData.customerName}</p>\r\n                  {invoiceData.customerPhone && <p>Phone: {invoiceData.customerPhone}</p>}\r\n                  {invoiceData.customerEmail && <p>Email: {invoiceData.customerEmail}</p>}\r\n                  {invoiceData.customerAddress && <p>{invoiceData.customerAddress}</p>}\r\n                  {invoiceData.customerGSTIN && <p>GSTIN: {invoiceData.customerGSTIN}</p>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Line Items */}\r\n            {invoiceData.lineItems && invoiceData.lineItems.length > 0 && (\r\n              <div>\r\n                <h3 className=\"font-semibold mb-3\">Items</h3>\r\n                <div className=\"space-y-4\">\r\n                  {invoiceData.lineItems.map((item, index) => (\r\n                    <div key={index} className=\"border rounded-lg p-4\">\r\n                      <div className=\"flex gap-4\">\r\n                        {item.image_url && (\r\n                          <img \r\n                            src={item.image_url} \r\n                            alt={item.item_name} \r\n                            className=\"w-20 h-20 object-cover rounded\"\r\n                          />\r\n                        )}\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"font-semibold\">{item.item_name}</h4>\r\n                          {item.description && (\r\n                            <p className=\"text-sm text-muted-foreground\">{item.description}</p>\r\n                          )}\r\n                          <div className=\"mt-2 grid grid-cols-2 gap-2 text-sm\">\r\n                            {item.net_weight && <p>Net Weight: {item.net_weight}g</p>}\r\n                            {item.diamond_weight > 0 && <p>Diamond: {item.diamond_weight}ct</p>}\r\n                            <p className=\"col-span-2 font-semibold\">Total: {formatCurrency(item.subtotal)}</p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Cost Breakdown */}\r\n            <div className=\"border-t pt-4\">\r\n              <h3 className=\"font-semibold mb-3\">Cost Breakdown</h3>\r\n              <div className=\"space-y-2 text-sm\">\r\n                {invoiceData.diamondCost > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Diamond Cost:</span>\r\n                    <span>{formatCurrency(invoiceData.diamondCost)}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceData.gemstoneCost > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Gemstone Cost:</span>\r\n                    <span>{formatCurrency(invoiceData.gemstoneCost)}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceData.goldCost > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Gold Cost:</span>\r\n                    <span>{formatCurrency(invoiceData.goldCost)}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceData.makingCharges > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Making Charges:</span>\r\n                    <span>{formatCurrency(invoiceData.makingCharges)}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceData.cadDesignCharges > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>CAD Design Charges:</span>\r\n                    <span>{formatCurrency(invoiceData.cadDesignCharges)}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceData.cammingCharges > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Camming Charges:</span>\r\n                    <span>{formatCurrency(invoiceData.cammingCharges)}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceData.certificationCost > 0 && (\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Certification Cost:</span>\r\n                    <span>{formatCurrency(invoiceData.certificationCost)}</span>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex justify-between font-semibold text-base pt-2 border-t\">\r\n                  <span>Total Amount:</span>\r\n                  <span>{formatCurrency(invoiceData.finalSellingPrice || invoiceData.totalCost)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Notes */}\r\n            {(invoiceData.notes || invoiceData.invoiceNotes) && (\r\n              <div className=\"border-t pt-4\">\r\n                <h3 className=\"font-semibold mb-2\">Notes</h3>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {invoiceData.invoiceNotes || invoiceData.notes}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n\r\n        <DialogFooter className=\"px-6 pb-6\">\r\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n            <X className=\"mr-2 h-4 w-4\" />\r\n            Cancel\r\n          </Button>\r\n          <Button onClick={onConfirmDownload}>\r\n            <Download className=\"mr-2 h-4 w-4\" />\r\n            Download PDF\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useState, useEffect, useRef } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { Calculator, IndianRupee, Save, FolderOpen, Trash2, TrendingUp, Upload, X, Image as ImageIcon, Info, FileText, Calendar, Copy, Check, Building2, User, Coins, Diamond, Gem, Percent } from \"lucide-react\";\r\nimport { BackToHomeButton } from \"@/components/BackToHomeButton\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { EstimateWorkflowSteps } from \"@/components/estimate/EstimateWorkflowSteps\";\r\nimport { EstimateFlowGuide } from \"@/components/estimate/EstimateFlowGuide\";\r\nimport { BasicInfoSection } from \"@/components/estimate/BasicInfoSection\";\r\nimport { CostingSection } from \"@/components/estimate/CostingSection\";\r\nimport { PricingSection } from \"@/components/estimate/PricingSection\";\r\nimport { ReviewSection } from \"@/components/estimate/ReviewSection\";\r\nimport { useEstimateWorkflow } from \"@/hooks/useEstimateWorkflow\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { ChevronDown } from \"lucide-react\";\r\nimport { InvoiceLineItems, type LineItem } from \"@/components/InvoiceLineItems\";\r\nimport { generateInvoicePDF, type InvoiceData } from \"@/utils/invoiceGenerator\";\r\nimport { generateEstimatePDF } from \"@/utils/estimateGenerator\";\r\nimport { InvoicePreviewDialog } from \"@/components/InvoicePreviewDialog\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\r\nimport { Calendar as CalendarPicker } from \"@/components/ui/calendar\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { format } from \"date-fns\";\r\n\r\nconst ManufacturingCost = () => {\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const [user, setUser] = useState<any>(null);\r\n  const { currentStep, steps } = useEstimateWorkflow();\r\n  const [showFlowGuide, setShowFlowGuide] = useState(true);\r\n  const [estimates, setEstimates] = useState<any[]>([]);\r\n  const [currentEstimateId, setCurrentEstimateId] = useState<string | null>(null);\r\n  const [estimateName, setEstimateName] = useState(\"\");\r\n  const [notes, setNotes] = useState(\"\");\r\n  const [showSaveDialog, setShowSaveDialog] = useState(false);\r\n  const [showLoadDialog, setShowLoadDialog] = useState(false);\r\n  const [estimateStatus, setEstimateStatus] = useState(\"draft\");\r\n  const [estimatedCompletionDate, setEstimatedCompletionDate] = useState<Date>();\r\n  const [isCustomerVisible, setIsCustomerVisible] = useState(false);\r\n  const [shareToken, setShareToken] = useState<string>(\"\");\r\n  const [copiedToken, setCopiedToken] = useState(false);\r\n  const [guestUsageCount, setGuestUsageCount] = useState(0);\r\n  const [showUsageLimitDialog, setShowUsageLimitDialog] = useState(false);\r\n  const [vendorProfile, setVendorProfile] = useState<any>(null);\r\n  const [invoiceNumber, setInvoiceNumber] = useState(\"\");\r\n  const [invoicePrefix, setInvoicePrefix] = useState(\"INV\");\r\n  const [invoiceDate, setInvoiceDate] = useState<Date>(new Date());\r\n  const [paymentTerms, setPaymentTerms] = useState(\"Net 30\");\r\n  const [paymentDueDate, setPaymentDueDate] = useState<Date>();\r\n  const [invoiceNotes, setInvoiceNotes] = useState(\"\");\r\n  const [invoiceTemplate, setInvoiceTemplate] = useState<'detailed' | 'summary' | 'minimal'>('detailed');\r\n  const [lineItems, setLineItems] = useState<LineItem[]>([]);\r\n  const [showInvoicePreview, setShowInvoicePreview] = useState(false);\r\n  const [previewInvoiceData, setPreviewInvoiceData] = useState<InvoiceData | null>(null);\r\n  const [formData, setFormData] = useState({\r\n    purityFraction: 0.76,\r\n    goldRate24k: 0\r\n  });\r\n  const [profitMargin, setProfitMargin] = useState(0);\r\n  const [customerDetails, setCustomerDetails] = useState({\r\n    name: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    address: \"\",\r\n    gstin: \"\"\r\n  });\r\n  const [vendorGSTIN, setVendorGSTIN] = useState(\"\");\r\n  const [gstMode, setGstMode] = useState<'sgst_cgst' | 'igst'>('sgst_cgst');\r\n  const [sgstPercentage, setSgstPercentage] = useState(9);\r\n  const [cgstPercentage, setCgstPercentage] = useState(9);\r\n  const [igstPercentage, setIgstPercentage] = useState(18);\r\n  const [shippingCharges, setShippingCharges] = useState(0);\r\n  const [shippingZone, setShippingZone] = useState('local');\r\n  const [exchangeRate, setExchangeRate] = useState(83); // USD to INR rate\r\n  const [costs, setCosts] = useState({\r\n    goldCost: 0,\r\n    totalCost: 0,\r\n    finalSellingPrice: 0,\r\n    profitAmount: 0,\r\n    sgstAmount: 0,\r\n    cgstAmount: 0,\r\n    igstAmount: 0,\r\n    grandTotal: 0,\r\n    totalInUSD: 0\r\n  });\r\n\r\n  // Check auth status and usage limits\r\n  useEffect(() => {\r\n    const checkUsageAndAuth = async () => {\r\n      const {\r\n        data: {\r\n          user\r\n        }\r\n      } = await supabase.auth.getUser();\r\n      setUser(user);\r\n      if (user) {\r\n        // Authenticated users have unlimited access\r\n        fetchEstimates();\r\n        fetchVendorProfile();\r\n      } else {\r\n        // Check guest usage via backend\r\n        try {\r\n          const {\r\n            data,\r\n            error\r\n          } = await supabase.functions.invoke('check-guest-usage', {\r\n            body: {\r\n              calculatorType: 'manufacturing'\r\n            }\r\n          });\r\n          if (error) {\r\n            console.error(\"Error checking guest usage:\", error);\r\n            // Fallback to allowing access if backend check fails\r\n            return;\r\n          }\r\n          if (!data.allowed) {\r\n            setShowUsageLimitDialog(true);\r\n          } else {\r\n            setGuestUsageCount(data.usageCount);\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Failed to check usage:\", error);\r\n          // Fallback to allowing access if request fails\r\n        }\r\n      }\r\n    };\r\n    checkUsageAndAuth();\r\n  }, []);\r\n\r\n  // Fetch vendor profile for branding and auto-populate pricing\r\n  const fetchVendorProfile = async () => {\r\n    const {\r\n      data: {\r\n        user\r\n      }\r\n    } = await supabase.auth.getUser();\r\n    if (!user) return;\r\n    const {\r\n      data,\r\n      error\r\n    } = await supabase.from('vendor_profiles').select('business_name, logo_url, primary_brand_color, secondary_brand_color, brand_tagline, email, phone, address_line1, address_line2, city, state, pincode, country, gold_rate_24k_per_gram, making_charges_per_gram').eq('user_id', user.id).maybeSingle();\r\n    if (error) {\r\n      console.error('Error fetching vendor profile:', error);\r\n    } else if (data) {\r\n      setVendorProfile(data);\r\n      // Auto-populate gold rate and making charges from profile\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        goldRate24k: data.gold_rate_24k_per_gram || 0,\r\n        makingCharges: data.making_charges_per_gram || 0\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Fetch saved estimates\r\n  const fetchEstimates = async () => {\r\n    const {\r\n      data: {\r\n        user\r\n      }\r\n    } = await supabase.auth.getUser();\r\n    if (!user) return;\r\n    const {\r\n      data,\r\n      error\r\n    } = await supabase.from('manufacturing_cost_estimates').select('*').eq('user_id', user.id).order('created_at', {\r\n      ascending: false\r\n    });\r\n    if (error) {\r\n      console.error('Error fetching estimates:', error);\r\n    } else {\r\n      setEstimates(data || []);\r\n    }\r\n  };\r\n\r\n\r\n  // Calculate costs from line items\r\n  useEffect(() => {\r\n    // Calculate subtotal from line items\r\n    const lineItemsTotal = lineItems.reduce((sum, item) => sum + (item.subtotal || 0), 0);\r\n    const totalCost = lineItemsTotal;\r\n    const finalSellingPrice = totalCost * (1 + profitMargin / 100);\r\n    const profitAmount = finalSellingPrice - totalCost;\r\n\r\n    // Calculate GST based on mode\r\n    let sgstAmount = 0;\r\n    let cgstAmount = 0;\r\n    let igstAmount = 0;\r\n    if (gstMode === 'sgst_cgst') {\r\n      sgstAmount = finalSellingPrice * sgstPercentage / 100;\r\n      cgstAmount = finalSellingPrice * cgstPercentage / 100;\r\n    } else {\r\n      igstAmount = finalSellingPrice * igstPercentage / 100;\r\n    }\r\n\r\n    // Calculate grand total with GST and shipping\r\n    const grandTotal = finalSellingPrice + sgstAmount + cgstAmount + igstAmount + shippingCharges;\r\n\r\n    // Calculate USD equivalent\r\n    const totalInUSD = grandTotal / exchangeRate;\r\n    setCosts({\r\n      goldCost: 0, // No longer calculated from formData\r\n      totalCost: parseFloat(totalCost.toFixed(2)),\r\n      finalSellingPrice: parseFloat(finalSellingPrice.toFixed(2)),\r\n      profitAmount: parseFloat(profitAmount.toFixed(2)),\r\n      sgstAmount: parseFloat(sgstAmount.toFixed(2)),\r\n      cgstAmount: parseFloat(cgstAmount.toFixed(2)),\r\n      igstAmount: parseFloat(igstAmount.toFixed(2)),\r\n      grandTotal: parseFloat(grandTotal.toFixed(2)),\r\n      totalInUSD: parseFloat(totalInUSD.toFixed(2))\r\n    });\r\n  }, [lineItems, profitMargin, gstMode, sgstPercentage, cgstPercentage, igstPercentage, shippingCharges, exchangeRate]);\r\n  const handleReset = () => {\r\n    setFormData({\r\n      purityFraction: 0.76,\r\n      goldRate24k: 0\r\n    });\r\n    setProfitMargin(0);\r\n    setCurrentEstimateId(null);\r\n    setEstimateName(\"\");\r\n    setNotes(\"\");\r\n    setCustomerDetails({\r\n      name: \"\",\r\n      phone: \"\",\r\n      email: \"\",\r\n      address: \"\",\r\n      gstin: \"\"\r\n    });\r\n    setVendorGSTIN(\"\");\r\n    setEstimateStatus(\"draft\");\r\n    setEstimatedCompletionDate(undefined);\r\n    setIsCustomerVisible(false);\r\n    setShareToken(\"\");\r\n    setLineItems([]);\r\n    setGstMode('sgst_cgst');\r\n    setSgstPercentage(9);\r\n    setCgstPercentage(9);\r\n    setIgstPercentage(18);\r\n    setShippingCharges(0);\r\n    setShippingZone('local');\r\n    setExchangeRate(83);\r\n  };\r\n  const copyShareLink = () => {\r\n    if (!shareToken) {\r\n      toast({\r\n        title: \"No Tracking Link\",\r\n        description: \"Please save the estimate first to generate a tracking link\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n    const trackingUrl = `${window.location.origin}/order-tracking/${shareToken}`;\r\n    navigator.clipboard.writeText(trackingUrl);\r\n    setCopiedToken(true);\r\n    setTimeout(() => setCopiedToken(false), 2000);\r\n    toast({\r\n      title: \"Link Copied\",\r\n      description: \"Customer tracking link copied to clipboard\"\r\n    });\r\n  };\r\n  const generateNextInvoiceNumber = async () => {\r\n    try {\r\n      const {\r\n        data: {\r\n          user\r\n        }\r\n      } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n      const {\r\n        data,\r\n        error\r\n      } = await supabase.from(\"manufacturing_cost_estimates\").select(\"invoice_number\").eq(\"user_id\", user.id).not(\"invoice_number\", \"is\", null).order(\"created_at\", {\r\n        ascending: false\r\n      }).limit(1);\r\n      if (error) throw error;\r\n      const currentYear = new Date().getFullYear();\r\n      let nextNumber = 1;\r\n      if (data && data.length > 0) {\r\n        const lastInvoice = data[0].invoice_number;\r\n        const match = lastInvoice.match(/(\\d+)$/);\r\n        if (match) {\r\n          nextNumber = parseInt(match[1]) + 1;\r\n        }\r\n      }\r\n      const newInvoiceNumber = `${invoicePrefix}-${currentYear}-${String(nextNumber).padStart(3, '0')}`;\r\n      setInvoiceNumber(newInvoiceNumber);\r\n      return newInvoiceNumber;\r\n    } catch (error) {\r\n      console.error(\"Error generating invoice number:\", error);\r\n      return `${invoicePrefix}-${new Date().getFullYear()}-001`;\r\n    }\r\n  };\r\n  // Simplified handlers - redirect to Invoice Generator page\r\n  const handleGenerateInvoice = async () => {\r\n    navigate('/invoice-generator');\r\n  };\r\n\r\n  const handleExportPDF = () => {\r\n    toast({\r\n      title: \"Use Invoice Generator\",\r\n      description: \"Please use the Invoice Generator page to create and export invoice PDFs\"\r\n    });\r\n    navigate('/invoice-generator');\r\n  };\r\n\r\n  const handleConfirmDownload = () => {\r\n    toast({\r\n      title: \"Use Invoice Generator\",\r\n      description: \"Please use the Invoice Generator page to create and export invoice PDFs\"\r\n    });\r\n    navigate('/invoice-generator');\r\n  };\r\n  const handleSave = async () => {\r\n    if (!user) {\r\n      toast({\r\n        title: \"Authentication Required\",\r\n        description: \"Please sign in to save estimates.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!estimateName.trim()) {\r\n      toast({\r\n        title: \"Missing Information\",\r\n        description: \"Please enter an estimate name.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    const estimateData = {\r\n      user_id: user.id,\r\n      estimate_name: estimateName,\r\n      customer_name: customerDetails.name || null,\r\n      customer_phone: customerDetails.phone || null,\r\n      customer_email: customerDetails.email || null,\r\n      customer_address: customerDetails.address || null,\r\n      net_weight: 0,\r\n      purity_fraction: formData.purityFraction,\r\n      gold_rate_24k: formData.goldRate24k,\r\n      making_charges: 0,\r\n      cad_design_charges: 0,\r\n      camming_charges: 0,\r\n      certification_cost: 0,\r\n      diamond_cost: 0,\r\n      gemstone_cost: 0,\r\n      gold_cost: costs.goldCost,\r\n      total_cost: costs.totalCost,\r\n      final_selling_price: costs.finalSellingPrice,\r\n      profit_margin_percentage: profitMargin,\r\n      notes,\r\n      status: estimateStatus,\r\n      estimated_completion_date: estimatedCompletionDate?.toISOString() || null,\r\n      is_customer_visible: isCustomerVisible,\r\n      share_token: shareToken || `EST-${Date.now()}-${Math.random().toString(36).substring(7)}`,\r\n      line_items: (lineItems.length > 0 ? lineItems : null) as any,\r\n      details: {\r\n        customer_gstin: customerDetails.gstin,\r\n        vendor_gstin: vendorGSTIN,\r\n        gst_mode: gstMode,\r\n        sgst_percentage: sgstPercentage,\r\n        cgst_percentage: cgstPercentage,\r\n        igst_percentage: igstPercentage,\r\n        shipping_charges: shippingCharges,\r\n        shipping_zone: shippingZone,\r\n        exchange_rate: exchangeRate\r\n      }\r\n    };\r\n\r\n    let result;\r\n    if (currentEstimateId) {\r\n      result = await supabase\r\n        .from('manufacturing_cost_estimates')\r\n        .update(estimateData)\r\n        .eq('id', currentEstimateId);\r\n    } else {\r\n      result = await supabase\r\n        .from('manufacturing_cost_estimates')\r\n        .insert(estimateData)\r\n        .select()\r\n        .single();\r\n      \r\n      if (result.data) {\r\n        setCurrentEstimateId(result.data.id);\r\n        setShareToken(result.data.share_token);\r\n      }\r\n    }\r\n\r\n    if (result.error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to save estimate\",\r\n        variant: \"destructive\"\r\n      });\r\n    } else {\r\n      toast({\r\n        title: \"Saved\",\r\n        description: currentEstimateId ? \"Estimate updated successfully\" : \"Estimate saved successfully\"\r\n      });\r\n      fetchEstimates();\r\n      setShowSaveDialog(false);\r\n    }\r\n  };\r\n  const handleLoad = (estimate: any) => {\r\n    const details = estimate.details as any;\r\n    setFormData({\r\n      purityFraction: estimate.purity_fraction || 0.76,\r\n      goldRate24k: estimate.gold_rate_24k || 0\r\n    });\r\n    setProfitMargin(estimate.profit_margin_percentage || 0);\r\n    setCurrentEstimateId(estimate.id);\r\n    setEstimateName(estimate.estimate_name);\r\n    setNotes(estimate.notes || \"\");\r\n    setCustomerDetails({\r\n      name: estimate.customer_name || \"\",\r\n      phone: estimate.customer_phone || \"\",\r\n      email: estimate.customer_email || \"\",\r\n      address: estimate.customer_address || \"\",\r\n      gstin: details?.customer_gstin || \"\"\r\n    });\r\n    setVendorGSTIN(details?.vendor_gstin || \"\");\r\n    setGstMode(details?.gst_mode || 'sgst_cgst');\r\n    setSgstPercentage(details?.sgst_percentage || 9);\r\n    setCgstPercentage(details?.cgst_percentage || 9);\r\n    setIgstPercentage(details?.igst_percentage || 18);\r\n    setShippingCharges(details?.shipping_charges || 0);\r\n    setShippingZone(details?.shipping_zone || 'local');\r\n    setExchangeRate(details?.exchange_rate || 83);\r\n    setLineItems(estimate.line_items || []);\r\n    setEstimateStatus(estimate.status || \"draft\");\r\n    setEstimatedCompletionDate(estimate.estimated_completion_date ? new Date(estimate.estimated_completion_date) : undefined);\r\n    setIsCustomerVisible(estimate.is_customer_visible || false);\r\n    setShareToken(estimate.share_token || \"\");\r\n    setInvoiceNumber(estimate.invoice_number || \"\");\r\n    setInvoiceDate(estimate.invoice_date ? new Date(estimate.invoice_date) : new Date());\r\n    setPaymentTerms(estimate.payment_terms || \"Net 30\");\r\n    setPaymentDueDate(estimate.payment_due_date ? new Date(estimate.payment_due_date) : undefined);\r\n    setInvoiceNotes(estimate.invoice_notes || \"\");\r\n    setShowLoadDialog(false);\r\n    toast({\r\n      title: \"Loaded\",\r\n      description: `Estimate \"${estimate.estimate_name}\" loaded successfully`\r\n    });\r\n  };\r\n  const handleDelete = async (id: string) => {\r\n    const {\r\n      error\r\n    } = await supabase.from('manufacturing_cost_estimates').delete().eq('id', id);\r\n    if (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete estimate\",\r\n        variant: \"destructive\"\r\n      });\r\n    } else {\r\n      toast({\r\n        title: \"Deleted\",\r\n        description: \"Estimate deleted successfully\"\r\n      });\r\n      fetchEstimates();\r\n      if (currentEstimateId === id) {\r\n        handleReset();\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-secondary/20 to-background py-8 px-4\">\r\n      {/* Guest Usage Limit Dialog */}\r\n      <Dialog open={showUsageLimitDialog} onOpenChange={setShowUsageLimitDialog}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Usage Limit Reached</DialogTitle>\r\n            <DialogDescription>\r\n              You've reached the limit of 5 uses per 24 hours for guest users. Sign in to get unlimited access to the Manufacturing Cost Estimator, or wait 24 hours for your limit to reset.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"flex gap-4\">\r\n            <Button onClick={() => navigate('/auth')} className=\"flex-1\">\r\n              Sign In\r\n            </Button>\r\n            <Button variant=\"outline\" onClick={() => navigate('/')} className=\"flex-1\">\r\n              Go Home\r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <BackToHomeButton />\r\n      <div className=\"max-w-6xl mx-auto space-y-8\">\r\n        {/* Header */}\r\n        <div className=\"text-center space-y-4\">\r\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-primary/20 to-accent/20 rounded-full mb-4\">\r\n            <Calculator className=\"h-8 w-8 text-primary\" />\r\n          </div>\r\n          <h1 className=\"text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary via-accent to-primary animate-gradient\">\r\n            Manufacturing Cost Estimator\r\n          </h1>\r\n          <p className=\"text-muted-foreground text-lg max-w-2xl mx-auto\">\r\n            Professional jewelry cost estimation and invoice generation workflow\r\n          </p>\r\n          \r\n          {/* Guest Usage Counter */}\r\n          {!user && guestUsageCount > 0 && guestUsageCount < 5 && <div className=\"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-muted/50 rounded-lg border border-border\">\r\n              <Info className=\"h-4 w-4 text-muted-foreground\" />\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Guest Usage: {guestUsageCount}/5 uses (resets in 24 hours).\r\n                <Button variant=\"link\" className=\"ml-1 p-0 h-auto text-sm underline\" onClick={() => navigate('/auth')}>\r\n                  Sign in for unlimited access\r\n                </Button>\r\n              </p>\r\n            </div>}\r\n        </div>\r\n\r\n        {/* Workflow Steps Indicator */}\r\n        <Card className=\"border-primary/20\">\r\n          <CardContent className=\"p-6\">\r\n            <EstimateWorkflowSteps currentStep={currentStep} steps={steps} />\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Flow Guide (Collapsible) */}\r\n        <Collapsible open={showFlowGuide} onOpenChange={setShowFlowGuide}>\r\n          <Card className=\"border-primary/20\">\r\n            <CollapsibleTrigger className=\"w-full\">\r\n              <CardHeader className=\"cursor-pointer hover:bg-muted/50 transition-colors\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"text-left\">\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Info className=\"h-5 w-5 text-primary\" />\r\n                      Understanding the Workflow\r\n                    </CardTitle>\r\n                    <CardDescription>\r\n                      Learn the difference between estimates and invoices\r\n                    </CardDescription>\r\n                  </div>\r\n                  <ChevronDown className={`h-5 w-5 text-muted-foreground transition-transform ${showFlowGuide ? 'rotate-180' : ''}`} />\r\n                </div>\r\n              </CardHeader>\r\n            </CollapsibleTrigger>\r\n            <CollapsibleContent>\r\n              <CardContent>\r\n                <EstimateFlowGuide />\r\n              </CardContent>\r\n            </CollapsibleContent>\r\n          </Card>\r\n        </Collapsible>\r\n\r\n        {/* Action Buttons */}\r\n        <ReviewSection\r\n          onSave={() => setShowSaveDialog(true)}\r\n          onLoad={() => setShowLoadDialog(true)}\r\n          onExportPDF={handleExportPDF}\r\n          onReset={handleReset}\r\n          onViewHistory={() => navigate(\"/estimate-history\")}\r\n          onCreateInvoice={() => navigate(\"/invoice-generator\")}\r\n          isAuthenticated={!!user}\r\n        />\r\n        \r\n\r\n        {/* Save Dialog */}\r\n        <Dialog open={showSaveDialog} onOpenChange={setShowSaveDialog}>\r\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n            <DialogHeader>\r\n              <DialogTitle>Save Estimate</DialogTitle>\r\n              <DialogDescription>\r\n                Save this manufacturing cost estimate with customer details and tracking options\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <div className=\"space-y-6\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"estimate-name\">Estimate Name *</Label>\r\n                <Input id=\"estimate-name\" value={estimateName} onChange={e => setEstimateName(e.target.value)} placeholder=\"e.g., Diamond Ring Quote - John Doe\" />\r\n              </div>\r\n\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"font-semibold\">Customer Information</h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"customer-name\">Customer Name</Label>\r\n                    <Input id=\"customer-name\" value={customerDetails.name} onChange={e => setCustomerDetails({\r\n                    ...customerDetails,\r\n                    name: e.target.value\r\n                  })} placeholder=\"Full name\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"customer-phone\">Phone Number</Label>\r\n                    <Input id=\"customer-phone\" value={customerDetails.phone} onChange={e => setCustomerDetails({\r\n                    ...customerDetails,\r\n                    phone: e.target.value\r\n                  })} placeholder=\"+1234567890\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"customer-email\">Email</Label>\r\n                    <Input id=\"customer-email\" type=\"email\" value={customerDetails.email} onChange={e => setCustomerDetails({\r\n                    ...customerDetails,\r\n                    email: e.target.value\r\n                  })} placeholder=\"customer@example.com\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"customer-address\">Address</Label>\r\n                    <Input id=\"customer-address\" value={customerDetails.address} onChange={e => setCustomerDetails({\r\n                    ...customerDetails,\r\n                    address: e.target.value\r\n                  })} placeholder=\"Complete address\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"notes\">Notes</Label>\r\n                <Textarea id=\"notes\" value={notes} onChange={e => setNotes(e.target.value)} placeholder=\"Add any additional notes or specifications...\" rows={3} />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Order Status</Label>\r\n                <Select value={estimateStatus} onValueChange={setEstimateStatus}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"draft\">Draft</SelectItem>\r\n                    <SelectItem value=\"quoted\">Quoted</SelectItem>\r\n                    <SelectItem value=\"approved\">Approved</SelectItem>\r\n                    <SelectItem value=\"in_production\">In Production</SelectItem>\r\n                    <SelectItem value=\"completed\">Completed</SelectItem>\r\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label>Estimated Completion Date</Label>\r\n                <Popover>\r\n                  <PopoverTrigger asChild>\r\n                    <Button variant=\"outline\" className=\"w-full justify-start text-left font-normal\">\r\n                      <Calendar className=\"mr-2 h-4 w-4\" />\r\n                      {estimatedCompletionDate ? format(estimatedCompletionDate, \"PPP\") : \"Select date\"}\r\n                    </Button>\r\n                  </PopoverTrigger>\r\n                  <PopoverContent className=\"w-auto p-0\">\r\n                    <CalendarPicker mode=\"single\" selected={estimatedCompletionDate} onSelect={setEstimatedCompletionDate} initialFocus />\r\n                  </PopoverContent>\r\n                </Popover>\r\n              </div>\r\n\r\n              <div className=\"flex items-center justify-between space-x-2 border rounded-lg p-4\">\r\n                <div className=\"space-y-0.5\">\r\n                  <Label>Enable Customer Portal</Label>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    Allow customer to track order status with a secure link\r\n                  </p>\r\n                </div>\r\n                <Switch checked={isCustomerVisible} onCheckedChange={setIsCustomerVisible} />\r\n              </div>\r\n\r\n              <div className=\"flex gap-3\">\r\n                <Button onClick={handleSave} className=\"flex-1\">Save Estimate</Button>\r\n                <Button onClick={() => setShowSaveDialog(false)} variant=\"outline\" className=\"flex-1\">Cancel</Button>\r\n              </div>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        {/* Vendor and Customer Details Section */}\r\n        <BasicInfoSection\r\n          vendorProfile={vendorProfile}\r\n          vendorGSTIN={vendorGSTIN}\r\n          onVendorGSTINChange={setVendorGSTIN}\r\n          customerDetails={customerDetails}\r\n          onCustomerDetailsChange={setCustomerDetails}\r\n        />\r\n\r\n        {/* Invoice Line Items */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-5 w-5 text-primary\" />\r\n              Invoice Line Items\r\n            </CardTitle>\r\n            <CardDescription>Add multiple jewelry items with individual pricing details</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <InvoiceLineItems items={lineItems} onChange={setLineItems} goldRate24k={formData.goldRate24k} purityFraction={formData.purityFraction} />\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Profit Margin and Summary */}\r\n        <PricingSection\r\n          profitMargin={profitMargin}\r\n          onProfitMarginChange={setProfitMargin}\r\n          costs={costs}\r\n          formData={{ diamondPerCaratPrice: 0, diamondWeight: 0, gemstonePerCaratPrice: 0, gemstoneWeight: 0, makingCharges: 0, cadDesignCharges: 0, cammingCharges: 0, certificationCost: 0 }}\r\n        />\r\n\r\n        {/* Tax, Shipping & Currency Section */}\r\n        <CostingSection\r\n          gstMode={gstMode}\r\n          onGstModeChange={setGstMode}\r\n          sgstPercentage={sgstPercentage}\r\n          cgstPercentage={cgstPercentage}\r\n          igstPercentage={igstPercentage}\r\n          onSgstChange={setSgstPercentage}\r\n          onCgstChange={setCgstPercentage}\r\n          onIgstChange={setIgstPercentage}\r\n          shippingCharges={shippingCharges}\r\n          onShippingChargesChange={setShippingCharges}\r\n          shippingZone={shippingZone}\r\n          onShippingZoneChange={setShippingZone}\r\n          exchangeRate={exchangeRate}\r\n          onExchangeRateChange={setExchangeRate}\r\n          costs={costs}\r\n        />\r\n      </div>\r\n\r\n      <InvoicePreviewDialog open={showInvoicePreview} onOpenChange={setShowInvoicePreview} invoiceData={previewInvoiceData} onConfirmDownload={handleConfirmDownload} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ManufacturingCost;"],"names":["EstimateWorkflowSteps","currentStep","steps","jsx","step","index","jsxs","cn","Check","EstimateFlowGuide","Card","CardHeader","CardTitle","Info","CardDescription","CardContent","Calculator","Diamond","IndianRupee","TrendingUp","Save","Alert","AlertDescription","ArrowRight","Separator","FileCheck","FileText","BasicInfoSection","vendorProfile","vendorGSTIN","onVendorGSTINChange","customerDetails","onCustomerDetailsChange","handleCustomerChange","field","value","Building2","Label","Input","e","User","Textarea","CostingSection","gstMode","onGstModeChange","sgstPercentage","cgstPercentage","igstPercentage","onSgstChange","onCgstChange","onIgstChange","shippingCharges","onShippingChargesChange","shippingZone","exchangeRate","onExchangeRateChange","costs","applyQuickGSTRate","rate","Percent","Button","Fragment","PricingSection","profitMargin","onProfitMarginChange","formData","ReviewSection","onSave","onLoad","onExportPDF","onReset","onViewHistory","onCreateInvoice","isAuthenticated","FolderOpen","Trash2","useEstimateWorkflow","setCurrentStep","useState","prev","InvoiceLineItems","items","onChange","goldRate24k","purityFraction","editingIndex","setEditingIndex","uploadingImage","setUploadingImage","addNewItem","newItem","updateItem","updatedItems","item","totalStoneWeight","deleteItem","_","i","handleImageUpload","file","fileExt","filePath","uploadError","data","supabase","imagePath","toast","error","removeImage","Plus","X","_a","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","EstimateImage","sum","InvoicePreviewDialog","open","onOpenChange","invoiceData","onConfirmDownload","formatCurrency","amount","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","ScrollArea","DialogFooter","Download","ManufacturingCost","useToast","navigate","useNavigate","user","setUser","showFlowGuide","setShowFlowGuide","estimates","setEstimates","currentEstimateId","setCurrentEstimateId","estimateName","setEstimateName","notes","setNotes","showSaveDialog","setShowSaveDialog","showLoadDialog","setShowLoadDialog","estimateStatus","setEstimateStatus","estimatedCompletionDate","setEstimatedCompletionDate","isCustomerVisible","setIsCustomerVisible","shareToken","setShareToken","copiedToken","setCopiedToken","guestUsageCount","setGuestUsageCount","showUsageLimitDialog","setShowUsageLimitDialog","setVendorProfile","invoiceNumber","setInvoiceNumber","invoicePrefix","setInvoicePrefix","invoiceDate","setInvoiceDate","paymentTerms","setPaymentTerms","paymentDueDate","setPaymentDueDate","invoiceNotes","setInvoiceNotes","invoiceTemplate","setInvoiceTemplate","lineItems","setLineItems","showInvoicePreview","setShowInvoicePreview","previewInvoiceData","setPreviewInvoiceData","setFormData","setProfitMargin","setCustomerDetails","setVendorGSTIN","setGstMode","setSgstPercentage","setCgstPercentage","setIgstPercentage","setShippingCharges","setShippingZone","setExchangeRate","setCosts","useEffect","fetchEstimates","fetchVendorProfile","totalCost","finalSellingPrice","profitAmount","sgstAmount","cgstAmount","igstAmount","grandTotal","totalInUSD","handleReset","handleExportPDF","handleConfirmDownload","handleSave","estimateData","result","BackToHomeButton","Collapsible","CollapsibleTrigger","ChevronDown","CollapsibleContent","Popover","PopoverTrigger","Calendar","format","PopoverContent","CalendarPicker","Switch"],"mappings":"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"}