import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as h}from"./react-vendor-BeR0k5Z3.js";import{A as B}from"./AdminLayout-iDUtkfn_.js";import{s as v,B as H,C as j,i as u,k as p,g as f}from"./index-CX6yiz0b.js";import{I as U}from"./input-CiHC6UAI.js";import{u as L,ab as D,U as k,G as I,h as A,d as F,K as G}from"./ui-vendor-DjQqXt9S.js";import{T as O,a as P,b as C,c,d as V,e as i}from"./table-CYMzKz5T.js";import{B as g}from"./badge-45Abp579.js";import{f as y}from"./format-sTPjOSS_.js";import"./separator-D0WC8Ha9.js";import"./index-DhS5fNEb.js";import"./index-D6fUEw85.js";import"./NavLink-Bvq0lq1P.js";import"./index-BC78nHQ6.js";import"./index-DVcnno33.js";import"./supabase-vendor-VSDMYZ1k.js";import"./en-US-DWrl2lTx.js";function ie(){const[S,R]=h.useState([]),[T,b]=h.useState(!0),[m,_]=h.useState(""),[t,M]=h.useState({totalLeads:0,winners:0,nonWinners:0,claimedRewards:0});h.useEffect(()=>{W()},[]);const W=async()=>{try{b(!0);const{data:s,error:l}=await v.from("scratch_leads").select("*").order("created_at",{ascending:!1});if(l)throw l;const{data:x,error:w}=await v.from("scratch_rewards").select("*");if(w)throw w;const d=(s||[]).map(r=>({...r,reward:x==null?void 0:x.find(n=>n.session_id===r.session_id)}));R(d);const o=d.filter(r=>{var n;return((n=r.reward)==null?void 0:n.reward_type)==="winner"}).length,a=d.filter(r=>{var n;return(n=r.reward)==null?void 0:n.claimed}).length;M({totalLeads:d.length,winners:o,nonWinners:d.length-o,claimedRewards:a})}catch(s){console.error("Error fetching leads:",s),L.error("Failed to load scratch card leads")}finally{b(!1)}},E=()=>{const s=["Name","Email","Phone","Business Name","Interest","Status","Reward","Claimed","Date"],l=N.map(a=>{var r,n;return[a.name,a.email,a.phone||"",a.business_name||"",a.interest||"",a.reward?"Winner":"Non-Winner",((r=a.reward)==null?void 0:r.reward_value)||"N/A",(n=a.reward)!=null&&n.claimed?"Yes":"No",y(new Date(a.created_at),"yyyy-MM-dd HH:mm")]}),x=[s,...l].map(a=>a.map(r=>`"${r}"`).join(",")).join(`
`),w=new Blob([x],{type:"text/csv"}),d=window.URL.createObjectURL(w),o=document.createElement("a");o.href=d,o.download=`scratch-leads-${y(new Date,"yyyy-MM-dd")}.csv`,o.click(),window.URL.revokeObjectURL(d),L.success("Leads exported successfully!")},N=S.filter(s=>{var l;return s.name.toLowerCase().includes(m.toLowerCase())||s.email.toLowerCase().includes(m.toLowerCase())||((l=s.business_name)==null?void 0:l.toLowerCase().includes(m.toLowerCase()))});return e.jsx(B,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Scratch Card Leads"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track all leads captured from the Scratch & Win game"})]}),e.jsxs(H,{onClick:E,className:"gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Export CSV"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Leads"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:t.totalLeads})})]}),e.jsxs(j,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Winners"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.winners}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.totalLeads>0?Math.round(t.winners/t.totalLeads*100):0,"% win rate"]})]})]}),e.jsxs(j,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Non-Winners"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.nonWinners}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Follow-up opportunities"})]})]}),e.jsxs(j,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Claimed Rewards"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.claimedRewards}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.winners>0?Math.round(t.claimedRewards/t.winners*100):0,"% claim rate"]})]})]})]}),e.jsxs(j,{children:[e.jsx(u,{children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Search by name, email, or business name...",value:m,onChange:s=>_(s.target.value),className:"pl-10"})]})})}),e.jsx(f,{children:T?e.jsx("div",{className:"text-center py-8",children:"Loading leads..."}):N.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:m?"No leads found matching your search.":"No leads captured yet."}):e.jsxs(O,{children:[e.jsx(P,{children:e.jsxs(C,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Phone"}),e.jsx(c,{children:"Business"}),e.jsx(c,{children:"Interest"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Reward"}),e.jsx(c,{children:"Date"})]})}),e.jsx(V,{children:N.map(s=>e.jsxs(C,{children:[e.jsx(i,{className:"font-medium",children:s.name}),e.jsx(i,{children:s.email}),e.jsx(i,{children:s.phone||"-"}),e.jsx(i,{children:s.business_name||"-"}),e.jsx(i,{children:s.interest||"-"}),e.jsx(i,{children:s.reward?e.jsx(g,{variant:"default",className:"bg-green-500",children:"Winner"}):e.jsx(g,{variant:"secondary",children:"Non-Winner"})}),e.jsx(i,{children:s.reward?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm",children:s.reward.reward_value}),s.reward.claimed&&e.jsx(g,{variant:"outline",className:"w-fit",children:"Claimed"})]}):"-"}),e.jsx(i,{className:"text-sm text-muted-foreground",children:y(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]},s.id))})]})})]})]})})}export{ie as default};
//# sourceMappingURL=ScratchLeads-DQLrHDtd.js.map
