{"version":3,"file":"Share-f4y0xJtw.js","sources":["../../src/components/ShareLinkQRCode.tsx","../../src/components/ShareLinkAnalytics.tsx","../../src/hooks/useRewardsSystemLazy.tsx","../../src/pages/Share.tsx"],"sourcesContent":["import { QRCodeSVG } from \"qrcode.react\";\r\nimport { Download, Share2 } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface ShareLinkQRCodeProps {\r\n  shareToken: string;\r\n  businessName?: string;\r\n}\r\n\r\nexport const ShareLinkQRCode = ({ shareToken, businessName }: ShareLinkQRCodeProps) => {\r\n  const shareUrl = `${window.location.origin}/shared/${encodeURIComponent(shareToken)}`;\r\n\r\n  const downloadQRCode = () => {\r\n    const svg = document.getElementById(`qr-${shareToken}`);\r\n    if (!svg) return;\r\n\r\n    const svgData = new XMLSerializer().serializeToString(svg);\r\n    const canvas = document.createElement(\"canvas\");\r\n    const ctx = canvas.getContext(\"2d\");\r\n    const img = new Image();\r\n\r\n    img.onload = () => {\r\n      canvas.width = img.width;\r\n      canvas.height = img.height;\r\n      ctx?.drawImage(img, 0, 0);\r\n      \r\n      canvas.toBlob((blob) => {\r\n        if (blob) {\r\n          const url = URL.createObjectURL(blob);\r\n          const link = document.createElement(\"a\");\r\n          link.href = url;\r\n          link.download = `catalog-qr-${shareToken.substring(0, 8)}.png`;\r\n          link.click();\r\n          URL.revokeObjectURL(url);\r\n          toast.success(\"QR code downloaded!\");\r\n        }\r\n      });\r\n    };\r\n\r\n    img.src = \"data:image/svg+xml;base64,\" + btoa(svgData);\r\n  };\r\n\r\n  const printQRCode = () => {\r\n    const printWindow = window.open(\"\", \"_blank\");\r\n    if (!printWindow) return;\r\n\r\n    const title = businessName || \"Jewelry Catalog\";\r\n    printWindow.document.write(`\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <title>QR Code - ${title}</title>\r\n          <style>\r\n            body {\r\n              display: flex;\r\n              flex-direction: column;\r\n              align-items: center;\r\n              justify-content: center;\r\n              min-height: 100vh;\r\n              margin: 0;\r\n              font-family: Arial, sans-serif;\r\n            }\r\n            .container {\r\n              text-align: center;\r\n              padding: 40px;\r\n            }\r\n            h1 {\r\n              margin-bottom: 20px;\r\n              color: #333;\r\n            }\r\n            .qr-container {\r\n              background: white;\r\n              padding: 30px;\r\n              border: 2px solid #333;\r\n              border-radius: 10px;\r\n              display: inline-block;\r\n            }\r\n            .instructions {\r\n              margin-top: 30px;\r\n              font-size: 14px;\r\n              color: #666;\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"container\">\r\n            <h1>${title}</h1>\r\n            <div class=\"qr-container\">\r\n              ${document.getElementById(`qr-${shareToken}`)?.outerHTML || \"\"}\r\n            </div>\r\n            <div class=\"instructions\">\r\n              <p>Scan this QR code to view our jewelry collection</p>\r\n              <p style=\"font-size: 12px; margin-top: 10px;\">${shareUrl}</p>\r\n            </div>\r\n          </div>\r\n        </body>\r\n      </html>\r\n    `);\r\n    printWindow.document.close();\r\n    setTimeout(() => {\r\n      printWindow.print();\r\n    }, 250);\r\n  };\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogTrigger asChild>\r\n        <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\r\n          <Share2 className=\"h-4 w-4\" />\r\n          QR Code\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle>Share Link QR Code</DialogTitle>\r\n          <DialogDescription>\r\n            Print or download this QR code to share your catalog offline\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex flex-col items-center gap-6 py-4\">\r\n          {/* QR Code */}\r\n          <div className=\"bg-white p-6 rounded-xl border-2 border-primary/20 shadow-lg\">\r\n            <QRCodeSVG\r\n              id={`qr-${shareToken}`}\r\n              value={shareUrl}\r\n              size={256}\r\n              level=\"H\"\r\n              includeMargin\r\n            />\r\n          </div>\r\n\r\n          {/* URL Display */}\r\n          <div className=\"w-full\">\r\n            <p className=\"text-xs text-muted-foreground text-center mb-2\">\r\n              Catalog Link:\r\n            </p>\r\n            <div className=\"bg-muted rounded-lg px-3 py-2 text-xs text-center break-all\">\r\n              {shareUrl}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex gap-2 w-full\">\r\n            <Button\r\n              onClick={downloadQRCode}\r\n              variant=\"outline\"\r\n              className=\"flex-1 gap-2\"\r\n            >\r\n              <Download className=\"h-4 w-4\" />\r\n              Download\r\n            </Button>\r\n            <Button\r\n              onClick={printQRCode}\r\n              className=\"flex-1 gap-2\"\r\n            >\r\n              <svg\r\n                className=\"h-4 w-4\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z\"\r\n                />\r\n              </svg>\r\n              Print\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Eye, TrendingUp, Users, Package } from \"lucide-react\";\r\nimport { format, subDays, startOfDay, endOfDay } from \"date-fns\";\r\nimport {\r\n  LineChart,\r\n  Line,\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n  Legend,\r\n} from \"recharts\";\r\n\r\ninterface ShareLinkAnalyticsProps {\r\n  shareLinkId: string;\r\n  viewCount: number;\r\n}\r\n\r\nexport const ShareLinkAnalytics = ({ shareLinkId, viewCount }: ShareLinkAnalyticsProps) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [viewsOverTime, setViewsOverTime] = useState<any[]>([]);\r\n  const [topProducts, setTopProducts] = useState<any[]>([]);\r\n  const [totalProductViews, setTotalProductViews] = useState(0);\r\n\r\n  useEffect(() => {\r\n    fetchAnalytics();\r\n  }, [shareLinkId]);\r\n\r\n  const fetchAnalytics = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Fetch views over time (last 7 days)\r\n      const sevenDaysAgo = subDays(new Date(), 7);\r\n      \r\n      const { data: productViews, error } = await supabase\r\n        .from(\"share_link_product_views\")\r\n        .select(\"viewed_at, product_id, products(name, image_url)\")\r\n        .eq(\"share_link_id\", shareLinkId)\r\n        .gte(\"viewed_at\", sevenDaysAgo.toISOString());\r\n\r\n      if (error) throw error;\r\n\r\n      // Process views over time\r\n      const viewsByDay: Record<string, number> = {};\r\n      const last7Days = Array.from({ length: 7 }, (_, i) => {\r\n        const date = subDays(new Date(), 6 - i);\r\n        const dateKey = format(date, \"MMM dd\");\r\n        viewsByDay[dateKey] = 0;\r\n        return dateKey;\r\n      });\r\n\r\n      productViews?.forEach((view) => {\r\n        const dateKey = format(new Date(view.viewed_at), \"MMM dd\");\r\n        if (dateKey in viewsByDay) {\r\n          viewsByDay[dateKey]++;\r\n        }\r\n      });\r\n\r\n      const viewsData = last7Days.map((date) => ({\r\n        date,\r\n        views: viewsByDay[date] || 0,\r\n      }));\r\n\r\n      setViewsOverTime(viewsData);\r\n\r\n      // Process top products\r\n      const productCounts: Record<string, { count: number; name: string; image: string | null }> = {};\r\n      productViews?.forEach((view) => {\r\n        const productData = view.products as any;\r\n        if (productData && view.product_id) {\r\n          if (!productCounts[view.product_id]) {\r\n            productCounts[view.product_id] = {\r\n              count: 0,\r\n              name: productData.name || \"Unknown Product\",\r\n              image: productData.image_url || null,\r\n            };\r\n          }\r\n          productCounts[view.product_id].count++;\r\n        }\r\n      });\r\n\r\n      const topProductsData = Object.entries(productCounts)\r\n        .map(([id, data]) => ({\r\n          id,\r\n          name: data.name,\r\n          image: data.image,\r\n          views: data.count,\r\n        }))\r\n        .sort((a, b) => b.views - a.views)\r\n        .slice(0, 5);\r\n\r\n      setTopProducts(topProductsData);\r\n      setTotalProductViews(productViews?.length || 0);\r\n    } catch (error) {\r\n      console.error(\"Error fetching analytics:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <div className=\"h-32 bg-muted animate-pulse rounded-lg\" />\r\n        <div className=\"h-64 bg-muted animate-pulse rounded-lg\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Stats Overview */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Catalog Views</CardTitle>\r\n            <Eye className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{viewCount}</div>\r\n            <p className=\"text-xs text-muted-foreground\">Total link opens</p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Product Views</CardTitle>\r\n            <Package className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{totalProductViews}</div>\r\n            <p className=\"text-xs text-muted-foreground\">Individual product views</p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Engagement Rate</CardTitle>\r\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">\r\n              {viewCount > 0 ? ((totalProductViews / viewCount) * 100).toFixed(1) : \"0\"}%\r\n            </div>\r\n            <p className=\"text-xs text-muted-foreground\">Products per visit</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Views Over Time Chart */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-base\">Views Over Time (Last 7 Days)</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <ResponsiveContainer width=\"100%\" height={250}>\r\n            <LineChart data={viewsOverTime}>\r\n              <CartesianGrid strokeDasharray=\"3 3\" />\r\n              <XAxis dataKey=\"date\" />\r\n              <YAxis />\r\n              <Tooltip />\r\n              <Legend />\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey=\"views\"\r\n                stroke=\"hsl(var(--primary))\"\r\n                strokeWidth={2}\r\n                dot={{ fill: \"hsl(var(--primary))\" }}\r\n              />\r\n            </LineChart>\r\n          </ResponsiveContainer>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Top Products */}\r\n      {topProducts.length > 0 && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"text-base\">Most Viewed Products</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-4\">\r\n              {topProducts.map((product, index) => (\r\n                <div key={product.id} className=\"flex items-center gap-4\">\r\n                  <Badge variant=\"secondary\" className=\"min-w-[2rem] justify-center\">\r\n                    {index + 1}\r\n                  </Badge>\r\n                  {product.image && (\r\n                    <img\r\n                      src={product.image}\r\n                      alt={product.name}\r\n                      className=\"h-12 w-12 object-cover rounded-md\"\r\n                    />\r\n                  )}\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"text-sm font-medium truncate\">{product.name}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{product.views} views</p>\r\n                  </div>\r\n                  <div className=\"w-32 bg-muted rounded-full h-2\">\r\n                    <div\r\n                      className=\"bg-primary h-2 rounded-full\"\r\n                      style={{\r\n                        width: `${(product.views / topProducts[0].views) * 100}%`,\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import { supabase } from \"@/integrations/supabase/client\";\r\n\r\n/**\r\n * Lazy version of rewards system - only provides awardPoints without fetching on mount\r\n * Use this when you only need to award points without displaying rewards data\r\n */\r\nexport const useRewardsSystemLazy = () => {\r\n  const awardPoints = async (actionType: string, actionDetails?: any) => {\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke('award-points', {\r\n        body: {\r\n          action_type: actionType,\r\n          action_details: actionDetails\r\n        }\r\n      });\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Error awarding points:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  return { awardPoints };\r\n};\r\n","import { useState, useEffect, useCallback } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { ApprovalGuard } from \"@/components/ApprovalGuard\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { SocialShareButton } from \"@/components/SocialShareButton\";\r\nimport { ShareStats } from \"@/components/ShareStats\";\r\nimport { ShareLinkQRCode } from \"@/components/ShareLinkQRCode\";\r\nimport { ShareLinkAnalytics } from \"@/components/ShareLinkAnalytics\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { toast } from \"sonner\";\r\nimport { ArrowLeft, Copy, ExternalLink, ChevronDown, BarChart3 } from \"lucide-react\";\r\nimport { PlanLimitWarning } from \"@/components/PlanLimitWarning\";\r\nimport { useRewardsSystemLazy } from \"@/hooks/useRewardsSystemLazy\";\r\n\r\nconst Share = () => {\r\n  const navigate = useNavigate();\r\n  const { awardPoints } = useRewardsSystemLazy();\r\n  const [loading, setLoading] = useState(false);\r\n  const [initialLoading, setInitialLoading] = useState(true);\r\n  const [shareLinks, setShareLinks] = useState<any[]>([]);\r\n  const [vendorProfile, setVendorProfile] = useState<any>(null);\r\n  const [expandedAnalytics, setExpandedAnalytics] = useState<string | null>(null);\r\n  const [formData, setFormData] = useState({\r\n    markup_percentage: \"\",\r\n    markdown_percentage: \"\",\r\n    expires_at: \"\",\r\n    show_vendor_details: true,\r\n    shared_categories: [\"Jewellery\", \"Gemstones\", \"Loose Diamonds\"],\r\n  });\r\n\r\n  // Fetch all data in parallel on mount\r\n  useEffect(() => {\r\n    const fetchAllData = async () => {\r\n      try {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n          setInitialLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Parallel fetch for share links and vendor profile\r\n        const [shareLinksResult, vendorProfileResult] = await Promise.all([\r\n          supabase\r\n            .from(\"share_links\")\r\n            .select(\"*\")\r\n            .order(\"created_at\", { ascending: false }),\r\n          supabase\r\n            .from(\"vendor_profiles\")\r\n            .select(\"business_name\")\r\n            .eq(\"user_id\", user.id)\r\n            .maybeSingle()\r\n        ]);\r\n\r\n        if (!shareLinksResult.error) {\r\n          setShareLinks(shareLinksResult.data || []);\r\n        }\r\n        \r\n        if (!vendorProfileResult.error && vendorProfileResult.data) {\r\n          setVendorProfile(vendorProfileResult.data);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n      } finally {\r\n        setInitialLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchAllData();\r\n  }, []);\r\n\r\n  const fetchShareLinks = useCallback(async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"share_links\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setShareLinks(data || []);\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to load share links\");\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const markup = formData.markup_percentage ? parseFloat(formData.markup_percentage) : 0;\r\n      const markdown = formData.markdown_percentage ? parseFloat(formData.markdown_percentage) : 0;\r\n\r\n      if (markup > 0 && markdown > 0) {\r\n        toast.error(\"Please use either markup or markdown, not both\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (formData.shared_categories.length === 0) {\r\n        toast.error(\"Please select at least one product category to share\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Validate expiration date is in the future\r\n      const expirationDate = new Date(formData.expires_at);\r\n      const now = new Date();\r\n      \r\n      if (expirationDate <= now) {\r\n        toast.error(\"Expiration date must be in the future\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"share_links\")\r\n        .insert([\r\n          {\r\n            user_id: user.id,\r\n            markup_percentage: markup,\r\n            markdown_percentage: markdown,\r\n            expires_at: formData.expires_at,\r\n            show_vendor_details: formData.show_vendor_details,\r\n            shared_categories: formData.shared_categories,\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      // Award points for creating share link\r\n      try {\r\n        await awardPoints('share_link_created');\r\n      } catch (pointsError) {\r\n        console.error('Failed to award points:', pointsError);\r\n      }\r\n\r\n      toast.success(\"Share link created successfully! ðŸŽ‰\");\r\n      setFormData({ \r\n        markup_percentage: \"\", \r\n        markdown_percentage: \"\", \r\n        expires_at: \"\", \r\n        show_vendor_details: true,\r\n        shared_categories: [\"Jewellery\", \"Gemstones\", \"Loose Diamonds\"]\r\n      });\r\n      fetchShareLinks();\r\n    } catch (error: any) {\r\n      toast.error(error.message || \"Failed to create share link\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const copyToClipboard = (token: string) => {\r\n    const url = `${window.location.origin}/shared/${encodeURIComponent(token)}`;\r\n    navigator.clipboard.writeText(url);\r\n    toast.success(\"Link copied to clipboard!\");\r\n  };\r\n\r\n  const toggleLinkStatus = async (id: string, currentStatus: boolean) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"share_links\")\r\n        .update({ is_active: !currentStatus })\r\n        .eq(\"id\", id);\r\n\r\n      if (error) throw error;\r\n      toast.success(currentStatus ? \"Link deactivated\" : \"Link activated\");\r\n      fetchShareLinks();\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to update link status\");\r\n    }\r\n  };\r\n\r\n  if (initialLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background py-8\">\r\n        <div className=\"container mx-auto px-4 max-w-4xl\">\r\n          <div className=\"h-10 w-32 bg-muted animate-pulse rounded mb-6\" />\r\n          <Card className=\"mb-8\">\r\n            <CardHeader>\r\n              <div className=\"h-8 w-48 bg-muted animate-pulse rounded\" />\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"h-24 bg-muted animate-pulse rounded\" />\r\n              <div className=\"h-10 bg-muted animate-pulse rounded\" />\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ApprovalGuard>\r\n      <div className=\"min-h-screen bg-background py-8\">\r\n        <div className=\"container mx-auto px-4 max-w-4xl\">\r\n          <Button variant=\"ghost\" onClick={() => navigate(\"/\")} className=\"mb-6\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Back to Catalog\r\n          </Button>\r\n\r\n          <Card className=\"mb-8\">\r\n            <CardHeader>\r\n              <CardTitle className=\"text-3xl font-serif\">Create Share Link</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {/* Plan Limit Warning */}\r\n              <div className=\"mb-6\">\r\n                <PlanLimitWarning />\r\n              </div>\r\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"markup_percentage\">Markup % (optional)</Label>\r\n                    <Input\r\n                      id=\"markup_percentage\"\r\n                      name=\"markup_percentage\"\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      min=\"0\"\r\n                      max=\"1000\"\r\n                      value={formData.markup_percentage}\r\n                      onChange={(e) =>\r\n                        setFormData({ ...formData, markup_percentage: e.target.value, markdown_percentage: \"\" })\r\n                      }\r\n                      placeholder=\"10\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"markdown_percentage\">Markdown % (optional)</Label>\r\n                    <Input\r\n                      id=\"markdown_percentage\"\r\n                      name=\"markdown_percentage\"\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      min=\"0\"\r\n                      max=\"100\"\r\n                      value={formData.markdown_percentage}\r\n                      onChange={(e) =>\r\n                        setFormData({ ...formData, markdown_percentage: e.target.value, markup_percentage: \"\" })\r\n                      }\r\n                      placeholder=\"5\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"expires_at\">Expiration Date *</Label>\r\n                  <Input\r\n                    id=\"expires_at\"\r\n                    name=\"expires_at\"\r\n                    type=\"datetime-local\"\r\n                    value={formData.expires_at}\r\n                    onChange={(e) => setFormData({ ...formData, expires_at: e.target.value })}\r\n                    min={new Date().toISOString().slice(0, 16)}\r\n                    required\r\n                  />\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    Set when this catalog link should stop working\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label>Product Categories to Share *</Label>\r\n                  <div className=\"space-y-2\">\r\n                    {[\"Jewellery\", \"Gemstones\", \"Loose Diamonds\"].map((category) => (\r\n                      <div key={category} className=\"flex items-center space-x-2\">\r\n                        <Checkbox\r\n                          id={`category-${category}`}\r\n                          checked={formData.shared_categories.includes(category)}\r\n                          onCheckedChange={(checked) => {\r\n                            if (checked) {\r\n                              setFormData({\r\n                                ...formData,\r\n                                shared_categories: [...formData.shared_categories, category],\r\n                              });\r\n                            } else {\r\n                              setFormData({\r\n                                ...formData,\r\n                                shared_categories: formData.shared_categories.filter((c) => c !== category),\r\n                              });\r\n                            }\r\n                          }}\r\n                        />\r\n                        <Label htmlFor={`category-${category}`} className=\"cursor-pointer font-normal\">\r\n                          {category}\r\n                        </Label>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    Select which product types to include in this share link\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"show_vendor_details\"\r\n                      checked={formData.show_vendor_details}\r\n                      onChange={(e) => setFormData({ ...formData, show_vendor_details: e.target.checked })}\r\n                      className=\"h-4 w-4 rounded border-input\"\r\n                    />\r\n                    <Label htmlFor=\"show_vendor_details\" className=\"cursor-pointer\">\r\n                      Show vendor details in shared catalog header\r\n                    </Label>\r\n                  </div>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    When enabled, your business name, contact info, and QR codes will be visible in the shared catalog\r\n                  </p>\r\n                </div>\r\n\r\n                <Button type=\"submit\" className=\"w-full\" disabled={loading}>\r\n                  {loading ? \"Creating Link...\" : \"Create Share Link\"}\r\n                </Button>\r\n              </form>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-2xl font-serif\">Your Share Links</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {shareLinks.length === 0 ? (\r\n                <p className=\"text-center text-muted-foreground py-8\">No share links yet</p>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {shareLinks.map((link) => {\r\n                    const shareUrl = `${window.location.origin}/shared/${encodeURIComponent(link.share_token)}`;\r\n                    const isExpiringSoon = new Date(link.expires_at).getTime() - new Date().getTime() < 24 * 60 * 60 * 1000;\r\n                    const isAnalyticsExpanded = expandedAnalytics === link.id;\r\n                    \r\n                    return (\r\n                      <Card\r\n                        key={link.id}\r\n                        className=\"border-border hover:border-primary/30 transition-colors\"\r\n                      >\r\n                        <CardContent className=\"p-4 space-y-3\">\r\n                          {/* Viral Stats */}\r\n                          <ShareStats\r\n                            viewCount={link.view_count}\r\n                            isExpiringSoon={isExpiringSoon}\r\n                            showTrending\r\n                          />\r\n                          \r\n                          <div className=\"flex items-start justify-between gap-4\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-center gap-2 flex-wrap\">\r\n                                <code className=\"text-sm bg-muted px-2 py-1 rounded truncate max-w-[200px]\">\r\n                                  {link.share_token.substring(0, 20)}...\r\n                                </code>\r\n                                <Button\r\n                                  size=\"sm\"\r\n                                  variant=\"ghost\"\r\n                                  onClick={() => copyToClipboard(link.share_token)}\r\n                                >\r\n                                  <Copy className=\"h-4 w-4\" />\r\n                                </Button>\r\n                                <Button\r\n                                  size=\"sm\"\r\n                                  variant=\"ghost\"\r\n                                  onClick={() => window.open(shareUrl, \"_blank\")}\r\n                                >\r\n                                  <ExternalLink className=\"h-4 w-4\" />\r\n                                </Button>\r\n                                \r\n                                {/* QR Code */}\r\n                                <ShareLinkQRCode\r\n                                  shareToken={link.share_token}\r\n                                  businessName={vendorProfile?.business_name}\r\n                                />\r\n                                \r\n                                {/* Social Share */}\r\n                                <SocialShareButton\r\n                                  url={shareUrl}\r\n                                  title={vendorProfile?.business_name || \"Exclusive Jewelry Collection\"}\r\n                                  description=\"Discover stunning jewelry pieces\"\r\n                                />\r\n                              </div>\r\n                              <div className=\"text-sm text-muted-foreground mt-2\">\r\n                                {link.markup_percentage > 0 && `+${link.markup_percentage}% markup`}\r\n                                {link.markdown_percentage > 0 && `-${link.markdown_percentage}% markdown`}\r\n                                {link.markup_percentage === 0 && link.markdown_percentage === 0 && \"No price adjustment\"}\r\n                                {\" â€¢ \"}\r\n                                Expires: {new Date(link.expires_at).toLocaleString()}\r\n                              </div>\r\n                              <div className=\"flex gap-1 mt-2 flex-wrap\">\r\n                                {link.shared_categories?.map((category: string) => (\r\n                                  <Badge key={category} variant=\"secondary\" className=\"text-xs\">\r\n                                    {category}\r\n                                  </Badge>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                            <Button\r\n                              size=\"sm\"\r\n                              variant={link.is_active ? \"destructive\" : \"default\"}\r\n                              onClick={() => toggleLinkStatus(link.id, link.is_active)}\r\n                            >\r\n                              {link.is_active ? \"Deactivate\" : \"Activate\"}\r\n                            </Button>\r\n                          </div>\r\n\r\n                          {/* Analytics Section */}\r\n                          <Collapsible\r\n                            open={isAnalyticsExpanded}\r\n                            onOpenChange={() => setExpandedAnalytics(isAnalyticsExpanded ? null : link.id)}\r\n                          >\r\n                            <CollapsibleTrigger asChild>\r\n                              <Button\r\n                                variant=\"outline\"\r\n                                size=\"sm\"\r\n                                className=\"w-full gap-2\"\r\n                              >\r\n                                <BarChart3 className=\"h-4 w-4\" />\r\n                                {isAnalyticsExpanded ? \"Hide Analytics\" : \"View Analytics\"}\r\n                                <ChevronDown\r\n                                  className={`h-4 w-4 transition-transform ${\r\n                                    isAnalyticsExpanded ? \"rotate-180\" : \"\"\r\n                                  }`}\r\n                                />\r\n                              </Button>\r\n                            </CollapsibleTrigger>\r\n                            <CollapsibleContent className=\"mt-4\">\r\n                              <ShareLinkAnalytics\r\n                                shareLinkId={link.id}\r\n                                viewCount={link.view_count}\r\n                              />\r\n                            </CollapsibleContent>\r\n                          </Collapsible>\r\n                        </CardContent>\r\n                      </Card>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </ApprovalGuard>\r\n  );\r\n};\r\n\r\nexport default Share;"],"names":["ShareLinkQRCode","shareToken","businessName","shareUrl","downloadQRCode","svg","svgData","canvas","ctx","img","blob","url","link","toast","printQRCode","printWindow","title","_a","Dialog","jsx","DialogTrigger","jsxs","Button","Share2","DialogContent","DialogHeader","DialogTitle","DialogDescription","QRCodeSVG","Download","ShareLinkAnalytics","shareLinkId","viewCount","loading","setLoading","useState","viewsOverTime","setViewsOverTime","topProducts","setTopProducts","totalProductViews","setTotalProductViews","useEffect","fetchAnalytics","sevenDaysAgo","subDays","productViews","error","supabase","viewsByDay","last7Days","_","i","date","dateKey","format","view","viewsData","productCounts","productData","topProductsData","id","data","a","b","Card","CardHeader","CardTitle","Eye","CardContent","Package","TrendingUp","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","Legend","Line","product","index","Badge","useRewardsSystemLazy","actionType","actionDetails","Share","navigate","useNavigate","awardPoints","initialLoading","setInitialLoading","shareLinks","setShareLinks","vendorProfile","setVendorProfile","expandedAnalytics","setExpandedAnalytics","formData","setFormData","user","shareLinksResult","vendorProfileResult","fetchShareLinks","useCallback","handleSubmit","e","markup","markdown","pointsError","copyToClipboard","token","toggleLinkStatus","currentStatus","ApprovalGuard","ArrowLeft","PlanLimitWarning","Label","Input","category","Checkbox","checked","c","isExpiringSoon","isAnalyticsExpanded","ShareStats","Copy","ExternalLink","SocialShareButton","Collapsible","CollapsibleTrigger","BarChart3","ChevronDown","CollapsibleContent"],"mappings":"ulCAkBO,MAAMA,GAAkB,CAAC,CAAE,WAAAC,EAAY,aAAAC,KAAyC,CACrF,MAAMC,EAAW,GAAG,OAAO,SAAS,MAAM,WAAW,mBAAmBF,CAAU,CAAC,GAE7EG,EAAiB,IAAM,CAC3B,MAAMC,EAAM,SAAS,eAAe,MAAMJ,CAAU,EAAE,EACtD,GAAI,CAACI,EAAK,OAEV,MAAMC,EAAU,IAAI,gBAAgB,kBAAkBD,CAAG,EACnDE,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAMD,EAAO,WAAW,IAAI,EAC5BE,EAAM,IAAI,MAEhBA,EAAI,OAAS,IAAM,CACjBF,EAAO,MAAQE,EAAI,MACnBF,EAAO,OAASE,EAAI,OACpBD,GAAA,MAAAA,EAAK,UAAUC,EAAK,EAAG,GAEvBF,EAAO,OAAQG,GAAS,CACtB,GAAIA,EAAM,CACR,MAAMC,EAAM,IAAI,gBAAgBD,CAAI,EAC9BE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAW,cAAcX,EAAW,UAAU,EAAG,CAAC,CAAC,OACxDW,EAAK,MAAA,EACL,IAAI,gBAAgBD,CAAG,EACvBE,EAAM,QAAQ,qBAAqB,CACrC,CACF,CAAC,CACH,EAEAJ,EAAI,IAAM,6BAA+B,KAAKH,CAAO,CACvD,EAEMQ,EAAc,IAAM,OACxB,MAAMC,EAAc,OAAO,KAAK,GAAI,QAAQ,EAC5C,GAAI,CAACA,EAAa,OAElB,MAAMC,EAAQd,GAAgB,kBAC9Ba,EAAY,SAAS,MAAM;AAAA;AAAA;AAAA;AAAA,6BAIFC,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAmChBA,CAAK;AAAA;AAAA,kBAEPC,EAAA,SAAS,eAAe,MAAMhB,CAAU,EAAE,IAA1C,YAAAgB,EAA6C,YAAa,EAAE;AAAA;AAAA;AAAA;AAAA,8DAIdd,CAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,KAKjE,EACDY,EAAY,SAAS,MAAA,EACrB,WAAW,IAAM,CACfA,EAAY,MAAA,CACd,EAAG,GAAG,CACR,EAEA,cACGG,EAAA,CACC,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAc,QAAO,GACpB,SAAAC,EAAAA,KAACC,EAAA,CAAO,QAAQ,UAAU,KAAK,KAAK,UAAU,QAC5C,SAAA,CAAAH,EAAAA,IAACI,EAAA,CAAO,UAAU,SAAA,CAAU,EAAE,SAAA,CAAA,CAEhC,CAAA,CACF,EACAF,EAAAA,KAACG,EAAA,CAAc,UAAU,cACvB,SAAA,CAAAH,OAACI,EAAA,CACC,SAAA,CAAAN,EAAAA,IAACO,GAAY,SAAA,oBAAA,CAAkB,EAC/BP,EAAAA,IAACQ,GAAkB,SAAA,8DAAA,CAEnB,CAAA,EACF,EAEAN,EAAAA,KAAC,MAAA,CAAI,UAAU,wCAEb,SAAA,CAAAF,EAAAA,IAAC,MAAA,CAAI,UAAU,+DACb,SAAAA,EAAAA,IAACS,EAAA,CACC,GAAI,MAAM3B,CAAU,GACpB,MAAOE,EACP,KAAM,IACN,MAAM,IACN,cAAa,EAAA,CAAA,EAEjB,EAGAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAF,EAAAA,IAAC,IAAA,CAAE,UAAU,iDAAiD,SAAA,gBAE9D,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,8DACZ,SAAAhB,CAAA,CACH,CAAA,EACF,EAGAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAA,EAAAA,KAACC,EAAA,CACC,QAASlB,EACT,QAAQ,UACR,UAAU,eAEV,SAAA,CAAAe,EAAAA,IAACU,EAAA,CAAS,UAAU,SAAA,CAAU,EAAE,UAAA,CAAA,CAAA,EAGlCR,EAAAA,KAACC,EAAA,CACC,QAASR,EACT,UAAU,eAEV,SAAA,CAAAK,EAAAA,IAAC,MAAA,CACC,UAAU,UACV,KAAK,OACL,OAAO,eACP,QAAQ,YAER,SAAAA,EAAAA,IAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,8KAAA,CAAA,CACJ,CAAA,EACI,OAAA,CAAA,CAAA,CAER,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,CAEJ,ECjKaW,GAAqB,CAAC,CAAE,YAAAC,EAAa,UAAAC,KAAyC,CACzF,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAI,EACrC,CAACC,EAAeC,CAAgB,EAAIF,EAAAA,SAAgB,CAAA,CAAE,EACtD,CAACG,EAAaC,CAAc,EAAIJ,EAAAA,SAAgB,CAAA,CAAE,EAClD,CAACK,EAAmBC,CAAoB,EAAIN,EAAAA,SAAS,CAAC,EAE5DO,EAAAA,UAAU,IAAM,CACdC,EAAA,CACF,EAAG,CAACZ,CAAW,CAAC,EAEhB,MAAMY,EAAiB,SAAY,CACjCT,EAAW,EAAI,EACf,GAAI,CAEF,MAAMU,EAAeC,EAAQ,IAAI,KAAQ,CAAC,EAEpC,CAAE,KAAMC,EAAc,MAAAC,CAAA,EAAU,MAAMC,EACzC,KAAK,0BAA0B,EAC/B,OAAO,kDAAkD,EACzD,GAAG,gBAAiBjB,CAAW,EAC/B,IAAI,YAAaa,EAAa,aAAa,EAE9C,GAAIG,EAAO,MAAMA,EAGjB,MAAME,EAAqC,CAAA,EACrCC,EAAY,MAAM,KAAK,CAAE,OAAQ,CAAA,EAAK,CAACC,EAAGC,IAAM,CACpD,MAAMC,EAAOR,EAAQ,IAAI,KAAQ,EAAIO,CAAC,EAChCE,EAAUC,EAAOF,EAAM,QAAQ,EACrC,OAAAJ,EAAWK,CAAO,EAAI,EACfA,CACT,CAAC,EAEDR,GAAA,MAAAA,EAAc,QAASU,GAAS,CAC9B,MAAMF,EAAUC,EAAO,IAAI,KAAKC,EAAK,SAAS,EAAG,QAAQ,EACrDF,KAAWL,GACbA,EAAWK,CAAO,GAEtB,GAEA,MAAMG,EAAYP,EAAU,IAAKG,IAAU,CACzC,KAAAA,EACA,MAAOJ,EAAWI,CAAI,GAAK,CAAA,EAC3B,EAEFhB,EAAiBoB,CAAS,EAG1B,MAAMC,EAAuF,CAAA,EAC7FZ,GAAA,MAAAA,EAAc,QAASU,GAAS,CAC9B,MAAMG,EAAcH,EAAK,SACrBG,GAAeH,EAAK,aACjBE,EAAcF,EAAK,UAAU,IAChCE,EAAcF,EAAK,UAAU,EAAI,CAC/B,MAAO,EACP,KAAMG,EAAY,MAAQ,kBAC1B,MAAOA,EAAY,WAAa,IAAA,GAGpCD,EAAcF,EAAK,UAAU,EAAE,QAEnC,GAEA,MAAMI,EAAkB,OAAO,QAAQF,CAAa,EACjD,IAAI,CAAC,CAACG,EAAIC,CAAI,KAAO,CACpB,GAAAD,EACA,KAAMC,EAAK,KACX,MAAOA,EAAK,MACZ,MAAOA,EAAK,KAAA,EACZ,EACD,KAAK,CAACC,EAAGC,IAAMA,EAAE,MAAQD,EAAE,KAAK,EAChC,MAAM,EAAG,CAAC,EAEbxB,EAAeqB,CAAe,EAC9BnB,GAAqBK,GAAA,YAAAA,EAAc,SAAU,CAAC,CAChD,OAASC,EAAO,CACd,QAAQ,MAAM,4BAA6BA,CAAK,CAClD,QAAA,CACEb,EAAW,EAAK,CAClB,CACF,EAEA,OAAID,EAEAZ,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAF,EAAAA,IAAC,MAAA,CAAI,UAAU,wCAAA,CAAyC,EACxDA,EAAAA,IAAC,MAAA,CAAI,UAAU,wCAAA,CAAyC,CAAA,EAC1D,EAKFE,EAAAA,KAAC,MAAA,CAAI,UAAU,YAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,OAAC4C,EAAA,CACC,SAAA,CAAA5C,EAAAA,KAAC6C,EAAA,CAAW,UAAU,4DACpB,SAAA,CAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,sBAAsB,SAAA,gBAAa,EACxDhD,EAAAA,IAACiD,GAAA,CAAI,UAAU,+BAAA,CAAgC,CAAA,EACjD,SACCC,EAAA,CACC,SAAA,CAAAlD,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAsB,SAAAa,EAAU,EAC/Cb,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,kBAAA,CAAgB,CAAA,CAAA,CAC/D,CAAA,EACF,SAEC8C,EAAA,CACC,SAAA,CAAA5C,EAAAA,KAAC6C,EAAA,CAAW,UAAU,4DACpB,SAAA,CAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,sBAAsB,SAAA,gBAAa,EACxDhD,EAAAA,IAACmD,GAAA,CAAQ,UAAU,+BAAA,CAAgC,CAAA,EACrD,SACCD,EAAA,CACC,SAAA,CAAAlD,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAsB,SAAAqB,EAAkB,EACvDrB,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,0BAAA,CAAwB,CAAA,CAAA,CACvE,CAAA,EACF,SAEC8C,EAAA,CACC,SAAA,CAAA5C,EAAAA,KAAC6C,EAAA,CAAW,UAAU,4DACpB,SAAA,CAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,sBAAsB,SAAA,kBAAe,EAC1DhD,EAAAA,IAACoD,GAAA,CAAW,UAAU,+BAAA,CAAgC,CAAA,EACxD,SACCF,EAAA,CACC,SAAA,CAAAhD,EAAAA,KAAC,MAAA,CAAI,UAAU,qBACZ,SAAA,CAAAW,EAAY,GAAMQ,EAAoBR,EAAa,KAAK,QAAQ,CAAC,EAAI,IAAI,GAAA,EAC5E,EACAb,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,oBAAA,CAAkB,CAAA,CAAA,CACjE,CAAA,CAAA,CACF,CAAA,EACF,SAGC8C,EAAA,CACC,SAAA,CAAA9C,EAAAA,IAAC+C,GACC,SAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,YAAY,yCAA6B,CAAA,CAChE,EACAhD,EAAAA,IAACkD,EAAA,CACC,SAAAlD,EAAAA,IAACqD,GAAA,CAAoB,MAAM,OAAO,OAAQ,IACxC,SAAAnD,OAACoD,GAAA,CAAU,KAAMrC,EACf,SAAA,CAAAjB,EAAAA,IAACuD,GAAA,CAAc,gBAAgB,KAAA,CAAM,EACrCvD,EAAAA,IAACwD,GAAA,CAAM,QAAQ,MAAA,CAAO,QACrBC,GAAA,EAAM,QACNC,GAAA,EAAQ,QACRC,GAAA,EAAO,EACR3D,EAAAA,IAAC4D,GAAA,CACC,KAAK,WACL,QAAQ,QACR,OAAO,sBACP,YAAa,EACb,IAAK,CAAE,KAAM,qBAAA,CAAsB,CAAA,CACrC,CAAA,CACF,EACF,CAAA,CACF,CAAA,EACF,EAGCzC,EAAY,OAAS,GACpBjB,EAAAA,KAAC4C,EAAA,CACC,SAAA,CAAA9C,EAAAA,IAAC+C,GACC,SAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,YAAY,gCAAoB,CAAA,CACvD,EACAhD,MAACkD,EAAA,CACC,SAAAlD,EAAAA,IAAC,MAAA,CAAI,UAAU,YACZ,SAAAmB,EAAY,IAAI,CAAC0C,EAASC,IACzB5D,EAAAA,KAAC,MAAA,CAAqB,UAAU,0BAC9B,SAAA,CAAAF,MAAC+D,GAAM,QAAQ,YAAY,UAAU,8BAClC,WAAQ,EACX,EACCF,EAAQ,OACP7D,EAAAA,IAAC,MAAA,CACC,IAAK6D,EAAQ,MACb,IAAKA,EAAQ,KACb,UAAU,mCAAA,CAAA,EAGd3D,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAF,EAAAA,IAAC,IAAA,CAAE,UAAU,+BAAgC,SAAA6D,EAAQ,KAAK,EAC1D3D,EAAAA,KAAC,IAAA,CAAE,UAAU,gCAAiC,SAAA,CAAA2D,EAAQ,MAAM,QAAA,CAAA,CAAM,CAAA,EACpE,EACA7D,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,8BACV,MAAO,CACL,MAAO,GAAI6D,EAAQ,MAAQ1C,EAAY,CAAC,EAAE,MAAS,GAAG,GAAA,CACxD,CAAA,CACF,CACF,CAAA,CAAA,EAtBQ0C,EAAQ,EAuBlB,CACD,CAAA,CACH,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EAEJ,CAEJ,ECtNaG,GAAuB,KAkB3B,CAAE,YAjBW,MAAOC,EAAoBC,IAAwB,CACrE,GAAI,CACF,KAAM,CAAE,KAAAvB,EAAM,MAAAf,CAAA,EAAU,MAAMC,EAAS,UAAU,OAAO,eAAgB,CACtE,KAAM,CACJ,YAAaoC,EACb,eAAgBC,CAAA,CAClB,CACD,EAED,GAAItC,EAAO,MAAMA,EACjB,OAAOe,CACT,OAASf,EAAO,CACd,cAAQ,MAAM,yBAA0BA,CAAK,EACvCA,CACR,CACF,CAES,GCJLuC,GAAQ,IAAM,CAClB,MAAMC,EAAWC,EAAA,EACX,CAAE,YAAAC,CAAA,EAAgBN,GAAA,EAClB,CAAClD,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAK,EACtC,CAACuD,EAAgBC,CAAiB,EAAIxD,EAAAA,SAAS,EAAI,EACnD,CAACyD,EAAYC,CAAa,EAAI1D,EAAAA,SAAgB,CAAA,CAAE,EAChD,CAAC2D,EAAeC,CAAgB,EAAI5D,EAAAA,SAAc,IAAI,EACtD,CAAC6D,EAAmBC,CAAoB,EAAI9D,EAAAA,SAAwB,IAAI,EACxE,CAAC+D,EAAUC,CAAW,EAAIhE,WAAS,CACvC,kBAAmB,GACnB,oBAAqB,GACrB,WAAY,GACZ,oBAAqB,GACrB,kBAAmB,CAAC,YAAa,YAAa,gBAAgB,CAAA,CAC/D,EAGDO,EAAAA,UAAU,IAAM,EACO,SAAY,CAC/B,GAAI,CACF,KAAM,CAAE,KAAM,CAAE,KAAA0D,CAAA,GAAW,MAAMpD,EAAS,KAAK,QAAA,EAC/C,GAAI,CAACoD,EAAM,CACTT,EAAkB,EAAK,EACvB,MACF,CAGA,KAAM,CAACU,EAAkBC,CAAmB,EAAI,MAAM,QAAQ,IAAI,CAChEtD,EACG,KAAK,aAAa,EAClB,OAAO,GAAG,EACV,MAAM,aAAc,CAAE,UAAW,EAAA,CAAO,EAC3CA,EACG,KAAK,iBAAiB,EACtB,OAAO,eAAe,EACtB,GAAG,UAAWoD,EAAK,EAAE,EACrB,YAAA,CAAY,CAChB,EAEIC,EAAiB,OACpBR,EAAcQ,EAAiB,MAAQ,EAAE,EAGvC,CAACC,EAAoB,OAASA,EAAoB,MACpDP,EAAiBO,EAAoB,IAAI,CAE7C,OAASvD,EAAO,CACd,QAAQ,MAAM,uBAAwBA,CAAK,CAC7C,QAAA,CACE4C,EAAkB,EAAK,CACzB,CACF,GAEA,CACF,EAAG,CAAA,CAAE,EAEL,MAAMY,EAAkBC,EAAAA,YAAY,SAAY,CAC9C,GAAI,CACF,KAAM,CAAE,KAAA1C,EAAM,MAAAf,CAAA,EAAU,MAAMC,EAC3B,KAAK,aAAa,EAClB,OAAO,GAAG,EACV,MAAM,aAAc,CAAE,UAAW,GAAO,EAE3C,GAAID,EAAO,MAAMA,EACjB8C,EAAc/B,GAAQ,EAAE,CAC1B,MAAqB,CACnBjD,EAAM,MAAM,4BAA4B,CAC1C,CACF,EAAG,CAAA,CAAE,EAEC4F,EAAe,MAAOC,GAAuB,CACjDA,EAAE,eAAA,EACFxE,EAAW,EAAI,EAEf,GAAI,CACF,KAAM,CAAE,KAAM,CAAE,KAAAkE,CAAA,GAAW,MAAMpD,EAAS,KAAK,QAAA,EAC/C,GAAI,CAACoD,EAAM,MAAM,IAAI,MAAM,mBAAmB,EAE9C,MAAMO,EAAST,EAAS,kBAAoB,WAAWA,EAAS,iBAAiB,EAAI,EAC/EU,EAAWV,EAAS,oBAAsB,WAAWA,EAAS,mBAAmB,EAAI,EAE3F,GAAIS,EAAS,GAAKC,EAAW,EAAG,CAC9B/F,EAAM,MAAM,gDAAgD,EAC5DqB,EAAW,EAAK,EAChB,MACF,CAEA,GAAIgE,EAAS,kBAAkB,SAAW,EAAG,CAC3CrF,EAAM,MAAM,sDAAsD,EAClEqB,EAAW,EAAK,EAChB,MACF,CAMA,GAHuB,IAAI,KAAKgE,EAAS,UAAU,OACnC,KAEW,CACzBrF,EAAM,MAAM,uCAAuC,EACnDqB,EAAW,EAAK,EAChB,MACF,CAEA,KAAM,CAAE,KAAA4B,GAAM,MAAAf,GAAU,MAAMC,EAC3B,KAAK,aAAa,EAClB,OAAO,CACN,CACE,QAASoD,EAAK,GACd,kBAAmBO,EACnB,oBAAqBC,EACrB,WAAYV,EAAS,WACrB,oBAAqBA,EAAS,oBAC9B,kBAAmBA,EAAS,iBAAA,CAC9B,CACD,EACA,OAAA,EACA,OAAA,EAEH,GAAInD,EAAO,MAAMA,EAGjB,GAAI,CACF,MAAM0C,EAAY,oBAAoB,CACxC,OAASoB,EAAa,CACpB,QAAQ,MAAM,0BAA2BA,CAAW,CACtD,CAEAhG,EAAM,QAAQ,qCAAqC,EACnDsF,EAAY,CACV,kBAAmB,GACnB,oBAAqB,GACrB,WAAY,GACZ,oBAAqB,GACrB,kBAAmB,CAAC,YAAa,YAAa,gBAAgB,CAAA,CAC/D,EACDI,EAAA,CACF,OAASxD,EAAY,CACnBlC,EAAM,MAAMkC,EAAM,SAAW,6BAA6B,CAC5D,QAAA,CACEb,EAAW,EAAK,CAClB,CACF,EAEM4E,EAAmBC,GAAkB,CACzC,MAAMpG,EAAM,GAAG,OAAO,SAAS,MAAM,WAAW,mBAAmBoG,CAAK,CAAC,GACzE,UAAU,UAAU,UAAUpG,CAAG,EACjCE,EAAM,QAAQ,2BAA2B,CAC3C,EAEMmG,EAAmB,MAAOnD,EAAYoD,IAA2B,CACrE,GAAI,CACF,KAAM,CAAE,MAAAlE,CAAA,EAAU,MAAMC,EACrB,KAAK,aAAa,EAClB,OAAO,CAAE,UAAW,CAACiE,CAAA,CAAe,EACpC,GAAG,KAAMpD,CAAE,EAEd,GAAId,EAAO,MAAMA,EACjBlC,EAAM,QAAQoG,EAAgB,mBAAqB,gBAAgB,EACnEV,EAAA,CACF,MAAqB,CACnB1F,EAAM,MAAM,8BAA8B,CAC5C,CACF,EAEA,OAAI6E,QAEC,MAAA,CAAI,UAAU,kCACb,SAAArE,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAF,EAAAA,IAAC,MAAA,CAAI,UAAU,+CAAA,CAAgD,EAC/DE,EAAAA,KAAC4C,EAAA,CAAK,UAAU,OACd,SAAA,CAAA9C,MAAC+C,EAAA,CACC,SAAA/C,EAAAA,IAAC,MAAA,CAAI,UAAU,0CAA0C,EAC3D,EACAE,EAAAA,KAACgD,EAAA,CAAY,UAAU,YACrB,SAAA,CAAAlD,EAAAA,IAAC,MAAA,CAAI,UAAU,qCAAA,CAAsC,EACrDA,EAAAA,IAAC,MAAA,CAAI,UAAU,qCAAA,CAAsC,CAAA,CAAA,CACvD,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAKFA,EAAAA,IAAC+F,GACC,SAAA/F,EAAAA,IAAC,MAAA,CAAI,UAAU,kCACb,SAAAE,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAA,EAAAA,KAACC,EAAA,CAAO,QAAQ,QAAQ,QAAS,IAAMiE,EAAS,GAAG,EAAG,UAAU,OAC9D,SAAA,CAAApE,EAAAA,IAACgG,GAAA,CAAU,UAAU,cAAA,CAAe,EAAE,iBAAA,EAExC,EAEA9F,EAAAA,KAAC4C,EAAA,CAAK,UAAU,OACd,SAAA,CAAA9C,EAAAA,IAAC+C,GACC,SAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,sBAAsB,6BAAiB,CAAA,CAC9D,SACCE,EAAA,CAEC,SAAA,CAAAlD,MAAC,MAAA,CAAI,UAAU,OACb,SAAAA,MAACiG,KAAiB,EACpB,EACA/F,EAAAA,KAAC,OAAA,CAAK,SAAUoF,EAAc,UAAU,YACtC,SAAA,CAAApF,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAF,EAAAA,IAACkG,EAAA,CAAM,QAAQ,oBAAoB,SAAA,sBAAmB,EACtDlG,EAAAA,IAACmG,EAAA,CACC,GAAG,oBACH,KAAK,oBACL,KAAK,SACL,KAAK,OACL,IAAI,IACJ,IAAI,OACJ,MAAOpB,EAAS,kBAChB,SAAWQ,GACTP,EAAY,CAAE,GAAGD,EAAU,kBAAmBQ,EAAE,OAAO,MAAO,oBAAqB,GAAI,EAEzF,YAAY,IAAA,CAAA,CACd,EACF,EAEArF,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAF,EAAAA,IAACkG,EAAA,CAAM,QAAQ,sBAAsB,SAAA,wBAAqB,EAC1DlG,EAAAA,IAACmG,EAAA,CACC,GAAG,sBACH,KAAK,sBACL,KAAK,SACL,KAAK,OACL,IAAI,IACJ,IAAI,MACJ,MAAOpB,EAAS,oBAChB,SAAWQ,GACTP,EAAY,CAAE,GAAGD,EAAU,oBAAqBQ,EAAE,OAAO,MAAO,kBAAmB,GAAI,EAEzF,YAAY,GAAA,CAAA,CACd,CAAA,CACF,CAAA,EACF,EAEArF,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAF,EAAAA,IAACkG,EAAA,CAAM,QAAQ,aAAa,SAAA,oBAAiB,EAC7ClG,EAAAA,IAACmG,EAAA,CACC,GAAG,aACH,KAAK,aACL,KAAK,iBACL,MAAOpB,EAAS,WAChB,SAAWQ,GAAMP,EAAY,CAAE,GAAGD,EAAU,WAAYQ,EAAE,OAAO,MAAO,EACxE,QAAS,KAAA,EAAO,cAAc,MAAM,EAAG,EAAE,EACzC,SAAQ,EAAA,CAAA,EAEVvF,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,gDAAA,CAE7C,CAAA,EACF,EAEAE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAF,EAAAA,IAACkG,GAAM,SAAA,+BAAA,CAA6B,EACpClG,EAAAA,IAAC,MAAA,CAAI,UAAU,YACZ,UAAC,YAAa,YAAa,gBAAgB,EAAE,IAAKoG,GACjDlG,EAAAA,KAAC,MAAA,CAAmB,UAAU,8BAC5B,SAAA,CAAAF,EAAAA,IAACqG,EAAA,CACC,GAAI,YAAYD,CAAQ,GACxB,QAASrB,EAAS,kBAAkB,SAASqB,CAAQ,EACrD,gBAAkBE,GAAY,CAE1BtB,EADEsB,EACU,CACV,GAAGvB,EACH,kBAAmB,CAAC,GAAGA,EAAS,kBAAmBqB,CAAQ,CAAA,EAGjD,CACV,GAAGrB,EACH,kBAAmBA,EAAS,kBAAkB,OAAQwB,GAAMA,IAAMH,CAAQ,CAAA,CAJ3E,CAOL,CAAA,CAAA,EAEFpG,EAAAA,IAACkG,GAAM,QAAS,YAAYE,CAAQ,GAAI,UAAU,6BAC/C,SAAAA,CAAA,CACH,CAAA,GApBQA,CAqBV,CACD,EACH,EACApG,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,0DAAA,CAE7C,CAAA,EACF,EAEAE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAF,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,GAAG,sBACH,QAAS+E,EAAS,oBAClB,SAAWQ,GAAMP,EAAY,CAAE,GAAGD,EAAU,oBAAqBQ,EAAE,OAAO,QAAS,EACnF,UAAU,8BAAA,CAAA,QAEXW,EAAA,CAAM,QAAQ,sBAAsB,UAAU,iBAAiB,SAAA,8CAAA,CAEhE,CAAA,EACF,EACAlG,EAAAA,IAAC,IAAA,CAAE,UAAU,gCAAgC,SAAA,oGAAA,CAE7C,CAAA,EACF,EAEAA,EAAAA,IAACG,EAAA,CAAO,KAAK,SAAS,UAAU,SAAS,SAAUW,EAChD,SAAAA,EAAU,mBAAqB,mBAAA,CAClC,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,SAECgC,EAAA,CACC,SAAA,CAAA9C,EAAAA,IAAC+C,GACC,SAAA/C,EAAAA,IAACgD,EAAA,CAAU,UAAU,sBAAsB,4BAAgB,CAAA,CAC7D,QACCE,EAAA,CACE,SAAAuB,EAAW,SAAW,EACrBzE,MAAC,KAAE,UAAU,yCAAyC,SAAA,qBAAkB,QAEvE,MAAA,CAAI,UAAU,YACZ,SAAAyE,EAAW,IAAKhF,GAAS,OACxB,MAAMT,EAAW,GAAG,OAAO,SAAS,MAAM,WAAW,mBAAmBS,EAAK,WAAW,CAAC,GACnF+G,EAAiB,IAAI,KAAK/G,EAAK,UAAU,EAAE,QAAA,EAAY,IAAI,OAAO,QAAA,EAAY,GAAK,GAAK,GAAK,IAC7FgH,EAAsB5B,IAAsBpF,EAAK,GAEvD,OACEO,EAAAA,IAAC8C,EAAA,CAEC,UAAU,0DAEV,SAAA5C,EAAAA,KAACgD,EAAA,CAAY,UAAU,gBAErB,SAAA,CAAAlD,EAAAA,IAAC0G,EAAA,CACC,UAAWjH,EAAK,WAChB,eAAA+G,EACA,aAAY,EAAA,CAAA,EAGdtG,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,4DACb,SAAA,CAAAT,EAAK,YAAY,UAAU,EAAG,EAAE,EAAE,KAAA,EACrC,EACAO,EAAAA,IAACG,EAAA,CACC,KAAK,KACL,QAAQ,QACR,QAAS,IAAMwF,EAAgBlG,EAAK,WAAW,EAE/C,SAAAO,EAAAA,IAAC2G,GAAA,CAAK,UAAU,SAAA,CAAU,CAAA,CAAA,EAE5B3G,EAAAA,IAACG,EAAA,CACC,KAAK,KACL,QAAQ,QACR,QAAS,IAAM,OAAO,KAAKnB,EAAU,QAAQ,EAE7C,SAAAgB,EAAAA,IAAC4G,GAAA,CAAa,UAAU,SAAA,CAAU,CAAA,CAAA,EAIpC5G,EAAAA,IAACnB,GAAA,CACC,WAAYY,EAAK,YACjB,aAAckF,GAAA,YAAAA,EAAe,aAAA,CAAA,EAI/B3E,EAAAA,IAAC6G,EAAA,CACC,IAAK7H,EACL,OAAO2F,GAAA,YAAAA,EAAe,gBAAiB,+BACvC,YAAY,kCAAA,CAAA,CACd,EACF,EACAzE,EAAAA,KAAC,MAAA,CAAI,UAAU,qCACZ,SAAA,CAAAT,EAAK,kBAAoB,GAAK,IAAIA,EAAK,iBAAiB,WACxDA,EAAK,oBAAsB,GAAK,IAAIA,EAAK,mBAAmB,aAC5DA,EAAK,oBAAsB,GAAKA,EAAK,sBAAwB,GAAK,sBAClE,MAAM,YACG,IAAI,KAAKA,EAAK,UAAU,EAAE,eAAA,CAAe,EACrD,QACC,MAAA,CAAI,UAAU,4BACZ,UAAAK,EAAAL,EAAK,oBAAL,YAAAK,EAAwB,IAAKsG,GAC5BpG,EAAAA,IAAC+D,EAAA,CAAqB,QAAQ,YAAY,UAAU,UACjD,SAAAqC,CAAA,EADSA,CAEZ,EACD,CACH,CAAA,EACF,EACApG,EAAAA,IAACG,EAAA,CACC,KAAK,KACL,QAASV,EAAK,UAAY,cAAgB,UAC1C,QAAS,IAAMoG,EAAiBpG,EAAK,GAAIA,EAAK,SAAS,EAEtD,SAAAA,EAAK,UAAY,aAAe,UAAA,CAAA,CACnC,EACF,EAGAS,EAAAA,KAAC4G,GAAA,CACC,KAAML,EACN,aAAc,IAAM3B,EAAqB2B,EAAsB,KAAOhH,EAAK,EAAE,EAE7E,SAAA,CAAAO,EAAAA,IAAC+G,GAAA,CAAmB,QAAO,GACzB,SAAA7G,EAAAA,KAACC,EAAA,CACC,QAAQ,UACR,KAAK,KACL,UAAU,eAEV,SAAA,CAAAH,EAAAA,IAACgH,GAAA,CAAU,UAAU,SAAA,CAAU,EAC9BP,EAAsB,iBAAmB,iBAC1CzG,EAAAA,IAACiH,GAAA,CACC,UAAW,gCACTR,EAAsB,aAAe,EACvC,EAAA,CAAA,CACF,CAAA,CAAA,EAEJ,EACAzG,EAAAA,IAACkH,GAAA,CAAmB,UAAU,OAC5B,SAAAlH,EAAAA,IAACW,GAAA,CACC,YAAalB,EAAK,GAClB,UAAWA,EAAK,UAAA,CAAA,CAClB,CACF,CAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAhGKA,EAAK,EAAA,CAmGhB,CAAC,EACH,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,CAAA,CACF,EACF,EACF,CAEJ"}