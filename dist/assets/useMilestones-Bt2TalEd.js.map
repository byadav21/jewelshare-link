{"version":3,"file":"useMilestones-Bt2TalEd.js","sources":["../../src/hooks/useMilestones.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\ninterface Milestone {\r\n  id: string;\r\n  milestone_type: string;\r\n  milestone_value: number;\r\n  achieved_at: string;\r\n  points_awarded: number;\r\n}\r\n\r\nexport const useMilestones = () => {\r\n  const [milestones, setMilestones] = useState<Milestone[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [latestMilestone, setLatestMilestone] = useState<Milestone | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchMilestones();\r\n    setupRealtimeListener();\r\n  }, []);\r\n\r\n  const fetchMilestones = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"vendor_milestones\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .order(\"achieved_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setMilestones(data || []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching milestones:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const setupRealtimeListener = () => {\r\n    const channel = supabase\r\n      .channel('milestone-achievements')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'vendor_milestones',\r\n        },\r\n        (payload: any) => {\r\n          if (payload.new) {\r\n            setLatestMilestone(payload.new);\r\n            setMilestones(prev => [payload.new, ...prev]);\r\n          }\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  };\r\n\r\n  const clearLatestMilestone = () => {\r\n    setLatestMilestone(null);\r\n  };\r\n\r\n  return {\r\n    milestones,\r\n    loading,\r\n    latestMilestone,\r\n    clearLatestMilestone,\r\n    refetch: fetchMilestones\r\n  };\r\n};\r\n"],"names":["useMilestones","milestones","setMilestones","useState","loading","setLoading","latestMilestone","setLatestMilestone","useEffect","fetchMilestones","setupRealtimeListener","user","supabase","data","error","channel","payload","prev"],"mappings":"uFAWO,MAAMA,EAAgB,IAAM,CACjC,KAAM,CAACC,EAAYC,CAAa,EAAIC,EAAAA,SAAsB,CAAA,CAAE,EACtD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAiBC,CAAkB,EAAIJ,EAAAA,SAA2B,IAAI,EAE7EK,EAAAA,UAAU,IAAM,CACdC,EAAA,EACAC,EAAA,CACF,EAAG,CAAA,CAAE,EAEL,MAAMD,EAAkB,SAAY,CAClC,GAAI,CACF,KAAM,CAAE,KAAM,CAAE,KAAAE,CAAA,GAAW,MAAMC,EAAS,KAAK,QAAA,EAC/C,GAAI,CAACD,EAAM,OAEX,KAAM,CAAE,KAAAE,EAAM,MAAAC,GAAU,MAAMF,EAC3B,KAAK,mBAAmB,EACxB,OAAO,GAAG,EACV,GAAG,UAAWD,EAAK,EAAE,EACrB,MAAM,cAAe,CAAE,UAAW,GAAO,EAE5C,GAAIG,EAAO,MAAMA,EACjBZ,EAAcW,GAAQ,EAAE,CAC1B,OAASC,EAAO,CACd,QAAQ,MAAM,6BAA8BA,CAAK,CACnD,QAAA,CACET,EAAW,EAAK,CAClB,CACF,EAEMK,EAAwB,IAAM,CAClC,MAAMK,EAAUH,EACb,QAAQ,wBAAwB,EAChC,GACC,mBACA,CACE,MAAO,SACP,OAAQ,SACR,MAAO,mBAAA,EAERI,GAAiB,CACZA,EAAQ,MACVT,EAAmBS,EAAQ,GAAG,EAC9Bd,KAAsB,CAACc,EAAQ,IAAK,GAAGC,CAAI,CAAC,EAEhD,CAAA,EAED,UAAA,EAEH,MAAO,IAAM,CACXL,EAAS,cAAcG,CAAO,CAChC,CACF,EAMA,MAAO,CACL,WAAAd,EACA,QAAAG,EACA,gBAAAE,EACA,qBAR2B,IAAM,CACjCC,EAAmB,IAAI,CACzB,EAOE,QAASE,CAAA,CAEb"}