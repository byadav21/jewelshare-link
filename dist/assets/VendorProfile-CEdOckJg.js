import{j as e}from"./query-vendor-CIvqgC9B.js";import{r as m,u as q}from"./react-vendor-BCzWReGx.js";import{q as E,l as p,B as _,Z as B,C as P,t as A,x as U,o as T}from"./index-DBHw7ps1.js";import{I as l}from"./input-CpEp8mrX.js";import{L as o}from"./label-Di_dI0OZ.js";import{T as D}from"./textarea-Bx7WjwE9.js";import{L}from"./LogoUpload-fMBNF6Kv.js";import{ak as I,O as S,b6 as R,u as j,a3 as W,s as C,B as k}from"./ui-vendor-B3Ur81tx.js";import{S as M}from"./switch-BY5jX96K.js";import"./supabase-vendor-DJknrin8.js";import"./dialog-acGhLkoK.js";import"./index-BswhvY0M.js";import"./index-vsC2Ycwh.js";import"./slider-DZxkH-Nl.js";import"./index-BdQq_4o_.js";import"./index-lgWsV-kP.js";import"./index-D6hZrTqZ.js";const V="BMmVcxQGW79VsFPEEQjGNnsiZPsD5W7MFPgC4STmGux9RfH_qAZ8466WmYBcnz8rqD1rvRL3t_WD7EXvHIrUA3w";function $(h){const f="=".repeat((4-h.length%4)%4),y=(h+f).replace(/-/g,"+").replace(/_/g,"/"),c=window.atob(y),g=new Uint8Array(c.length);for(let d=0;d<c.length;++d)g[d]=c.charCodeAt(d);return g.buffer}function G(){const[h,f]=m.useState(!1),[y,c]=m.useState(!1),[g,d]=m.useState(!0),[x,r]=m.useState("default"),{toast:t}=E();m.useEffect(()=>{(()=>{const s="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;f(s),s&&r(Notification.permission)})()},[]),m.useEffect(()=>{(async()=>{if(!h){d(!1);return}try{const{data:{user:s}}=await p.auth.getUser();if(!s){d(!1);return}const n=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(n){const{data:i}=await p.from("push_subscriptions").select("id").eq("user_id",s.id).eq("endpoint",n.endpoint).single();c(!!i)}}catch(s){console.error("Error checking push subscription:",s)}finally{d(!1)}})()},[h]);const v=m.useCallback(async()=>{if(!h)return t({title:"Not Supported",description:"Push notifications are not supported in your browser.",variant:"destructive"}),!1;try{d(!0);const u=await Notification.requestPermission();if(r(u),u!=="granted")return t({title:"Permission Denied",description:"Please enable notifications in your browser settings.",variant:"destructive"}),!1;const{data:{user:s}}=await p.auth.getUser();if(!s)return t({title:"Not Logged In",description:"Please log in to enable push notifications.",variant:"destructive"}),!1;const i=(await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:$(V)})).toJSON(),{error:b}=await p.from("push_subscriptions").upsert({user_id:s.id,endpoint:i.endpoint,p256dh:i.keys.p256dh,auth:i.keys.auth},{onConflict:"user_id,endpoint"});return b?(console.error("Error saving subscription:",b),t({title:"Error",description:"Failed to save notification subscription.",variant:"destructive"}),!1):(c(!0),t({title:"Notifications Enabled",description:"You'll now receive push notifications for product interests and inquiries."}),!0)}catch(u){return console.error("Error subscribing to push notifications:",u),t({title:"Error",description:"Failed to enable push notifications.",variant:"destructive"}),!1}finally{d(!1)}},[h,t]),w=m.useCallback(async()=>{try{d(!0);const{data:{user:u}}=await p.auth.getUser();if(!u)return!1;const a=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return a&&(await a.unsubscribe(),await p.from("push_subscriptions").delete().eq("user_id",u.id).eq("endpoint",a.endpoint)),c(!1),t({title:"Notifications Disabled",description:"You won't receive push notifications anymore."}),!0}catch(u){return console.error("Error unsubscribing:",u),t({title:"Error",description:"Failed to disable push notifications.",variant:"destructive"}),!1}finally{d(!1)}},[t]);return{isSupported:h,isSubscribed:y,isLoading:g,permission:x,subscribe:v,unsubscribe:w}}function Q({variant:h="switch",showLabel:f=!0}){const{isSupported:y,isSubscribed:c,isLoading:g,permission:d,subscribe:x,unsubscribe:r}=G();if(!y)return null;const t=async()=>{c?await r():await x()};return h==="button"?e.jsxs(_,{variant:c?"default":"outline",size:"sm",onClick:t,disabled:g,className:"gap-2",children:[g?e.jsx(I,{className:"h-4 w-4 animate-spin"}):c?e.jsx(S,{className:"h-4 w-4"}):e.jsx(R,{className:"h-4 w-4"}),f&&(c?"Notifications On":"Enable Notifications")]}):e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[f&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{htmlFor:"push-notifications",className:"text-sm font-medium",children:"Push Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d==="denied"?"Blocked in browser settings":c?"Receive alerts for new inquiries":"Get notified about product interests"})]}),e.jsx(M,{id:"push-notifications",checked:c,onCheckedChange:t,disabled:g||d==="denied"})]})}const O={elegant:{name:"Elegant",description:"Sophisticated purple and gold palette",primary:"#6B21A8",secondary:"#D97706"},modern:{name:"Modern",description:"Fresh blue and cyan tones",primary:"#0EA5E9",secondary:"#06B6D4"},classic:{name:"Classic",description:"Timeless navy and burgundy",primary:"#1E3A8A",secondary:"#991B1B"},luxury:{name:"Luxury",description:"Premium gold and black elegance",primary:"#D4AF37",secondary:"#1a1a1a"},minimalist:{name:"Minimalist",description:"Clean grayscale simplicity",primary:"#4B5563",secondary:"#9CA3AF"},vibrant:{name:"Vibrant",description:"Bold and energetic colors",primary:"#EC4899",secondary:"#8B5CF6"}},ue=()=>{const h=q(),[f,y]=m.useState(!1),[c,g]=m.useState({}),[d,x]=m.useState("custom"),[r,t]=m.useState({business_name:"",address_line1:"",address_line2:"",city:"",state:"",pincode:"",country:"",email:"",phone:"",whatsapp_number:"",instagram_qr_url:"",whatsapp_qr_url:"",logo_url:"",business_story:"",certifications:[],awards:[],making_charges_per_gram:"",primary_brand_color:"#4F46E5",secondary_brand_color:"#8B5CF6",brand_tagline:""});m.useEffect(()=>{v()},[]);const v=async()=>{try{const{data:{user:s}}=await p.auth.getUser();if(!s)return;const{data:a,error:n}=await p.from("vendor_profiles").select("*").eq("user_id",s.id).maybeSingle();if(n&&n.code!=="PGRST116")throw n;if(a){const i=a;t({business_name:i.business_name||"",address_line1:i.address_line1||"",address_line2:i.address_line2||"",city:i.city||"",state:i.state||"",pincode:i.pincode||"",country:i.country||"",email:i.email||"",phone:i.phone||"",whatsapp_number:i.whatsapp_number||"",instagram_qr_url:i.instagram_qr_url||"",whatsapp_qr_url:i.whatsapp_qr_url||"",logo_url:i.logo_url||"",business_story:i.business_story||"",certifications:i.certifications||[],awards:i.awards||[],making_charges_per_gram:i.making_charges_per_gram||"",primary_brand_color:i.primary_brand_color||"#4F46E5",secondary_brand_color:i.secondary_brand_color||"#8B5CF6",brand_tagline:i.brand_tagline||""}),x(i.brand_theme||"custom")}}catch{j.error("Failed to load vendor profile")}},w=async s=>{s.preventDefault(),y(!0);try{const{data:{user:a}}=await p.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:n}=await p.from("vendor_profiles").upsert({user_id:a.id,...r,brand_theme:d,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(n)throw n;j.success("Vendor profile saved!")}catch(a){j.error(a.message||"Failed to save vendor profile")}finally{y(!1)}},u=async(s,a)=>{try{g({...c,[a]:!0});const{data:{user:n}}=await p.auth.getUser();if(!n)throw new Error("Not authenticated");const i=s.name.split(".").pop(),b=`${n.id}/${a}-qr-${Date.now()}.${i}`,{error:N,data:z}=await p.storage.from("vendor-qr-codes").upload(b,s,{upsert:!0});if(N)throw N;const{data:{publicUrl:F}}=p.storage.from("vendor-qr-codes").getPublicUrl(b);t({...r,[a==="instagram"?"instagram_qr_url":"whatsapp_qr_url"]:F}),j.success(`${a==="instagram"?"Instagram":"WhatsApp"} QR code uploaded!`)}catch(n){j.error(`Failed to upload QR code: ${n.message}`)}finally{g({...c,[a]:!1})}};return e.jsx(B,{children:e.jsx("div",{className:"min-h-screen bg-background py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-3xl",children:[e.jsxs(_,{variant:"ghost",onClick:()=>h("/"),className:"mb-6",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Catalog"]}),e.jsxs(P,{children:[e.jsxs(A,{children:[e.jsx(U,{className:"text-3xl font-serif",children:"Vendor Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"This information will be displayed in your shared catalogs"})]}),e.jsx(T,{children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Brand Logo"}),e.jsx(L,{onUploadComplete:s=>t({...r,logo_url:s}),currentImage:r.logo_url}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically cropped and optimized to 500×500px WebP format. Your logo will appear on PDF invoices and shared catalogs."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"business_name",children:"Business Name *"}),e.jsx(l,{id:"business_name",value:r.business_name,onChange:s=>t({...r,business_name:s.target.value}),placeholder:"GEMHUB",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",children:"Email *"}),e.jsx(l,{id:"email",type:"email",value:r.email,onChange:s=>t({...r,email:s.target.value}),placeholder:"contact@gemhub.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"phone",children:"Phone *"}),e.jsx(l,{id:"phone",type:"tel",value:r.phone,onChange:s=>t({...r,phone:s.target.value}),placeholder:"+91 98765 43210",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"whatsapp_number",children:"WhatsApp Number *"}),e.jsx(l,{id:"whatsapp_number",type:"tel",value:r.whatsapp_number,onChange:s=>t({...r,whatsapp_number:s.target.value}),placeholder:"+919876543210 (with country code, no spaces)",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter with country code, no spaces (e.g., +919876543210)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"address_line1",children:"Address Line 1 *"}),e.jsx(l,{id:"address_line1",value:r.address_line1,onChange:s=>t({...r,address_line1:s.target.value}),placeholder:"Building, Street",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"address_line2",children:"Address Line 2"}),e.jsx(l,{id:"address_line2",value:r.address_line2,onChange:s=>t({...r,address_line2:s.target.value}),placeholder:"Area, Landmark"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"city",children:"City *"}),e.jsx(l,{id:"city",value:r.city,onChange:s=>t({...r,city:s.target.value}),placeholder:"Mumbai",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"state",children:"State *"}),e.jsx(l,{id:"state",value:r.state,onChange:s=>t({...r,state:s.target.value}),placeholder:"Maharashtra",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"pincode",children:"Pincode *"}),e.jsx(l,{id:"pincode",value:r.pincode,onChange:s=>t({...r,pincode:s.target.value}),placeholder:"400001",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"country",children:"Country *"}),e.jsx(l,{id:"country",value:r.country,onChange:s=>t({...r,country:s.target.value}),placeholder:"India",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"making_charges_per_gram",children:"Making Charges per Gram (₹)"}),e.jsx(l,{id:"making_charges_per_gram",type:"number",step:"0.01",value:r.making_charges_per_gram,onChange:s=>t({...r,making_charges_per_gram:s.target.value}),placeholder:"150"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This will be used to auto-calculate making charges for jewelry products"})]}),e.jsxs("div",{className:"border-t pt-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Brand Story & Credentials"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"business_story",children:"Business Story"}),e.jsx(D,{id:"business_story",value:r.business_story,onChange:s=>t({...r,business_story:s.target.value}),placeholder:"Tell your brand's story...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Certifications"}),r.certifications.map((s,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{value:s,onChange:n=>{const i=[...r.certifications];i[a]=n.target.value,t({...r,certifications:i})},placeholder:"e.g., ISO 9001:2015"}),e.jsx(_,{type:"button",variant:"outline",size:"icon",onClick:()=>{const n=r.certifications.filter((i,b)=>b!==a);t({...r,certifications:n})},children:e.jsx(C,{className:"h-4 w-4"})})]},a)),e.jsx(_,{type:"button",variant:"outline",onClick:()=>t({...r,certifications:[...r.certifications,""]}),children:"Add Certification"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Awards & Recognition"}),r.awards.map((s,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{value:s,onChange:n=>{const i=[...r.awards];i[a]=n.target.value,t({...r,awards:i})},placeholder:"e.g., Best Jeweler 2023"}),e.jsx(_,{type:"button",variant:"outline",size:"icon",onClick:()=>{const n=r.awards.filter((i,b)=>b!==a);t({...r,awards:n})},children:e.jsx(C,{className:"h-4 w-4"})})]},a)),e.jsx(_,{type:"button",variant:"outline",onClick:()=>t({...r,awards:[...r.awards,""]}),children:"Add Award"})]})]}),e.jsxs("div",{className:"border-t pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Brand Customization for Estimates"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a preset theme or customize your own brand colors"}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium mb-3 block",children:"Choose a Brand Theme"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[Object.entries(O).map(([s,a])=>e.jsxs("div",{onClick:()=>{x(s),t({...r,primary_brand_color:a.primary,secondary_brand_color:a.secondary})},className:`cursor-pointer rounded-lg border-2 p-4 transition-all hover:scale-105 ${d===s?"border-primary shadow-lg ring-2 ring-primary/20":"border-border hover:border-primary/50"}`,style:{background:`linear-gradient(135deg, ${a.primary}15, ${a.secondary}15)`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:a.primary}}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:a.secondary}})]}),e.jsx("p",{className:"font-semibold text-sm",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description})]},s)),e.jsxs("div",{onClick:()=>x("custom"),className:`cursor-pointer rounded-lg border-2 p-4 transition-all hover:scale-105 ${d==="custom"?"border-primary shadow-lg ring-2 ring-primary/20":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(k,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("p",{className:"font-semibold text-sm",children:"Custom"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pick your own colors"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"brand_tagline",children:"Brand Tagline"}),e.jsx(l,{id:"brand_tagline",value:r.brand_tagline,onChange:s=>t({...r,brand_tagline:s.target.value}),placeholder:"e.g., Crafting Excellence Since 1985"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This will appear on your estimate PDFs below your business name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"primary_brand_color",children:"Primary Brand Color"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(l,{id:"primary_brand_color",type:"color",value:r.primary_brand_color,onChange:s=>{t({...r,primary_brand_color:s.target.value}),x("custom")},className:"w-20 h-10"}),e.jsx(l,{type:"text",value:r.primary_brand_color,onChange:s=>{t({...r,primary_brand_color:s.target.value}),x("custom")},placeholder:"#4F46E5",className:"flex-1"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used for headers and primary accents in PDFs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"secondary_brand_color",children:"Secondary Brand Color"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(l,{id:"secondary_brand_color",type:"color",value:r.secondary_brand_color,onChange:s=>{t({...r,secondary_brand_color:s.target.value}),x("custom")},className:"w-20 h-10"}),e.jsx(l,{type:"text",value:r.secondary_brand_color,onChange:s=>{t({...r,secondary_brand_color:s.target.value}),x("custom")},placeholder:"#8B5CF6",className:"flex-1"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used for secondary elements and highlights"})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/30",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-16 h-16 rounded border",style:{backgroundColor:r.primary_brand_color}}),e.jsx("div",{className:"w-16 h-16 rounded border",style:{backgroundColor:r.secondary_brand_color}})]})]})]}),e.jsxs("div",{className:"border-t pt-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"QR Codes"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"instagram_qr",children:"Instagram QR Code"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(l,{id:"instagram_qr",type:"file",accept:"image/*",onChange:s=>{var n;const a=(n=s.target.files)==null?void 0:n[0];a&&u(a,"instagram")},disabled:c.instagram}),c.instagram&&e.jsx("span",{className:"text-sm",children:"Uploading..."})]}),r.instagram_qr_url&&e.jsx("img",{src:r.instagram_qr_url,alt:"Instagram QR",className:"w-32 h-32 object-cover mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"whatsapp_qr",children:"WhatsApp QR Code"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(l,{id:"whatsapp_qr",type:"file",accept:"image/*",onChange:s=>{var n;const a=(n=s.target.files)==null?void 0:n[0];a&&u(a,"whatsapp")},disabled:c.whatsapp}),c.whatsapp&&e.jsx("span",{className:"text-sm",children:"Uploading..."})]}),r.whatsapp_qr_url&&e.jsx("img",{src:r.whatsapp_qr_url,alt:"WhatsApp QR",className:"w-32 h-32 object-cover mt-2"})]})]})]}),e.jsxs("div",{className:"border-t pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notification Settings"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get instant alerts when customers show interest in your products"}),e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg",children:e.jsx(Q,{showLabel:!0})})]}),e.jsx(_,{type:"submit",className:"w-full",disabled:f,children:f?"Saving...":"Save Vendor Profile"})]})})]})]})})})};export{ue as default};
//# sourceMappingURL=VendorProfile-CEdOckJg.js.map
