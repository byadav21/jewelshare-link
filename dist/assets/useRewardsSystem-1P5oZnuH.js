import{r as n}from"./react-vendor-BCzWReGx.js";import{l as r}from"./index-DBHw7ps1.js";const _=()=>{const[u,a]=n.useState(null),[d,l]=n.useState([]),[h,f]=n.useState(!0);n.useEffect(()=>{i(),c(),p()},[]);const i=async()=>{try{const{data:{user:t}}=await r.auth.getUser();if(!t)return;const{data:s,error:e}=await r.from("vendor_points").select("*").eq("user_id",t.id).maybeSingle();if(e&&e.code!=="PGRST116")throw e;if(s)a(s);else{const{data:o}=await r.from("vendor_points").insert({user_id:t.id,total_points:0,current_tier:"bronze"}).select().single();a(o)}}catch(t){console.error("Error fetching points:",t)}finally{f(!1)}},c=async()=>{try{const{data:{user:t}}=await r.auth.getUser();if(!t)return;const{data:s,error:e}=await r.from("points_history").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(20);if(e)throw e;l(s||[])}catch(t){console.error("Error fetching points history:",t)}},p=async()=>{const{data:{user:t}}=await r.auth.getUser();if(!t)return;const s=r.channel("points-updates").on("postgres_changes",{event:"UPDATE",schema:"public",table:"vendor_points"},e=>{e.new&&a(e.new)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"points_history"},()=>{c()}).subscribe();return()=>{r.removeChannel(s)}};return{points:u,history:d,loading:h,awardPoints:async(t,s)=>{try{const{data:e,error:o}=await r.functions.invoke("award-points",{body:{action_type:t,action_details:s}});if(o)throw o;return await i(),e}catch(e){throw console.error("Error awarding points:",e),e}},refetch:i}};export{_ as u};
//# sourceMappingURL=useRewardsSystem-1P5oZnuH.js.map
