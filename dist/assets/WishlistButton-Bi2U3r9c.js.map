{"version":3,"file":"WishlistButton-Bi2U3r9c.js","sources":["../../src/hooks/useWishlist.tsx","../../src/components/WishlistButton.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Generate or retrieve session ID for anonymous users\r\nconst getSessionId = () => {\r\n  let sessionId = localStorage.getItem('wishlist_session_id');\r\n  if (!sessionId) {\r\n    sessionId = crypto.randomUUID();\r\n    localStorage.setItem('wishlist_session_id', sessionId);\r\n  }\r\n  return sessionId;\r\n};\r\n\r\nexport const useWishlist = () => {\r\n  const [wishlistId, setWishlistId] = useState<string | null>(null);\r\n  const [wishlistItems, setWishlistItems] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    initializeWishlist();\r\n  }, []);\r\n\r\n  const initializeWishlist = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      const sessionId = user ? null : getSessionId();\r\n\r\n      // Try to find existing wishlist\r\n      let query = supabase.from('wishlists').select('id, wishlist_items(product_id)');\r\n      \r\n      if (user) {\r\n        query = query.eq('user_id', user.id);\r\n      } else {\r\n        query = query.eq('session_id', sessionId);\r\n      }\r\n\r\n      const { data: wishlists, error } = await query.maybeSingle();\r\n\r\n      if (error && error.code !== 'PGRST116') {\r\n        console.error('Error fetching wishlist:', error);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (wishlists) {\r\n        setWishlistId(wishlists.id);\r\n        setWishlistItems(wishlists.wishlist_items?.map((item: any) => item.product_id) || []);\r\n      } else {\r\n        // Create new wishlist\r\n        const { data: newWishlist, error: createError } = await supabase\r\n          .from('wishlists')\r\n          .insert({\r\n            user_id: user?.id || null,\r\n            session_id: sessionId,\r\n            name: 'My Wishlist'\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (createError) {\r\n          console.error('Error creating wishlist:', createError);\r\n        } else if (newWishlist) {\r\n          setWishlistId(newWishlist.id);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error initializing wishlist:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const addToWishlist = async (productId: string, shareLinkId?: string) => {\r\n    if (!wishlistId) {\r\n      toast.error('Wishlist not initialized');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase.from('wishlist_items').insert({\r\n        wishlist_id: wishlistId,\r\n        product_id: productId,\r\n        share_link_id: shareLinkId || null\r\n      });\r\n\r\n      if (error) {\r\n        if (error.code === '23505') {\r\n          toast.info('Product already in wishlist');\r\n          return false;\r\n        }\r\n        throw error;\r\n      }\r\n\r\n      setWishlistItems(prev => [...prev, productId]);\r\n      toast.success('Added to wishlist!');\r\n      return true;\r\n    } catch (err: any) {\r\n      console.error('Error adding to wishlist:', err);\r\n      toast.error('Failed to add to wishlist');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const removeFromWishlist = async (productId: string) => {\r\n    if (!wishlistId) return false;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('wishlist_items')\r\n        .delete()\r\n        .eq('wishlist_id', wishlistId)\r\n        .eq('product_id', productId);\r\n\r\n      if (error) throw error;\r\n\r\n      setWishlistItems(prev => prev.filter(id => id !== productId));\r\n      toast.success('Removed from wishlist');\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Error removing from wishlist:', err);\r\n      toast.error('Failed to remove from wishlist');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const isInWishlist = (productId: string) => {\r\n    return wishlistItems.includes(productId);\r\n  };\r\n\r\n  return {\r\n    wishlistId,\r\n    wishlistItems,\r\n    loading,\r\n    addToWishlist,\r\n    removeFromWishlist,\r\n    isInWishlist,\r\n    itemCount: wishlistItems.length\r\n  };\r\n};\r\n","import { useState } from \"react\";\r\nimport { Heart } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useWishlist } from \"@/hooks/useWishlist\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface WishlistButtonProps {\r\n  productId: string;\r\n  shareLinkId?: string;\r\n  variant?: \"default\" | \"icon\";\r\n  className?: string;\r\n}\r\n\r\nexport const WishlistButton = ({ \r\n  productId, \r\n  shareLinkId,\r\n  variant = \"icon\",\r\n  className \r\n}: WishlistButtonProps) => {\r\n  const { addToWishlist, removeFromWishlist, isInWishlist, loading } = useWishlist();\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const inWishlist = isInWishlist(productId);\r\n\r\n  const handleClick = async (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    \r\n    setIsAnimating(true);\r\n    setTimeout(() => setIsAnimating(false), 600);\r\n\r\n    if (inWishlist) {\r\n      await removeFromWishlist(productId);\r\n    } else {\r\n      await addToWishlist(productId, shareLinkId);\r\n    }\r\n  };\r\n\r\n  if (variant === \"icon\") {\r\n    return (\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        onClick={handleClick}\r\n        disabled={loading}\r\n        className={`h-8 w-8 hover:bg-background/80 ${className}`}\r\n      >\r\n        <motion.div\r\n          animate={isAnimating ? { scale: [1, 1.3, 1] } : {}}\r\n          transition={{ duration: 0.3 }}\r\n        >\r\n          <Heart \r\n            className={`h-4 w-4 transition-colors ${\r\n              inWishlist \r\n                ? 'fill-red-500 text-red-500' \r\n                : 'text-muted-foreground hover:text-red-500'\r\n            }`}\r\n          />\r\n        </motion.div>\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Button\r\n      variant={inWishlist ? \"default\" : \"outline\"}\r\n      size=\"sm\"\r\n      onClick={handleClick}\r\n      disabled={loading}\r\n      className={`gap-2 ${\r\n        inWishlist \r\n          ? 'bg-red-500 hover:bg-red-600 text-white' \r\n          : 'hover:bg-red-50 dark:hover:bg-red-950/20 hover:text-red-500'\r\n      } ${className}`}\r\n    >\r\n      <motion.div\r\n        animate={isAnimating ? { scale: [1, 1.3, 1] } : {}}\r\n        transition={{ duration: 0.3 }}\r\n      >\r\n        <Heart \r\n          className={`h-4 w-4 ${inWishlist ? 'fill-current' : ''}`}\r\n        />\r\n      </motion.div>\r\n      {inWishlist ? 'Saved' : 'Save'}\r\n    </Button>\r\n  );\r\n};\r\n"],"names":["getSessionId","sessionId","useWishlist","wishlistId","setWishlistId","useState","wishlistItems","setWishlistItems","loading","setLoading","useEffect","initializeWishlist","user","supabase","query","wishlists","error","_a","item","newWishlist","createError","err","productId","shareLinkId","toast","prev","id","WishlistButton","variant","className","addToWishlist","removeFromWishlist","isInWishlist","isAnimating","setIsAnimating","inWishlist","handleClick","jsx","Button","motion","Heart","jsxs"],"mappings":"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"}