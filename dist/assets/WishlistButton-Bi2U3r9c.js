import{j as n}from"./query-vendor-BLxHmmGk.js";import{r as c}from"./react-vendor-BeR0k5Z3.js";import{F as d,B as y,z as S}from"./index-DGlTgSKx.js";import{u as a,H as b}from"./ui-vendor-CN4tOqpp.js";const I=()=>{let t=localStorage.getItem("wishlist_session_id");return t||(t=crypto.randomUUID(),localStorage.setItem("wishlist_session_id",t)),t},E=()=>{const[t,h]=c.useState(null),[l,o]=c.useState([]),[f,u]=c.useState(!0);c.useEffect(()=>{w()},[]);const w=async()=>{var i;try{const{data:{user:s}}=await d.auth.getUser(),e=s?null:I();let r=d.from("wishlists").select("id, wishlist_items(product_id)");s?r=r.eq("user_id",s.id):r=r.eq("session_id",e);const{data:v,error:x}=await r.maybeSingle();if(x&&x.code!=="PGRST116"){console.error("Error fetching wishlist:",x),u(!1);return}if(v)h(v.id),o(((i=v.wishlist_items)==null?void 0:i.map(m=>m.product_id))||[]);else{const{data:m,error:p}=await d.from("wishlists").insert({user_id:(s==null?void 0:s.id)||null,session_id:e,name:"My Wishlist"}).select().single();p?console.error("Error creating wishlist:",p):m&&h(m.id)}}catch(s){console.error("Error initializing wishlist:",s)}finally{u(!1)}};return{wishlistId:t,wishlistItems:l,loading:f,addToWishlist:async(i,s)=>{if(!t)return a.error("Wishlist not initialized"),!1;try{const{error:e}=await d.from("wishlist_items").insert({wishlist_id:t,product_id:i,share_link_id:s||null});if(e){if(e.code==="23505")return a.info("Product already in wishlist"),!1;throw e}return o(r=>[...r,i]),a.success("Added to wishlist!"),!0}catch(e){return console.error("Error adding to wishlist:",e),a.error("Failed to add to wishlist"),!1}},removeFromWishlist:async i=>{if(!t)return!1;try{const{error:s}=await d.from("wishlist_items").delete().eq("wishlist_id",t).eq("product_id",i);if(s)throw s;return o(e=>e.filter(r=>r!==i)),a.success("Removed from wishlist"),!0}catch(s){return console.error("Error removing from wishlist:",s),a.error("Failed to remove from wishlist"),!1}},isInWishlist:i=>l.includes(i),itemCount:l.length}},q=({productId:t,shareLinkId:h,variant:l="icon",className:o})=>{const{addToWishlist:f,removeFromWishlist:u,isInWishlist:w,loading:g}=E(),[_,W]=c.useState(!1),i=w(t),s=async e=>{e.stopPropagation(),W(!0),setTimeout(()=>W(!1),600),i?await u(t):await f(t,h)};return l==="icon"?n.jsx(y,{variant:"ghost",size:"icon",onClick:s,disabled:g,className:`h-8 w-8 hover:bg-background/80 ${o}`,children:n.jsx(S.div,{animate:_?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:n.jsx(b,{className:`h-4 w-4 transition-colors ${i?"fill-red-500 text-red-500":"text-muted-foreground hover:text-red-500"}`})})}):n.jsxs(y,{variant:i?"default":"outline",size:"sm",onClick:s,disabled:g,className:`gap-2 ${i?"bg-red-500 hover:bg-red-600 text-white":"hover:bg-red-50 dark:hover:bg-red-950/20 hover:text-red-500"} ${o}`,children:[n.jsx(S.div,{animate:_?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:n.jsx(b,{className:`h-4 w-4 ${i?"fill-current":""}`})}),i?"Saved":"Save"]})};export{q as W,E as u};
//# sourceMappingURL=WishlistButton-Bi2U3r9c.js.map
