import{u as R,j as e}from"./query-vendor-BLxHmmGk.js";import{u as U,r as b}from"./react-vendor-BeR0k5Z3.js";import{w as q,B as D,C as i,i as d,k as o,g as l,s as M}from"./index-CX6yiz0b.js";import{I as Q}from"./input-CiHC6UAI.js";import{B as w}from"./badge-45Abp579.js";import{T as K,a as O,b as v,c as x,d as P,e as m}from"./table-CYMzKz5T.js";import{S as V,a as X,b as J,c as Y,d as C}from"./select-CYWHo3cU.js";import{E as z,a1 as G,l as g,aX as A,aY as S,p as T,K as L}from"./ui-vendor-DjQqXt9S.js";import{f as W}from"./format-sTPjOSS_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-D6fUEw85.js";import"./index-DjQc2W_p.js";import"./en-US-DWrl2lTx.js";const he=()=>{const u=U(),{isAdmin:j,loading:B}=q(),[n,_]=b.useState(""),[h,F]=b.useState("all"),{data:t,isLoading:H}=R({queryKey:["audit-logs"],queryFn:async()=>{const{data:s,error:r}=await M.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(500);if(r)throw r;return s},enabled:j}),I=s=>s.includes("approve")||s.includes("enable")?e.jsx(A,{className:"h-4 w-4 text-green-500"}):s.includes("reject")||s.includes("disable")||s.includes("delete")?e.jsx(S,{className:"h-4 w-4 text-red-500"}):s.includes("permission")?e.jsx(T,{className:"h-4 w-4 text-blue-500"}):e.jsx(g,{className:"h-4 w-4 text-muted-foreground"}),k=s=>s.includes("approve")||s.includes("enable")?"default":s.includes("reject")||s.includes("disable")||s.includes("delete")?"destructive":"secondary",a=t==null?void 0:t.filter(s=>{var p,f,N,y;const r=!n||((p=s.action)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((f=s.entity_type)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((y=(N=s.details)==null?void 0:N.email)==null?void 0:y.toLowerCase().includes(n.toLowerCase())),c=h==="all"||s.action.includes(h);return r&&c}),E=Array.from(new Set(t==null?void 0:t.map(s=>s.action.includes("approve")?"approve":s.action.includes("reject")?"reject":s.action.includes("enable")?"enable":s.action.includes("disable")?"disable":s.action.includes("permission")?"permission":s.action.includes("delete")?"delete":"other")));return B?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):j?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{variant:"ghost",onClick:()=>u("/super-admin"),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(G,{className:"h-8 w-8"}),"Audit Logs"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track all administrative actions"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Actions"}),e.jsx(g,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.length)||0})})]}),e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Approvals"}),e.jsx(A,{className:"h-4 w-4 text-green-500"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.filter(s=>s.action.includes("approve")).length)||0})})]}),e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Rejections"}),e.jsx(S,{className:"h-4 w-4 text-red-500"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.filter(s=>s.action.includes("reject")).length)||0})})]}),e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Permission Changes"}),e.jsx(T,{className:"h-4 w-4 text-blue-500"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.filter(s=>s.action.includes("permission")).length)||0})})]})]}),e.jsx(i,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{type:"text",placeholder:"Search by action, entity type, or email...",value:n,onChange:s=>_(s.target.value),className:"pl-10"})]}),e.jsxs(V,{value:h,onValueChange:F,children:[e.jsx(X,{className:"w-full md:w-[200px]",children:e.jsx(J,{placeholder:"Filter by action"})}),e.jsxs(Y,{children:[e.jsx(C,{value:"all",children:"All Actions"}),E.map(s=>e.jsx(C,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]})]})]})})}),e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(o,{children:"Activity Log"})}),e.jsx(l,{children:H?e.jsx("div",{className:"text-center py-8",children:"Loading audit logs..."}):(a==null?void 0:a.length)===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No audit logs found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs(v,{children:[e.jsx(x,{children:"Timestamp"}),e.jsx(x,{children:"Action"}),e.jsx(x,{children:"Entity Type"}),e.jsx(x,{children:"Details"}),e.jsx(x,{children:"IP Address"})]})}),e.jsx(P,{children:a==null?void 0:a.map(s=>e.jsxs(v,{children:[e.jsx(m,{className:"text-sm",children:W(new Date(s.created_at),"MMM dd, yyyy HH:mm:ss")}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[I(s.action),e.jsx(w,{variant:k(s.action),children:s.action})]})}),e.jsx(m,{children:e.jsx(w,{variant:"outline",children:s.entity_type})}),e.jsx(m,{className:"max-w-md",children:s.details?e.jsx("div",{className:"text-sm space-y-1",children:Object.entries(s.details).map(([r,c])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[r,":"]})," ",typeof c=="object"?JSON.stringify(c):String(c)]},r))}):"-"}),e.jsx(m,{className:"text-sm text-muted-foreground",children:s.ip_address||"-"})]},s.id))})]})})})]})]}):(u("/"),null)};export{he as default};
//# sourceMappingURL=AuditLogs-CkZrXwwb.js.map
