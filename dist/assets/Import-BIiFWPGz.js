import{j as e,u as Ee}from"./query-vendor-BLxHmmGk.js";import{r as Y,u as Ne}from"./react-vendor-BeR0k5Z3.js";import{C as ce,G as oe,H as de,I as me,D as ue,E as Ce,_ as Re,B as F,F as M}from"./index-DGlTgSKx.js";import{I as ye}from"./input-CEHl5GoJ.js";import{L as te}from"./label-ClRcubO_.js";import{S as be,a as Ie,b as Se,c as _e,d as ve}from"./select-CQfvDDtS.js";import{r as Pe,u as $,w as Ae}from"./xlsx-CKN5doRT.js";import{g as De,d as Oe,b as Ue}from"./validations-Dq2g6qv0.js";import{g as Le}from"./generateTemplate-CGI6eLLE.js";import{B as J}from"./badge-DknkzE8c.js";import{S as Me}from"./scroll-area-B6OKxq6t.js";import{i as X,aa as z,A as Ye,J as ke,q as re,ae,ac as le}from"./ui-vendor-CN4tOqpp.js";import{s as m,p as Ge}from"./jewelryCalculations-CdGLIbP_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-aqCwQlp3.js";import"./index-DjQc2W_p.js";import"./index-ibl8YJur.js";import"./invoiceTemplate-N6fQ82wS.js";const qe="https://api.exchangerate-api.com/v4/latest/INR";let V=null,ie=0;const Fe=36e5,B=async l=>{try{const O=Date.now();if(V&&O-ie<Fe)return parseFloat((l*V).toFixed(2));const I=await(await fetch(qe)).json();return I.rates&&I.rates.USD?(V=I.rates.USD,ie=O,parseFloat((l*V).toFixed(2))):(console.warn("Currency API failed, using fallback rate"),parseFloat((l*.012).toFixed(2)))}catch(O){return console.error("Currency conversion error:",O),parseFloat((l*.012).toFixed(2))}},we=l=>{switch(l){case"Gemstones":return{required:["SKU ID","GEMSTONE NAME","PRICE INR","STOCK QUANTITY"],optional:["GEMSTONE TYPE","CARAT WEIGHT","COLOR","CLARITY","CUT","POLISH","SYMMETRY","MEASUREMENT","CERTIFICATION","IMAGE URL","COST PRICE","RETAIL PRICE"]};case"Loose Diamonds":return{required:["SKU NO","DIAMOND TYPE","SHAPE","CARAT","COLOR","CLARITY","PRICE INR","STOCK QUANTITY"],optional:["STATUS","COLOR SHADE AMOUNT","CUT","POLISH","SYMMETRY","FLO","MEASUREMENT","RATIO","LAB","IMAGE URL","COST PRICE","RETAIL PRICE"]};case"Jewellery":default:return{required:["Prodcut","Gross Weight","PURITY_FRACTION_USED"],optional:["SKU","Category","Metal Type","Diamond Color","Diamond CLARITY","Diamond Weight 1","Diamond Weight 2","Diamond RATE 1","Diamond Rate 2","Center stone TYPE","Certification cost","Gemstone cost","IMAGE_URL","STOCK QUANTITY","DELIVERY TYPE","Description"]}}},We=({mappings:l,productType:O})=>{const P=l.filter(p=>p.required),I=l.filter(p=>!p.required),d=l.filter(p=>p.mapped),W=P.filter(p=>!p.mapped);return e.jsxs(ce,{className:"border-2 border-primary/20",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-lg",children:"Column Mapping Preview"}),e.jsxs(me,{children:["Review how your Excel columns will be imported for ",O]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(J,{variant:W.length===0?"default":"destructive",className:"gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),d.length," / ",P.length," required"]})})]})}),e.jsxs(ue,{children:[e.jsx(Me,{className:"h-[400px] pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2 text-primary",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-primary/50 to-transparent"}),"Required Fields",e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-primary/50 to-transparent"})]}),P.map((p,k)=>e.jsx(ne,{mapping:p},`req-${k}`))]}),I.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2 text-muted-foreground",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-border to-transparent"}),"Optional Fields",e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-border to-transparent"})]}),I.map((p,k)=>e.jsx(ne,{mapping:p},`opt-${k}`))]})]})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"p-2 bg-green-500/10 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mapped"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:d.length})]}),e.jsxs("div",{className:"p-2 bg-amber-500/10 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optional"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:I.filter(p=>!p.mapped).length})]}),e.jsxs("div",{className:"p-2 bg-destructive/10 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing"}),e.jsx("p",{className:"text-lg font-bold text-destructive",children:W.length})]})]})})]})]})},ne=({mapping:l})=>e.jsx("div",{className:`
      p-3 rounded-lg border transition-all
      ${l.mapped?"bg-green-500/5 border-green-500/20":l.required?"bg-destructive/5 border-destructive/20":"bg-muted/30 border-border/50"}
    `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:l.mapped?e.jsx(X,{className:"h-4 w-4 text-green-600"}):l.required?e.jsx(z,{className:"h-4 w-4 text-destructive"}):e.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-muted-foreground/30"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[l.columnPosition&&e.jsxs(J,{variant:"outline",className:"text-xs font-mono",children:["Col ",l.columnPosition]}),e.jsx("code",{className:"px-2 py-0.5 bg-background rounded text-xs font-mono",children:l.excelColumn})]}),e.jsx(Ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("code",{className:"px-2 py-0.5 bg-primary/10 rounded text-xs font-mono text-primary",children:l.databaseField}),l.required&&e.jsx(J,{variant:"secondary",className:"text-xs",children:"Required"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",l.dataType,")"]})]}),l.sampleValue&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Sample:"})," ",e.jsxs("span",{className:"italic",children:['"',l.sampleValue,'"']})]})]})]})}),ds=()=>{const[l,O]=Y.useState(null),[P,I]=Y.useState(!1),[d,W]=Y.useState("Jewellery"),[p,k]=Y.useState([]),[R,H]=Y.useState(null),[U,Z]=Y.useState(null),[ee,pe]=Y.useState([]),{toast:L}=Ce(),se=Ne(),{data:Q}=Ee({queryKey:["approvedCategories"],queryFn:async()=>{const{data:{user:s}}=await M.auth.getUser();if(!s)return[];const{data:a}=await M.from("user_approval_status").select("approved_categories").eq("user_id",s.id).single();return(a==null?void 0:a.approved_categories)||[]}}),xe=async(s,a,x,h,A,C)=>{const g=m(s["PRICE INR"]||s.PRICE_INR||s["Price INR"]||s.Price),S="COST PRICE"in s||"COST_PRICE"in s||"Cost Price"in s,T="RETAIL PRICE"in s||"RETAIL_PRICE"in s||"Retail Price"in s,i=S?m(s["COST PRICE"]||s.COST_PRICE||s["Cost Price"]):null,t=T?m(s["RETAIL PRICE"]||s.RETAIL_PRICE||s["Retail Price"]):null,c=g&&g>0?g:.01,y=i!==null&&i>0?i:c,f=t!==null&&t>0?t:c,n=c>.01?await B(c):null;return{user_id:a,sku:s["SKU ID"]||s.SKU||`GEM-${x+1}`,gemstone_name:s["GEMSTONE NAME"]||s["Gemstone Name"]||"Ruby",gemstone_type:s["GEMSTONE TYPE"]||s["Gemstone Type"]||null,carat_weight:m(s["CARAT WEIGHT"]||s["Carat Weight"]),color:s.COLOR||s.Color||null,clarity:s.CLARITY||s.Clarity||null,cut:s.CUT||s.Cut||null,polish:s.POLISH||s.Polish||null,symmetry:s.SYMMETRY||s.Symmetry||null,measurement:s.MEASUREMENT||s.Measurement||null,certification:s.CERTIFICATION||s.Certification||null,image_url:h,image_url_2:A,image_url_3:C,price_inr:c,price_usd:n,cost_price:y,retail_price:f,stock_quantity:m(s["STOCK QUANTITY"]||s["Stock Quantity"])||1,product_type:"Gemstones",name:s["GEMSTONE NAME"]||s["Gemstone Name"]||"Unknown Gemstone"}},he=async(s,a,x,h,A,C)=>{const g=m(s["PRICE INR"]||s.PRICE_INR||s["Price INR"]||s.Price),S="COST PRICE"in s||"COST_PRICE"in s||"Cost Price"in s,T="RETAIL PRICE"in s||"RETAIL_PRICE"in s||"Retail Price"in s,i=S?m(s["COST PRICE"]||s.COST_PRICE||s["Cost Price"]):null,t=T?m(s["RETAIL PRICE"]||s.RETAIL_PRICE||s["Retail Price"]):null,c=g&&g>0?g:.01,y=i!==null&&i>0?i:c,f=t!==null&&t>0?t:c,n=c>.01?await B(c):null;return{user_id:a,sku:s["SKU NO"]||s.SKU||`DIA-${x+1}`,diamond_type:s["DIAMOND TYPE"]||s["Diamond Type"]||"Natural",status:s.STATUS||s.Status||null,shape:s.SHAPE||s.Shape||"Round",carat:m(s.CARAT||s.Carat),clarity:s.CLARITY||s.Clarity||"VS1",color:s.COLOR||s.Color||"F",color_shade_amount:s["COLOR SHADE AMOUNT"]||s["Color Shade Amount"]||null,cut:s.CUT||s.Cut||null,polish:s.POLISH||s.Polish||null,symmetry:s.SYMMETRY||s.Symmetry||null,fluorescence:s.FLO||s.Fluorescence||null,measurement:s.MEASUREMENT||s.Measurement||null,ratio:s.RATIO||s.Ratio||null,lab:s.LAB||s.Lab||null,image_url:h,image_url_2:A,image_url_3:C,price_inr:c,price_usd:n,cost_price:y,retail_price:f,stock_quantity:m(s["STOCK QUANTITY"]||s["Stock Quantity"])||1,product_type:"Loose Diamonds",name:`${s.SHAPE||"Round"} Diamond ${s.CARAT||"1.0"}ct`}},ge=async(s,a,x,h,A,C,g,S,T)=>{const i=Ge(s,g,S),t=(...q)=>{for(const K of q)if(s[K]!==void 0&&s[K]!==null&&s[K]!=="")return s[K];return null},c=m(t("Gross Weight","G WT","GWT")),y=m(t("Diamond Weight 1","D.WT 1","D WT 1","DWT1")),f=m(t("Diamond Weight 2","D.WT 2","D WT 2","DWT2")),n=m(t("Diamond RATE 1","D RATE 1","DRATE1")),j=m(t("Diamond Rate 2","Pointer diamond","D RATE 2")),o=m(t("Certification cost","CERTIFICATION_COST")),G=m(t("Gemstone cost","GEMSTONE_COST")),v=m(t("GEMSTONE WT","Gemstone Weight")),E=m(t("TOTAL_USD","TOTAL USD"))||(i.totalPrice>0?await B(i.totalPrice):null),r=t("Diamond Color","DIAMOND COLOR","Diamond_Color")||(T[`C${x+2}`]?String(T[`C${x+2}`].v||"").trim():null),u=t("Diamond CLARITY","CLARITY","Clarity")||(T[`D${x+2}`]?String(T[`D${x+2}`].v||"").trim():null),_=t("Prodcut","Prodcut Title","Product Title","PRODUCT","Name")||`Product ${x+1}`,N=t("SKU","CERT","SKU ID"),b=t("Category","CATEGORY"),w=(()=>{const q=t("DELIVERY TYPE","Delivery Type");return q&&String(q).toLowerCase().includes("schedule")?"scheduled":"immediate"})();return{user_id:a,name:_,description:t("DESCRIPTION","Description")||null,sku:N,category:b,metal_type:t("METAL TYPE","Metal Type")||null,gemstone:t("GEMSTONE Name","GEMSTONE","Gemstone","Gemstone Name")||null,gemstone_name:t("GEMSTONE Name","GEMSTONE","Gemstone","Gemstone Name")||null,color:t("COLOR","Color")||null,diamond_color:r,clarity:u,image_url:h,image_url_2:A,image_url_3:C,weight_grams:c||null,net_weight:i.netWeight||null,diamond_weight:i.totalDiamondWeight||null,carat_weight:v||null,d_wt_1:y||null,d_wt_2:f||null,diamond_type:t("Center stone TYPE","CS TYPE","Diamond Type","CENTER_STONE_TYPE")||null,purity_fraction_used:i.purityFraction,d_rate_1:n||null,pointer_diamond:j||null,d_value:i.dValue||null,gemstone_type:t("GEMSTONE TYPE","Gemstone Type")||null,mkg:i.makingCharges||null,gold_per_gram_price:i.goldValue||null,certification_cost:o||null,gemstone_cost:G||null,total_usd:E,price_inr:i.totalPrice,price_usd:E,cost_price:i.costPrice,retail_price:i.costPrice,stock_quantity:m(t("STOCK QUANTITY","Stock"))||1,delivery_type:w,dispatches_in_days:t("DISPATCHES IN DAYS","Dispatches")||null,product_type:"Jewellery"}},Te=async()=>{if(!l){L({title:"Error",description:"Please select a file",variant:"destructive"});return}I(!0),k([]),H(null),Z(null);try{const{data:{user:s}}=await M.auth.getUser();if(!s)throw new Error("Not authenticated");const{data:a}=await M.from("vendor_profiles").select("gold_rate_24k_per_gram, making_charges_per_gram").eq("user_id",s.id).single(),x=(a==null?void 0:a.gold_rate_24k_per_gram)||7e3,h=(a==null?void 0:a.making_charges_per_gram)||500;d==="Jewellery"&&L({title:"Using Vendor Profile Rates",description:`Gold Rate: ₹${x.toLocaleString()}/gram | Making Charges: ₹${h.toLocaleString()}/gram`});const A=await l.arrayBuffer(),C=Pe(A);let g=C.SheetNames[0];g==="Instructions"&&C.SheetNames.length>1&&(g=C.SheetNames[1]);const S=C.Sheets[g],T=$.sheet_to_json(S);if(T.length>0){const n=Object.keys(T[0]),j=we(d),o=[],G={},v=T[0],D=[];d==="Jewellery"?[{excel:"Prodcut",db:"name",type:"text",required:!0,alternatives:["Prodcut Title","Product Title","PRODUCT","Name"]},{excel:"Gross Weight",db:"weight_grams",type:"number",required:!0,alternatives:["G WT","GWT"]},{excel:"PURITY_FRACTION_USED",db:"purity_fraction_used",type:"number",required:!0,alternatives:["Purity"]},{excel:"SKU",db:"sku",type:"text",required:!1,alternatives:["CERT","SKU ID"]},{excel:"Category",db:"category",type:"text",required:!1,alternatives:["CATEGORY"]},{excel:"Metal Type",db:"metal_type",type:"text",required:!1,alternatives:["METAL TYPE"]},{excel:"Diamond Color",db:"diamond_color",type:"text",required:!1,alternatives:["DIAMOND COLOR"]},{excel:"Diamond CLARITY",db:"clarity",type:"text",required:!1,alternatives:["CLARITY"]},{excel:"Diamond Weight 1",db:"d_wt_1",type:"number",required:!1,alternatives:["D.WT 1","D WT 1"]},{excel:"Diamond Weight 2",db:"d_wt_2",type:"number",required:!1,alternatives:["D.WT 2","D WT 2"]},{excel:"Diamond RATE 1",db:"d_rate_1",type:"number",required:!1,alternatives:["D RATE 1"]},{excel:"Diamond Rate 2",db:"pointer_diamond",type:"number",required:!1,alternatives:["Pointer diamond"]},{excel:"Center stone TYPE",db:"diamond_type",type:"text",required:!1,alternatives:["CS TYPE","Diamond Type"]},{excel:"Certification cost",db:"certification_cost",type:"number",required:!1,alternatives:[]},{excel:"Gemstone cost",db:"gemstone_cost",type:"number",required:!1,alternatives:[]},{excel:"IMAGE_URL",db:"image_url",type:"url",required:!1,alternatives:["Image URL","Images"]},{excel:"STOCK QUANTITY",db:"stock_quantity",type:"number",required:!1,alternatives:["Stock","Stock Quantity"]}].forEach(r=>{const u=[r.excel,...r.alternatives||[]];let _=null,N=!1;for(const b of u){const w=v[b]||v[b.toUpperCase()]||v[b.toLowerCase()];if(w!=null){_=w,N=!0;break}n.some(q=>q.toLowerCase().replace(/[^a-z0-9]/g,"")===b.toLowerCase().replace(/[^a-z0-9]/g,""))&&(N=!0)}D.push({excelColumn:r.excel,databaseField:r.db,sampleValue:_?String(_).substring(0,50):"",dataType:r.type,required:r.required,mapped:N})}):d==="Gemstones"?[{excel:"SKU ID",db:"sku",type:"text",required:!0},{excel:"GEMSTONE NAME",db:"gemstone_name",type:"text",required:!0},{excel:"CARAT WEIGHT",db:"carat_weight",type:"number",required:!1},{excel:"COLOR",db:"color",type:"text",required:!1},{excel:"CLARITY",db:"clarity",type:"text",required:!1},{excel:"PRICE INR",db:"price_inr",type:"number",required:!0}].forEach(r=>{const u=v[r.excel];D.push({excelColumn:r.excel,databaseField:r.db,sampleValue:u?String(u).substring(0,50):"",dataType:r.type,required:r.required,mapped:n.includes(r.excel)})}):d==="Loose Diamonds"&&[{excel:"SKU NO",db:"sku",type:"text",required:!0},{excel:"SHAPE",db:"shape",type:"text",required:!0},{excel:"CARAT",db:"carat",type:"number",required:!0},{excel:"COLOR",db:"color",type:"text",required:!0},{excel:"CLARITY",db:"clarity",type:"text",required:!0},{excel:"PRICE INR",db:"price_inr",type:"number",required:!0}].forEach(r=>{const u=v[r.excel];D.push({excelColumn:r.excel,databaseField:r.db,sampleValue:u?String(u).substring(0,50):"",dataType:r.type,required:r.required,mapped:n.includes(r.excel)})}),pe(D),j.required.forEach(E=>{if(!n.find(u=>u.toLowerCase()===E.toLowerCase()||u.replace(/[_\s]/g,"").toLowerCase()===E.replace(/[_\s]/g,"").toLowerCase())){const u=n.find(_=>{const N=_.toLowerCase().replace(/[_\s]/g,""),b=E.toLowerCase().replace(/[_\s]/g,"");return N.includes(b)||b.includes(N)});u?G[E]=u:o.push(E)}}),Z({detected:n,missing:o,suggestions:G})}const i=[],t=[],c=d==="Gemstones"?De:d==="Loose Diamonds"?Oe:Ue;for(const[n,j]of T.entries()){const o=j,G=()=>{const _=o.IMAGE_URL||o["IMAGE URL"]||o["Image URL"]||o.Images||o.IMAGE_URL;if(!_)return{imageUrl:null,imageUrl2:null,imageUrl3:null};const N=String(_).replace(/\\:/g,":").replace(/\\\|/g,"|").replace(/\\/g,"").split("|").map(b=>b.trim()).filter(b=>b.startsWith("http"));return{imageUrl:N[0]||null,imageUrl2:N[1]||null,imageUrl3:N[2]||null}},{imageUrl:v,imageUrl2:D,imageUrl3:E}=G();let r;d==="Gemstones"?r=await xe(o,s.id,n,v,D,E):d==="Loose Diamonds"?r=await he(o,s.id,n,v,D,E):r=await ge(o,s.id,n,v,D,E,x,h,S);const u=c.safeParse(r);if(u.success)t.push(r);else{const _=u.error.issues.map(N=>`${N.path.join(".")}: ${N.message}`);i.push({row:n+2,product:r.name||r.sku||`Row ${n+2}`,errors:_})}}const y=new Map;t.forEach((n,j)=>{if(n.sku){const o=y.get(n.sku)||[];o.push(j),y.set(n.sku,o)}});const f=Array.from(y.entries()).filter(([n,j])=>j.length>1).map(([n,j])=>({sku:n,rows:j.map(o=>o+2)}));if(f.length>0){const n=f.map(({sku:j,rows:o})=>`SKU "${j}" appears in rows: ${o.join(", ")}`).join(`
`);L({title:"Duplicate SKUs Found",description:`Found ${f.length} duplicate SKU(s) in your file. Please make each SKU unique:
${n}`,variant:"destructive"}),f.forEach(({sku:j,rows:o})=>{i.push({row:o[0],product:j,errors:[`Duplicate SKU found in rows: ${o.join(", ")}`]})})}H({valid:t,invalid:i}),L({title:"Preview Ready",description:`${t.length} products will be imported, ${i.length+f.length} have errors`})}catch(s){L({title:"Preview Failed",description:s.message||"Failed to preview Excel file",variant:"destructive"})}finally{I(!1)}},fe=async()=>{if(!(!R||R.valid.length===0)){I(!0);try{const{data:{user:s}}=await M.auth.getUser();if(!s){L({title:"Error",description:"You must be logged in to import products",variant:"destructive"});return}const a=R.valid,x=a.map(t=>t.sku).filter(Boolean),{data:h,error:A}=await M.from("products").select("id, sku").eq("user_id",s.id).is("deleted_at",null).in("sku",x);if(A)throw console.error("Error fetching existing products:",A),new Error("Failed to check existing products. Please try again.");const C=new Map((h==null?void 0:h.map(t=>[t.sku,t.id]))||[]),g=a.filter(t=>t.sku&&C.has(t.sku)),S=a.filter(t=>!t.sku||!C.has(t.sku));let T=0,i=0;if(g.length>0)for(const t of g){const c=C.get(t.sku),{error:y}=await M.from("products").update(t).eq("id",c);y||T++}if(S.length>0){const{data:t,error:c}=await M.from("products").insert(S).select();if(c){if(console.error("Insert error:",c),c.code==="23505"&&c.message.includes("products_sku_key")){const y=S.filter(f=>f.sku).map(f=>f.sku).join(", ");throw new Error(`Duplicate SKU detected. One or more SKUs already exist in your catalog: ${y}. Please use unique SKUs for each product or remove duplicate rows from your Excel file.`)}throw c}i=(t==null?void 0:t.length)||0}k(R.invalid),L({title:"Success!",description:`Updated ${T} products, imported ${i} new products`}),se("/")}catch(s){L({title:"Import Failed",description:s.message||"Failed to import products",variant:"destructive"})}finally{I(!1)}}},je=()=>{const s=$.book_new(),a=p.map(h=>({"Row Number":h.row,"Product Name/SKU":h.product,Errors:h.errors.join("; ")})),x=$.json_to_sheet(a);$.book_append_sheet(s,x,"Import Errors"),Ae(s,`import-errors-${new Date().toISOString().split("T")[0]}.xlsx`)};return e.jsx(Re,{children:e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs(F,{variant:"ghost",onClick:()=>se("/"),className:"mb-6",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Back to Catalog"]}),e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx(de,{children:"Import Products"}),e.jsx(me,{children:"Upload your jewelry catalog from an Excel file"})]})]})}),e.jsx(ue,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"productType",children:"Select Product Type"}),e.jsxs(be,{value:d,onValueChange:s=>W(s),children:[e.jsx(Ie,{children:e.jsx(Se,{})}),e.jsx(_e,{children:Q==null?void 0:Q.map(s=>e.jsx(ve,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Step 1: Download Template"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Get the Excel template for ",d]})]}),e.jsxs(F,{variant:"outline",onClick:()=>Le(d),className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Download Template"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Step 2: Upload Filled Template"}),e.jsx(te,{htmlFor:"file",children:"Select Excel File"}),e.jsx(ye,{id:"file",type:"file",accept:".xlsx,.xls",onChange:s=>{var a;return O(((a=s.target.files)==null?void 0:a[0])||null)}}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload your filled .xlsx or .xls file"})]}),e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Supported Columns:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 grid grid-cols-1 md:grid-cols-2 gap-1",children:[d==="Jewellery"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• CERT (SKU)"}),e.jsx("li",{children:"• PRODUCT (name)"}),e.jsx("li",{children:"• Diamond Color/Co"}),e.jsx("li",{children:"• CLARITY"}),e.jsx("li",{children:"• D.WT 1, D.WT 2 (diamond weights)"}),e.jsx("li",{children:"• T DWT (total diamond weight)"}),e.jsx("li",{children:"• G WT (gross weight)"}),e.jsx("li",{children:"• NET WT (net weight)"}),e.jsx("li",{children:"• CS TYPE (category)"}),e.jsx("li",{children:"• PURITY_FRACTION_USED"}),e.jsx("li",{children:"• D RATE 1 (diamond rate)"}),e.jsx("li",{children:"• Pointer diamond"}),e.jsx("li",{children:"• D VALUE (diamond value)"}),e.jsx("li",{children:"• GEMSTONE TYPE"}),e.jsx("li",{children:"• MKG (making charges)"}),e.jsx("li",{children:"• GOLD (gold cost)"}),e.jsx("li",{children:"• Certification cost"}),e.jsx("li",{children:"• Gemstone cost"}),e.jsx("li",{children:"• TOTAL (retail price)"}),e.jsx("li",{children:"• TOTAL_USD"}),e.jsx("li",{children:"• Product Type"}),e.jsx("li",{children:"• IMAGE_URL (images - use | separator)"}),e.jsx("li",{children:"• Thumbnail (3rd image)"}),e.jsx("li",{className:"font-semibold text-primary",children:"• DELIVERY TYPE (immediate/scheduled)"}),e.jsx("li",{className:"font-semibold text-primary",children:"• DELIVERY DATE (for scheduled)"})]}),d==="Gemstones"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• SKU ID (SKU)"}),e.jsx("li",{children:"• GEMSTONE NAME"}),e.jsx("li",{children:"• GEMSTONE TYPE"}),e.jsx("li",{children:"• CARAT WEIGHT"}),e.jsx("li",{children:"• COLOR"}),e.jsx("li",{children:"• CLARITY"}),e.jsx("li",{children:"• CUT"}),e.jsx("li",{children:"• POLISH"}),e.jsx("li",{children:"• SYMMETRY"}),e.jsx("li",{children:"• MEASUREMENT"}),e.jsx("li",{children:"• CERTIFICATION"}),e.jsx("li",{children:"• PRICE_INR"}),e.jsx("li",{children:"• STOCK QUANTITY"}),e.jsx("li",{children:"• IMAGE_URL (images - use | separator)"})]}),d==="Loose Diamonds"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• SKU NO"}),e.jsx("li",{children:"• DIAMOND TYPE (Natural/Lab-grown)"}),e.jsx("li",{children:"• STATUS"}),e.jsx("li",{children:"• SHAPE"}),e.jsx("li",{children:"• CARAT"}),e.jsx("li",{children:"• CLARITY"}),e.jsx("li",{children:"• COLOR"}),e.jsx("li",{children:"• COLOR SHADE AMOUNT"}),e.jsx("li",{children:"• CUT"}),e.jsx("li",{children:"• POLISH"}),e.jsx("li",{children:"• SYMMETRY"}),e.jsx("li",{children:"• FLO (Fluorescence)"}),e.jsx("li",{children:"• MEASUREMENT"}),e.jsx("li",{children:"• RATIO"}),e.jsx("li",{children:"• LAB"}),e.jsx("li",{children:"• PRICE_INR"}),e.jsx("li",{children:"• STOCK QUANTITY"}),e.jsx("li",{children:"• IMAGE_URL (images - use | separator)"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d==="Jewellery"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Delivery:"}),' Set DELIVERY TYPE to "immediate" or "scheduled". If scheduled, add DELIVERY DATE in YYYY-MM-DD format.']}),(d==="Gemstones"||d==="Loose Diamonds")&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Images:"})," Separate multiple image URLs with | (pipe) symbol. Up to 3 images supported."]})]})})]}),ee.length>0&&e.jsx("div",{className:"mt-6",children:e.jsx(We,{mappings:ee,productType:d})}),U&&e.jsxs("div",{className:"space-y-3",children:[U.missing.length>0&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm text-destructive",children:"Missing Required Columns"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"The following columns are required but not found in your file:"}),e.jsx("ul",{className:"mt-2 space-y-1",children:U.missing.map(s=>e.jsx("li",{className:"text-sm font-mono bg-background/50 px-2 py-1 rounded",children:s},s))})]})]})}),Object.keys(U.suggestions).length>0&&e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm text-amber-600",children:"Column Name Suggestions"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"These columns have similar names and will be automatically mapped:"}),e.jsx("ul",{className:"mt-2 space-y-1",children:Object.entries(U.suggestions).map(([s,a])=>e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-mono bg-background/50 px-2 py-1 rounded",children:a}),e.jsx("span",{className:"mx-2",children:"→"}),e.jsx("span",{className:"font-mono bg-primary/10 px-2 py-1 rounded",children:s})]},s))})]})]})}),U.missing.length===0&&Object.keys(U.suggestions).length===0&&e.jsx("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-green-600"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"All columns match perfectly!"})]})}),e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Detected columns:"})," ",U.detected.join(", ")]})})]}),e.jsx(F,{onClick:Te,disabled:P||!l,className:"w-full",children:P?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading Preview..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Preview Import"]})}),R&&e.jsx("div",{className:"mt-6 space-y-4",children:e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Import Preview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valid Products"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:R.valid.length})]}),e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Invalid Products"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:R.invalid.length})]})]}),R.invalid.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-destructive mb-2",children:"Products with errors:"}),e.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-1",children:[R.invalid.slice(0,5).map((s,a)=>e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Row ",s.row,": ",s.product," - ",s.errors[0]]},a)),R.invalid.length>5&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["...and ",R.invalid.length-5," more errors"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{onClick:fe,disabled:P||R.valid.length===0,className:"flex-1",children:P?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):`Confirm Import (${R.valid.length} products)`}),e.jsx(F,{variant:"outline",onClick:()=>H(null),disabled:P,children:"Cancel"})]})]})}),p.length>0&&e.jsxs("div",{className:"mt-6 p-4 border border-destructive rounded-lg bg-destructive/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-destructive",children:["Import Errors (",p.length,")"]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:je,className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Download Error Log"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Some products failed to import. Download the error log to see details."})]})]})})]})]})})})};export{ds as default};
//# sourceMappingURL=Import-BIiFWPGz.js.map
