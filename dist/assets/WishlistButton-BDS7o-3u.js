import{j as u}from"./query-vendor-CIvqgC9B.js";import{r}from"./react-vendor-BCzWReGx.js";import{l as f,B as k,k as p}from"./index-DBHw7ps1.js";import{u as m,H as S}from"./ui-vendor-B3Ur81tx.js";const C=()=>{let e=localStorage.getItem("wishlist_session_id");return e||(e=crypto.randomUUID(),localStorage.setItem("wishlist_session_id",e)),e},E=()=>{const[e,w]=r.useState(null),[l,n]=r.useState([]),[W,g]=r.useState(!0),_=r.useCallback(async()=>{var i;try{const{data:{user:s}}=await f.auth.getUser(),t=s?null:C();let o=f.from("wishlists").select("id, wishlist_items(product_id)");s?o=o.eq("user_id",s.id):o=o.eq("session_id",t);const{data:b,error:x}=await o.maybeSingle();if(x&&x.code!=="PGRST116"){console.error("Error fetching wishlist:",x),g(!1);return}if(b)w(b.id),n(((i=b.wishlist_items)==null?void 0:i.map(v=>v.product_id))||[]);else{const{data:v,error:y}=await f.from("wishlists").insert({user_id:(s==null?void 0:s.id)||null,session_id:t,name:"My Wishlist"}).select().single();y?console.error("Error creating wishlist:",y):v&&w(v.id)}}catch(s){console.error("Error initializing wishlist:",s)}finally{g(!1)}},[]);r.useEffect(()=>{_()},[_]);const c=r.useCallback(async(i,s)=>{if(!e)return m.error("Wishlist not initialized"),!1;try{const{error:t}=await f.from("wishlist_items").insert({wishlist_id:e,product_id:i,share_link_id:s||null});if(t){if(t.code==="23505")return m.info("Product already in wishlist"),!1;throw t}return n(o=>[...o,i]),m.success("Added to wishlist!"),!0}catch(t){return console.error("Error adding to wishlist:",t),m.error("Failed to add to wishlist"),!1}},[e]),d=r.useCallback(async i=>{if(!e)return!1;try{const{error:s}=await f.from("wishlist_items").delete().eq("wishlist_id",e).eq("product_id",i);if(s)throw s;return n(t=>t.filter(o=>o!==i)),m.success("Removed from wishlist"),!0}catch(s){return console.error("Error removing from wishlist:",s),m.error("Failed to remove from wishlist"),!1}},[e]),h=r.useCallback(i=>l.includes(i),[l]),a=r.useCallback(async(i,s)=>h(i)?d(i):c(i,s),[h,c,d]);return{wishlistId:e,wishlistItems:l,loading:W,addToWishlist:c,removeFromWishlist:d,isInWishlist:h,toggleWishlist:a,itemCount:l.length}},$=({productId:e,shareLinkId:w,variant:l="icon",className:n})=>{const{addToWishlist:W,removeFromWishlist:g,isInWishlist:_,loading:c}=E(),[d,h]=r.useState(!1),a=_(e),i=async s=>{s.stopPropagation(),h(!0),setTimeout(()=>h(!1),600),a?await g(e):await W(e,w)};return l==="icon"?u.jsx(k,{variant:"ghost",size:"icon",onClick:i,disabled:c,className:`h-8 w-8 hover:bg-background/80 ${n}`,children:u.jsx(p.div,{animate:d?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:u.jsx(S,{className:`h-4 w-4 transition-colors ${a?"fill-red-500 text-red-500":"text-muted-foreground hover:text-red-500"}`})})}):u.jsxs(k,{variant:a?"default":"outline",size:"sm",onClick:i,disabled:c,className:`gap-2 ${a?"bg-red-500 hover:bg-red-600 text-white":"hover:bg-red-50 dark:hover:bg-red-950/20 hover:text-red-500"} ${n}`,children:[u.jsx(p.div,{animate:d?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:u.jsx(S,{className:`h-4 w-4 ${a?"fill-current":""}`})}),a?"Saved":"Save"]})};export{$ as W,E as u};
//# sourceMappingURL=WishlistButton-BDS7o-3u.js.map
