{"version":3,"file":"EstimateHistory-rrnQRU6d.js","sources":["../../src/pages/EstimateHistory.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { Search, FileText, Eye, ArrowLeft, FileCheck } from \"lucide-react\";\r\nimport { exportCatalogToPDF } from \"@/utils/pdfExport\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\n\r\ninterface Estimate {\r\n  id: string;\r\n  estimate_name: string;\r\n  created_at: string;\r\n  customer_name: string;\r\n  customer_email: string;\r\n  customer_phone: string;\r\n  total_cost: number;\r\n  final_selling_price: number;\r\n  status: string;\r\n  updated_at: string;\r\n}\r\n\r\nconst EstimateHistory = () => {\r\n  const navigate = useNavigate();\r\n  const [estimates, setEstimates] = useState<Estimate[]>([]);\r\n  const [filteredEstimates, setFilteredEstimates] = useState<Estimate[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetchEstimates();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    filterEstimates();\r\n  }, [searchTerm, statusFilter, estimates]);\r\n\r\n  const fetchEstimates = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        toast.error(\"Please sign in to view estimates\");\r\n        navigate(\"/auth\");\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"manufacturing_cost_estimates\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .or(\"is_invoice_generated.is.null,is_invoice_generated.eq.false\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      setEstimates(data || []);\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to load estimates\");\r\n      console.error(\"Error fetching estimates:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filterEstimates = () => {\r\n    let filtered = estimates;\r\n\r\n    if (searchTerm) {\r\n      filtered = filtered.filter(\r\n        (estimate) =>\r\n          estimate.estimate_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n          estimate.customer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n          estimate.customer_email?.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n\r\n    if (statusFilter !== \"all\") {\r\n      filtered = filtered.filter((estimate) => estimate.status === statusFilter);\r\n    }\r\n\r\n    setFilteredEstimates(filtered);\r\n  };\r\n\r\n  const handleViewEstimate = (estimateId: string) => {\r\n    navigate(`/manufacturing-cost?estimate=${estimateId}`);\r\n  };\r\n\r\n  const handleConvertToInvoice = (estimateId: string) => {\r\n    navigate(`/invoice-generator?estimate=${estimateId}`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4 md:p-8\">\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        <Button\r\n          variant=\"ghost\"\r\n          onClick={() => navigate(\"/calculators\")}\r\n          className=\"group\"\r\n        >\r\n          <ArrowLeft className=\"mr-2 h-4 w-4 transition-transform group-hover:-translate-x-1\" />\r\n          Back to Calculators\r\n        </Button>\r\n\r\n        <Card className=\"border-primary/10 shadow-2xl backdrop-blur-sm bg-card/95\">\r\n          <CardHeader className=\"bg-gradient-to-r from-primary/5 via-secondary/5 to-accent/5 border-b\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-3xl font-bold flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                  <FileText className=\"h-7 w-7 text-primary\" />\r\n                </div>\r\n                Estimate History\r\n              </CardTitle>\r\n              <Badge variant=\"secondary\" className=\"text-sm\">\r\n                {filteredEstimates.length} {filteredEstimates.length === 1 ? \"Estimate\" : \"Estimates\"}\r\n              </Badge>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"p-6 space-y-6\">\r\n            <div className=\"flex flex-col md:flex-row gap-4\">\r\n              <div className=\"flex-1 relative\">\r\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Search by estimate name, customer name or email...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                <SelectTrigger className=\"w-full md:w-48\">\r\n                  <SelectValue placeholder=\"Filter by status\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">All Status</SelectItem>\r\n                  <SelectItem value=\"draft\">Draft</SelectItem>\r\n                  <SelectItem value=\"quoted\">Quoted</SelectItem>\r\n                  <SelectItem value=\"approved\">Approved</SelectItem>\r\n                  <SelectItem value=\"in_production\">In Production</SelectItem>\r\n                  <SelectItem value=\"completed\">Completed</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"text-center py-16\">\r\n                <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4\"></div>\r\n                <p className=\"text-muted-foreground text-lg\">Loading estimates...</p>\r\n              </div>\r\n            ) : filteredEstimates.length === 0 ? (\r\n              <div className=\"text-center py-16\">\r\n                <div className=\"p-4 rounded-full bg-muted/50 inline-block mb-4\">\r\n                  <FileText className=\"h-16 w-16 text-muted-foreground\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold mb-2\">No estimates found</h3>\r\n                <p className=\"text-muted-foreground mb-6\">\r\n                  {searchTerm || statusFilter !== \"all\"\r\n                    ? \"Try adjusting your filters\"\r\n                    : \"Start creating estimates to see them here\"}\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {filteredEstimates.map((estimate) => (\r\n                  <Card \r\n                    key={estimate.id} \r\n                    className=\"group hover:shadow-lg hover:border-primary/20 transition-all duration-200 bg-gradient-to-br from-card to-card/50\"\r\n                  >\r\n                    <CardContent className=\"p-6\">\r\n                      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                        <div className=\"space-y-3 flex-1\">\r\n                          <div className=\"flex items-center gap-3 flex-wrap\">\r\n                            <div className=\"flex items-center gap-2 bg-primary/5 px-3 py-1.5 rounded-lg\">\r\n                              <FileText className=\"h-4 w-4 text-primary\" />\r\n                              <h3 className=\"font-bold text-lg\">{estimate.estimate_name}</h3>\r\n                            </div>\r\n                            <Badge \r\n                              variant={estimate.status === \"completed\" ? \"default\" : \"secondary\"}\r\n                              className=\"capitalize\"\r\n                            >\r\n                              {estimate.status?.replace(\"_\", \" \")}\r\n                            </Badge>\r\n                          </div>\r\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                            <div className=\"flex items-center gap-2 text-sm\">\r\n                              <span className=\"font-medium text-muted-foreground\">Customer:</span>\r\n                              <span className=\"text-foreground\">{estimate.customer_name || \"N/A\"}</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 text-sm\">\r\n                              <span className=\"font-medium text-muted-foreground\">Created:</span>\r\n                              <span className=\"text-foreground\">\r\n                                {new Date(estimate.created_at).toLocaleDateString('en-US', { \r\n                                  year: 'numeric', \r\n                                  month: 'short', \r\n                                  day: 'numeric',\r\n                                  hour: '2-digit',\r\n                                  minute: '2-digit'\r\n                                })}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-baseline gap-2 pt-1\">\r\n                            <span className=\"text-sm font-medium text-muted-foreground\">Amount:</span>\r\n                            <span className=\"text-2xl font-bold text-primary\">\r\n                              â‚¹{estimate.final_selling_price?.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex gap-3\">\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"default\"\r\n                            onClick={() => handleViewEstimate(estimate.id)}\r\n                            className=\"group/btn\"\r\n                          >\r\n                            <Eye className=\"h-4 w-4 mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                            View\r\n                          </Button>\r\n                          <Button\r\n                            size=\"default\"\r\n                            onClick={() => handleConvertToInvoice(estimate.id)}\r\n                            className=\"group/btn bg-primary hover:bg-primary/90\"\r\n                          >\r\n                            <FileCheck className=\"h-4 w-4 mr-2 transition-transform group-hover/btn:scale-110\" />\r\n                            Create Invoice\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EstimateHistory;\r\n"],"names":["EstimateHistory","navigate","useNavigate","estimates","setEstimates","useState","filteredEstimates","setFilteredEstimates","searchTerm","setSearchTerm","statusFilter","setStatusFilter","loading","setLoading","useEffect","fetchEstimates","filterEstimates","user","supabase","toast","data","error","filtered","estimate","_a","_b","_c","handleViewEstimate","estimateId","handleConvertToInvoice","jsxs","Button","jsx","ArrowLeft","Card","CardHeader","CardTitle","FileText","Badge","CardContent","Search","Input","e","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Eye","FileCheck"],"mappings":"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"}