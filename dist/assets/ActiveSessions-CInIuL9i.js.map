{"version":3,"file":"ActiveSessions-CInIuL9i.js","sources":["../../src/pages/ActiveSessions.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { ApprovalGuard } from \"@/components/ApprovalGuard\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { Monitor, Smartphone, Tablet, Trash2, ArrowLeft } from \"lucide-react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useVendorPermissions } from \"@/hooks/useVendorPermissions\";\r\n\r\ninterface Session {\r\n  id: string;\r\n  session_id: string;\r\n  device_info: string;\r\n  ip_address: string;\r\n  last_activity: string;\r\n  created_at: string;\r\n}\r\n\r\nconst ActiveSessions = () => {\r\n  const navigate = useNavigate();\r\n  const { role, loading: roleLoading } = useUserRole();\r\n  const { permissions, loading: permissionsLoading } = useVendorPermissions();\r\n  const [sessions, setSessions] = useState<Session[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Check permissions\r\n  const canView = role === \"admin\" || role === \"team_member\" || permissions.can_view_sessions;\r\n  const canManage = role === \"admin\" || permissions.can_manage_sessions;\r\n\r\n  const fetchSessions = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"user_sessions\" as any)\r\n        .select(\"*\")\r\n        .order(\"last_activity\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setSessions((data as any) || []);\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to load sessions\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchSessions();\r\n  }, []);\r\n\r\n  const removeSession = async (sessionId: string) => {\r\n    if (!canManage) {\r\n      toast.error(\"You don't have permission to manage sessions\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"user_sessions\" as any)\r\n        .delete()\r\n        .eq(\"id\", sessionId);\r\n\r\n      if (error) throw error;\r\n      \r\n      toast.success(\"Session removed successfully\");\r\n      fetchSessions();\r\n    } catch (error: any) {\r\n      toast.error(\"Failed to remove session\");\r\n    }\r\n  };\r\n\r\n  const getDeviceIcon = (deviceInfo: string) => {\r\n    const info = deviceInfo.toLowerCase();\r\n    if (info.includes(\"mobile\") || info.includes(\"android\") || info.includes(\"iphone\")) {\r\n      return <Smartphone className=\"h-4 w-4\" />;\r\n    }\r\n    if (info.includes(\"tablet\") || info.includes(\"ipad\")) {\r\n      return <Tablet className=\"h-4 w-4\" />;\r\n    }\r\n    return <Monitor className=\"h-4 w-4\" />;\r\n  };\r\n\r\n  const getDeviceName = (deviceInfo: string) => {\r\n    const info = deviceInfo.toLowerCase();\r\n    if (info.includes(\"mobile\") || info.includes(\"android\")) return \"Mobile (Android)\";\r\n    if (info.includes(\"iphone\")) return \"Mobile (iPhone)\";\r\n    if (info.includes(\"ipad\")) return \"Tablet (iPad)\";\r\n    if (info.includes(\"mac\")) return \"Desktop (Mac)\";\r\n    if (info.includes(\"windows\")) return \"Desktop (Windows)\";\r\n    if (info.includes(\"linux\")) return \"Desktop (Linux)\";\r\n    return \"Unknown Device\";\r\n  };\r\n\r\n  const isCurrentSession = (sessionId: string) => {\r\n    // This would need to be enhanced with actual current session detection\r\n    return false;\r\n  };\r\n\r\n  if (roleLoading || permissionsLoading) {\r\n    return (\r\n      <ApprovalGuard>\r\n        <div className=\"container mx-auto p-6 max-w-6xl\">\r\n          <div className=\"text-center py-12\">\r\n            <div className=\"animate-pulse text-primary\">Loading...</div>\r\n          </div>\r\n        </div>\r\n      </ApprovalGuard>\r\n    );\r\n  }\r\n\r\n  if (!canView) {\r\n    return (\r\n      <ApprovalGuard>\r\n        <div className=\"container mx-auto p-6 max-w-6xl\">\r\n          <div className=\"text-center py-12\">\r\n            <p className=\"text-muted-foreground\">You don't have permission to view active sessions</p>\r\n            <Button variant=\"outline\" onClick={() => navigate(\"/\")} className=\"mt-4\">\r\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n              Back to Catalog\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </ApprovalGuard>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ApprovalGuard>\r\n      <div className=\"container mx-auto p-6 max-w-6xl\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold\">Active Sessions</h1>\r\n            <p className=\"text-muted-foreground mt-1\">\r\n              Manage your active devices (Maximum 5 devices)\r\n            </p>\r\n          </div>\r\n          <Button variant=\"outline\" onClick={() => navigate(\"/\")}>\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Back to Catalog\r\n          </Button>\r\n        </div>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Your Devices</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {loading ? (\r\n              <div className=\"text-center py-12\">\r\n                <div className=\"animate-pulse text-primary\">Loading sessions...</div>\r\n              </div>\r\n            ) : sessions.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <Monitor className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\r\n                <p className=\"text-muted-foreground\">No active sessions found</p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"mb-4 flex items-center justify-between\">\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {sessions.length} of 5 devices active\r\n                  </p>\r\n                  {sessions.length >= 5 && (\r\n                    <Badge variant=\"destructive\">Maximum devices reached</Badge>\r\n                  )}\r\n                </div>\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>Device</TableHead>\r\n                      <TableHead>IP Address</TableHead>\r\n                      <TableHead>Last Active</TableHead>\r\n                      <TableHead>Logged In</TableHead>\r\n                      <TableHead>Actions</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {sessions.map((session) => (\r\n                      <TableRow key={session.id}>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {getDeviceIcon(session.device_info)}\r\n                            <div>\r\n                              <p className=\"font-medium\">{getDeviceName(session.device_info)}</p>\r\n                              {isCurrentSession(session.session_id) && (\r\n                                <Badge variant=\"secondary\" className=\"text-xs mt-1\">\r\n                                  This device\r\n                                </Badge>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell className=\"font-mono text-sm\">\r\n                          {session.ip_address}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {new Date(session.last_activity).toLocaleString()}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {new Date(session.created_at).toLocaleString()}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {canManage ? (\r\n                            <Button\r\n                              size=\"sm\"\r\n                              variant=\"ghost\"\r\n                              onClick={() => removeSession(session.id)}\r\n                            >\r\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n                            </Button>\r\n                          ) : (\r\n                            <span className=\"text-sm text-muted-foreground\">View only</span>\r\n                          )}\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              </>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </ApprovalGuard>\r\n  );\r\n};\r\n\r\nexport default ActiveSessions;"],"names":["ActiveSessions","navigate","useNavigate","role","roleLoading","useUserRole","permissions","permissionsLoading","useVendorPermissions","sessions","setSessions","useState","loading","setLoading","canView","canManage","fetchSessions","data","error","supabase","toast","useEffect","removeSession","sessionId","getDeviceIcon","deviceInfo","info","jsx","Smartphone","Tablet","Monitor","getDeviceName","isCurrentSession","ApprovalGuard","jsxs","Button","ArrowLeft","Card","CardHeader","CardTitle","CardContent","Fragment","Badge","Table","TableHeader","TableRow","TableHead","TableBody","session","TableCell","Trash2"],"mappings":"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"}