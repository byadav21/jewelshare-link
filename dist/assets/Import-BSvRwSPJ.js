import{j as e,u as De}from"./query-vendor-BLxHmmGk.js";import{r as Y,u as Le}from"./react-vendor-BeR0k5Z3.js";import{C as be,i as Re,k as ye,l as Ie,g as Se,h as Ue,A as Me,B as V,s as P}from"./index-CX6yiz0b.js";import{I as ke}from"./input-CiHC6UAI.js";import{L as Te}from"./label-DbIM3Eg1.js";import{S as Ye,a as Fe,b as Ge,c as qe,d as Ke}from"./select-CYWHo3cU.js";import{r as We,u as J,w as Ve}from"./xlsx-CKN5doRT.js";import{g as $e,d as He,b as Be}from"./validations-BCm7QRmg.js";import{g as Qe}from"./generateTemplate-V6wkhAa8.js";import{B as se}from"./badge-45Abp579.js";import{S as Je}from"./scroll-area-BorAVKI3.js";import{i as re,a7 as te,A as ze,E as Xe,q as Ee,ab as je,a9 as fe}from"./ui-vendor-DjQqXt9S.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-D6fUEw85.js";import"./index-DjQc2W_p.js";import"./index-ibl8YJur.js";import"./invoiceTemplate-N6fQ82wS.js";const Ze="https://api.exchangerate-api.com/v4/latest/INR";let z=null,Ne=0;const es=36e5,ee=async i=>{try{const S=Date.now();if(z&&S-Ne<es)return parseFloat((i*z).toFixed(2));const E=await(await fetch(Ze)).json();return E.rates&&E.rates.USD?(z=E.rates.USD,Ne=S,parseFloat((i*z).toFixed(2))):(console.warn("Currency API failed, using fallback rate"),parseFloat((i*.012).toFixed(2)))}catch(S){return console.error("Currency conversion error:",S),parseFloat((i*.012).toFixed(2))}},ss=i=>{switch(i){case"Gemstones":return{required:["SKU ID","GEMSTONE NAME","PRICE INR","STOCK QUANTITY"],optional:["GEMSTONE TYPE","CARAT WEIGHT","COLOR","CLARITY","CUT","POLISH","SYMMETRY","MEASUREMENT","CERTIFICATION","IMAGE URL","COST PRICE","RETAIL PRICE"]};case"Loose Diamonds":return{required:["SKU NO","DIAMOND TYPE","SHAPE","CARAT","COLOR","CLARITY","PRICE INR","STOCK QUANTITY"],optional:["STATUS","COLOR SHADE AMOUNT","CUT","POLISH","SYMMETRY","FLO","MEASUREMENT","RATIO","LAB","IMAGE URL","COST PRICE","RETAIL PRICE"]};case"Jewellery":default:return{required:["CERT","PRODUCT","G WT","STOCK QUANTITY"],optional:["CATEGORY","DESCRIPTION","METAL TYPE","GEMSTONE","Diamond Color","CLARITY","D.WT 1","D.WT 2","GEMSTONE WT","T DWT","CS TYPE","NET WT","PURITY_FRACTION_USED","D RATE 1","Pointer diamond","GEMSTONE RATE","D VALUE","GEMSTONE TYPE","MKG","GOLD","Certification cost","Gemstone cost","TOTAL","TOTAL_USD","Product Type","IMAGE_URL","DELIVERY TYPE"]}}},ts=({mappings:i,productType:S})=>{const j=i.filter(m=>m.required),E=i.filter(m=>!m.required),d=i.filter(m=>m.mapped),H=j.filter(m=>!m.mapped);return e.jsxs(be,{className:"border-2 border-primary/20",children:[e.jsx(Re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ye,{className:"text-lg",children:"Column Mapping Preview"}),e.jsxs(Ie,{children:["Review how your Excel columns will be imported for ",S]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(se,{variant:H.length===0?"default":"destructive",className:"gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),d.length," / ",j.length," required"]})})]})}),e.jsxs(Se,{children:[e.jsx(Je,{className:"h-[400px] pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2 text-primary",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-primary/50 to-transparent"}),"Required Fields",e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-primary/50 to-transparent"})]}),j.map((m,F)=>e.jsx(Ce,{mapping:m},`req-${F}`))]}),E.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2 text-muted-foreground",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-border to-transparent"}),"Optional Fields",e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-border to-transparent"})]}),E.map((m,F)=>e.jsx(Ce,{mapping:m},`opt-${F}`))]})]})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"p-2 bg-green-500/10 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mapped"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:d.length})]}),e.jsxs("div",{className:"p-2 bg-amber-500/10 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optional"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:E.filter(m=>!m.mapped).length})]}),e.jsxs("div",{className:"p-2 bg-destructive/10 rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing"}),e.jsx("p",{className:"text-lg font-bold text-destructive",children:H.length})]})]})})]})]})},Ce=({mapping:i})=>e.jsx("div",{className:`
      p-3 rounded-lg border transition-all
      ${i.mapped?"bg-green-500/5 border-green-500/20":i.required?"bg-destructive/5 border-destructive/20":"bg-muted/30 border-border/50"}
    `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:i.mapped?e.jsx(re,{className:"h-4 w-4 text-green-600"}):i.required?e.jsx(te,{className:"h-4 w-4 text-destructive"}):e.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-muted-foreground/30"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[i.columnPosition&&e.jsxs(se,{variant:"outline",className:"text-xs font-mono",children:["Col ",i.columnPosition]}),e.jsx("code",{className:"px-2 py-0.5 bg-background rounded text-xs font-mono",children:i.excelColumn})]}),e.jsx(ze,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("code",{className:"px-2 py-0.5 bg-primary/10 rounded text-xs font-mono text-primary",children:i.databaseField}),i.required&&e.jsx(se,{variant:"secondary",className:"text-xs",children:"Required"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",i.dataType,")"]})]}),i.sampleValue&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Sample:"})," ",e.jsxs("span",{className:"italic",children:['"',i.sampleValue,'"']})]})]})]})}),Ss=()=>{const[i,S]=Y.useState(null),[j,E]=Y.useState(!1),[d,H]=Y.useState("Jewellery"),[m,F]=Y.useState([]),[h,X]=Y.useState(null),[_,le]=Y.useState(null),[ie,_e]=Y.useState([]),{toast:O}=Ue(),ae=Le(),{data:Z}=De({queryKey:["approvedCategories"],queryFn:async()=>{const{data:{user:t}}=await P.auth.getUser();if(!t)return[];const{data:n}=await P.from("user_approval_status").select("approved_categories").eq("user_id",t.id).single();return(n==null?void 0:n.approved_categories)||[]}}),we=async()=>{if(!i){O({title:"Error",description:"Please select a file",variant:"destructive"});return}E(!0),F([]),X(null),le(null);try{const{data:{user:t}}=await P.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:n}=await P.from("vendor_profiles").select("gold_rate_24k_per_gram, making_charges_per_gram").eq("user_id",t.id).single(),$=(n==null?void 0:n.gold_rate_24k_per_gram)||7e3,C=(n==null?void 0:n.making_charges_per_gram)||500,B=await i.arrayBuffer(),w=We(B);let G=w.SheetNames[0];G==="Instructions"&&w.SheetNames.length>1&&(G=w.SheetNames[1]);const D=w.Sheets[G],L=J.sheet_to_json(D);if(L.length>0){const o=Object.keys(L[0]),g=ss(d),s=[],l={},f=L[0],y=[];d==="Jewellery"?[{excel:"CERT",db:"sku",type:"text",required:!1,col:"A"},{excel:"PRODUCT",db:"name",type:"text",required:!0,col:"B"},{excel:"Diamond Color",db:"diamond_color",type:"text",required:!1,col:"C"},{excel:"CLARITY",db:"clarity",type:"text",required:!1,col:"D"},{excel:"D.WT 1",db:"d_wt_1",type:"number",required:!1},{excel:"D.WT 2",db:"d_wt_2",type:"number",required:!1},{excel:"T DWT",db:"diamond_weight",type:"number",required:!1},{excel:"G WT",db:"weight_grams",type:"number",required:!0},{excel:"NET WT",db:"net_weight",type:"number",required:!1},{excel:"PURITY_FRACTION_USED",db:"purity_fraction_used",type:"number",required:!0},{excel:"D RATE 1",db:"d_rate_1",type:"number",required:!1},{excel:"Pointer diamond",db:"pointer_diamond",type:"number",required:!1},{excel:"D VALUE",db:"d_value",type:"number",required:!1},{excel:"MKG",db:"mkg",type:"number",required:!1},{excel:"GOLD",db:"gold_per_gram_price",type:"number",required:!1},{excel:"Certification cost",db:"certification_cost",type:"number",required:!1},{excel:"Gemstone cost",db:"gemstone_cost",type:"number",required:!1},{excel:"TOTAL",db:"retail_price",type:"number",required:!0},{excel:"METAL TYPE",db:"metal_type",type:"text",required:!0},{excel:"IMAGE_URL",db:"image_url",type:"url",required:!1}].forEach(r=>{const x=f[r.excel]||f[r.excel.toUpperCase()]||f[r.excel.toLowerCase()],a=o.some(u=>u.toLowerCase().replace(/[^a-z0-9]/g,"")===r.excel.toLowerCase().replace(/[^a-z0-9]/g,""));y.push({excelColumn:r.excel,databaseField:r.db,sampleValue:x?String(x).substring(0,50):"",dataType:r.type,required:r.required,mapped:a,columnPosition:r.col})}):d==="Gemstones"?[{excel:"SKU ID",db:"sku",type:"text",required:!0},{excel:"GEMSTONE NAME",db:"gemstone_name",type:"text",required:!0},{excel:"CARAT WEIGHT",db:"carat_weight",type:"number",required:!1},{excel:"COLOR",db:"color",type:"text",required:!1},{excel:"CLARITY",db:"clarity",type:"text",required:!1},{excel:"PRICE INR",db:"price_inr",type:"number",required:!0}].forEach(r=>{const x=f[r.excel];y.push({excelColumn:r.excel,databaseField:r.db,sampleValue:x?String(x).substring(0,50):"",dataType:r.type,required:r.required,mapped:o.includes(r.excel)})}):d==="Loose Diamonds"&&[{excel:"SKU NO",db:"sku",type:"text",required:!0},{excel:"SHAPE",db:"shape",type:"text",required:!0},{excel:"CARAT",db:"carat",type:"number",required:!0},{excel:"COLOR",db:"color",type:"text",required:!0},{excel:"CLARITY",db:"clarity",type:"text",required:!0},{excel:"PRICE INR",db:"price_inr",type:"number",required:!0}].forEach(r=>{const x=f[r.excel];y.push({excelColumn:r.excel,databaseField:r.db,sampleValue:x?String(x).substring(0,50):"",dataType:r.type,required:r.required,mapped:o.includes(r.excel)})}),_e(y),g.required.forEach(T=>{if(!o.find(x=>x.toLowerCase()===T.toLowerCase()||x.replace(/[_\s]/g,"").toLowerCase()===T.replace(/[_\s]/g,"").toLowerCase())){const x=o.find(a=>{const u=a.toLowerCase().replace(/[_\s]/g,""),I=T.toLowerCase().replace(/[_\s]/g,"");return u.includes(I)||I.includes(u)});x?l[T]=x:s.push(T)}}),le({detected:o,missing:s,suggestions:l})}const U=[],c=[],b=d==="Gemstones"?$e:d==="Loose Diamonds"?He:Be;for(const[o,g]of L.entries()){const s=g,l=a=>{if(typeof a=="number")return a;if(typeof a=="string"){const u=a.replace(/[^0-9.-]/g,"");return parseFloat(u)||0}return 0};let f=null,y=null,T=null;if(s.IMAGE_URL||s["IMAGE URL"]){const a=String(s.IMAGE_URL||s["IMAGE URL"]).replace(/\\/g,"").split("|").map(u=>u.trim()).filter(u=>u.startsWith("http"));f=a[0]||null,y=a[1]||null,T=a[2]||null}let r;if(d==="Gemstones"){const a=l(s["PRICE INR"]||s.PRICE_INR||s["Price INR"]||s.Price),u="COST PRICE"in s||"COST_PRICE"in s||"Cost Price"in s,I="RETAIL PRICE"in s||"RETAIL_PRICE"in s||"Retail Price"in s,A=u?l(s["COST PRICE"]||s.COST_PRICE||s["Cost Price"]):null,N=I?l(s["RETAIL PRICE"]||s.RETAIL_PRICE||s["Retail Price"]):null,p=a&&a>0?a:.01,q=A!==null&&A>0?A:p,K=N!==null&&N>0?N:p,W=p>.01?await ee(p):null;r={user_id:t.id,sku:s["SKU ID"]||s.SKU||`GEM-${o+1}`,gemstone_name:s["GEMSTONE NAME"]||s["Gemstone Name"]||"Ruby",gemstone_type:s["GEMSTONE TYPE"]||s["Gemstone Type"]||null,carat_weight:l(s["CARAT WEIGHT"]||s["Carat Weight"]),color:s.COLOR||s.Color||null,clarity:s.CLARITY||s.Clarity||null,cut:s.CUT||s.Cut||null,polish:s.POLISH||s.Polish||null,symmetry:s.SYMMETRY||s.Symmetry||null,measurement:s.MEASUREMENT||s.Measurement||null,certification:s.CERTIFICATION||s.Certification||null,image_url:f||null,image_url_2:y||null,image_url_3:T||null,price_inr:p,price_usd:W,cost_price:q,retail_price:K,stock_quantity:l(s["STOCK QUANTITY"]||s["Stock Quantity"])||1,product_type:"Gemstones",name:s["GEMSTONE NAME"]||s["Gemstone Name"]||"Unknown Gemstone"}}else if(d==="Loose Diamonds"){const a=l(s["PRICE INR"]||s.PRICE_INR||s["Price INR"]||s.Price),u="COST PRICE"in s||"COST_PRICE"in s||"Cost Price"in s,I="RETAIL PRICE"in s||"RETAIL_PRICE"in s||"Retail Price"in s,A=u?l(s["COST PRICE"]||s.COST_PRICE||s["Cost Price"]):null,N=I?l(s["RETAIL PRICE"]||s.RETAIL_PRICE||s["Retail Price"]):null,p=a&&a>0?a:.01,q=A!==null&&A>0?A:p,K=N!==null&&N>0?N:p,W=p>.01?await ee(p):null;r={user_id:t.id,sku:s["SKU NO"]||s.SKU||`DIA-${o+1}`,diamond_type:s["DIAMOND TYPE"]||s["Diamond Type"]||"Natural",status:s.STATUS||s.Status||null,shape:s.SHAPE||s.Shape||"Round",carat:l(s.CARAT||s.Carat),clarity:s.CLARITY||s.Clarity||"VS1",color:s.COLOR||s.Color||"F",color_shade_amount:s["COLOR SHADE AMOUNT"]||s["Color Shade Amount"]||null,cut:s.CUT||s.Cut||null,polish:s.POLISH||s.Polish||null,symmetry:s.SYMMETRY||s.Symmetry||null,fluorescence:s.FLO||s.Fluorescence||null,measurement:s.MEASUREMENT||s.Measurement||null,ratio:s.RATIO||s.Ratio||null,lab:s.LAB||s.Lab||null,image_url:f||null,image_url_2:y||null,image_url_3:T||null,price_inr:p,price_usd:W,cost_price:q,retail_price:K,stock_quantity:l(s["STOCK QUANTITY"]||s["Stock Quantity"])||1,product_type:"Loose Diamonds",name:`${s.SHAPE||"Round"} Diamond ${s.CARAT||"1.0"}ct`}}else{const a=l(s["G WT"])||0,u=l(s["T DWT"])||0,I=l(s["GEMSTONE WT"])||0,N=l(s["NET WT"])||a-u+I/5,p=(()=>{const v=s.PURITY_FRACTION_USED;if(!v)return .76;if(typeof v=="string"&&v.includes("%")){const ge=parseFloat(v.replace(/[^0-9.-]/g,""));return ge>0?ge/100:.76}const Q=l(v);return Q>1?Q/100:Q||.76})(),q=l(s["D.WT 1"]||s["D WT 1"])||0,K=l(s["D.WT 2"]||s["D WT 2"])||0,W=l(s["D RATE 1"])||0,ne=l(s["Pointer diamond"])||0,oe=l(s["D VALUE"])||q*W+K*ne,ce=l(s.MKG)||a*C,de=l(s.GOLD)||N*$*p,ue=l(s["Certification cost"])||0,me=l(s["Gemstone cost"])||0,k=l(s.TOTAL)||oe+ce+de+ue+me,xe=l(s.TOTAL_USD)||(k>0?await ee(k):null),pe=D[`C${o+2}`],Pe=pe?String(pe.v||"").trim():null,he=D[`D${o+2}`],Oe=he?String(he.v||"").trim():null;r={user_id:t.id,name:s.PRODUCT||s.CERT||`Product ${o+1}`,description:s.DESCRIPTION||s["Product Type"]||null,sku:s.CERT||s["SKU ID"]||s.SKU||null,category:s.CATEGORY||null,metal_type:s["METAL TYPE"]||null,gemstone:s.GEMSTONE||null,color:s.COLOR||null,diamond_color:Pe||s["Diamond Color"]||s["DIAMOND COLOR"]||null,clarity:Oe||s.CLARITY||null,image_url:f||null,image_url_2:y||null,image_url_3:T||null,weight_grams:a||null,net_weight:N||null,diamond_weight:u||null,carat_weight:I||null,d_wt_1:q||null,d_wt_2:K||null,diamond_type:s["CS TYPE"]||null,purity_fraction_used:p,d_rate_1:W||null,pointer_diamond:ne||null,d_value:oe||null,gemstone_type:s["GEMSTONE TYPE"]||null,mkg:ce||null,gold_per_gram_price:de||null,certification_cost:ue||null,gemstone_cost:me||null,total_usd:xe,price_inr:k,price_usd:xe,cost_price:k>0?k:.01,retail_price:k>0?k:.01,stock_quantity:l(s["STOCK QUANTITY"])||1,delivery_type:(()=>{const v=s["DELIVERY TYPE"];return v&&String(v).toLowerCase().includes("schedule")?"scheduled":"immediate"})(),dispatches_in_days:s["DISPATCHES IN DAYS"]||null,product_type:"Jewellery"}}const x=b.safeParse(r);if(x.success)c.push(r);else{const a=x.error.issues.map(u=>`${u.path.join(".")}: ${u.message}`);U.push({row:o+2,product:r.name||r.sku||`Row ${o+2}`,errors:a})}}const M=new Map;c.forEach((o,g)=>{if(o.sku){const s=M.get(o.sku)||[];s.push(g),M.set(o.sku,s)}});const R=Array.from(M.entries()).filter(([o,g])=>g.length>1).map(([o,g])=>({sku:o,rows:g.map(s=>s+2)}));if(R.length>0){const o=R.map(({sku:g,rows:s})=>`SKU "${g}" appears in rows: ${s.join(", ")}`).join(`
`);O({title:"Duplicate SKUs Found",description:`Found ${R.length} duplicate SKU(s) in your file. Please make each SKU unique:
${o}`,variant:"destructive"}),R.forEach(({sku:g,rows:s})=>{U.push({row:s[0],product:g,errors:[`Duplicate SKU found in rows: ${s.join(", ")}`]})})}X({valid:c,invalid:U}),O({title:"Preview Ready",description:`${c.length} products will be imported, ${U.length+R.length} have errors`})}catch(t){O({title:"Preview Failed",description:t.message||"Failed to preview Excel file",variant:"destructive"})}finally{E(!1)}},Ae=async()=>{if(!(!h||h.valid.length===0)){E(!0);try{const{data:{user:t}}=await P.auth.getUser();if(!t){O({title:"Error",description:"You must be logged in to import products",variant:"destructive"});return}const n=h.valid,$=n.map(c=>c.sku).filter(Boolean),{data:C,error:B}=await P.from("products").select("id, sku").eq("user_id",t.id).is("deleted_at",null).in("sku",$);if(B)throw console.error("Error fetching existing products:",B),new Error("Failed to check existing products. Please try again.");const w=new Map((C==null?void 0:C.map(c=>[c.sku,c.id]))||[]),G=n.filter(c=>c.sku&&w.has(c.sku)),D=n.filter(c=>!c.sku||!w.has(c.sku));let L=0,U=0;if(G.length>0)for(const c of G){const b=w.get(c.sku),{error:M}=await P.from("products").update(c).eq("id",b);M||L++}if(D.length>0){const{data:c,error:b}=await P.from("products").insert(D).select();if(b){if(console.error("Insert error:",b),b.code==="23505"&&b.message.includes("products_sku_key")){const M=D.filter(R=>R.sku).map(R=>R.sku).join(", ");throw new Error(`Duplicate SKU detected. One or more SKUs already exist in your catalog: ${M}. Please use unique SKUs for each product or remove duplicate rows from your Excel file.`)}throw b}U=(c==null?void 0:c.length)||0}F(h.invalid),O({title:"Success!",description:`Updated ${L} products, imported ${U} new products`}),ae("/")}catch(t){O({title:"Import Failed",description:t.message||"Failed to import products",variant:"destructive"})}finally{E(!1)}}},ve=()=>{const t=J.book_new(),n=m.map(C=>({"Row Number":C.row,"Product Name/SKU":C.product,Errors:C.errors.join("; ")})),$=J.json_to_sheet(n);J.book_append_sheet(t,$,"Import Errors"),Ve(t,`import-errors-${new Date().toISOString().split("T")[0]}.xlsx`)};return e.jsx(Me,{children:e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs(V,{variant:"ghost",onClick:()=>ae("/"),className:"mb-6",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Back to Catalog"]}),e.jsxs(be,{children:[e.jsx(Re,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx(ye,{children:"Import Products"}),e.jsx(Ie,{children:"Upload your jewelry catalog from an Excel file"})]})]})}),e.jsx(Se,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"productType",children:"Select Product Type"}),e.jsxs(Ye,{value:d,onValueChange:t=>H(t),children:[e.jsx(Fe,{children:e.jsx(Ge,{})}),e.jsx(qe,{children:Z==null?void 0:Z.map(t=>e.jsx(Ke,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Step 1: Download Template"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Get the Excel template for ",d]})]}),e.jsxs(V,{variant:"outline",onClick:()=>Qe(d),className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Download Template"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Step 2: Upload Filled Template"}),e.jsx(Te,{htmlFor:"file",children:"Select Excel File"}),e.jsx(ke,{id:"file",type:"file",accept:".xlsx,.xls",onChange:t=>{var n;return S(((n=t.target.files)==null?void 0:n[0])||null)}}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload your filled .xlsx or .xls file"})]}),e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Supported Columns:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 grid grid-cols-1 md:grid-cols-2 gap-1",children:[d==="Jewellery"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• CERT (SKU)"}),e.jsx("li",{children:"• PRODUCT (name)"}),e.jsx("li",{children:"• Diamond Color/Co"}),e.jsx("li",{children:"• CLARITY"}),e.jsx("li",{children:"• D.WT 1, D.WT 2 (diamond weights)"}),e.jsx("li",{children:"• T DWT (total diamond weight)"}),e.jsx("li",{children:"• G WT (gross weight)"}),e.jsx("li",{children:"• NET WT (net weight)"}),e.jsx("li",{children:"• CS TYPE (category)"}),e.jsx("li",{children:"• PURITY_FRACTION_USED"}),e.jsx("li",{children:"• D RATE 1 (diamond rate)"}),e.jsx("li",{children:"• Pointer diamond"}),e.jsx("li",{children:"• D VALUE (diamond value)"}),e.jsx("li",{children:"• GEMSTONE TYPE"}),e.jsx("li",{children:"• MKG (making charges)"}),e.jsx("li",{children:"• GOLD (gold cost)"}),e.jsx("li",{children:"• Certification cost"}),e.jsx("li",{children:"• Gemstone cost"}),e.jsx("li",{children:"• TOTAL (retail price)"}),e.jsx("li",{children:"• TOTAL_USD"}),e.jsx("li",{children:"• Product Type"}),e.jsx("li",{children:"• IMAGE_URL (images - use | separator)"}),e.jsx("li",{children:"• Thumbnail (3rd image)"}),e.jsx("li",{className:"font-semibold text-primary",children:"• DELIVERY TYPE (immediate/scheduled)"}),e.jsx("li",{className:"font-semibold text-primary",children:"• DELIVERY DATE (for scheduled)"})]}),d==="Gemstones"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• SKU ID (SKU)"}),e.jsx("li",{children:"• GEMSTONE NAME"}),e.jsx("li",{children:"• GEMSTONE TYPE"}),e.jsx("li",{children:"• CARAT WEIGHT"}),e.jsx("li",{children:"• COLOR"}),e.jsx("li",{children:"• CLARITY"}),e.jsx("li",{children:"• CUT"}),e.jsx("li",{children:"• POLISH"}),e.jsx("li",{children:"• SYMMETRY"}),e.jsx("li",{children:"• MEASUREMENT"}),e.jsx("li",{children:"• CERTIFICATION"}),e.jsx("li",{children:"• PRICE_INR"}),e.jsx("li",{children:"• STOCK QUANTITY"}),e.jsx("li",{children:"• IMAGE_URL (images - use | separator)"})]}),d==="Loose Diamonds"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• SKU NO"}),e.jsx("li",{children:"• DIAMOND TYPE (Natural/Lab-grown)"}),e.jsx("li",{children:"• STATUS"}),e.jsx("li",{children:"• SHAPE"}),e.jsx("li",{children:"• CARAT"}),e.jsx("li",{children:"• CLARITY"}),e.jsx("li",{children:"• COLOR"}),e.jsx("li",{children:"• COLOR SHADE AMOUNT"}),e.jsx("li",{children:"• CUT"}),e.jsx("li",{children:"• POLISH"}),e.jsx("li",{children:"• SYMMETRY"}),e.jsx("li",{children:"• FLO (Fluorescence)"}),e.jsx("li",{children:"• MEASUREMENT"}),e.jsx("li",{children:"• RATIO"}),e.jsx("li",{children:"• LAB"}),e.jsx("li",{children:"• PRICE_INR"}),e.jsx("li",{children:"• STOCK QUANTITY"}),e.jsx("li",{children:"• IMAGE_URL (images - use | separator)"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d==="Jewellery"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Delivery:"}),' Set DELIVERY TYPE to "immediate" or "scheduled". If scheduled, add DELIVERY DATE in YYYY-MM-DD format.']}),(d==="Gemstones"||d==="Loose Diamonds")&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Images:"})," Separate multiple image URLs with | (pipe) symbol. Up to 3 images supported."]})]})})]}),ie.length>0&&e.jsx("div",{className:"mt-6",children:e.jsx(ts,{mappings:ie,productType:d})}),_&&e.jsxs("div",{className:"space-y-3",children:[_.missing.length>0&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm text-destructive",children:"Missing Required Columns"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"The following columns are required but not found in your file:"}),e.jsx("ul",{className:"mt-2 space-y-1",children:_.missing.map(t=>e.jsx("li",{className:"text-sm font-mono bg-background/50 px-2 py-1 rounded",children:t},t))})]})]})}),Object.keys(_.suggestions).length>0&&e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm text-amber-600",children:"Column Name Suggestions"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"These columns have similar names and will be automatically mapped:"}),e.jsx("ul",{className:"mt-2 space-y-1",children:Object.entries(_.suggestions).map(([t,n])=>e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-mono bg-background/50 px-2 py-1 rounded",children:n}),e.jsx("span",{className:"mx-2",children:"→"}),e.jsx("span",{className:"font-mono bg-primary/10 px-2 py-1 rounded",children:t})]},t))})]})]})}),_.missing.length===0&&Object.keys(_.suggestions).length===0&&e.jsx("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-green-600"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"All columns match perfectly!"})]})}),e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Detected columns:"})," ",_.detected.join(", ")]})})]}),e.jsx(V,{onClick:we,disabled:j||!i,className:"w-full",children:j?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading Preview..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Preview Import"]})}),h&&e.jsx("div",{className:"mt-6 space-y-4",children:e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/50",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Import Preview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valid Products"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.valid.length})]}),e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Invalid Products"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:h.invalid.length})]})]}),h.invalid.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-destructive mb-2",children:"Products with errors:"}),e.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-1",children:[h.invalid.slice(0,5).map((t,n)=>e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Row ",t.row,": ",t.product," - ",t.errors[0]]},n)),h.invalid.length>5&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["...and ",h.invalid.length-5," more errors"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{onClick:Ae,disabled:j||h.valid.length===0,className:"flex-1",children:j?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):`Confirm Import (${h.valid.length} products)`}),e.jsx(V,{variant:"outline",onClick:()=>X(null),disabled:j,children:"Cancel"})]})]})}),m.length>0&&e.jsxs("div",{className:"mt-6 p-4 border border-destructive rounded-lg bg-destructive/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-destructive",children:["Import Errors (",m.length,")"]}),e.jsxs(V,{variant:"outline",size:"sm",onClick:ve,className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Download Error Log"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Some products failed to import. Download the error log to see details."})]})]})})]})]})})})};export{Ss as default};
//# sourceMappingURL=Import-BSvRwSPJ.js.map
