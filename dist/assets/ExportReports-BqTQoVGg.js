import{u as E,j as e}from"./query-vendor-BLxHmmGk.js";import{u as v,r as B}from"./react-vendor-BeR0k5Z3.js";import{Z as K,B as f,C as j,G as w,H as N,I as g,D as b,F as y}from"./index-DGlTgSKx.js";import{J as U,ae as q,U as V,l as M,b4 as G,P as L,u as C}from"./ui-vendor-CN4tOqpp.js";import{E as A,a as F}from"./jspdf.plugin.autotable-DkGJWiqm.js";import{u as c,w as H}from"./xlsx-CKN5doRT.js";import{f as i}from"./format-CqKCEgBk.js";import"./supabase-vendor-VSDMYZ1k.js";const se=()=>{const k=v(),{isAdmin:_,loading:I}=K(),[d,m]=B.useState(null),{data:u}=E({queryKey:["vendor-report-data"],queryFn:async()=>{const{data:s,error:n}=await y.from("user_approval_status").select("user_id, business_name, email, status, requested_at");if(n)throw n;const{data:a}=await y.from("vendor_profiles").select("user_id, business_name, email, phone"),{data:t}=await y.from("products").select("user_id").is("deleted_at",null),o=t==null?void 0:t.reduce((l,h)=>(l[h.user_id]=(l[h.user_id]||0)+1,l),{});return s==null?void 0:s.map(l=>({...l,profile:a==null?void 0:a.find(h=>h.user_id===l.user_id),productCount:(o==null?void 0:o[l.user_id])||0}))},enabled:_}),{data:p}=E({queryKey:["inquiry-report-data"],queryFn:async()=>{const{data:s,error:n}=await y.from("catalog_inquiries").select("*").order("created_at",{ascending:!1});if(n)throw n;return s},enabled:_}),{data:x}=E({queryKey:["product-report-data"],queryFn:async()=>{const{data:s,error:n}=await y.from("products").select("*").is("deleted_at",null).order("created_at",{ascending:!1});if(n)throw n;const{data:a}=await y.from("product_interests").select("product_id"),t=a==null?void 0:a.reduce((o,l)=>(o[l.product_id]=(o[l.product_id]||0)+1,o),{});return s==null?void 0:s.map(o=>({...o,interestCount:(t==null?void 0:t[o.id])||0}))},enabled:_}),R=()=>{m("vendor-pdf");const s=new A;s.setFontSize(18),s.text("Vendor Performance Report",14,20),s.setFontSize(10),s.text(`Generated on: ${i(new Date,"MMM dd, yyyy HH:mm")}`,14,28);const n=u==null?void 0:u.map(a=>{var t,o;return[((t=a.profile)==null?void 0:t.business_name)||a.business_name||"N/A",((o=a.profile)==null?void 0:o.email)||a.email||"N/A",a.status,a.productCount.toString(),i(new Date(a.requested_at),"MMM dd, yyyy")]});F(s,{head:[["Business Name","Email","Status","Products","Joined"]],body:n||[],startY:35,styles:{fontSize:8},headStyles:{fillColor:[59,130,246]}}),s.save(`vendor-performance-${i(new Date,"yyyy-MM-dd")}.pdf`),C.success("Vendor report exported successfully"),m(null)},$=()=>{m("inquiry-excel");const s=p==null?void 0:p.map(t=>({"Customer Name":t.customer_name,Email:t.customer_email,Phone:t.customer_phone||"N/A",Message:t.message,Date:i(new Date(t.created_at),"MMM dd, yyyy HH:mm")})),n=c.json_to_sheet(s||[]),a=c.book_new();c.book_append_sheet(a,n,"Inquiries"),H(a,`customer-inquiries-${i(new Date,"yyyy-MM-dd")}.xlsx`),C.success("Inquiry report exported successfully"),m(null)},z=()=>{m("product-pdf");const s=new A;s.setFontSize(18),s.text("Product Trends Report",14,20),s.setFontSize(10),s.text(`Generated on: ${i(new Date,"MMM dd, yyyy HH:mm")}`,14,28);const n=x==null?void 0:x.sort((t,o)=>o.interestCount-t.interestCount).slice(0,50),a=n==null?void 0:n.map(t=>{var o;return[t.name,t.sku||"N/A",t.category||"N/A",`â‚¹${((o=t.retail_price)==null?void 0:o.toLocaleString())||0}`,t.interestCount.toString()]});F(s,{head:[["Product Name","SKU","Category","Price","Interests"]],body:a||[],startY:35,styles:{fontSize:8},headStyles:{fillColor:[59,130,246]}}),s.save(`product-trends-${i(new Date,"yyyy-MM-dd")}.pdf`),C.success("Product trends report exported successfully"),m(null)},T=()=>{m("all-excel");const s=c.book_new(),n=u==null?void 0:u.map(r=>{var S,P,D;return{"Business Name":((S=r.profile)==null?void 0:S.business_name)||r.business_name||"N/A",Email:((P=r.profile)==null?void 0:P.email)||r.email||"N/A",Phone:((D=r.profile)==null?void 0:D.phone)||"N/A",Status:r.status,Products:r.productCount,Joined:i(new Date(r.requested_at),"MMM dd, yyyy")}}),a=c.json_to_sheet(n||[]);c.book_append_sheet(s,a,"Vendors");const t=p==null?void 0:p.map(r=>({"Customer Name":r.customer_name,Email:r.customer_email,Phone:r.customer_phone||"N/A",Message:r.message,Date:i(new Date(r.created_at),"MMM dd, yyyy")})),o=c.json_to_sheet(t||[]);c.book_append_sheet(s,o,"Inquiries");const l=x==null?void 0:x.slice(0,1e3).map(r=>({Name:r.name,SKU:r.sku||"N/A",Category:r.category||"N/A",Price:r.retail_price||0,Stock:r.stock_quantity||0,Interests:r.interestCount})),h=c.json_to_sheet(l||[]);c.book_append_sheet(s,h,"Products"),H(s,`complete-report-${i(new Date,"yyyy-MM-dd")}.xlsx`),C.success("Complete report exported successfully"),m(null)};return I?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):_?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(f,{variant:"ghost",onClick:()=>k("/super-admin"),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(q,{className:"h-8 w-8"}),"Export Reports"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Generate and download various reports"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Vendor Performance"]}),e.jsx(g,{children:"Export vendor statistics including products, status, and join dates"})]}),e.jsx(b,{className:"space-y-2",children:e.jsxs(f,{onClick:R,disabled:d==="vendor-pdf",className:"w-full",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),d==="vendor-pdf"?"Exporting...":"Export as PDF"]})})]}),e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Customer Inquiries"]}),e.jsx(g,{children:"Export all customer inquiries with contact details and messages"})]}),e.jsx(b,{className:"space-y-2",children:e.jsxs(f,{onClick:$,disabled:d==="inquiry-excel",className:"w-full",variant:"secondary",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),d==="inquiry-excel"?"Exporting...":"Export as Excel"]})})]}),e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Product Trends"]}),e.jsx(g,{children:"Export top products with interest counts and pricing"})]}),e.jsx(b,{className:"space-y-2",children:e.jsxs(f,{onClick:z,disabled:d==="product-pdf",className:"w-full",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),d==="product-pdf"?"Exporting...":"Export as PDF"]})})]}),e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Complete Report"]}),e.jsx(g,{children:"Export all data (vendors, inquiries, products) in one Excel file"})]}),e.jsx(b,{className:"space-y-2",children:e.jsxs(f,{onClick:T,disabled:d==="all-excel",className:"w-full",variant:"secondary",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),d==="all-excel"?"Exporting...":"Export as Excel"]})})]})]})]}):(k("/"),null)};export{se as default};
//# sourceMappingURL=ExportReports-BqTQoVGg.js.map
