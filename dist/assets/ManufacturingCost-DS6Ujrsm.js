import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as l,u as cs}from"./react-vendor-BeR0k5Z3.js";import{f as te,C as _,i as I,k as F,l as E,g as y,B as N,s as w,h as os}from"./index-CX6yiz0b.js";import{I as o}from"./input-CiHC6UAI.js";import{L as i}from"./label-DbIM3Eg1.js";import{T as oe}from"./textarea-CBQfWmvq.js";import{S as ds}from"./switch-7lvrHTHU.js";import{B as ms}from"./BackToHomeButton-C1MOpu96.js";import{D as xs,ak as ae,k as De,af as hs,al as Le,d as Re,am as Ue,A as B,an as gs,l as J,a8 as us,ao as ps,ap as js,aq as Ee,ar as Ve,ai as fs,X as Be,u as Pe,ab as Ns,C as vs,O as bs}from"./ui-vendor-DjQqXt9S.js";import{A as Ge,a as Ae}from"./alert-DIsJjuyH.js";import{S as ys}from"./separator-D0WC8Ha9.js";import{C as Cs,a as _s,b as ws}from"./collapsible-Dru8hkE9.js";import{S as We,a as Me,b as ze,c as Oe,d as S}from"./select-CYWHo3cU.js";import{E as Ss}from"./EstimateImage-DpQ34XUT.js";import{D as re,b as ne,c as ie,d as le,e as ce,f as Is}from"./dialog-KVJ8gRMk.js";import{S as Fs}from"./scroll-area-BorAVKI3.js";import{P as ks,a as Ts,b as Es,C as Ps}from"./popover-BMhq8iVk.js";import{f as Gs}from"./format-sTPjOSS_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-DjQc2W_p.js";import"./proxy-8agjeDDu.js";import"./index-DSkn7fL5.js";import"./index-BdQq_4o_.js";import"./index-BC78nHQ6.js";import"./index-D6fUEw85.js";import"./index-DhS5fNEb.js";import"./en-US-DWrl2lTx.js";import"./endOfMonth-DIWrT0r0.js";import"./subDays-ByyGNxrB.js";const As=({currentStep:r,steps:d})=>e.jsx("div",{className:"w-full py-8",children:e.jsx("div",{className:"flex items-center justify-between",children:d.map((s,m)=>e.jsxs("div",{className:"flex flex-1 items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:te("flex h-12 w-12 items-center justify-center rounded-full border-2 transition-all duration-300",r>s.id?"border-primary bg-primary text-primary-foreground":r===s.id?"border-primary bg-background text-primary animate-pulse":"border-muted-foreground/30 bg-background text-muted-foreground"),children:r>s.id?e.jsx(xs,{className:"h-6 w-6"}):e.jsx("span",{className:"text-sm font-bold",children:s.id})}),e.jsxs("div",{className:"mt-2 text-center max-w-[120px]",children:[e.jsx("p",{className:te("text-sm font-semibold transition-colors",r>=s.id?"text-foreground":"text-muted-foreground"),children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]})]}),m<d.length-1&&e.jsx("div",{className:te("h-0.5 flex-1 mx-4 transition-all duration-300",r>s.id?"bg-primary":"bg-muted-foreground/30")})]},s.id))})}),Ds=()=>e.jsxs(_,{className:"border-primary/20 bg-gradient-to-br from-primary/5 via-background to-accent/5",children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),"Estimate vs Invoice - Quick Guide"]}),e.jsx(E,{children:"Understanding the workflow from cost estimation to final invoice"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Step 1: Create Estimate"})]}),e.jsxs("div",{className:"pl-7 space-y-2 text-sm text-muted-foreground",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-4 w-4"}),"Enter jewelry specifications (weight, purity, diamonds, gemstones)"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Calculate manufacturing costs (gold, making charges, CAD, certification)"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Set profit margin to determine selling price"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Save as ",e.jsx("span",{className:"font-semibold text-foreground",children:"Draft"})," for future reference"]})]}),e.jsx(Ge,{className:"bg-primary/5 border-primary/20",children:e.jsxs(Ae,{className:"text-sm",children:[e.jsx("strong",{children:"Estimates"})," are for quotations and internal calculations. They can be modified anytime and don't require complete customer details."]})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(B,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx(ys,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-5 w-5 text-accent"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Step 2: Generate Invoice"})]}),e.jsxs("div",{className:"pl-7 space-y-2 text-sm text-muted-foreground",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Convert approved estimate to professional invoice"]}),e.jsx("p",{children:"• Add invoice number (auto-generated)"}),e.jsx("p",{children:"• Set payment terms and due date"}),e.jsx("p",{children:"• Include customer name (mandatory for invoices)"}),e.jsx("p",{children:"• Choose invoice template style"})]}),e.jsx(Ge,{className:"bg-accent/5 border-accent/20",children:e.jsxs(Ae,{className:"text-sm",children:[e.jsx("strong",{children:"Invoices"})," are final billing documents with unique numbers. Once generated, they're stored separately in Invoice History for record-keeping."]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-muted/30 rounded-lg border",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Quick Actions:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{children:"✓ Save Estimate → Draft status"}),e.jsx("div",{children:"✓ Export Estimate PDF → Quotation"}),e.jsx("div",{children:"✓ Generate Invoice → Final bill"}),e.jsx("div",{children:"✓ View History → Past records"})]})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-primary/10 via-accent/10 to-primary/10 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Status Workflow:"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 bg-background rounded border",children:"Draft"}),e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{className:"px-2 py-1 bg-background rounded border",children:"Quoted"}),e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{className:"px-2 py-1 bg-background rounded border",children:"Approved"}),e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{className:"px-2 py-1 bg-background rounded border",children:"In Production"}),e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{className:"px-2 py-1 bg-background rounded border text-accent font-semibold",children:"Completed"})]})]})]})]}),Ls=({vendorProfile:r,vendorGSTIN:d,onVendorGSTINChange:s,customerDetails:m,onCustomerDetailsChange:h})=>{const p=(c,f)=>{h({...m,[c]:f})};return e.jsxs("div",{className:"relative grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-border to-transparent transform -translate-x-1/2"}),e.jsxs(_,{className:"border-primary/20 shadow-sm relative z-10",children:[e.jsxs(I,{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b border-primary/10",children:[e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5 text-primary"}),"Vendor Details"]}),e.jsx(E,{children:"Your business information"})]}),e.jsx(y,{className:"pt-6 bg-primary/5",children:r?e.jsxs("div",{className:"space-y-4",children:[r.logo_url&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:r.logo_url,alt:"Vendor Logo",className:"h-20 w-auto object-contain"})}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"border-b border-border pb-2",children:e.jsx("p",{className:"font-semibold text-foreground",children:r.business_name||"Business Name"})}),(r.address_line1||r.city||r.state)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Address"}),e.jsx("p",{className:"text-foreground leading-relaxed",children:[r.address_line1,r.address_line2,r.city,r.state,r.pincode,r.country].filter(Boolean).join(", ")})]}),r.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Phone"}),e.jsx("p",{className:"text-foreground",children:r.phone})]}),r.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Email"}),e.jsx("p",{className:"text-foreground",children:r.email})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"vendor-gstin",className:"text-xs text-muted-foreground mb-1",children:"GSTIN (Optional)"}),e.jsx(o,{id:"vendor-gstin",value:d,onChange:c=>s(c.target.value),placeholder:"Enter GSTIN",className:"mt-1.5"})]})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground py-4",children:"Loading vendor details..."})})]}),e.jsxs(_,{className:"border-accent/20 shadow-sm relative z-10",children:[e.jsxs(I,{className:"bg-gradient-to-r from-accent/10 to-accent/5 border-b border-accent/10",children:[e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(ps,{className:"h-5 w-5 text-accent"}),"Customer Details"]}),e.jsx(E,{children:"Enter customer information"})]}),e.jsx(y,{className:"pt-6 bg-accent/5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"customer-name",className:"text-sm font-medium",children:"Customer Name *"}),e.jsx(o,{id:"customer-name",value:m.name,onChange:c=>p("name",c.target.value),placeholder:"Enter customer name",className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"customer-phone",className:"text-sm font-medium",children:"Phone Number"}),e.jsx(o,{id:"customer-phone",value:m.phone,onChange:c=>p("phone",c.target.value),placeholder:"Enter phone number",className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"customer-email",className:"text-sm font-medium",children:"Email Address"}),e.jsx(o,{id:"customer-email",type:"email",value:m.email,onChange:c=>p("email",c.target.value),placeholder:"Enter email address",className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"customer-address",className:"text-sm font-medium",children:"Address"}),e.jsx(oe,{id:"customer-address",value:m.address,onChange:c=>p("address",c.target.value),placeholder:"Enter customer address",className:"mt-1.5 min-h-[90px]",rows:3})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"customer-gstin",className:"text-sm font-medium",children:"GSTIN (Optional)"}),e.jsx(o,{id:"customer-gstin",value:m.gstin,onChange:c=>p("gstin",c.target.value),placeholder:"Enter customer GSTIN",className:"mt-1.5"})]})]})})]})]})},Rs=({gstMode:r,onGstModeChange:d,sgstPercentage:s,cgstPercentage:m,igstPercentage:h,onSgstChange:p,onCgstChange:c,onIgstChange:f,shippingCharges:L,onShippingChargesChange:g,shippingZone:k,exchangeRate:P,onExchangeRateChange:T,costs:t})=>{const n=a=>{r==="sgst_cgst"?(p(a/2),c(a/2)):f(a)};return e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5 text-primary"}),"Tax, Shipping & Currency"]}),e.jsx(E,{children:"Configure GST, shipping charges, and currency conversion"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{className:"text-sm font-semibold",children:"GST Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"sgst-cgst-mode",checked:r==="sgst_cgst",onChange:()=>d("sgst_cgst"),className:"h-4 w-4"}),e.jsx(i,{htmlFor:"sgst-cgst-mode",className:"text-sm cursor-pointer",children:"SGST + CGST (Intra-State)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"igst-mode",checked:r==="igst",onChange:()=>d("igst"),className:"h-4 w-4"}),e.jsx(i,{htmlFor:"igst-mode",className:"text-sm cursor-pointer",children:"IGST (Inter-State)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-semibold",children:"Quick GST Rate Selection"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[0,3,5,12,18,28].map(a=>e.jsxs(N,{type:"button",variant:r==="sgst_cgst"&&s===a/2||r==="igst"&&h===a?"default":"outline",size:"sm",onClick:()=>n(a),children:[a,"%"]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r==="sgst_cgst"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"sgst",className:"text-sm",children:"SGST (%)"}),e.jsx(o,{id:"sgst",type:"number",min:0,max:100,step:.1,value:s,onChange:a=>p(parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"cgst",className:"text-sm",children:"CGST (%)"}),e.jsx(o,{id:"cgst",type:"number",min:0,max:100,step:.1,value:m,onChange:a=>c(parseFloat(a.target.value)||0)})]})]}):e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx(i,{htmlFor:"igst",className:"text-sm",children:"IGST (%)"}),e.jsx(o,{id:"igst",type:"number",min:0,max:100,step:.1,value:h,onChange:a=>f(parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"exchange-rate",className:"text-sm",children:"Exchange Rate (USD to INR)"}),e.jsx(o,{id:"exchange-rate",type:"number",min:0,step:.01,value:P,onChange:a=>T(parseFloat(a.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"shipping",className:"text-sm",children:"Shipping Charges (₹) - Manual Override"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{id:"shipping",type:"number",min:0,step:.01,value:L,onChange:a=>g(parseFloat(a.target.value)||0),className:"pl-9"})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Cost Breakdown"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal (Before Tax):"}),e.jsxs("span",{className:"font-semibold",children:["₹",t.finalSellingPrice.toLocaleString("en-IN")]})]}),r==="sgst_cgst"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[e.jsxs("span",{className:"text-muted-foreground",children:["SGST (",s,"%):"]}),e.jsxs("span",{className:"font-semibold",children:["₹",t.sgstAmount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[e.jsxs("span",{className:"text-muted-foreground",children:["CGST (",m,"%):"]}),e.jsxs("span",{className:"font-semibold",children:["₹",t.cgstAmount.toLocaleString("en-IN")]})]})]}):e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[e.jsxs("span",{className:"text-muted-foreground",children:["IGST (",h,"%):"]}),e.jsxs("span",{className:"font-semibold",children:["₹",t.igstAmount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Shipping (",k,"):"]}),e.jsxs("span",{className:"font-semibold",children:["₹",L.toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-primary/10 rounded-lg",children:[e.jsx("span",{className:"font-bold text-lg",children:"Grand Total (INR):"}),e.jsxs("span",{className:"font-bold text-xl text-primary",children:["₹",t.grandTotal.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-accent/10 rounded-lg mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Equivalent (USD):"}),e.jsxs("span",{className:"font-semibold text-lg text-accent",children:["$",t.totalInUSD.toLocaleString("en-US")]})]})]})]})]})]})},Us=({profitMargin:r,onProfitMarginChange:d,costs:s,formData:m})=>e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"Profit Margin & Final Pricing"]}),e.jsx(E,{children:"Set profit margin and view final selling price"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(i,{htmlFor:"profit-margin",className:"text-sm font-semibold",children:"Profit Margin (%)"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:[r,"%"]})]}),e.jsx(o,{id:"profit-margin",type:"range",min:0,max:200,step:1,value:r,onChange:h=>d(parseFloat(h.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"200%"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manufacturing Cost"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",s.totalCost.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"p-4 bg-primary/10 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Final Selling Price (Before Tax)"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",s.finalSellingPrice.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"p-4 bg-accent/10 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Profit Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["₹",s.profitAmount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Grand Total (After Tax)"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",s.grandTotal.toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Cost Breakdown"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Gold Cost:"}),e.jsxs("span",{className:"font-medium",children:["₹",s.goldCost.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Diamond Cost:"}),e.jsxs("span",{className:"font-medium",children:["₹",(m.diamondPerCaratPrice*m.diamondWeight).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Gemstone Cost:"}),e.jsxs("span",{className:"font-medium",children:["₹",(m.gemstonePerCaratPrice*m.gemstoneWeight).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Making Charges:"}),e.jsxs("span",{className:"font-medium",children:["₹",m.makingCharges.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"CAD Design:"}),e.jsxs("span",{className:"font-medium",children:["₹",m.cadDesignCharges.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Camming:"}),e.jsxs("span",{className:"font-medium",children:["₹",m.cammingCharges.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Certification:"}),e.jsxs("span",{className:"font-medium",children:["₹",m.certificationCost.toLocaleString("en-IN")]})]})]})]})]})]}),Vs=({onSave:r,onLoad:d,onExportPDF:s,onReset:m,onViewHistory:h,onCreateInvoice:p,isAuthenticated:c})=>e.jsx(_,{className:"border-primary/20 shadow-lg",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[c&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{onClick:r,size:"lg",variant:"outline",className:"gap-2",children:[e.jsx(Ue,{className:"h-5 w-5"}),"Save Estimate"]}),e.jsxs(N,{onClick:d,size:"lg",variant:"outline",className:"gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Load Estimate"]})]}),e.jsxs(N,{onClick:s,size:"lg",className:"gap-2 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70",children:[e.jsx(J,{className:"h-5 w-5"}),"Export Estimate PDF"]})]}),c&&e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center border-t pt-4",children:[e.jsxs(N,{onClick:h,size:"lg",variant:"secondary",className:"gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"View Estimate History"]}),e.jsxs(N,{onClick:p,size:"lg",variant:"secondary",className:"gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Create Invoice"]}),e.jsxs(N,{onClick:m,size:"lg",variant:"destructive",className:"gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Reset Form"]})]})]})})}),Bs=()=>{const[r,d]=l.useState(1);return{currentStep:r,steps:[{id:1,title:"Basic Info",description:"Customer & estimate details",isComplete:!1},{id:2,title:"Specifications",description:"Jewelry details & weights",isComplete:!1},{id:3,title:"Additional Costs",description:"CAD, camming & GST",isComplete:!1},{id:4,title:"Pricing",description:"Profit margin & final price",isComplete:!1},{id:5,title:"Review & Save",description:"Export or generate invoice",isComplete:!1}],goToNextStep:()=>{r<5&&d(f=>f+1)},goToPreviousStep:()=>{r>1&&d(f=>f-1)},goToStep:f=>{d(f)},validateStep:f=>{switch(f){case 1:return{isValid:!0};case 2:return{isValid:!0};case 3:return{isValid:!0};case 4:return{isValid:!0};case 5:return{isValid:!0};default:return{isValid:!1}}},isFirstStep:r===1,isLastStep:r===5}},Ws=({items:r,onChange:d,goldRate24k:s,purityFraction:m})=>{const[h,p]=l.useState(null),[c,f]=l.useState(!1),L=()=>{const t={id:`item-${Date.now()}`,item_name:"",description:"",image_url:"",diamond_weight:0,diamond_per_carat_price:0,diamond_color:"",diamond_clarity:"",diamond_cut:"",diamond_certification:"",gemstone_weight:0,gemstone_type:"",gemstone_color:"",gemstone_clarity:"",net_weight:0,gross_weight:0,purity_fraction:m,diamond_cost:0,gemstone_cost:0,gold_cost:0,making_charges:0,certification_cost:0,cad_design_charges:0,camming_charges:0,subtotal:0,weight_mode:"gross"};d([...r,t]),p(r.length)},g=(t,n,a)=>{const C=[...r];C[t]={...C[t],[n]:a};const x=C[t];if(x.weight_mode==="gross"&&(n==="gross_weight"||n==="diamond_weight"||n==="gemstone_weight")){const R=(x.diamond_weight+x.gemstone_weight)/5;x.net_weight=Math.max(0,x.gross_weight-R)}(n==="diamond_weight"||n==="diamond_per_carat_price")&&(x.diamond_cost=x.diamond_weight*x.diamond_per_carat_price),x.gold_cost=x.net_weight*x.purity_fraction*s,x.subtotal=x.gold_cost+x.making_charges+x.certification_cost+x.cad_design_charges+x.camming_charges+x.diamond_cost+x.gemstone_cost,d(C)},k=t=>{const n=r.filter((a,C)=>C!==t);d(n),h===t&&p(null)},P=async(t,n)=>{try{f(!0);const a=n.name.split(".").pop(),x=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${a}`}`,{error:R,data:Y}=await w.storage.from("manufacturing-estimates").upload(x,n,{cacheControl:"3600",upsert:!1});if(R)throw R;const W=Y.path;g(t,"image_url",W),Pe.success("Image uploaded successfully")}catch(a){console.error("Error uploading image:",a),Pe.error("Failed to upload image")}finally{f(!1)}},T=t=>{g(t,"image_url","")};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Invoice Line Items"}),e.jsxs(N,{onClick:L,size:"sm",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),r.length===0?e.jsx(_,{children:e.jsx(y,{className:"p-6 text-center text-muted-foreground",children:'No items added yet. Click "Add Item" to start adding jewelry pieces to this invoice.'})}):e.jsx("div",{className:"space-y-4",children:r.map((t,n)=>e.jsxs(_,{className:"border-2",children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{className:"text-base",children:["Item ",n+1,": ",t.item_name||"Untitled Item"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:h===n?"default":"outline",size:"sm",onClick:()=>p(h===n?null:n),children:h===n?"Done":"Edit"}),e.jsx(N,{variant:"destructive",size:"sm",onClick:()=>k(n),children:e.jsx(Ve,{className:"h-4 w-4"})})]})]})}),h===n?e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{children:"Item Name *"}),e.jsx(o,{value:t.item_name,onChange:a=>g(n,"item_name",a.target.value),placeholder:"e.g., Diamond Engagement Ring"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{children:"Description"}),e.jsx(oe,{value:t.description,onChange:a=>g(n,"description",a.target.value),placeholder:"Describe the jewelry piece...",rows:3})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{children:"Product Image"}),e.jsx("div",{className:"mt-2",children:t.image_url?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:t.image_url,alt:t.item_name,className:"h-32 w-32 object-cover rounded border"}),e.jsx(N,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2",onClick:()=>T(n),children:e.jsx(Be,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{type:"file",accept:"image/*",onChange:a=>{var x;const C=(x=a.target.files)==null?void 0:x[0];C&&P(n,C)},disabled:c}),c&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})})]}),e.jsxs("div",{className:"col-span-2 space-y-4 p-4 border rounded-lg bg-card",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-base mb-1",children:"Weight & Purity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter weights and purity details"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2 block",children:"Weight Entry Mode:"}),e.jsxs(We,{value:t.weight_mode,onValueChange:a=>g(n,"weight_mode",a),children:[e.jsx(Me,{children:e.jsx(ze,{})}),e.jsxs(Oe,{children:[e.jsx(S,{value:"gross",children:"Gross Weight Mode (Auto-calculate Net Weight)"}),e.jsx(S,{value:"net",children:"Net Weight Mode (Direct Entry)"})]})]})]}),t.weight_mode==="gross"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Gross Weight (grams)"}),e.jsx(o,{type:"number",step:"0.01",value:t.gross_weight,onChange:a=>g(n,"gross_weight",parseFloat(a.target.value)||0),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsxs(i,{children:["Net Weight (grams) ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Auto-calculated)"})]}),e.jsx(o,{type:"number",step:"0.01",value:t.net_weight,disabled:!0,className:"mt-1.5 bg-muted"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Gross Weight (grams)"}),e.jsx(o,{type:"number",step:"0.01",value:t.gross_weight,onChange:a=>g(n,"gross_weight",parseFloat(a.target.value)||0),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Net Weight (grams)"}),e.jsx(o,{type:"number",step:"0.01",value:t.net_weight,onChange:a=>g(n,"net_weight",parseFloat(a.target.value)||0),className:"mt-1.5"})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Purity Fraction (e.g., 0.76 for 18K)"}),e.jsx(o,{type:"number",step:"0.01",min:"0",max:"1",value:t.purity_fraction,onChange:a=>g(n,"purity_fraction",parseFloat(a.target.value)||0),className:"mt-1.5"})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Diamond Weight (ct)"}),e.jsx(o,{type:"number",step:"0.01",value:t.diamond_weight,onChange:a=>g(n,"diamond_weight",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Diamond Per Carat Price (₹/ct)"}),e.jsx(o,{type:"number",step:"0.01",value:t.diamond_per_carat_price,onChange:a=>g(n,"diamond_per_carat_price",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsxs(i,{children:["Diamond Cost (₹) ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Auto-calculated)"})]}),e.jsx(o,{type:"number",step:"0.01",value:t.diamond_cost,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Diamond Color"}),e.jsx(o,{value:t.diamond_color,onChange:a=>g(n,"diamond_color",a.target.value),placeholder:"e.g., D, E, F"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Diamond Clarity"}),e.jsx(o,{value:t.diamond_clarity,onChange:a=>g(n,"diamond_clarity",a.target.value),placeholder:"e.g., VVS1, VS1, SI1"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Diamond Cut"}),e.jsx(o,{value:t.diamond_cut,onChange:a=>g(n,"diamond_cut",a.target.value),placeholder:"e.g., Excellent, Very Good"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Diamond Certification"}),e.jsx(o,{value:t.diamond_certification,onChange:a=>g(n,"diamond_certification",a.target.value),placeholder:"e.g., GIA, IGI"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Gemstone Weight (ct)"}),e.jsx(o,{type:"number",step:"0.01",value:t.gemstone_weight,onChange:a=>g(n,"gemstone_weight",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Gemstone Cost (₹)"}),e.jsx(o,{type:"number",step:"0.01",value:t.gemstone_cost,onChange:a=>g(n,"gemstone_cost",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Gemstone Type"}),e.jsx(o,{value:t.gemstone_type,onChange:a=>g(n,"gemstone_type",a.target.value),placeholder:"e.g., Ruby, Sapphire, Emerald"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Gemstone Color"}),e.jsx(o,{value:t.gemstone_color,onChange:a=>g(n,"gemstone_color",a.target.value),placeholder:"e.g., Pigeon Blood Red"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Gemstone Clarity"}),e.jsx(o,{value:t.gemstone_clarity,onChange:a=>g(n,"gemstone_clarity",a.target.value),placeholder:"e.g., Eye Clean, VVS"})]}),e.jsx("div",{className:"col-span-2"}),e.jsxs("div",{children:[e.jsx(i,{children:"Making Charges (₹)"}),e.jsx(o,{type:"number",step:"0.01",value:t.making_charges,onChange:a=>g(n,"making_charges",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(i,{children:"CAD Design Charges (₹)"}),e.jsx(o,{type:"number",step:"0.01",value:t.cad_design_charges,onChange:a=>g(n,"cad_design_charges",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Camming Charges (₹)"}),e.jsx(o,{type:"number",step:"0.01",value:t.camming_charges,onChange:a=>g(n,"camming_charges",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Certification Cost (₹)"}),e.jsx(o,{type:"number",step:"0.01",value:t.certification_cost,onChange:a=>g(n,"certification_cost",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"col-span-2 pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Gold Cost (Auto-calculated):"}),e.jsxs("span",{className:"text-lg",children:["₹",t.gold_cost.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-bold text-lg",children:"Item Subtotal:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["₹",t.subtotal.toFixed(2)]})]})]})]})}):e.jsx(y,{children:e.jsxs("div",{className:"flex gap-4",children:[t.image_url&&e.jsx(Ss,{src:t.image_url,alt:t.item_name,className:"h-24 w-24 object-cover rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-2",children:[t.diamond_weight>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Diamond:"})," ",t.diamond_weight,"ct"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Color/Clarity:"})," ",t.diamond_color||"N/A","/",t.diamond_clarity||"N/A"]}),t.diamond_cut&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Cut:"})," ",t.diamond_cut]}),t.diamond_certification&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Cert:"})," ",t.diamond_certification]})]}),t.gemstone_weight>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Gemstone:"})," ",t.gemstone_weight,"ct"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",t.gemstone_type||"N/A"]}),t.gemstone_color&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Color:"})," ",t.gemstone_color]}),t.gemstone_clarity&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Clarity:"})," ",t.gemstone_clarity]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Gold:"})," ",t.net_weight,"g"]})]}),e.jsxs("div",{className:"mt-2 font-semibold",children:["Subtotal: ₹",t.subtotal.toFixed(2)]})]})]})})]},t.id))}),r.length>0&&e.jsx(_,{className:"bg-muted/50",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Total (All Items):"}),e.jsxs("span",{className:"text-2xl font-bold text-primary",children:["₹",r.reduce((t,n)=>t+n.subtotal,0).toFixed(2)]})]})})})]})},Ms=({open:r,onOpenChange:d,invoiceData:s,onConfirmDownload:m})=>{var p;if(!s)return null;const h=c=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(c);return e.jsx(re,{open:r,onOpenChange:d,children:e.jsxs(ne,{className:"max-w-4xl max-h-[90vh] p-0",children:[e.jsxs(ie,{className:"px-6 pt-6",children:[e.jsx(le,{children:"Invoice Preview"}),e.jsx(ce,{children:"Review your invoice before downloading the PDF"})]}),e.jsx(Fs,{className:"h-[calc(90vh-180px)] px-6",children:e.jsxs("div",{className:"bg-background border rounded-lg p-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start border-b pb-4",children:[e.jsxs("div",{children:[((p=s.vendorBranding)==null?void 0:p.logo)&&e.jsx("img",{src:s.vendorBranding.logo,alt:"Logo",className:"h-16 mb-2"}),e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"INVOICE"}),e.jsx("p",{className:"text-lg font-semibold mt-1",children:s.invoiceNumber})]}),s.vendorBranding&&e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("p",{className:"font-semibold",children:s.vendorBranding.name}),s.vendorBranding.address&&e.jsx("p",{className:"text-muted-foreground",children:s.vendorBranding.address}),s.vendorBranding.phone&&e.jsxs("p",{className:"text-muted-foreground",children:["Phone: ",s.vendorBranding.phone]}),s.vendorBranding.email&&e.jsxs("p",{className:"text-muted-foreground",children:["Email: ",s.vendorBranding.email]}),s.vendorGSTIN&&e.jsxs("p",{className:"text-muted-foreground",children:["GSTIN: ",s.vendorGSTIN]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Invoice Details"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:["Date: ",new Date(s.invoiceDate).toLocaleDateString()]}),s.paymentDueDate&&e.jsxs("p",{children:["Due Date: ",new Date(s.paymentDueDate).toLocaleDateString()]}),s.paymentTerms&&e.jsxs("p",{children:["Terms: ",s.paymentTerms]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Bill To"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{className:"font-semibold",children:s.customerName}),s.customerPhone&&e.jsxs("p",{children:["Phone: ",s.customerPhone]}),s.customerEmail&&e.jsxs("p",{children:["Email: ",s.customerEmail]}),s.customerAddress&&e.jsx("p",{children:s.customerAddress}),s.customerGSTIN&&e.jsxs("p",{children:["GSTIN: ",s.customerGSTIN]})]})]})]}),s.lineItems&&s.lineItems.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Items"}),e.jsx("div",{className:"space-y-4",children:s.lineItems.map((c,f)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-4",children:[c.image_url&&e.jsx("img",{src:c.image_url,alt:c.item_name,className:"w-20 h-20 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:c.item_name}),c.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.description}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[c.net_weight&&e.jsxs("p",{children:["Net Weight: ",c.net_weight,"g"]}),c.diamond_weight>0&&e.jsxs("p",{children:["Diamond: ",c.diamond_weight,"ct"]}),e.jsxs("p",{className:"col-span-2 font-semibold",children:["Total: ",h(c.subtotal)]})]})]})]})},f))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Cost Breakdown"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[s.diamondCost>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Diamond Cost:"}),e.jsx("span",{children:h(s.diamondCost)})]}),s.gemstoneCost>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Gemstone Cost:"}),e.jsx("span",{children:h(s.gemstoneCost)})]}),s.goldCost>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Gold Cost:"}),e.jsx("span",{children:h(s.goldCost)})]}),s.makingCharges>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Making Charges:"}),e.jsx("span",{children:h(s.makingCharges)})]}),s.cadDesignCharges>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"CAD Design Charges:"}),e.jsx("span",{children:h(s.cadDesignCharges)})]}),s.cammingCharges>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Camming Charges:"}),e.jsx("span",{children:h(s.cammingCharges)})]}),s.certificationCost>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Certification Cost:"}),e.jsx("span",{children:h(s.certificationCost)})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-base pt-2 border-t",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{children:h(s.finalSellingPrice||s.totalCost)})]})]})]}),(s.notes||s.invoiceNotes)&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.invoiceNotes||s.notes})]})]})}),e.jsxs(Is,{className:"px-6 pb-6",children:[e.jsxs(N,{variant:"outline",onClick:()=>d(!1),children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(N,{onClick:m,children:[e.jsx(Ns,{className:"mr-2 h-4 w-4"}),"Download PDF"]})]})]})})},Dt=()=>{const{toast:r}=os(),d=cs(),[s,m]=l.useState(null),{currentStep:h,steps:p}=Bs(),[c,f]=l.useState(!0),[L,g]=l.useState([]),[k,P]=l.useState(null),[T,t]=l.useState(""),[n,a]=l.useState(""),[C,x]=l.useState(!1),[R,Y]=l.useState(!1),[W,de]=l.useState("draft"),[G,me]=l.useState(),[xe,he]=l.useState(!1),[qe,ge]=l.useState(""),[zs,Os]=l.useState(!1),[K,$e]=l.useState(0),[He,ue]=l.useState(!1),[Qe,Ze]=l.useState(null),[qs,$s]=l.useState(""),[Hs,Qs]=l.useState("INV"),[Zs,Js]=l.useState(new Date),[Ys,Ks]=l.useState("Net 30"),[Xs,et]=l.useState(),[st,tt]=l.useState(""),[at,rt]=l.useState("detailed"),[U,pe]=l.useState([]),[Je,Ye]=l.useState(!1),[Ke,nt]=l.useState(null),[M,je]=l.useState({purityFraction:.76,goldRate24k:0}),[z,fe]=l.useState(0),[b,A]=l.useState({name:"",phone:"",email:"",address:"",gstin:""}),[Ne,ve]=l.useState(""),[O,be]=l.useState("sgst_cgst"),[q,ye]=l.useState(9),[$,Ce]=l.useState(9),[H,_e]=l.useState(18),[Q,we]=l.useState(0),[Se,Ie]=l.useState("local"),[Z,Fe]=l.useState(83),[V,Xe]=l.useState({goldCost:0,totalCost:0,finalSellingPrice:0,profitAmount:0,sgstAmount:0,cgstAmount:0,igstAmount:0,grandTotal:0,totalInUSD:0});l.useEffect(()=>{(async()=>{const{data:{user:j}}=await w.auth.getUser();if(m(j),j)ke(),es();else try{const{data:v,error:D}=await w.functions.invoke("check-guest-usage",{body:{calculatorType:"manufacturing"}});if(D){console.error("Error checking guest usage:",D);return}v.allowed?$e(v.usageCount):ue(!0)}catch(v){console.error("Failed to check usage:",v)}})()},[]);const es=async()=>{const{data:{user:u}}=await w.auth.getUser();if(!u)return;const{data:j,error:v}=await w.from("vendor_profiles").select("business_name, logo_url, primary_brand_color, secondary_brand_color, brand_tagline, email, phone, address_line1, address_line2, city, state, pincode, country, gold_rate_24k_per_gram, making_charges_per_gram").eq("user_id",u.id).maybeSingle();v?console.error("Error fetching vendor profile:",v):j&&(Ze(j),je(D=>({...D,goldRate24k:j.gold_rate_24k_per_gram||0,makingCharges:j.making_charges_per_gram||0})))},ke=async()=>{const{data:{user:u}}=await w.auth.getUser();if(!u)return;const{data:j,error:v}=await w.from("manufacturing_cost_estimates").select("*").eq("user_id",u.id).order("created_at",{ascending:!1});v?console.error("Error fetching estimates:",v):g(j||[])};l.useEffect(()=>{const j=U.reduce((is,ls)=>is+(ls.subtotal||0),0),v=j*(1+z/100),D=v-j;let X=0,ee=0,se=0;O==="sgst_cgst"?(X=v*q/100,ee=v*$/100):se=v*H/100;const Te=v+X+ee+se+Q,ns=Te/Z;Xe({goldCost:0,totalCost:parseFloat(j.toFixed(2)),finalSellingPrice:parseFloat(v.toFixed(2)),profitAmount:parseFloat(D.toFixed(2)),sgstAmount:parseFloat(X.toFixed(2)),cgstAmount:parseFloat(ee.toFixed(2)),igstAmount:parseFloat(se.toFixed(2)),grandTotal:parseFloat(Te.toFixed(2)),totalInUSD:parseFloat(ns.toFixed(2))})},[U,z,O,q,$,H,Q,Z]);const ss=()=>{je({purityFraction:.76,goldRate24k:0}),fe(0),P(null),t(""),a(""),A({name:"",phone:"",email:"",address:"",gstin:""}),ve(""),de("draft"),me(void 0),he(!1),ge(""),pe([]),be("sgst_cgst"),ye(9),Ce(9),_e(18),we(0),Ie("local"),Fe(83)},ts=()=>{r({title:"Use Invoice Generator",description:"Please use the Invoice Generator page to create and export invoice PDFs"}),d("/invoice-generator")},as=()=>{r({title:"Use Invoice Generator",description:"Please use the Invoice Generator page to create and export invoice PDFs"}),d("/invoice-generator")},rs=async()=>{if(!s){r({title:"Authentication Required",description:"Please sign in to save estimates.",variant:"destructive"});return}if(!T.trim()){r({title:"Missing Information",description:"Please enter an estimate name.",variant:"destructive"});return}const u={user_id:s.id,estimate_name:T,customer_name:b.name||null,customer_phone:b.phone||null,customer_email:b.email||null,customer_address:b.address||null,net_weight:0,purity_fraction:M.purityFraction,gold_rate_24k:M.goldRate24k,making_charges:0,cad_design_charges:0,camming_charges:0,certification_cost:0,diamond_cost:0,gemstone_cost:0,gold_cost:V.goldCost,total_cost:V.totalCost,final_selling_price:V.finalSellingPrice,profit_margin_percentage:z,notes:n,status:W,estimated_completion_date:(G==null?void 0:G.toISOString())||null,is_customer_visible:xe,share_token:qe||`EST-${Date.now()}-${Math.random().toString(36).substring(7)}`,line_items:U.length>0?U:null,details:{customer_gstin:b.gstin,vendor_gstin:Ne,gst_mode:O,sgst_percentage:q,cgst_percentage:$,igst_percentage:H,shipping_charges:Q,shipping_zone:Se,exchange_rate:Z}};let j;k?j=await w.from("manufacturing_cost_estimates").update(u).eq("id",k):(j=await w.from("manufacturing_cost_estimates").insert(u).select().single(),j.data&&(P(j.data.id),ge(j.data.share_token))),j.error?r({title:"Error",description:"Failed to save estimate",variant:"destructive"}):(r({title:"Saved",description:k?"Estimate updated successfully":"Estimate saved successfully"}),ke(),x(!1))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-secondary/20 to-background py-8 px-4",children:[e.jsx(re,{open:He,onOpenChange:ue,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Usage Limit Reached"}),e.jsx(ce,{children:"You've reached the limit of 5 uses per 24 hours for guest users. Sign in to get unlimited access to the Manufacturing Cost Estimator, or wait 24 hours for your limit to reset."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(N,{onClick:()=>d("/auth"),className:"flex-1",children:"Sign In"}),e.jsx(N,{variant:"outline",onClick:()=>d("/"),className:"flex-1",children:"Go Home"})]})]})}),e.jsx(ms,{}),e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-primary/20 to-accent/20 rounded-full mb-4",children:e.jsx(De,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary via-accent to-primary animate-gradient",children:"Manufacturing Cost Estimator"}),e.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Professional jewelry cost estimation and invoice generation workflow"}),!s&&K>0&&K<5&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-muted/50 rounded-lg border border-border",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Guest Usage: ",K,"/5 uses (resets in 24 hours).",e.jsx(N,{variant:"link",className:"ml-1 p-0 h-auto text-sm underline",onClick:()=>d("/auth"),children:"Sign in for unlimited access"})]})]})]}),e.jsx(_,{className:"border-primary/20",children:e.jsx(y,{className:"p-6",children:e.jsx(As,{currentStep:h,steps:p})})}),e.jsx(Cs,{open:c,onOpenChange:f,children:e.jsxs(_,{className:"border-primary/20",children:[e.jsx(_s,{className:"w-full",children:e.jsx(I,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),"Understanding the Workflow"]}),e.jsx(E,{children:"Learn the difference between estimates and invoices"})]}),e.jsx(vs,{className:`h-5 w-5 text-muted-foreground transition-transform ${c?"rotate-180":""}`})]})})}),e.jsx(ws,{children:e.jsx(y,{children:e.jsx(Ds,{})})})]})}),e.jsx(Vs,{onSave:()=>x(!0),onLoad:()=>Y(!0),onExportPDF:ts,onReset:ss,onViewHistory:()=>d("/estimate-history"),onCreateInvoice:()=>d("/invoice-generator"),isAuthenticated:!!s}),e.jsx(re,{open:C,onOpenChange:x,children:e.jsxs(ne,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Save Estimate"}),e.jsx(ce,{children:"Save this manufacturing cost estimate with customer details and tracking options"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"estimate-name",children:"Estimate Name *"}),e.jsx(o,{id:"estimate-name",value:T,onChange:u=>t(u.target.value),placeholder:"e.g., Diamond Ring Quote - John Doe"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customer-name",children:"Customer Name"}),e.jsx(o,{id:"customer-name",value:b.name,onChange:u=>A({...b,name:u.target.value}),placeholder:"Full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customer-phone",children:"Phone Number"}),e.jsx(o,{id:"customer-phone",value:b.phone,onChange:u=>A({...b,phone:u.target.value}),placeholder:"+1234567890"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customer-email",children:"Email"}),e.jsx(o,{id:"customer-email",type:"email",value:b.email,onChange:u=>A({...b,email:u.target.value}),placeholder:"customer@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customer-address",children:"Address"}),e.jsx(o,{id:"customer-address",value:b.address,onChange:u=>A({...b,address:u.target.value}),placeholder:"Complete address"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:"Notes"}),e.jsx(oe,{id:"notes",value:n,onChange:u=>a(u.target.value),placeholder:"Add any additional notes or specifications...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Order Status"}),e.jsxs(We,{value:W,onValueChange:de,children:[e.jsx(Me,{children:e.jsx(ze,{})}),e.jsxs(Oe,{children:[e.jsx(S,{value:"draft",children:"Draft"}),e.jsx(S,{value:"quoted",children:"Quoted"}),e.jsx(S,{value:"approved",children:"Approved"}),e.jsx(S,{value:"in_production",children:"In Production"}),e.jsx(S,{value:"completed",children:"Completed"}),e.jsx(S,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Estimated Completion Date"}),e.jsxs(ks,{children:[e.jsx(Ts,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(bs,{className:"mr-2 h-4 w-4"}),G?Gs(G,"PPP"):"Select date"]})}),e.jsx(Es,{className:"w-auto p-0",children:e.jsx(Ps,{mode:"single",selected:G,onSelect:me,initialFocus:!0})})]})]}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 border rounded-lg p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{children:"Enable Customer Portal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customer to track order status with a secure link"})]}),e.jsx(ds,{checked:xe,onCheckedChange:he})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N,{onClick:rs,className:"flex-1",children:"Save Estimate"}),e.jsx(N,{onClick:()=>x(!1),variant:"outline",className:"flex-1",children:"Cancel"})]})]})]})}),e.jsx(Ls,{vendorProfile:Qe,vendorGSTIN:Ne,onVendorGSTINChange:ve,customerDetails:b,onCustomerDetailsChange:A}),e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-primary"}),"Invoice Line Items"]}),e.jsx(E,{children:"Add multiple jewelry items with individual pricing details"})]}),e.jsx(y,{children:e.jsx(Ws,{items:U,onChange:pe,goldRate24k:M.goldRate24k,purityFraction:M.purityFraction})})]}),e.jsx(Us,{profitMargin:z,onProfitMarginChange:fe,costs:V,formData:{diamondPerCaratPrice:0,diamondWeight:0,gemstonePerCaratPrice:0,gemstoneWeight:0,makingCharges:0,cadDesignCharges:0,cammingCharges:0,certificationCost:0}}),e.jsx(Rs,{gstMode:O,onGstModeChange:be,sgstPercentage:q,cgstPercentage:$,igstPercentage:H,onSgstChange:ye,onCgstChange:Ce,onIgstChange:_e,shippingCharges:Q,onShippingChargesChange:we,shippingZone:Se,onShippingZoneChange:Ie,exchangeRate:Z,onExchangeRateChange:Fe,costs:V})]}),e.jsx(Ms,{open:Je,onOpenChange:Ye,invoiceData:Ke,onConfirmDownload:as})]})};export{Dt as default};
//# sourceMappingURL=ManufacturingCost-DS6Ujrsm.js.map
