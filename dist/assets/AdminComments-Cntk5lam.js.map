{"version":3,"file":"AdminComments-Cntk5lam.js","sources":["../../src/pages/AdminComments.tsx"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { AdminLayout } from \"@/components/AdminLayout\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { Check, X, Trash2, MessageSquare } from \"lucide-react\";\r\nimport { AdminLoadingSkeleton } from \"@/components/admin/AdminLoadingSkeleton\";\r\nimport { AdminEmptyState } from \"@/components/admin/AdminEmptyState\";\r\n\r\ninterface BlogComment {\r\n  id: string;\r\n  blog_post_id: string;\r\n  author_name: string;\r\n  author_email: string;\r\n  content: string;\r\n  status: string;\r\n  created_at: string;\r\n  blog_posts: {\r\n    title: string;\r\n  };\r\n}\r\n\r\nexport default function AdminComments() {\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data: comments, isLoading } = useQuery({\r\n    queryKey: [\"admin-comments\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"blog_comments\")\r\n        .select(\"*, blog_posts(title)\")\r\n        .order(\"created_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as BlogComment[];\r\n    },\r\n  });\r\n\r\n  const updateStatusMutation = useMutation({\r\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\r\n      const { error } = await supabase\r\n        .from(\"blog_comments\")\r\n        .update({ \r\n          status,\r\n          moderated_at: new Date().toISOString(),\r\n          moderated_by: (await supabase.auth.getUser()).data.user?.id\r\n        })\r\n        .eq(\"id\", id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-comments\"] });\r\n      toast.success(\"Comment status updated\");\r\n    },\r\n    onError: () => toast.error(\"Failed to update comment\"),\r\n  });\r\n\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"blog_comments\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-comments\"] });\r\n      toast.success(\"Comment deleted\");\r\n    },\r\n    onError: () => toast.error(\"Failed to delete comment\"),\r\n  });\r\n\r\n  const pendingCount = comments?.filter((c) => c.status === \"pending\").length || 0;\r\n  const approvedCount = comments?.filter((c) => c.status === \"approved\").length || 0;\r\n\r\n  return (\r\n    <AdminLayout>\r\n      <div className=\"p-6 space-y-6 animate-fade-in\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent\">\r\n            Comment Moderation\r\n          </h1>\r\n          <p className=\"text-muted-foreground mt-1\">Review and moderate blog comments</p>\r\n        </div>\r\n\r\n        {/* Stats Cards */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <Card className=\"bg-gradient-card border-border/50 shadow-md\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\r\n                Total Comments\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold\">{comments?.length || 0}</div>\r\n            </CardContent>\r\n          </Card>\r\n          <Card className=\"bg-gradient-info border-border/50 shadow-md\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-info-foreground\">\r\n                Pending Review\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold text-info\">{pendingCount}</div>\r\n            </CardContent>\r\n          </Card>\r\n          <Card className=\"bg-gradient-success border-border/50 shadow-md\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-success-foreground\">\r\n                Approved\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold text-success\">{approvedCount}</div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {isLoading ? (\r\n          <AdminLoadingSkeleton />\r\n        ) : !comments || comments.length === 0 ? (\r\n          <AdminEmptyState\r\n            icon={MessageSquare}\r\n            title=\"No comments yet\"\r\n            description=\"Comments will appear here when visitors start engaging with your blog posts\"\r\n          />\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {comments.map((comment, index) => (\r\n              <Card\r\n                key={comment.id}\r\n                className=\"bg-gradient-card border-border/50 shadow-md hover:shadow-lg transition-all duration-300 animate-fade-in\"\r\n                style={{ animationDelay: `${index * 50}ms` }}\r\n              >\r\n                <CardHeader>\r\n                  <div className=\"flex justify-between items-start gap-4\">\r\n                    <div className=\"space-y-2 flex-1\">\r\n                      <div className=\"flex items-center gap-2 flex-wrap\">\r\n                        <CardTitle className=\"text-lg\">{comment.author_name}</CardTitle>\r\n                        {comment.status === \"pending\" ? (\r\n                          <Badge variant=\"outline\" className=\"bg-warning/10 text-warning border-warning/20\">\r\n                            Pending\r\n                          </Badge>\r\n                        ) : comment.status === \"approved\" ? (\r\n                          <Badge className=\"bg-success text-success-foreground\">Approved</Badge>\r\n                        ) : (\r\n                          <Badge variant=\"destructive\">Rejected</Badge>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"text-sm text-muted-foreground space-y-1\">\r\n                        <p>{comment.author_email}</p>\r\n                        <p className=\"flex items-center gap-2\">\r\n                          <span>{new Date(comment.created_at).toLocaleDateString()}</span>\r\n                          <span>â€¢</span>\r\n                          <span className=\"text-foreground/70\">{comment.blog_posts?.title}</span>\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <p className=\"text-sm leading-relaxed border-l-2 border-primary/30 pl-4 py-2\">\r\n                    {comment.content}\r\n                  </p>\r\n                  <div className=\"flex gap-2\">\r\n                    {comment.status !== \"approved\" && (\r\n                      <Button\r\n                        size=\"sm\"\r\n                        onClick={() =>\r\n                          updateStatusMutation.mutate({\r\n                            id: comment.id,\r\n                            status: \"approved\",\r\n                          })\r\n                        }\r\n                        className=\"bg-success hover:bg-success/90 text-success-foreground shadow-md\"\r\n                      >\r\n                        <Check className=\"h-4 w-4 mr-2\" />\r\n                        Approve\r\n                      </Button>\r\n                    )}\r\n                    {comment.status !== \"rejected\" && (\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        onClick={() =>\r\n                          updateStatusMutation.mutate({\r\n                            id: comment.id,\r\n                            status: \"rejected\",\r\n                          })\r\n                        }\r\n                        className=\"hover:bg-destructive/10 hover:border-destructive hover:text-destructive\"\r\n                      >\r\n                        <X className=\"h-4 w-4 mr-2\" />\r\n                        Reject\r\n                      </Button>\r\n                    )}\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"destructive\"\r\n                      onClick={() => deleteMutation.mutate(comment.id)}\r\n                      className=\"ml-auto\"\r\n                    >\r\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                      Delete\r\n                    </Button>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </AdminLayout>\r\n  );\r\n}\r\n"],"names":["AdminComments","queryClient","useQueryClient","comments","isLoading","useQuery","data","error","supabase","updateStatusMutation","useMutation","id","status","_a","toast","deleteMutation","pendingCount","c","approvedCount","jsx","AdminLayout","jsxs","Card","CardHeader","CardTitle","CardContent","AdminLoadingSkeleton","AdminEmptyState","MessageSquare","comment","index","Badge","Button","Check","X","Trash2"],"mappings":"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"}