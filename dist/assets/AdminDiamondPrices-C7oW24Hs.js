import{b as Ce,u as se,j as e}from"./query-vendor-BLxHmmGk.js";import{r as m}from"./react-vendor-BeR0k5Z3.js";import{A as we}from"./AdminLayout-iDUtkfn_.js";import{C as R,i as P,k as A,l as D,g as T,B as p,s as U}from"./index-CX6yiz0b.js";import{I as L}from"./input-CiHC6UAI.js";import{L as u}from"./label-DbIM3Eg1.js";import{q as Se,a7 as be,ab as Fe,a_ as Re,ar as Pe,K as Ae,X as De,aw as Te,d as Ue,ag as Le,u as d}from"./ui-vendor-DjQqXt9S.js";import{A as qe,a as Ve}from"./alert-DIsJjuyH.js";import{T as te,a as ne,b as q,c as n,d as le,e as l}from"./table-CYMzKz5T.js";import{B as h}from"./badge-45Abp579.js";import{T as Me,a as ke,b as ce,c as ie}from"./tabs-30ai4xjf.js";import{S as E,a as I,b as H,c as B,d as g}from"./select-CYWHo3cU.js";import"./separator-D0WC8Ha9.js";import"./index-DhS5fNEb.js";import"./index-D6fUEw85.js";import"./NavLink-Bvq0lq1P.js";import"./index-BC78nHQ6.js";import"./index-DVcnno33.js";import"./supabase-vendor-VSDMYZ1k.js";import"./index-BdQq_4o_.js";import"./index-DjQc2W_p.js";const la=()=>{const[S,K]=m.useState(!1),[Q,O]=m.useState(null),[$,z]=m.useState(null),[V,de]=m.useState(100),b=Ce(),[f,X]=m.useState(""),[_,Z]=m.useState(""),[y,J]=m.useState(""),[v,W]=m.useState(""),[N,Y]=m.useState(""),{data:j,isLoading:M}=se({queryKey:["diamond-prices",f,_,y,v,N],queryFn:async()=>{let a=U.from("diamond_prices").select("*",{count:"exact"});f&&(a=a.eq("shape",f)),_&&(a=a.eq("color_grade",_)),y&&(a=a.eq("clarity_grade",y)),v&&(a=a.gte("carat_range_min",parseFloat(v))),N&&(a=a.lte("carat_range_max",parseFloat(N))),a=a.order("shape",{ascending:!0}).order("carat_range_min",{ascending:!0}).limit(1e4);const{data:r,error:s,count:c}=await a;if(s)throw s;return{data:r,count:c}}}),o=(j==null?void 0:j.data)||[],C=(j==null?void 0:j.count)||0,oe=Array.from(new Set(o.map(a=>a.shape))).sort(),xe=Array.from(new Set(o.map(a=>a.color_grade))).sort(),me=Array.from(new Set(o.map(a=>a.clarity_grade))).sort(),he=()=>{X(""),Z(""),J(""),W(""),Y(""),d.success("Filters cleared")},pe=f||_||y||v||N,{data:k,isLoading:ue}=se({queryKey:["diamond-price-history"],queryFn:async()=>{const{data:a,error:r}=await U.from("diamond_price_history").select("*").order("changed_at",{ascending:!1}).limit(100);if(r)throw r;return a}}),je=()=>{const a=["shape","carat_range_min","carat_range_max","color_grade","clarity_grade","cut_grade","price_per_carat","currency","notes"],r=["Round,0.50,0.69,D,IF,Excellent,15000,USD,Sample entry","Round,0.50,0.69,D,VVS1,Excellent,12000,USD,","Princess,1.00,1.49,E,VS1,Very Good,8000,USD,"],s=[a.join(","),...r].join(`
`),c=new Blob([s],{type:"text/csv"}),i=window.URL.createObjectURL(c),x=document.createElement("a");x.href=i,x.download="diamond_prices_template.csv",x.click(),window.URL.revokeObjectURL(i),d.success("Template downloaded!")},ge=(a,r="Round")=>{const s=a.split(",").map(F=>F.trim());if(s.length<6)return null;const c={BR:"Round",PS:"Pear",PR:"Princess",EM:"Emerald",CU:"Cushion",OV:"Oval",MQ:"Marquise",HT:"Heart",RD:"Radiant",AS:"Asscher"},i=s[0];return{shape:c[i]||r,clarity_grade:s[1],color_grade:s[2],carat_range_min:parseFloat(s[3]),carat_range_max:parseFloat(s[4]),price_per_carat:parseFloat(s[5]),cut_grade:"Excellent",currency:"USD",notes:null}},fe=a=>{const r=a.split(",").map(s=>s.trim());return r.length<7?null:{shape:r[0],carat_range_min:parseFloat(r[1]),carat_range_max:parseFloat(r[2]),color_grade:r[3],clarity_grade:r[4],cut_grade:r[5],price_per_carat:parseFloat(r[6]),currency:r[7]||"USD",notes:r[8]||null}},ee=async(a,r)=>{if(!a){d.error("Please select a CSV file");return}K(!0);try{const c=(await a.text()).split(`
`).filter(w=>w.trim());if(c.length<1){d.error("CSV file is empty");return}const i=[];let x=0;const F=c[0],ae=/^[A-Z]{2},/.test(F),ve=ae?0:F.toLowerCase().includes("shape")?1:0;for(let w=ve;w<c.length;w++){const G=c[w];if(!G.trim())continue;let t=null;if(ae?t=ge(G,r==="round"?"Round":"Pear"):t=fe(G),t&&r==="round"?t.shape="Round":t&&r==="pear"&&(!t.shape||t.shape==="Round")&&(t.shape="Pear"),!t){x++;continue}if(!t.shape||isNaN(t.carat_range_min)||isNaN(t.carat_range_max)||!t.color_grade||!t.clarity_grade||!t.cut_grade||isNaN(t.price_per_carat)){x++;continue}i.push(t)}if(i.length===0){d.error("No valid records found in CSV");return}const{error:re}=await U.from("diamond_prices").insert(i);if(re)throw re;const Ne=x>0?`Imported ${i.length} records (${x} rows skipped)`:`Successfully imported ${i.length} price records!`;d.success(Ne),b.invalidateQueries({queryKey:["diamond-prices"]}),r==="pear"&&O(null),r==="round"&&z(null)}catch(s){console.error("Upload error:",s),d.error(s.message||"Failed to upload CSV")}finally{K(!1)}},_e=async()=>{if(confirm("Are you sure you want to delete ALL diamond prices? This action cannot be undone."))try{const{error:a}=await U.from("diamond_prices").delete().neq("id","00000000-0000-0000-0000-000000000000");if(a)throw a;d.success("All prices deleted successfully"),b.invalidateQueries({queryKey:["diamond-prices"]})}catch(a){console.error("Delete error:",a),d.error("Failed to delete prices")}},ye=()=>{b.invalidateQueries({queryKey:["diamond-prices"]}),b.invalidateQueries({queryKey:["diamond-price-history"]}),d.success("Data refreshed")};return e.jsx(we,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Diamond Price Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Import and manage Rapaport-style diamond pricing data"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Import CSV"]}),e.jsx(D,{children:"Upload a CSV file with diamond pricing data"})]}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs(qe,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsxs(Ve,{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Standard format:"})," shape, carat_range_min, carat_range_max, color_grade, clarity_grade, cut_grade, price_per_carat, currency, notes"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Rapaport format:"})," CutCode, Clarity, Color, CaratMin, CaratMax, Price, Date"]}),e.jsx("div",{className:"text-muted-foreground mt-1",children:"Supports both formats automatically"})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"secondary",children:"Fancy Shapes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pear, Princess, Emerald, Cushion, Oval, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"pear-csv",children:"Pear Pricing CSV"}),e.jsx(L,{id:"pear-csv",type:"file",accept:".csv",onChange:a=>{var r;return O(((r=a.target.files)==null?void 0:r[0])||null)}})]}),e.jsx(p,{onClick:()=>ee(Q,"pear"),disabled:!Q||S,className:"w-full",children:S?"Uploading...":"Upload Pear/Fancy Shapes"})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"secondary",children:"Round"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Round brilliant diamonds only"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"round-csv",children:"Round Pricing CSV"}),e.jsx(L,{id:"round-csv",type:"file",accept:".csv",onChange:a=>{var r;return z(((r=a.target.files)==null?void 0:r[0])||null)}})]}),e.jsx(p,{onClick:()=>ee($,"round"),disabled:!$||S,className:"w-full",children:S?"Uploading...":"Upload Round Pricing"})]}),e.jsxs(p,{onClick:je,variant:"outline",className:"w-full",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]}),e.jsxs(R,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Database Stats"}),e.jsx(D,{children:"Current pricing data summary"})]}),e.jsx(p,{onClick:ye,variant:"outline",size:"icon",disabled:M,children:e.jsx(Re,{className:`h-4 w-4 ${M?"animate-spin":""}`})})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Entries"}),e.jsx("p",{className:"text-2xl font-bold",children:C})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unique Shapes"}),e.jsx("p",{className:"text-2xl font-bold",children:o?new Set(o.map(a=>a.shape)).size:0})]})]}),e.jsxs(p,{onClick:_e,variant:"destructive",className:"w-full",disabled:C===0,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Delete All Prices"]})]})]})]}),e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Search & Filter"]}),e.jsx(D,{children:"Filter diamond prices by shape, grades, and carat range"})]}),e.jsx(T,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Shape"}),e.jsxs(E,{value:f,onValueChange:X,children:[e.jsx(I,{children:e.jsx(H,{placeholder:"All shapes"})}),e.jsxs(B,{children:[e.jsx(g,{value:"",children:"All shapes"}),oe.map(a=>e.jsx(g,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Color Grade"}),e.jsxs(E,{value:_,onValueChange:Z,children:[e.jsx(I,{children:e.jsx(H,{placeholder:"All colors"})}),e.jsxs(B,{children:[e.jsx(g,{value:"",children:"All colors"}),xe.map(a=>e.jsx(g,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Clarity Grade"}),e.jsxs(E,{value:y,onValueChange:J,children:[e.jsx(I,{children:e.jsx(H,{placeholder:"All clarities"})}),e.jsxs(B,{children:[e.jsx(g,{value:"",children:"All clarities"}),me.map(a=>e.jsx(g,{value:a,children:a},a))]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Carat Range Min"}),e.jsx(L,{type:"number",step:"0.01",placeholder:"e.g., 0.50",value:v,onChange:a=>W(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Carat Range Max"}),e.jsx(L,{type:"number",step:"0.01",placeholder:"e.g., 1.00",value:N,onChange:a=>Y(a.target.value)})]})]}),pe&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsxs(h,{variant:"secondary",children:[C," ",C===1?"result":"results"," found"]}),e.jsxs(p,{onClick:he,variant:"ghost",size:"sm",className:"h-8",children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]})]})})]}),e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Diamond Pricing Data"]}),e.jsx(D,{children:"View current prices and update history"})]}),e.jsx(T,{children:e.jsxs(Me,{defaultValue:"current",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-2",children:[e.jsx(ce,{value:"current",children:"Current Prices"}),e.jsx(ce,{value:"history",children:"Update History"})]}),e.jsx(ie,{value:"current",children:M?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):C===0?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No pricing data yet. Upload a CSV to get started."}):e.jsxs("div",{className:"border rounded-lg overflow-auto max-h-[500px]",children:[e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(q,{children:[e.jsx(n,{children:"Shape"}),e.jsx(n,{children:"Carat Range"}),e.jsx(n,{children:"Color"}),e.jsx(n,{children:"Clarity"}),e.jsx(n,{children:"Cut"}),e.jsx(n,{className:"text-right",children:"Price/Carat"})]})}),e.jsx(le,{children:o.slice(0,V).map(a=>e.jsxs(q,{children:[e.jsx(l,{children:e.jsx(h,{variant:"outline",children:a.shape})}),e.jsxs(l,{children:[a.carat_range_min," - ",a.carat_range_max]}),e.jsx(l,{children:a.color_grade}),e.jsx(l,{children:a.clarity_grade}),e.jsx(l,{children:a.cut_grade}),e.jsxs(l,{className:"text-right font-mono",children:[a.currency," ",a.price_per_carat.toLocaleString()]})]},a.id))})]}),o.length>V&&e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",V," of ",o.length," entries"]}),e.jsx(p,{variant:"outline",onClick:()=>de(a=>Math.min(a+100,o.length)),children:"Load More (100)"})]})]})}),e.jsx(ie,{value:"history",children:ue?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading history..."}):!k||k.length===0?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No price updates recorded yet."}):e.jsxs("div",{className:"border rounded-lg overflow-auto max-h-[500px]",children:[e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(q,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Shape"}),e.jsx(n,{children:"Grades"}),e.jsx(n,{children:"Change"}),e.jsx(n,{className:"text-right",children:"Old Price"}),e.jsx(n,{className:"text-right",children:"New Price"}),e.jsx(n,{children:"Type"})]})}),e.jsx(le,{children:k.map(a=>{const r=a.old_price_per_carat?(a.new_price_per_carat-a.old_price_per_carat)/a.old_price_per_carat*100:0,s=r>0;return e.jsxs(q,{children:[e.jsx(l,{className:"text-sm",children:new Date(a.changed_at).toLocaleString()}),e.jsx(l,{children:e.jsx(h,{variant:"outline",children:a.shape})}),e.jsxs(l,{className:"text-sm",children:[a.color_grade,"/",a.clarity_grade,"/",a.cut_grade,e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.carat_range_min,"-",a.carat_range_max,"ct"]})]}),e.jsx(l,{children:a.change_type==="insert"?e.jsx(h,{variant:"secondary",children:"New"}):a.change_type==="delete"?e.jsx(h,{variant:"destructive",children:"Deleted"}):r!==0?e.jsxs("div",{className:"flex items-center gap-1",children:[s?e.jsx(Ue,{className:"h-4 w-4 text-green-500"}):e.jsx(Le,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:s?"text-green-600":"text-red-600",children:[s?"+":"",r.toFixed(1),"%"]})]}):e.jsx("span",{className:"text-muted-foreground",children:"No change"})}),e.jsx(l,{className:"text-right font-mono text-sm",children:a.old_price_per_carat?`${a.currency} ${a.old_price_per_carat.toLocaleString()}`:"-"}),e.jsxs(l,{className:"text-right font-mono text-sm",children:[a.currency," ",a.new_price_per_carat.toLocaleString()]}),e.jsx(l,{children:e.jsx(h,{variant:a.change_type==="insert"?"default":a.change_type==="delete"?"destructive":"secondary",children:a.change_type})})]},a.id)})})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-3 border-t",children:"Showing last 100 updates"})]})})]})})]})]})})};export{la as default};
//# sourceMappingURL=AdminDiamondPrices-C7oW24Hs.js.map
