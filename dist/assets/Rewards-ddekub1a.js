import{j as e}from"./query-vendor-BLxHmmGk.js";import{r as h,u as F}from"./react-vendor-BeR0k5Z3.js";import{u as q}from"./useRewardsSystem-d5GTIiEP.js";import{u as Y}from"./useMilestones-Bt2TalEd.js";import{s as b,C as d,i as l,k as m,l as x,g as p,B as A,h as K,A as C}from"./index-CX6yiz0b.js";import{B as v}from"./badge-45Abp579.js";import{P as $}from"./progress-CjUz6kiI.js";import{k as N}from"./proxy-8agjeDDu.js";import{D as J,aH as O,L as Q,P as w,G as g,E as V,au as _,e as k,aI as W,m as P,av as X}from"./ui-vendor-DjQqXt9S.js";import{f as S}from"./format-sTPjOSS_.js";import"./supabase-vendor-VSDMYZ1k.js";import"./en-US-DWrl2lTx.js";const Z=()=>{const[r,o]=h.useState([]),[t,c]=h.useState(!0);h.useEffect(()=>{i()},[]);const i=async()=>{try{const{data:{user:n}}=await b.auth.getUser();if(!n)return;const{data:j,error:f}=await b.from("redemptions").select("*").eq("user_id",n.id).order("redeemed_at",{ascending:!1});if(f)throw f;o(j||[])}catch(n){console.error("Error fetching redemptions:",n)}finally{c(!1)}};return{redemptions:r,loading:t,refetch:i}},ee=r=>({extra_products:w,extra_share_links:Q,premium_support:O})[r]||g,se=({reward:r,userPoints:o,onRedeem:t,isRedeeming:c})=>{const i=o>=r.points_cost,n=ee(r.reward_type);return e.jsx(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},children:e.jsxs(d,{className:`relative overflow-hidden ${i?"":"opacity-60"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-primary/10 to-accent/10 rounded-full blur-3xl"}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center mb-3",children:e.jsx(n,{className:"h-6 w-6 text-primary"})}),e.jsxs(v,{variant:i?"default":"secondary",children:[r.points_cost," points"]})]}),e.jsx(m,{className:"text-lg",children:r.name}),r.description&&e.jsx(x,{children:r.description})]}),e.jsx(p,{children:e.jsx(A,{onClick:()=>t(r.id),disabled:!i||c,className:"w-full",variant:i?"default":"outline",children:c?"Redeeming...":i?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Redeem Now"]}):"Not Enough Points"})})]})})},he=()=>{const r=F(),{toast:o}=K(),{points:t,history:c,loading:i,refetch:n}=q(),{milestones:j,loading:f}=Y(),{refetch:E}=Z(),[M,L]=h.useState([]),[T,R]=h.useState(null),I=i||f;h.useEffect(()=>{B()},[]);const B=async()=>{const{data:s,error:a}=await b.from("rewards_catalog").select("*").eq("is_active",!0).order("points_cost",{ascending:!0});!a&&s&&L(s)},U=async s=>{R(s);try{const{data:a,error:y}=await b.functions.invoke("redeem-reward",{body:{reward_id:s}});if(y)throw y;o({title:"Reward Redeemed!",description:"Your reward has been successfully applied to your account."}),await n(),await E()}catch(a){o({title:"Redemption Failed",description:a.message||"Unable to redeem reward. Please try again.",variant:"destructive"})}finally{R(null)}},z=s=>{const a={bronze:"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400",silver:"bg-gray-100 text-gray-700 dark:bg-gray-800/20 dark:text-gray-400",gold:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400",platinum:"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400"};return a[s]||a.bronze},D=s=>({bronze:{next:"Silver",points:500},silver:{next:"Gold",points:2e3},gold:{next:"Platinum",points:5e3},platinum:{next:"Legend",points:1e4}})[s]||{next:"Silver",points:500},G=s=>({product_added:w,share_link_created:P,product_viewed:X,first_product:w,profile_completed:g})[s]||k;if(I)return e.jsx(C,{children:e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-10 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-40 bg-muted rounded"}),e.jsx("div",{className:"h-60 bg-muted rounded"})]})})})});const u=t?D(t.current_tier):null,H=t&&u?t.total_points/u.points*100:0;return e.jsx(C,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-muted/10 to-background",children:e.jsxs("div",{className:"container mx-auto max-w-6xl p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>r("/catalog"),children:e.jsx(V,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Rewards & Achievements"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your progress and earn rewards"})]})]}),t&&e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(d,{className:"bg-gradient-to-br from-primary/10 via-background to-accent/10 border-primary/20",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center",children:e.jsx(_,{className:"h-8 w-8 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsxs(m,{className:"text-2xl",children:[t.total_points.toLocaleString()," Points"]}),e.jsx(x,{children:"Your total reward points"})]})]}),e.jsx(v,{className:z(t.current_tier),variant:"secondary",children:t.current_tier.toUpperCase()})]})}),u&&t.current_tier!=="platinum"&&e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Progress to ",u.next]}),e.jsxs("span",{className:"font-medium",children:[u.points-t.total_points," points to go"]})]}),e.jsx($,{value:Math.min(H,100),className:"h-3"})]})})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsxs(l,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-primary"}),"Achievements"]}),e.jsx(x,{children:"Milestones you've unlocked"})]}),e.jsx(p,{children:j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No achievements yet. Keep growing!"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:j.map((s,a)=>e.jsxs(N.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(_,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.milestone_type.replace(/_/g," ").toUpperCase()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S(new Date(s.achieved_at),"MMM d, yyyy")})]}),e.jsxs(v,{variant:"secondary",className:"flex-shrink-0",children:["+",s.points_awarded," pts"]})]},s.id))})})]}),e.jsxs(d,{children:[e.jsxs(l,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-primary"}),"Recent Activity"]}),e.jsx(x,{children:"Points you've earned recently"})]}),e.jsx(p,{children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(g,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No activity yet. Start earning points!"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:c.map((s,a)=>{const y=G(s.action_type);return e.jsxs(N.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.action_type.replace(/_/g," ").toUpperCase()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S(new Date(s.created_at),"MMM d, yyyy h:mm a")})]}),e.jsxs(v,{variant:s.points>0?"default":"secondary",className:"flex-shrink-0",children:[s.points>0?"+":"",s.points," pts"]})]},s.id)})})})]})]}),e.jsxs(d,{children:[e.jsxs(l,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),"Redeem Rewards"]}),e.jsx(x,{children:"Exchange your points for exclusive perks"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(s=>e.jsx(se,{reward:s,userPoints:(t==null?void 0:t.total_points)||0,onRedeem:U,isRedeeming:T===s.id},s.id))})})]}),e.jsxs(d,{children:[e.jsxs(l,{children:[e.jsx(m,{children:"How to Earn Points"}),e.jsx(x,{children:"Actions that reward you with points"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[{action:"Add a product",points:10,icon:w},{action:"Create share link",points:20,icon:P},{action:"Complete profile",points:30,icon:g},{action:"First product",points:50,icon:k}].map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border border-border bg-muted/30 hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.action}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",s.points," points"]})]})]},s.action))})})]})]})})})};export{he as default};
//# sourceMappingURL=Rewards-ddekub1a.js.map
